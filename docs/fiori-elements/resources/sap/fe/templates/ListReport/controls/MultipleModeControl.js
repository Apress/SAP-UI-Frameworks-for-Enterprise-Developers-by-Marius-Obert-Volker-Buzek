/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/MessageStrip","sap/fe/core/helpers/ResourceModelHelper","sap/m/IconTabFilter","sap/ui/core/Control","sap/ui/core/Core","sap/ui/fl/write/api/ControlPersonalizationWriteAPI","sap/ui/model/json/JSONModel"],function(e,t,n,i,o,r,l,s,a,u,c){"use strict";var d,f,g,h,p,v,C,b,y,_,m,I,T,F,A,w,M;var S=r.getResourceModel;var z=i.property;var P=i.event;var O=i.defineUI5Class;var E=i.association;var R=i.aggregation;function B(e,t,n,i){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function D(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function K(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;L(e,t)}function L(e,t){L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return L(e,t)}function V(e,t,n,i,o){var r={};Object.keys(i).forEach(function(e){r[e]=i[e]});r.enumerable=!!r.enumerable;r.configurable=!!r.configurable;if("value"in r||r.initializer){r.writable=true}r=n.slice().reverse().reduce(function(n,i){return i(e,t,n)||n},r);if(o&&r.initializer!==void 0){r.value=r.initializer?r.initializer.call(o):void 0;r.initializer=undefined}if(r.initializer===void 0){Object.defineProperty(e,t,r);r=null}return r}function N(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var j;(function(e){e["Suspend"]="suspendBinding";e["Resume"]="resumeBinding"})(j||(j={}));let x=(d=O("sap.fe.templates.ListReport.controls.MultipleModeControl"),f=z({type:"boolean"}),g=z({type:"boolean",defaultValue:false}),h=z({type:"boolean",defaultValue:false}),p=R({type:"sap.m.IconTabBar",multiple:false,isDefault:true}),v=E({type:"sap.ui.core.Control",multiple:true}),C=E({type:"sap.fe.core.controls.FilterBar",multiple:false}),b=P(),d(y=(_=function(i){K(r,i);function r(){var e;for(var t=arguments.length,n=new Array(t),o=0;o<t;o++){n[o]=arguments[o]}e=i.call(this,...n)||this;B(e,"showCounts",m,D(e));B(e,"freezeContent",I,D(e));B(e,"countsOutDated",T,D(e));B(e,"content",F,D(e));B(e,"innerControls",A,D(e));B(e,"filterControl",w,D(e));B(e,"select",M,D(e));return e}var s=r.prototype;s.onBeforeRendering=function e(){this.getTabsModel();const t=this._getFilterControl();if(!t){this.setCountsOutDated(true)}const n=t===null||t===void 0?void 0:t.getParent();this.getAllInnerControls().forEach(e=>{var t;if(this.showCounts){e.attachEvent("internalDataRequested",this._refreshTabsCount.bind(this))}(t=e.suspendBinding)===null||t===void 0?void 0:t.call(e)});if(n){n.attachEvent("internalSearch",this._onSearch.bind(this));n.attachEvent("internalFilterChanged",this._onFilterChanged.bind(this))}};s.onAfterRendering=function e(){var t,n;(t=this.getSelectedInnerControl())===null||t===void 0?void 0:(n=t.resumeBinding)===null||n===void 0?void 0:n.call(t,!this.getProperty("freezeContent"))};r.render=function e(t,n){t.renderControl(n.content)};s.getTabsModel=function e(){const t="tabsInternal";const n=this.content;if(!n){return undefined}let i=n.getModel(t);if(!i){i=new c({});n.setModel(i,t)}return i};s.getSelectedInnerControl=function e(){var t;const n=(t=this.content)===null||t===void 0?void 0:t.getItems().find(e=>e.getKey()===this.content.getSelectedKey());return n?this.getAllInnerControls().find(e=>this._getTabFromInnerControl(e)===n):undefined};r.handleTabChange=function e(t){var n,i;const o=t.getSource();const r=o.getParent();const l=t.getParameters();r._setInnerBinding(true);const s=l===null||l===void 0?void 0:l.previousKey;const a=l===null||l===void 0?void 0:l.selectedKey;if(a&&s!==a){const e=r._getFilterControl();if(e&&!r.getProperty("freezeContent")){if(!r.getSelectedInnerControl()){r._refreshCustomView(e.getFilterConditions(),"tabChanged")}}u.add({changes:[{changeSpecificData:{changeType:"selectIconTabBarFilter",content:{selectedKey:a,previousSelectedKey:s}},selectorElement:o}]})}(n=r._getViewController())===null||n===void 0?void 0:(i=n.getExtensionAPI())===null||i===void 0?void 0:i.updateAppState();r.fireEvent("select",{iconTabBar:o,selectedKey:a,previousKey:s})};s.invalidateContent=function e(){this.setCountsOutDated(true);this.getAllInnerControls().forEach(e=>{var t;(t=e.invalidateContent)===null||t===void 0?void 0:t.call(e)})};s.setCountsOutDated=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.setProperty("countsOutDated",t);if(t&&!this.getSelectedInnerControl()){this._refreshTabsCount()}};s.setFreezeContent=function e(t){this.setProperty("freezeContent",t);this._setInnerBinding()};s._updateMultiTabNotApplicableFields=function e(){const t=this.getTabsModel();const n=this._getFilterControl();if(t&&n){const e={};this.getAllInnerControls().forEach(t=>{const i=this._getTabFromInnerControl(t);if(i){var o;const r=i.getKey();const l=((o=t.refreshNotApplicableFields)===null||o===void 0?void 0:o.call(t,n))||[];e[r]={notApplicable:{fields:l,title:this._setTabMessageStrip({entityTypePath:n.data("entityType"),ignoredFields:l,title:i.getText()})}};if(t&&t.isA("sap.fe.macros.chart.ChartAPI")){e[r]=this.checkNonFilterableEntitySet(t,r,e)}}});t.setData(e)}};s.checkNonFilterableEntitySet=function e(t,i,o){var r,l,s,a,u;const c=S(t);const d=t!==null&&t!==void 0&&t.getContent?t.getContent():undefined;const f=d&&((r=n.getInvolvedDataModelObjects(d.getModel().getMetaModel().getContext(`${d.data("targetCollectionPath")}`)))===null||r===void 0?void 0:(l=r.targetObject)===null||l===void 0?void 0:(s=l.annotations)===null||s===void 0?void 0:(a=s.Capabilities)===null||a===void 0?void 0:(u=a.FilterRestrictions)===null||u===void 0?void 0:u.Filterable);if(f!==undefined&&!f){if(o[i].notApplicable.fields.indexOf("$search")>-1){o[i].notApplicable.title+=" "+c.getText("C_LR_MULTIVIZ_CHART_MULTI_NON_FILTERABLE")}else{o[i].notApplicable.fields=["nonFilterable"];o[i].notApplicable.title=c.getText("C_LR_MULTIVIZ_CHART_MULTI_NON_FILTERABLE")}}return o[i]};s.getAllInnerControls=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return this.innerControls.reduce((e,n)=>{const i=a.byId(n);if(i){e.push(i)}return e.filter(e=>{var n;return!t||((n=this._getTabFromInnerControl(e))===null||n===void 0?void 0:n.getVisible())})},[])||[]};s._getFilterControl=function e(){return a.byId(this.filterControl)};s._getTabFromInnerControl=function e(t){const n=l.getMetadata().getName();let i=t;if(i&&!i.isA(n)&&i.getParent){i=t.getParent()}return i&&i.isA(n)?i:undefined};s._getViewController=function e(){const n=t.getTargetView(this);return n&&n.getController()};s._refreshCustomView=function e(t,n){var i,o;(i=this._getViewController())===null||i===void 0?void 0:(o=i.onViewNeedsRefresh)===null||o===void 0?void 0:o.call(i,{filterConditions:t,currentTabId:this.content.getSelectedKey(),refreshCause:n})};s._refreshTabsCount=function t(n){var i,o;const r=n===null||n===void 0?void 0:n.getSource();const l=r?(i=this._getTabFromInnerControl(r))===null||i===void 0?void 0:i.getKey():(o=this.content)===null||o===void 0?void 0:o.getSelectedKey();this.getAllInnerControls(true).forEach(t=>{const n=this._getTabFromInnerControl(t);if(t!==null&&t!==void 0&&t.getCounts&&(this.countsOutDated||l===(n===null||n===void 0?void 0:n.getKey()))){if(n&&n.setCount){n.setCount("...");t.getCounts().then(e=>n.setCount(e||"0")).catch(function(t){e.error("Error while requesting Counts for Control",t)})}}});this.setCountsOutDated(false)};s._setInnerBinding=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.content){this.getAllInnerControls().forEach(e=>{var n;const i=this._getTabFromInnerControl(e);const o=(i===null||i===void 0?void 0:i.getKey())===this.content.getSelectedKey();const r=o&&!this.getProperty("freezeContent")?j.Resume:j.Suspend;(n=e[r])===null||n===void 0?void 0:n.call(e,r===j.Resume?t&&o:undefined)})}};s._setTabMessageStrip=function e(t){let n="";const i=t.ignoredFields;const r=this._getFilterControl();if(r&&Array.isArray(i)&&i.length>0&&t.title){const e=o.getLabels(i,t.entityTypePath,r,S(r));n=o.getText(e,r,t.title);return n}};s._onSearch=function e(t){this.setCountsOutDated(true);this.setFreezeContent(false);if(this.getSelectedInnerControl()){this._updateMultiTabNotApplicableFields()}else{this._refreshCustomView(t.getParameter("conditions"),"search")}};s._onFilterChanged=function e(t){if(t.getParameter("conditionsBased")){this.setFreezeContent(true)}};return r}(s),m=V(_.prototype,"showCounts",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),I=V(_.prototype,"freezeContent",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),T=V(_.prototype,"countsOutDated",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),F=V(_.prototype,"content",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),A=V(_.prototype,"innerControls",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),w=V(_.prototype,"filterControl",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),M=V(_.prototype,"select",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),_))||y);return x},false);