/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/SemanticObjectHelper","sap/fe/macros/field/FieldTemplating","sap/fe/core/buildingBlocks/BuildingBlockBase","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/BuildingBlockTemplateProcessor"],function(e,t,i,n,a,o,r,c){"use strict";var s,l,u,d,p,f,m,v,b;var g={};var y=c.xml;var O=r.defineBuildingBlock;var j=r.blockAttribute;var h=a.isUsedInNavigationWithQuickViewFacets;var P=a.getPropertyWithSemanticObject;var k=a.getDataModelObjectPathForValue;var S=n.getSemanticObjectUnavailableActions;var w=n.getSemanticObjects;var F=n.getSemanticObjectMappings;var T=n.getDynamicPathFromSemanticObject;var x=i.isProperty;var E=t.pathInModel;var D=t.getExpressionFromAnnotation;var Q=t.compileExpression;function V(e,t,i,n){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function B(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function L(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;M(e,t)}function M(e,t){M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return M(e,t)}function $(e,t,i,n,a){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o);if(a&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(a):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function U(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let z=(s=O({name:"QuickView",namespace:"sap.fe.macros",designtime:"sap/fe/macros/quickView/QuickView.designtime"}),l=j({type:"sap.ui.model.Context",required:true,expectedTypes:["Property"],expectedAnnotationTypes:["com.sap.vocabularies.UI.v1.DataField","com.sap.vocabularies.UI.v1.DataFieldWithUrl","com.sap.vocabularies.UI.v1.DataFieldForAnnotation","com.sap.vocabularies.UI.v1.DataPointType"]}),u=j({type:"sap.ui.model.Context",required:true,expectedTypes:["EntitySet","NavigationProperty","EntityType","Singleton"]}),d=j({type:"string"}),s(p=(f=function(t){L(i,t);i.getRelativePathToQuickViewEntity=function e(t){let i;const n=this.getNavPropToQuickViewEntity(t);if(n){i=t.navigationProperties.reduce((e,i)=>{var a;if(i.name!==n.name&&!((a=t.contextLocation)!==null&&a!==void 0&&a.navigationProperties.find(e=>e.name===i.name))){return`${e}${i.name}/`}return e},"");i=`${i}${n.name}`}return i};i.getSemanticObjectsForPayloadAndQualifierMap=function e(t){const i={};const n=[];if(t!==undefined){for(const e of w(t)){const t=Q(D(e));if(t&&!n.includes(t)){i[e.qualifier||""]=t;n.push(t)}}}return{semanticObjectsList:n,qualifierMap:i}};i.getSemanticObjectMappingsForPayload=function e(t,i){const n=[];if(t!==undefined){for(const e of F(t)){const t=i[e.qualifier||""];if(t){n.push({semanticObject:t,items:e.map(e=>({key:e.LocalProperty.value,value:e.SemanticObjectProperty.valueOf()}))})}}}return n};i.getSemanticObjectUnavailableActionsForPayload=function e(t,i){const n=[];if(t!==undefined){for(const e of S(t)){const t=i[e.qualifier||""];if(t){n.push({semanticObject:t,actions:e.map(e=>e)})}}}return n};i.addCustomSemanticObjectToSemanticObjectListForPayload=function e(t,i){if(i){if(!i.startsWith("[")){if(!t.includes(i)){t.push(i)}}else{for(const e of JSON.parse(i)){if(!t.includes(e)){t.push(e)}}}}};i.getNavPropToQuickViewEntity=function e(t){var i;const n=t.targetObject;const a=t.targetEntityType.navigationProperties;let o=a.find(e=>e.referentialConstraint.some(t=>{var i;return t.sourceProperty===n.name&&((i=e.targetType.annotations.UI)===null||i===void 0?void 0:i.QuickViewFacets)}));if(!o&&((i=t.contextLocation)===null||i===void 0?void 0:i.targetEntitySet)!==t.targetEntitySet){var r,c;const e=((r=t.targetEntityType.annotations.Common)===null||r===void 0?void 0:r.SemanticKey)||[];const i=e.some(function(e){return e.$target.name===n.name});const a=t.navigationProperties[t.navigationProperties.length-1];if((i||n.isKey)&&(c=t.targetEntityType.annotations.UI)!==null&&c!==void 0&&c.QuickViewFacets){o=a}}return o};function i(n,a,o){var r,c,s,l,u;var d;d=t.call(this,n,a,o)||this;V(d,"dataField",m,B(d));V(d,"contextPath",v,B(d));V(d,"semanticObject",b,B(d));let p=e.getInvolvedDataModelObjects(d.dataField,d.contextPath);const f=k(p);p=f||p;const g=x(p.targetObject)?p.targetObject:undefined;const y=g&&h(p,g)?"true":"false";const O=i.getRelativePathToQuickViewEntity(p);const j=((r=p.contextLocation)===null||r===void 0?void 0:(c=r.targetEntitySet)===null||c===void 0?void 0:c.name)??((s=p.contextLocation)===null||s===void 0?void 0:s.targetObject).fullyQualifiedName;const S=O?`/${j}/${O}`:undefined;const w=O?Q(E(O)):undefined;const F=P(p);let T;const{semanticObjectsList:D,qualifierMap:L}=i.getSemanticObjectsForPayloadAndQualifierMap(F);const M=i.getSemanticObjectMappingsForPayload(F,L);const $=i.getSemanticObjectUnavailableActionsForPayload(F,L);if(x(F)){T=L.main||L[""]}i.addCustomSemanticObjectToSemanticObjectListForPayload(D,d.semanticObject);const U=(g===null||g===void 0?void 0:(l=g.annotations.Common)===null||l===void 0?void 0:(u=l.Label)===null||u===void 0?void 0:u.valueOf())||"";d.payload={semanticObjects:D,entityType:S,semanticObjectUnavailableActions:$,semanticObjectMappings:M,mainSemanticObject:T,propertyPathLabel:U,dataField:S===undefined?d.dataField.getPath():undefined,contact:undefined,navigationPath:w,hasQuickViewFacets:y};return d}g=i;var n=i.prototype;n.getTemplate=function e(){const t={name:"sap/fe/macros/quickView/QuickViewDelegate",payload:this.payload};return y`<mdc:Link xmlns:mdc="sap.ui.mdc" delegate="${JSON.stringify(t)}">
			${this.writeCustomData(this.payload.semanticObjects)}
			</mdc:Link>`};n.writeCustomData=function e(t){let i="";for(const e of t){const t=T(e);if(t){i=`${i}\n\t\t\t\t<core:CustomData xmlns:core="sap.ui.core" key="${t}" value="${e}" />`}}if(i.length){return`<mdc:customData>\n\t\t\t\t${i}\n\t\t\t</mdc:customData>`}return""};return i}(o),m=$(f.prototype,"dataField",[l],{configurable:true,enumerable:true,writable:true,initializer:null}),v=$(f.prototype,"contextPath",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),b=$(f.prototype,"semanticObject",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),f))||p);g=z;return g},false);