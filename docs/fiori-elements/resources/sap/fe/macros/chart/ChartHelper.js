/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/macros/CommonHelper","sap/fe/macros/internal/helpers/ActionHelper","sap/ui/model/json/JSONModel","sap/ui/model/odata/v4/AnnotationHelper"],function(e,a,t,o,r,i){"use strict";var n=a.getUiControl;function s(e){return e.getPath().replace(/@com.sap.vocabularies.UI.v1.(Chart|PresentationVariant).*/,"")}var c;(function(e){e["com.sap.vocabularies.UI.v1.ChartType/Column"]="column";e["com.sap.vocabularies.UI.v1.ChartType/ColumnStacked"]="stacked_column";e["com.sap.vocabularies.UI.v1.ChartType/ColumnDual"]="dual_column";e["com.sap.vocabularies.UI.v1.ChartType/ColumnStackedDual"]="dual_stacked_column";e["com.sap.vocabularies.UI.v1.ChartType/ColumnStacked100"]="100_stacked_column";e["com.sap.vocabularies.UI.v1.ChartType/ColumnStackedDual100"]="100_dual_stacked_column";e["com.sap.vocabularies.UI.v1.ChartType/Bar"]="bar";e["com.sap.vocabularies.UI.v1.ChartType/BarStacked"]="stacked_bar";e["com.sap.vocabularies.UI.v1.ChartType/BarDual"]="dual_bar";e["com.sap.vocabularies.UI.v1.ChartType/BarStackedDual"]="dual_stacked_bar";e["com.sap.vocabularies.UI.v1.ChartType/BarStacked100"]="100_stacked_bar";e["com.sap.vocabularies.UI.v1.ChartType/BarStackedDual100"]="100_dual_stacked_bar";e["com.sap.vocabularies.UI.v1.ChartType/Area"]="area";e["com.sap.vocabularies.UI.v1.ChartType/AreaStacked"]="stacked_column";e["com.sap.vocabularies.UI.v1.ChartType/AreaStacked100"]="100_stacked_column";e["com.sap.vocabularies.UI.v1.ChartType/HorizontalArea"]="bar";e["com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked"]="stacked_bar";e["com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked100"]="100_stacked_bar";e["com.sap.vocabularies.UI.v1.ChartType/Line"]="line";e["com.sap.vocabularies.UI.v1.ChartType/LineDual"]="dual_line";e["com.sap.vocabularies.UI.v1.ChartType/Combination"]="combination";e["com.sap.vocabularies.UI.v1.ChartType/CombinationStacked"]="stacked_combination";e["com.sap.vocabularies.UI.v1.ChartType/CombinationDual"]="dual_combination";e["com.sap.vocabularies.UI.v1.ChartType/CombinationStackedDual"]="dual_stacked_combination";e["com.sap.vocabularies.UI.v1.ChartType/HorizontalCombinationStacked"]="horizontal_stacked_combination";e["com.sap.vocabularies.UI.v1.ChartType/Pie"]="pie";e["com.sap.vocabularies.UI.v1.ChartType/Donut"]="donut";e["com.sap.vocabularies.UI.v1.ChartType/Scatter"]="scatter";e["com.sap.vocabularies.UI.v1.ChartType/Bubble"]="bubble";e["com.sap.vocabularies.UI.v1.ChartType/Radar"]="line";e["com.sap.vocabularies.UI.v1.ChartType/HeatMap"]="heatmap";e["com.sap.vocabularies.UI.v1.ChartType/TreeMap"]="treemap";e["com.sap.vocabularies.UI.v1.ChartType/Waterfall"]="waterfall";e["com.sap.vocabularies.UI.v1.ChartType/Bullet"]="bullet";e["com.sap.vocabularies.UI.v1.ChartType/VerticalBullet"]="vertical_bullet";e["com.sap.vocabularies.UI.v1.ChartType/HorizontalWaterfall"]="horizontal_waterfall";e["com.sap.vocabularies.UI.v1.ChartType/HorizontalCombinationDual"]="dual_horizontal_combination";e["com.sap.vocabularies.UI.v1.ChartType/HorizontalCombinationStackedDual"]="dual_horizontal_stacked_combination"})(c||(c={}));var l;(function(e){e["com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Category"]="category";e["com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"]="series";e["com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Category2"]="category2"})(l||(l={}));const u={formatJSONToString(e){if(!e){return undefined}let a=JSON.stringify(e);a=a.replace(new RegExp("{","g"),"\\{");a=a.replace(new RegExp("}","g"),"\\}");return a},formatChartType(e){return c[e===null||e===void 0?void 0:e.$EnumMember]},formatDimensions(a){const t=a.getObject("./"),o=a.getModel(),i=s(a),n=[];let c=false;t.DimensionAttributes=t.DimensionAttributes||[];for(const a of t.Dimensions){const r=a.$PropertyPath;const s=o.getObject(`${i+r}@${"com.sap.vocabularies.Common.v1.Text"}`)||{};if(r.indexOf("/")>-1){e.error(`$expand is not yet supported. Dimension: ${r} from an association cannot be used`)}if(s.$Path&&s.$Path.indexOf("/")>-1){e.error(`$expand is not yet supported. Text Property: ${s.$Path} from an association cannot be used for the dimension ${r}`);c=true}const v={key:r,textPath:!c?s.$Path:undefined,label:o.getObject(`${i+r}@${"com.sap.vocabularies.Common.v1.Label"}`),role:"category"};for(const e of t.DimensionAttributes){var u;if(v.key===((u=e.Dimension)===null||u===void 0?void 0:u.$PropertyPath)){var p;v.role=l[(p=e.Role)===null||p===void 0?void 0:p.$EnumMember]||v.role;break}}v.criticality=this.fetchCriticality(o,o.createBindingContext(i+r)).then(this.formatJSONToString);n.push(v)}const v=new r(n);v.$$valueAsPromise=true;return v.createBindingContext("/")},fetchCriticality(e,a){const t="@com.sap.vocabularies.UI.v1";return e.requestObject(`${t}.ValueCriticality`,a).then(function(e){let a,t;if(e){a={VeryPositive:[],Positive:[],Critical:[],VeryNegative:[],Negative:[],Neutral:[]};for(let o=0;o<e.length;o++){t=e[o];if(t.Criticality.$EnumMember.endsWith("VeryPositive")){a.VeryPositive.push(t.Value)}else if(t.Criticality.$EnumMember.endsWith("Positive")){a.Positive.push(t.Value)}else if(t.Criticality.$EnumMember.endsWith("Critical")){a.Critical.push(t.Value)}else if(t.Criticality.$EnumMember.endsWith("VeryNegative")){a.VeryNegative.push(t.Value)}else if(t.Criticality.$EnumMember.endsWith("Negative")){a.Negative.push(t.Value)}else{a.Neutral.push(t.Value)}}for(const e in a){if(a[e].length==0){delete a[e]}}}return a})},formatMeasures(e){return e.getModel().getData()},getUiChart(e){return n(e,`@${"com.sap.vocabularies.UI.v1.Chart"}`)},getOperationAvailableMap(e,a){const t=(e===null||e===void 0?void 0:e.Actions)||[];return JSON.stringify(o.getOperationAvailableMap(t,"chart",a))},getSortConditions:function(e,a,o,r){if(a&&t._isPresentationVariantAnnotation(o)&&a.SortOrder){const t={sorters:[]};const o=e.getPath(0).split("@")[0];a.SortOrder.forEach(function(){let a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};let i="";const n={};if(a.DynamicProperty){var s;i="_fe_aggregatable_"+((s=e.getModel(0).getObject(o+a.DynamicProperty.$AnnotationPath))===null||s===void 0?void 0:s.Name)}else if(a.Property){const t=r.GroupableProperties;if(t&&t.length){for(let e=0;e<t.length;e++){if(t[e].$PropertyPath===a.Property.$PropertyPath){i="_fe_groupable_"+a.Property.$PropertyPath;break}if(!i){i="_fe_aggregatable_"+a.Property.$PropertyPath}}}else if(e.getModel(0).getObject(`${o+a.Property.$PropertyPath}@${"Org.OData.Aggregation.V1.Groupable"}`)){i="_fe_groupable_"+a.Property.$PropertyPath}else{i="_fe_aggregatable_"+a.Property.$PropertyPath}}if(i){n.name=i;n.descending=!!a.Descending;t.sorters.push(n)}else{throw new Error("Please define the right path to the sort property")}});return JSON.stringify(t)}return undefined},getBindingData(e,a,o){const r=[];let i;for(const e in o){if(o[e].$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){const i=o[e].Action;const n=t.getActionPath(a,false,i,true);if(n&&n.$Path){r.push(`'${n.$Path}'`)}else if(n===null){}}}if(r.length>0){i=" $select: '"+r.join()+"'"}return"'{path: '"+(a.getObject("$kind")==="EntitySet"?"/":"")+a.getObject("@sapui.name")+"'"+(i?",parameters:{"+i+"}":"")+"}'"},_getModel(e,a){return a.context},isDataFieldForActionButtonEnabled(e,a,t,r,i){if(e!==true){return"true"}const n=t.getModel();const s=t.getPath();const c=n.getObject(s).$Partner;const l=r&&JSON.parse(r);const u=l&&l[a]&&l[a].split("/");const p=o.getNumberOfContextsExpression(i);if(u&&u[0]===c){const e=l[a].replace(c+"/","");return"{= ${"+p+" && ${"+e+"}}"}else{return"{= ${"+p+"}"}},getHiddenPathExpressionForTableActionsAndIBN(e,a){const t=a.context,o=t.getPath(),r=i.getNavigationPath(o);if(e.indexOf("/")>0){const a=e.split("/");const o=a[0];if(t.getObject(r+"/$Partner")===o){return"{= !%{"+a.slice(1).join("/")+"} }"}}return true},getPressEventForDataFieldForActionButton(e,a,t){return o.getPressEventDataFieldForActionButton(e,a,{contexts:"${internal>selectedContexts}"},t)},getActionType(e){return(e["$Type"].indexOf("com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")>-1||e["$Type"].indexOf("com.sap.vocabularies.UI.v1.DataFieldForAction")>-1)&&e["Inline"]},getCollectionName(e){return e.split("/")[e.split("/").length-1]}};u.getSortConditions.requiresIContext=true;return u},false);