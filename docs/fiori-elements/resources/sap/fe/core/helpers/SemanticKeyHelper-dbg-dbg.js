/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log"], function (Log) {
  "use strict";

  const SemanticKeyHelper = {
    getSemanticKeys: function (oMetaModel, sEntitySetName) {
      return oMetaModel.getObject(`/${sEntitySetName}/@com.sap.vocabularies.Common.v1.SemanticKey`);
    },
    getSemanticObjectInformation: function (oMetaModel, sEntitySetName) {
      const oSemanticObject = oMetaModel.getObject(`/${sEntitySetName}/@com.sap.vocabularies.Common.v1.SemanticObject`);
      const aSemanticKeys = this.getSemanticKeys(oMetaModel, sEntitySetName);
      return {
        semanticObject: oSemanticObject,
        semanticKeys: aSemanticKeys
      };
    },
    getSemanticPath: function (oContext) {
      let bStrict = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      const oMetaModel = oContext.getModel().getMetaModel(),
        sEntitySetName = oMetaModel.getMetaContext(oContext.getPath()).getObject("@sapui.name"),
        oSemanticObjectInformation = this.getSemanticObjectInformation(oMetaModel, sEntitySetName);
      let sTechnicalPath, sSemanticPath;
      if (oContext.isA("sap.ui.model.odata.v4.ODataListBinding") && oContext.isRelative()) {
        sTechnicalPath = oContext.getHeaderContext().getPath();
      } else {
        sTechnicalPath = oContext.getPath();
      }
      if (this._isPathForSemantic(sTechnicalPath) && oSemanticObjectInformation.semanticKeys) {
        const aSemanticKeys = oSemanticObjectInformation.semanticKeys,
          oEntityType = oMetaModel.getObject(`/${oMetaModel.getObject(`/${sEntitySetName}`).$Type}`);
        try {
          const sSemanticKeysPart = aSemanticKeys.map(function (oSemanticKey) {
            const sPropertyPath = oSemanticKey.$PropertyPath;
            let sKeyValue = oContext.getProperty(sPropertyPath);
            if (sKeyValue === undefined || sKeyValue === null) {
              throw new Error(`Couldn't resolve semantic key value for ${sPropertyPath}`);
            } else {
              if (oEntityType[sPropertyPath].$Type === "Edm.String") {
                sKeyValue = `'${encodeURIComponent(sKeyValue)}'`;
              }
              if (aSemanticKeys.length > 1) {
                // Several semantic keys --> path should be entitySet(key1=value1, key2=value2, ...)
                // Otherwise we keep entitySet(keyValue)
                sKeyValue = `${sPropertyPath}=${sKeyValue}`;
              }
              return sKeyValue;
            }
          }).join(",");
          sSemanticPath = `/${sEntitySetName}(${sSemanticKeysPart})`;
        } catch (e) {
          Log.info(e);
        }
      }
      return bStrict ? sSemanticPath : sSemanticPath || sTechnicalPath;
    },
    // ==============================
    // INTERNAL METHODS
    // ==============================

    _isPathForSemantic: function (sPath) {
      // Only path on root objects allow semantic keys, i.e. sPath = xxx(yyy)
      return /^[^()]+\([^()]+\)$/.test(sPath);
    }
  };
  return SemanticKeyHelper;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTZW1hbnRpY0tleUhlbHBlciIsImdldFNlbWFudGljS2V5cyIsIm9NZXRhTW9kZWwiLCJzRW50aXR5U2V0TmFtZSIsImdldE9iamVjdCIsImdldFNlbWFudGljT2JqZWN0SW5mb3JtYXRpb24iLCJvU2VtYW50aWNPYmplY3QiLCJhU2VtYW50aWNLZXlzIiwic2VtYW50aWNPYmplY3QiLCJzZW1hbnRpY0tleXMiLCJnZXRTZW1hbnRpY1BhdGgiLCJvQ29udGV4dCIsImJTdHJpY3QiLCJnZXRNb2RlbCIsImdldE1ldGFNb2RlbCIsImdldE1ldGFDb250ZXh0IiwiZ2V0UGF0aCIsIm9TZW1hbnRpY09iamVjdEluZm9ybWF0aW9uIiwic1RlY2huaWNhbFBhdGgiLCJzU2VtYW50aWNQYXRoIiwiaXNBIiwiaXNSZWxhdGl2ZSIsImdldEhlYWRlckNvbnRleHQiLCJfaXNQYXRoRm9yU2VtYW50aWMiLCJvRW50aXR5VHlwZSIsIiRUeXBlIiwic1NlbWFudGljS2V5c1BhcnQiLCJtYXAiLCJvU2VtYW50aWNLZXkiLCJzUHJvcGVydHlQYXRoIiwiJFByb3BlcnR5UGF0aCIsInNLZXlWYWx1ZSIsImdldFByb3BlcnR5IiwidW5kZWZpbmVkIiwiRXJyb3IiLCJlbmNvZGVVUklDb21wb25lbnQiLCJsZW5ndGgiLCJqb2luIiwiZSIsIkxvZyIsImluZm8iLCJzUGF0aCIsInRlc3QiXSwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIlNlbWFudGljS2V5SGVscGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBMb2cgZnJvbSBcInNhcC9iYXNlL0xvZ1wiO1xuaW1wb3J0IHR5cGUgT0RhdGFNZXRhTW9kZWwgZnJvbSBcInNhcC91aS9tb2RlbC9vZGF0YS92NC9PRGF0YU1ldGFNb2RlbFwiO1xuXG5jb25zdCBTZW1hbnRpY0tleUhlbHBlciA9IHtcblx0Z2V0U2VtYW50aWNLZXlzOiBmdW5jdGlvbiAob01ldGFNb2RlbDogT0RhdGFNZXRhTW9kZWwsIHNFbnRpdHlTZXROYW1lOiBzdHJpbmcpIHtcblx0XHRyZXR1cm4gb01ldGFNb2RlbC5nZXRPYmplY3QoYC8ke3NFbnRpdHlTZXROYW1lfS9AY29tLnNhcC52b2NhYnVsYXJpZXMuQ29tbW9uLnYxLlNlbWFudGljS2V5YCk7XG5cdH0sXG5cdGdldFNlbWFudGljT2JqZWN0SW5mb3JtYXRpb246IGZ1bmN0aW9uIChvTWV0YU1vZGVsOiBPRGF0YU1ldGFNb2RlbCwgc0VudGl0eVNldE5hbWU6IHN0cmluZykge1xuXHRcdGNvbnN0IG9TZW1hbnRpY09iamVjdCA9IG9NZXRhTW9kZWwuZ2V0T2JqZWN0KGAvJHtzRW50aXR5U2V0TmFtZX0vQGNvbS5zYXAudm9jYWJ1bGFyaWVzLkNvbW1vbi52MS5TZW1hbnRpY09iamVjdGApO1xuXHRcdGNvbnN0IGFTZW1hbnRpY0tleXMgPSB0aGlzLmdldFNlbWFudGljS2V5cyhvTWV0YU1vZGVsLCBzRW50aXR5U2V0TmFtZSk7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHNlbWFudGljT2JqZWN0OiBvU2VtYW50aWNPYmplY3QsXG5cdFx0XHRzZW1hbnRpY0tleXM6IGFTZW1hbnRpY0tleXNcblx0XHR9O1xuXHR9LFxuXHRnZXRTZW1hbnRpY1BhdGg6IGZ1bmN0aW9uIChvQ29udGV4dDogYW55LCBiU3RyaWN0OiBib29sZWFuID0gZmFsc2UpIHtcblx0XHRjb25zdCBvTWV0YU1vZGVsID0gb0NvbnRleHQuZ2V0TW9kZWwoKS5nZXRNZXRhTW9kZWwoKSxcblx0XHRcdHNFbnRpdHlTZXROYW1lID0gb01ldGFNb2RlbC5nZXRNZXRhQ29udGV4dChvQ29udGV4dC5nZXRQYXRoKCkpLmdldE9iamVjdChcIkBzYXB1aS5uYW1lXCIpLFxuXHRcdFx0b1NlbWFudGljT2JqZWN0SW5mb3JtYXRpb24gPSB0aGlzLmdldFNlbWFudGljT2JqZWN0SW5mb3JtYXRpb24ob01ldGFNb2RlbCwgc0VudGl0eVNldE5hbWUpO1xuXHRcdGxldCBzVGVjaG5pY2FsUGF0aCwgc1NlbWFudGljUGF0aDtcblxuXHRcdGlmIChvQ29udGV4dC5pc0EoXCJzYXAudWkubW9kZWwub2RhdGEudjQuT0RhdGFMaXN0QmluZGluZ1wiKSAmJiBvQ29udGV4dC5pc1JlbGF0aXZlKCkpIHtcblx0XHRcdHNUZWNobmljYWxQYXRoID0gb0NvbnRleHQuZ2V0SGVhZGVyQ29udGV4dCgpLmdldFBhdGgoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c1RlY2huaWNhbFBhdGggPSBvQ29udGV4dC5nZXRQYXRoKCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuX2lzUGF0aEZvclNlbWFudGljKHNUZWNobmljYWxQYXRoKSAmJiBvU2VtYW50aWNPYmplY3RJbmZvcm1hdGlvbi5zZW1hbnRpY0tleXMpIHtcblx0XHRcdGNvbnN0IGFTZW1hbnRpY0tleXMgPSBvU2VtYW50aWNPYmplY3RJbmZvcm1hdGlvbi5zZW1hbnRpY0tleXMsXG5cdFx0XHRcdG9FbnRpdHlUeXBlID0gb01ldGFNb2RlbC5nZXRPYmplY3QoYC8ke29NZXRhTW9kZWwuZ2V0T2JqZWN0KGAvJHtzRW50aXR5U2V0TmFtZX1gKS4kVHlwZX1gKTtcblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0Y29uc3Qgc1NlbWFudGljS2V5c1BhcnQgPSBhU2VtYW50aWNLZXlzXG5cdFx0XHRcdFx0Lm1hcChmdW5jdGlvbiAob1NlbWFudGljS2V5OiBhbnkpIHtcblx0XHRcdFx0XHRcdGNvbnN0IHNQcm9wZXJ0eVBhdGggPSBvU2VtYW50aWNLZXkuJFByb3BlcnR5UGF0aDtcblx0XHRcdFx0XHRcdGxldCBzS2V5VmFsdWUgPSBvQ29udGV4dC5nZXRQcm9wZXJ0eShzUHJvcGVydHlQYXRoKTtcblxuXHRcdFx0XHRcdFx0aWYgKHNLZXlWYWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHNLZXlWYWx1ZSA9PT0gbnVsbCkge1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoYENvdWxkbid0IHJlc29sdmUgc2VtYW50aWMga2V5IHZhbHVlIGZvciAke3NQcm9wZXJ0eVBhdGh9YCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZiAob0VudGl0eVR5cGVbc1Byb3BlcnR5UGF0aF0uJFR5cGUgPT09IFwiRWRtLlN0cmluZ1wiKSB7XG5cdFx0XHRcdFx0XHRcdFx0c0tleVZhbHVlID0gYCcke2VuY29kZVVSSUNvbXBvbmVudChzS2V5VmFsdWUpfSdgO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGlmIChhU2VtYW50aWNLZXlzLmxlbmd0aCA+IDEpIHtcblx0XHRcdFx0XHRcdFx0XHQvLyBTZXZlcmFsIHNlbWFudGljIGtleXMgLS0+IHBhdGggc2hvdWxkIGJlIGVudGl0eVNldChrZXkxPXZhbHVlMSwga2V5Mj12YWx1ZTIsIC4uLilcblx0XHRcdFx0XHRcdFx0XHQvLyBPdGhlcndpc2Ugd2Uga2VlcCBlbnRpdHlTZXQoa2V5VmFsdWUpXG5cdFx0XHRcdFx0XHRcdFx0c0tleVZhbHVlID0gYCR7c1Byb3BlcnR5UGF0aH09JHtzS2V5VmFsdWV9YDtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gc0tleVZhbHVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmpvaW4oXCIsXCIpO1xuXG5cdFx0XHRcdHNTZW1hbnRpY1BhdGggPSBgLyR7c0VudGl0eVNldE5hbWV9KCR7c1NlbWFudGljS2V5c1BhcnR9KWA7XG5cdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdExvZy5pbmZvKGUgYXMgYW55KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gYlN0cmljdCA/IHNTZW1hbnRpY1BhdGggOiBzU2VtYW50aWNQYXRoIHx8IHNUZWNobmljYWxQYXRoO1xuXHR9LFxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHQvLyBJTlRFUk5BTCBNRVRIT0RTXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdF9pc1BhdGhGb3JTZW1hbnRpYzogZnVuY3Rpb24gKHNQYXRoOiBhbnkpIHtcblx0XHQvLyBPbmx5IHBhdGggb24gcm9vdCBvYmplY3RzIGFsbG93IHNlbWFudGljIGtleXMsIGkuZS4gc1BhdGggPSB4eHgoeXl5KVxuXHRcdHJldHVybiAvXlteKCldK1xcKFteKCldK1xcKSQvLnRlc3Qoc1BhdGgpO1xuXHR9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTZW1hbnRpY0tleUhlbHBlcjtcbiJdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQUE7QUFBQTs7OztFQUdBLE1BQU1BLGlCQUFpQixHQUFHO0lBQ3pCQyxlQUFlLEVBQUUsVUFBVUMsVUFBMEIsRUFBRUMsY0FBc0IsRUFBRTtNQUM5RSxPQUFPRCxVQUFVLENBQUNFLFNBQVMsQ0FBRSxJQUFHRCxjQUFlLDhDQUE2QyxDQUFDO0lBQzlGLENBQUM7SUFDREUsNEJBQTRCLEVBQUUsVUFBVUgsVUFBMEIsRUFBRUMsY0FBc0IsRUFBRTtNQUMzRixNQUFNRyxlQUFlLEdBQUdKLFVBQVUsQ0FBQ0UsU0FBUyxDQUFFLElBQUdELGNBQWUsaURBQWdELENBQUM7TUFDakgsTUFBTUksYUFBYSxHQUFHLElBQUksQ0FBQ04sZUFBZSxDQUFDQyxVQUFVLEVBQUVDLGNBQWMsQ0FBQztNQUN0RSxPQUFPO1FBQ05LLGNBQWMsRUFBRUYsZUFBZTtRQUMvQkcsWUFBWSxFQUFFRjtNQUNmLENBQUM7SUFDRixDQUFDO0lBQ0RHLGVBQWUsRUFBRSxVQUFVQyxRQUFhLEVBQTRCO01BQUEsSUFBMUJDLE9BQWdCLHVFQUFHLEtBQUs7TUFDakUsTUFBTVYsVUFBVSxHQUFHUyxRQUFRLENBQUNFLFFBQVEsRUFBRSxDQUFDQyxZQUFZLEVBQUU7UUFDcERYLGNBQWMsR0FBR0QsVUFBVSxDQUFDYSxjQUFjLENBQUNKLFFBQVEsQ0FBQ0ssT0FBTyxFQUFFLENBQUMsQ0FBQ1osU0FBUyxDQUFDLGFBQWEsQ0FBQztRQUN2RmEsMEJBQTBCLEdBQUcsSUFBSSxDQUFDWiw0QkFBNEIsQ0FBQ0gsVUFBVSxFQUFFQyxjQUFjLENBQUM7TUFDM0YsSUFBSWUsY0FBYyxFQUFFQyxhQUFhO01BRWpDLElBQUlSLFFBQVEsQ0FBQ1MsR0FBRyxDQUFDLHdDQUF3QyxDQUFDLElBQUlULFFBQVEsQ0FBQ1UsVUFBVSxFQUFFLEVBQUU7UUFDcEZILGNBQWMsR0FBR1AsUUFBUSxDQUFDVyxnQkFBZ0IsRUFBRSxDQUFDTixPQUFPLEVBQUU7TUFDdkQsQ0FBQyxNQUFNO1FBQ05FLGNBQWMsR0FBR1AsUUFBUSxDQUFDSyxPQUFPLEVBQUU7TUFDcEM7TUFFQSxJQUFJLElBQUksQ0FBQ08sa0JBQWtCLENBQUNMLGNBQWMsQ0FBQyxJQUFJRCwwQkFBMEIsQ0FBQ1IsWUFBWSxFQUFFO1FBQ3ZGLE1BQU1GLGFBQWEsR0FBR1UsMEJBQTBCLENBQUNSLFlBQVk7VUFDNURlLFdBQVcsR0FBR3RCLFVBQVUsQ0FBQ0UsU0FBUyxDQUFFLElBQUdGLFVBQVUsQ0FBQ0UsU0FBUyxDQUFFLElBQUdELGNBQWUsRUFBQyxDQUFDLENBQUNzQixLQUFNLEVBQUMsQ0FBQztRQUUzRixJQUFJO1VBQ0gsTUFBTUMsaUJBQWlCLEdBQUduQixhQUFhLENBQ3JDb0IsR0FBRyxDQUFDLFVBQVVDLFlBQWlCLEVBQUU7WUFDakMsTUFBTUMsYUFBYSxHQUFHRCxZQUFZLENBQUNFLGFBQWE7WUFDaEQsSUFBSUMsU0FBUyxHQUFHcEIsUUFBUSxDQUFDcUIsV0FBVyxDQUFDSCxhQUFhLENBQUM7WUFFbkQsSUFBSUUsU0FBUyxLQUFLRSxTQUFTLElBQUlGLFNBQVMsS0FBSyxJQUFJLEVBQUU7Y0FDbEQsTUFBTSxJQUFJRyxLQUFLLENBQUUsMkNBQTBDTCxhQUFjLEVBQUMsQ0FBQztZQUM1RSxDQUFDLE1BQU07Y0FDTixJQUFJTCxXQUFXLENBQUNLLGFBQWEsQ0FBQyxDQUFDSixLQUFLLEtBQUssWUFBWSxFQUFFO2dCQUN0RE0sU0FBUyxHQUFJLElBQUdJLGtCQUFrQixDQUFDSixTQUFTLENBQUUsR0FBRTtjQUNqRDtjQUNBLElBQUl4QixhQUFhLENBQUM2QixNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUM3QjtnQkFDQTtnQkFDQUwsU0FBUyxHQUFJLEdBQUVGLGFBQWMsSUFBR0UsU0FBVSxFQUFDO2NBQzVDO2NBQ0EsT0FBT0EsU0FBUztZQUNqQjtVQUNELENBQUMsQ0FBQyxDQUNETSxJQUFJLENBQUMsR0FBRyxDQUFDO1VBRVhsQixhQUFhLEdBQUksSUFBR2hCLGNBQWUsSUFBR3VCLGlCQUFrQixHQUFFO1FBQzNELENBQUMsQ0FBQyxPQUFPWSxDQUFDLEVBQUU7VUFDWEMsR0FBRyxDQUFDQyxJQUFJLENBQUNGLENBQUMsQ0FBUTtRQUNuQjtNQUNEO01BRUEsT0FBTzFCLE9BQU8sR0FBR08sYUFBYSxHQUFHQSxhQUFhLElBQUlELGNBQWM7SUFDakUsQ0FBQztJQUVEO0lBQ0E7SUFDQTs7SUFFQUssa0JBQWtCLEVBQUUsVUFBVWtCLEtBQVUsRUFBRTtNQUN6QztNQUNBLE9BQU8sb0JBQW9CLENBQUNDLElBQUksQ0FBQ0QsS0FBSyxDQUFDO0lBQ3hDO0VBQ0QsQ0FBQztFQUFDLE9BRWF6QyxpQkFBaUI7QUFBQSJ9