/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/controls/filterbar/utils/VisualFilterUtils","sap/fe/core/helpers/ClassSupport","sap/fe/macros/CommonHelper","sap/fe/macros/filter/FilterUtils","sap/m/VBox","sap/ui/core/Core","../../templating/FilterHelper"],function(e,t,r,i,n,a,o,s){"use strict";var l,c,u,g,p,f,_,d,h,E,I;var m=s.getFiltersConditionsFromSelectionVariant;var T=r.property;var R=r.implementInterface;var S=r.event;var L=r.defineUI5Class;function b(e,t,r,i){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function P(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function v(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;y(e,t)}function y(e,t){y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return y(e,t)}function M(e,t,r,i,n){var a={};Object.keys(i).forEach(function(e){a[e]=i[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},a);if(n&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(n):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}function V(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let F=(l=L("sap.fe.core.controls.filterbar.VisualFilter"),c=R("sap.ui.core.IFormContent"),u=T({type:"boolean"}),g=T({type:"string"}),p=S(),l(f=(_=function(r){v(a,r);function a(){var e;for(var t=arguments.length,i=new Array(t),n=0;n<t;n++){i[n]=arguments[n]}e=r.call(this,...i)||this;b(e,"__implements__sap_ui_core_IFormContent",d,P(e));b(e,"showValueHelp",h,P(e));b(e,"valueHelpIconSrc",E,P(e));b(e,"valueHelpRequest",I,P(e));return e}var s=a.prototype;s.onAfterRendering=function e(){var r;let a;const s=this.getItems()[1].getItems()[0];const l=this.data("infoPath");const c=s.getBinding("segments")||s.getBinding("bars")||s.getBinding("points");const u=s.getBindingContext("internal");const g=o.getLibraryResourceBundle("sap.fe.macros");const p=s.data("showOverlayInitially");const f=s.data("selectionVariantAnnotation")?i.parseCustomData(s.data("selectionVariantAnnotation")):{SelectOptions:[]};const _=s.data("requiredProperties")?i.parseCustomData(s.data("requiredProperties")):[];const d=s.getModel().getMetaModel();const h=c?c.getPath():"";let E=(r=this.getParent())===null||r===void 0?void 0:r.getParent();if(E.getMetadata().getElementName()==="sap.ui.mdc.filterbar.p13n.AdaptationFilterBar"){var I;E=(I=E.getParent())===null||I===void 0?void 0:I.getParent()}let T={};let R=[];let S;if(E.getMetadata().getElementName()==="sap.fe.core.controls.FilterBar"){T=E.getConditions();R=E.getPropertyInfoSet();S=E.data("entityType").split("/")[1]}const L=s.data("parameters")?s.data("parameters").customData:[];const b=m(h,d,f,t.getCustomConditions.bind(t));const P=t.convertFilterCondions(b);const v={};Object.keys(T).forEach(function(e){if(T[e].length){v[e]=T[e]}});Object.keys(P).forEach(function(e){if(!v[e]){v[e]=P[e]}});if(p==="true"){if(!Object.keys(f).length){if(_.length>1){u.setProperty(l,{showError:true,errorMessageTitle:g.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:g.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{a=d.getObject(`${h}/${_[0]}@com.sap.vocabularies.Common.v1.Label`)||_[0];u.setProperty(l,{showError:true,errorMessageTitle:g.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:g.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",a)})}}else{const e=[];const t=[];if(f.SelectOptions){f.SelectOptions.forEach(function(t){e.push(t.PropertyName.$PropertyPath)})}if(f.Parameters){f.Parameters.forEach(function(t){e.push(t.PropertyName.$PropertyPath)})}_.forEach(function(r){if(e.indexOf(r)===-1){t.push(r)}});if(t.length>1){u.setProperty(l,{showError:true,errorMessageTitle:g.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:g.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{a=d.getObject(`${h}/${t[0]}@com.sap.vocabularies.Common.v1.Label`)||t[0];u.setProperty(l,{showError:true,errorMessageTitle:g.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:g.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",a)})}if(t.length>1){u.setProperty(l,{showError:true,errorMessageTitle:g.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:g.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{u.setProperty(l,{showError:true,errorMessageTitle:g.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:g.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",t[0])})}}}if(!this._oChartBinding||this._oChartBinding!==c){if(this._oChartBinding){this.detachDataReceivedHandler(this._oChartBinding)}this.attachDataRecivedHandler(c);this._oChartBinding=c}const y=u.getProperty(l)&&u.getProperty(l).showError;const M=h!==""?h.split("/")[1].split("(")[0]:"";if(L&&L.length&&S===M){const e=n.getBindingPathForParameters(E,v,R,L);if(e){c.sPath=e}}if(c&&c.isSuspended()&&!y){c.resume()}};s.attachDataRecivedHandler=function e(t){if(t){t.attachEvent("dataReceived",this.onInternalDataReceived,this);this._oChartBinding=t}};s.detachDataReceivedHandler=function e(t){if(t){t.detachEvent("dataReceived",this.onInternalDataReceived,this);this._oChartBinding=undefined}};s.setShowValueHelp=function e(t){if(this.getItems().length>0){const e=this.getItems()[0].getItems()[0];e.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setVisible(t)}});this.setProperty("showValueHelp",t)}};s.setValueHelpIconSrc=function e(t){if(this.getItems().length>0){const e=this.getItems()[0].getItems()[0];e.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setIcon(t)}});this.setProperty("valueHelpIconSrc",t)}};s.onInternalDataReceived=function r(i){const n=this.getId();const a=e.getTargetView(this);const s=this.getItems()[1].getItems()[0];const l=this.data("infoPath");const c=s.getBindingContext("internal");const u=o.getLibraryResourceBundle("sap.fe.macros");const g=s.data("uom");t.updateChartScaleFactorTitle(s,a,n,l);if(i.getParameter("error")){const e=u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");const r=u.getText("M_VISUAL_FILTERS_ERROR_DATA_TEXT");t.applyErrorMessageAndTitle(e,r,l,a)}else if(i.getParameter("data")){const e=i.getSource().getCurrentContexts();if(e&&e.length===0){t.setNoDataMessage(l,u,a)}else{c.setProperty(l,{})}t.setMultiUOMMessage(e,s,l,u,a)}if(g&&(g["ISOCurrency"]&&g["ISOCurrency"].$Path||g["Unit"]&&g["Unit"].$Path)){const e=i.getSource().getContexts();const r=e&&e[0].getObject();t.applyUOMToTitle(s,r,a,l)}};return a}(a),d=M(_.prototype,"__implements__sap_ui_core_IFormContent",[c],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),h=M(_.prototype,"showValueHelp",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),E=M(_.prototype,"valueHelpIconSrc",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),I=M(_.prototype,"valueHelpRequest",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),_))||f);return F},false);