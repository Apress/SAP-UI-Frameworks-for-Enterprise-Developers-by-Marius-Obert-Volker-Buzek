/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/ui/core/Core","../helpers/BindingHelper","../ManifestSettings"],function(e,t,i,n,o,a,l,r,d,v){"use strict";var s={};var u=v.ActionType;var c=d.UI;var f=d.singletonPathVisitor;var p=d.Draft;var y=l.isPathDeletable;var g=a.isEntitySet;var b=n.pathInModel;var E=n.not;var h=n.ifElse;var A=n.getExpressionFromAnnotation;var m=n.fn;var D=n.equal;var C=n.constant;var I=n.compileExpression;var O=n.and;var S=i.KeyHelper;var T=t.Placement;var P=e.getSemanticObjectMapping;var B=e.getEnabledForAnnotationAction;var F=e.getCopyAction;var N=e.dataFieldIsCopyAction;var U=e.ButtonType;function H(e,t){var i,n,o;return((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Identification)===null||o===void 0?void 0:o.filter(e=>{var i,n,o,a,l,r,d,v,s,u;return((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Hidden)===null||o===void 0?void 0:o.valueOf())!==true&&e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&Boolean((a=e.Determining)===null||a===void 0?void 0:a.valueOf())===t&&(((l=e.ActionTarget)===null||l===void 0?void 0:(r=l.isBound)===null||r===void 0?void 0:r.valueOf())!==true||(e===null||e===void 0?void 0:(d=e.ActionTarget)===null||d===void 0?void 0:(v=d.annotations)===null||v===void 0?void 0:(s=v.Core)===null||s===void 0?void 0:(u=s.OperationAvailable)===null||u===void 0?void 0:u.valueOf())!==false)?true:false}))||[]}s.getIdentificationDataFieldForActions=H;function M(e,t){var i,n,o;return((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Identification)===null||o===void 0?void 0:o.filter(e=>{var i,n,o,a;return((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Hidden)===null||o===void 0?void 0:o.valueOf())!==true&&e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&Boolean((a=e.Determining)===null||a===void 0?void 0:a.valueOf())===t?true:false}))||[]}const k=["UI.CriticalityType/VeryPositive","UI.CriticalityType/Positive","UI.CriticalityType/Negative","UI.CriticalityType/VeryNegative"];s.IMPORTANT_CRITICALITIES=k;function R(e,t){const i=e.getDataModelObjectPath(),n=i.navigationProperties.map(e=>e.name),o=A(t,n,undefined,t=>f(t,e.getConvertedTypes(),[])),a=e.getManifestWrapper(),l=a.getViewLevel(),r=l>1?c.IsEditable:E(c.IsEditable);return h(t===undefined||t.valueOf()===false,r,O(r,D(o,false)))}s.getDeleteButtonVisibility=R;function x(e,t,i){const n=i.getEntitySet(),a=o.isDraftRoot(n);let l=h(t!==undefined,t,h(e!==undefined,D(A(e),true),C(true)));l=a?O(l,E(b("DraftAdministrativeData/InProcessByUser"))):l;return l}s.getDeleteButtonEnabled=x;function V(e,t,i,n,a){const l=i===null||i===void 0?void 0:i.getEntitySet(),r=e.getEntitySet(),d=e.getManifestWrapper().isFclEnabled();let v;const s=j(i,t);if(a&&a>1){v=o.isDraftNode(r)}else{v=o.isDraftRoot(l)}const u=j(i,n);const f=E(c.IsEditable);const y=h(a>1,h(n===undefined||n.valueOf()===false,O(f,D(b("rootEditVisible","internal"),true),h(d,D(b("/showEditButton","fclhelper"),true),true)),O(f,D(u,false),D(b("rootEditVisible","internal"),true),h(d,D(b("/showEditButton","fclhelper"),true),true))),h(t===undefined||t.valueOf()===false,f,O(f,D(s,false))));return h(v,O(y,p.HasNoDraftForCurrentUser),y)}s.getEditButtonVisibility=V;function j(e,t){const i=e.getDataModelObjectPath(),n=i.navigationProperties.map(e=>e.name),o=A(t,n,undefined,t=>f(t,e.getConvertedTypes(),n));return o}s.getHiddenExpression=j;function w(e,t,i){const n=e.getEntitySet(),a=o.isDraftRoot(n),l=o.isSticky(n);let r;if(a&&g(n)){var d,v;r=(d=n.annotations.Common)===null||d===void 0?void 0:(v=d.DraftRoot)===null||v===void 0?void 0:v.EditAction}else if(l&&g(n)){var s,u;r=(s=n.annotations.Session)===null||s===void 0?void 0:(u=s.StickySessionSupported)===null||u===void 0?void 0:u.EditAction}if(r){var c,f;const n=e.getAbsoluteAnnotationPath(r);const o=e.resolveAbsolutePath(n).target;if((o===null||o===void 0?void 0:(c=o.annotations)===null||c===void 0?void 0:(f=c.Core)===null||f===void 0?void 0:f.OperationAvailable)===null){}else if(i>1){if(t!==undefined){return I(O(D(A(t),true),D(b("rootEditEnabled","internal"),true)))}else{return I(D(b("rootEditEnabled","internal"),true))}}else{return B(e,o??undefined)}}return"true"}s.getEditButtonEnabled=w;function L(e){var t,i,n,a,l;const d=e.getContextPath();const v=o.getRootEntitySetPath(d);const s=e.getConverterContextFor("/"+v);const c=e.getEntitySet(),p=e.getEntityType(),h=s.getEntitySet(),C=s.getEntityType(),T=o.getStickySession(h),B=o.getDraftRoot(h),j=o.getDraftNode(h),L=c&&((t=c.annotations)===null||t===void 0?void 0:(i=t.Capabilities)===null||i===void 0?void 0:i.DeleteRestrictions),K=o.isUpdateHidden(h,C),W=h&&g(h)&&(K===null||K===void 0?void 0:K.valueOf()),_=e.getDataModelObjectPath(),q=y(_,{pathVisitor:(t,i)=>f(t,e.getConvertedTypes(),i)}),Q=q?I(q):q,G=H(e.getEntityType(),false);const Y=e.getManifestWrapper().getViewLevel()===1?F(G.filter(e=>N(e))):undefined;const z=G.filter(e=>!N(e));const J=[];if(g(c)&&B!==null&&B!==void 0&&B.EditAction&&W!==true){J.push({type:u.DraftActions,key:"DraftActions"})}const X=e.getManifestWrapper().getViewLevel();const Z=X>1?c===null||c===void 0?void 0:(n=c.annotations.Capabilities)===null||n===void 0?void 0:(a=n.UpdateRestrictions)===null||a===void 0?void 0:a.Updatable:undefined;if(B||j){J.push({type:u.CollaborationAvatars,key:"CollaborationAvatars"})}z.filter(e=>k.indexOf(e===null||e===void 0?void 0:e.Criticality)>-1).forEach(t=>{J.push($(t,e))});if((B!==null&&B!==void 0&&B.EditAction||T!==null&&T!==void 0&&T.EditAction)&&W!==true){J.push({type:u.Primary,key:"EditAction",visible:I(V(e,K,s,o.isUpdateHidden(c,p),X)),enabled:w(s,Z,X)})}if(Q&&Q!=="false"||(L===null||L===void 0?void 0:(l=L.Deletable)===null||l===void 0?void 0:l.valueOf())!==false&&Q!=="false"){const t=o.getDeleteHidden(c,p);J.push({type:u.Secondary,key:"DeleteAction",visible:I(R(e,t)),enabled:I(x(L===null||L===void 0?void 0:L.Deletable,q,e)),parentEntityDeleteEnabled:Q})}if(Y){var ee;J.push({...$(Y,e),type:u.Copy,text:((ee=Y.Label)===null||ee===void 0?void 0:ee.toString())??r.getLibraryResourceBundle("sap.fe.core").getText("C_COMMON_COPY")})}const te=M(e.getEntityType(),false);te.filter(e=>k.indexOf(e===null||e===void 0?void 0:e.Criticality)===-1).forEach(t=>{var i,n,o,a,l,r;if(((i=t.RequiresContext)===null||i===void 0?void 0:i.valueOf())===true){throw new Error(`RequiresContext property should not be true for header IBN action : ${t.Label}`)}if(((n=t.Inline)===null||n===void 0?void 0:n.valueOf())===true){throw new Error(`Inline property should not be true for header IBN action : ${t.Label}`)}const d={semanticObjectMapping:P(t.Mapping)};J.push({type:u.DataFieldForIntentBasedNavigation,text:(o=t.Label)===null||o===void 0?void 0:o.toString(),annotationPath:e.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),buttonType:U.Ghost,visible:I(O(E(D(A((a=t.annotations)===null||a===void 0?void 0:(l=a.UI)===null||l===void 0?void 0:l.Hidden),true)),E(D(b("shellNavigationNotAvailable","internal"),true)))),enabled:t.NavigationAvailable!==undefined?I(D(A((r=t.NavigationAvailable)===null||r===void 0?void 0:r.valueOf()),true)):true,key:S.generateKeyFromDataField(t),isNavigable:true,press:I(m("._intentBasedNavigation.navigate",[A(t.SemanticObject),A(t.Action),d])),customData:I({semanticObject:A(t.SemanticObject),action:A(t.Action)})})});z.filter(e=>k.indexOf(e===null||e===void 0?void 0:e.Criticality)===-1).forEach(t=>{J.push($(t,e))});return J}s.getHeaderDefaultActions=L;function K(e){var t,i,n;const o=e.getEntityType();const a=((t=o.annotations)===null||t===void 0?void 0:(i=t.UI)===null||i===void 0?void 0:(n=i.Identification)===null||n===void 0?void 0:n.filter(e=>{var t,i,n;return(e===null||e===void 0?void 0:(t=e.annotations)===null||t===void 0?void 0:(i=t.UI)===null||i===void 0?void 0:(n=i.Hidden)===null||n===void 0?void 0:n.valueOf())===true}))||[];return a.map(e=>({type:u.Default,key:S.generateKeyFromDataField(e)}))}s.getHiddenHeaderActions=K;function W(e,t){var i,n,a,l;const r=t.getEntitySet();const d=t.getEntityType();const v=o.getStickySession(r),s=g(r)&&(((i=r.annotations.Common)===null||i===void 0?void 0:(n=i.DraftRoot)===null||n===void 0?void 0:n.term)??((a=r.annotations.Session)===null||a===void 0?void 0:(l=a.StickySessionSupported)===null||l===void 0?void 0:l.term)),c=Boolean(s==="com.sap.vocabularies.Common.v1.DraftRoot"||v&&(v===null||v===void 0?void 0:v.SaveAction)),f=e>1,p=Boolean(s==="com.sap.vocabularies.Common.v1.DraftRoot"||v&&(v===null||v===void 0?void 0:v.DiscardAction));const y=H(t.getEntityType(),true);const b=y.filter(e=>k.indexOf(e===null||e===void 0?void 0:e.Criticality)>-1).map(e=>$(e,t));if((r===null||r===void 0?void 0:r.entityTypeName)===(d===null||d===void 0?void 0:d.fullyQualifiedName)&&c){b.push({type:u.Primary,key:"SaveAction"})}if(f){b.push({type:u.DefaultApply,key:"ApplyAction"})}y.filter(e=>k.indexOf(e===null||e===void 0?void 0:e.Criticality)===-1).forEach(e=>{b.push($(e,t))});if(p){b.push({type:u.Secondary,key:"CancelAction",position:{placement:T.End}})}return b}s.getFooterDefaultActions=W;function $(e,t){var i,n;return{type:u.DataFieldForAction,annotationPath:t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:S.generateKeyFromDataField(e),visible:I(E(D(A((i=e.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:n.Hidden),true))),enabled:B(t,e.ActionTarget),isNavigable:true}}return s},false);