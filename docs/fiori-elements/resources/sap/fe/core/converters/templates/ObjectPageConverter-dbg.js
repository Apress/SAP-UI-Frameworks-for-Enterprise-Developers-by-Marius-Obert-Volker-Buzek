/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/objectPage/HeaderAndFooterAction","sap/fe/core/helpers/BindingToolkit","../controls/ObjectPage/Avatar","../controls/ObjectPage/HeaderFacet","../controls/ObjectPage/SubSection","../helpers/BindingHelper","../helpers/ConfigurableObject","../helpers/ID","../ManifestSettings"],function(e,t,n,o,i,a,s,r,c,l){"use strict";var d={};var u=l.VisualizationType;var v=l.TemplateType;var f=c.getSectionID;var b=c.getEditableHeaderSectionID;var g=c.getCustomSectionID;var p=r.Placement;var m=r.OverrideType;var y=r.insertCustomElements;var h=s.UI;var E=a.SubSectionType;var A=a.createSubSections;var S=a.createCustomSubSections;var C=a.createCustomHeaderFacetSubSections;var T=i.getHeaderFacetsFromManifest;var w=i.getHeaderFacetsFromAnnotations;var H=o.getAvatar;var I=n.not;var F=n.ifElse;var k=n.getExpressionFromAnnotation;var L=n.equal;var M=n.constant;var O=n.compileExpression;var P=t.getHiddenHeaderActions;var j=t.getHeaderDefaultActions;var z=t.getFooterDefaultActions;var x=e.removeDuplicateActions;var D=e.getActionsFromManifest;const B=(e,t)=>{var n,o;return((n=e.ID)===null||n===void 0?void 0:n.toString())||((o=e.Label)===null||o===void 0?void 0:o.toString())||t};function U(e,t){var n,o;const i=b();const a=(n=e.getEntityType().annotations)===null||n===void 0?void 0:(o=n.UI)===null||o===void 0?void 0:o.HeaderFacets;const s=a?A(a,e,true):[];const r=C(e);let c=[];if(r.length>0){let e=0;t.forEach(function(t){while(s.length>e&&s[e].visible==="false"){c.push(s[e]);e++}if(s.length>e&&(t.key===s[e].key||t.key.slice(t.key.lastIndexOf("::")+2)===s[e].key.slice(s[e].key.lastIndexOf("::")+2))){c.push(s[e]);e++}else{r.forEach(function(e){if(t.key===e.key){c.push(e)}})}})}else{c=s}const l={id:i,key:"EditableHeaderContent",title:"{sap.fe.i18n>T_COMMON_OBJECT_PAGE_HEADER_SECTION}",visible:O(h.IsEditable),subSections:c};return l}d.createEditableHeaderSection=U;function V(e){var t,n,o;const i=e.getEntityType();const a=((t=i.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:(o=n.Facets)===null||o===void 0?void 0:o.map(t=>W(t,e)))||[];return a}function W(e,t){var n,o,i;const a=f(e);const s={id:a,key:B(e,a),title:e.Label?O(k(e.Label)):undefined,showTitle:!!e.Label,visible:O(I(L(k((n=e.annotations)===null||n===void 0?void 0:(o=n.UI)===null||o===void 0?void 0:(i=o.Hidden)===null||i===void 0?void 0:i.valueOf()),true))),subSections:A([e],t)};return s}function _(e,t){const n={};Object.keys(e).forEach(o=>{n[o]=N(e[o],o,t)});return n}function N(e,t,n){const o=e.id||g(t);let i=e.position;if(!i){i={placement:p.After}}let a;if(!e.subSections){a={[t]:{...e,position:undefined,visible:"true"}}}else{a=e.subSections}const s=S(a,n);const r={id:o,key:t,title:e.title,showTitle:!!e.title,visible:e.visible!==undefined?e.visible:"true",position:i,subSections:s};return r}const G=function(e){const t=j(e);const n=e.getManifestWrapper();const o=D(n.getHeaderActions(),e,t,undefined,undefined,P(e));const i={isNavigable:m.overwrite,enabled:m.overwrite,visible:m.overwrite,defaultValuesExtensionFunction:m.overwrite,command:m.overwrite};const a=y(t,o.actions,i);return{actions:x(a),commandActions:o.commandActions}};d.getHeaderActions=G;const q=function(e){const t=e.getManifestWrapper();const n=z(t.getViewLevel(),e);const o=D(t.getFooterActions(),e,n);const i={isNavigable:m.overwrite,enabled:m.overwrite,visible:m.overwrite,defaultValuesExtensionFunction:m.overwrite,command:m.overwrite};const a=y(n,o.actions,i);return{actions:a,commandActions:o.commandActions}};d.getFooterActions=q;function J(e){var t;return e!==null&&e!==void 0&&(t=e.presentation)!==null&&t!==void 0&&t.visualizations[0]?e.presentation.visualizations[0]:undefined}function R(e,t){var n,o;return e.visible==="true"&&(e===null||e===void 0?void 0:(n=e.presentation)===null||n===void 0?void 0:n.visualizations)&&(t===null||t===void 0?void 0:t.type)==="Table"&&(t===null||t===void 0?void 0:(o=t.control)===null||o===void 0?void 0:o.type)==="GridTable"}function K(e,t,n,o){if(R(t,n)){const t=n.control;if(!(o==="Page"&&e.length>1)){t.rowCountMode="Auto"}if(o!=="Tabs"){t.useCondensedTableLayout=false}}}function Q(e,t){var n;if((e===null||e===void 0?void 0:(n=e.content)===null||n===void 0?void 0:n.length)===1){var o;const n=((o=e.content[0].presentation)===null||o===void 0?void 0:o.visualizations[0]).control;if(n.type==="GridTable"){n.rowCountMode="Auto";if(t!=="Tabs"){n.useCondensedTableLayout=false}}}}function X(e,t,n){let o;let i;const a=t.subSections;if(a.length===1){o=a[0];switch(a[0].type){case"DataVisualization":i=J(o);K(e,o,i,n);break;case"Mixed":Q(o,n);break;default:break}return}Y(a)}function Y(e){let t;e.forEach(e=>{var n,o,i;t=e;if((n=t)!==null&&n!==void 0&&(o=n.presentation)!==null&&o!==void 0&&o.visualizations){var a,s;(a=t)===null||a===void 0?void 0:(s=a.presentation)===null||s===void 0?void 0:s.visualizations.forEach(e=>{if(e.type===u.Table){e.control.useCondensedTableLayout=false}})}if((i=t)!==null&&i!==void 0&&i.content){t.content.forEach(e=>{var t;(t=e.presentation)===null||t===void 0?void 0:t.visualizations.forEach(e=>{if(e.type===u.Table){e.control.useCondensedTableLayout=false}})})}})}const Z=function(e){const t=e.getManifestWrapper();const n=y(V(e),_(t.getSections(),e),{title:m.overwrite,visible:m.overwrite,subSections:{actions:m.merge,title:m.overwrite,sideContent:m.overwrite,objectPageLazyLoaderEnabled:m.overwrite}});n.forEach(function(e){var o;X(n,e,t.getSectionLayout());(o=e.subSections)===null||o===void 0?void 0:o.forEach(function(e){var t;e.title=e.title==="undefined"?undefined:e.title;if(e.type==="Mixed"){var n;(n=e.content)===null||n===void 0?void 0:n.forEach(t=>{t.objectPageLazyLoaderEnabled=e.objectPageLazyLoaderEnabled})}if(e.type==="Mixed"&&(t=e.content)!==null&&t!==void 0&&t.length){var o;const t=e.content.find(e=>e.type===E.Form);if(e.sideContent){if(t){t.sideContent=e.sideContent}else{e.content[0].sideContent=e.sideContent}e.sideContent=undefined}if(t&&(o=e.actions)!==null&&o!==void 0&&o.length){t.actions=e.actions;e.actions=[]}}})});return n};d.getSections=Z;function $(e){var t,n;const o=e.getManifestWrapper();return(((t=e.getEntityType().annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:n.HeaderFacets)||[]).length>0||Object.keys(o.getHeaderFacets()).length>0}function ee(e){const t=e.getManifestWrapper();return F(!$(e),M(false),F(L(t.isHeaderEditable(),false),M(true),I(h.IsEditable)))}const te=function(e){return O(ee(e))};d.getShowHeaderContent=te;const ne=function(e){return O(I(ee(e)))};d.getExpandedImageVisible=ne;const oe=function(e){var t,n;const o=e.getManifestWrapper();let i;const a=e.getEntityType();const s=y(w(e),T(o.getHeaderFacets()));const r=G(e);const c=q(e);if(o.isHeaderEditable()&&((t=a.annotations.UI)!==null&&t!==void 0&&t.HeaderFacets||(n=a.annotations.UI)!==null&&n!==void 0&&n.HeaderInfo)){i=U(e,s)}const l=Z(e);return{template:v.ObjectPage,header:{visible:o.getShowObjectPageHeader(),section:i,facets:s,actions:r.actions,showContent:te(e),hasContent:$(e),avatar:H(e),title:{expandedImageVisible:ne(e)}},sections:l,footerActions:c.actions,headerCommandActions:r.commandActions,footerCommandActions:c.commandActions,showAnchorBar:o.getShowAnchorBar(),useIconTabBar:o.useIconTabBar()}};d.convertPage=oe;return d},false);