/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/macros/table/Utils"],function(e,t){"use strict";let i=function(){function i(e,t){this._aBindingRegistrations=[];this._aOtherEventSources=[];this._isSearchPending=false;this._aMDCTables=[];this._aMDCCharts=[];this._oEventProvider=e;this._fnOnFinished=t}var n=i.prototype;n.isSearchPending=function e(){return this._isSearchPending};n.isDataReceived=function e(){return this._isDataReceived};n.resetDataReceived=function e(){this._isDataReceived=undefined};n.reset=function e(){this._aBindingRegistrations.forEach(e=>{e.binding.detachEvent("dataRequested",this.onDataRequested,this);e.binding.detachEvent("dataReceived",this.onDataReceived,this)});this._aOtherEventSources.forEach(e=>{e.detachEvent("search",this.onSearch,this);e.detachEvent("bindingUpdated",this.register,this)});this._aBindingRegistrations=[];this._aOtherEventSources=[];this._aMDCTables=[];this._aMDCCharts=[];this._isSearchPending=false;this._isDataReceived=undefined};n.onDataReceived=function t(i,n){const r=i.getSource();const a=this._aBindingRegistrations.find(e=>e.binding===r);if(!a){e.error("PageReady - data received on an unregistered binding");return}switch(r.getGroupId()){case"$auto.Workers":this._oEventProvider.fireEvent("workersBatchReceived");break;case"$auto.Heroes":this._oEventProvider.fireEvent("heroesBatchReceived");break;default:}a.receivedCount++;if(a.receivedCount<a.requestedCount){r.attachEventOnce("dataReceived",{triggeredBySearch:n.triggeredBySearch},this.onDataReceived,this);return}const s=this._aBindingRegistrations.some(e=>e.requestedCount!==0)&&this._aBindingRegistrations.every(e=>e.requestedCount===0||e.receivedCount>=e.requestedCount);if(n.triggeredBySearch||a.receivedCount>=a.requestedCount){this._isSearchPending=false}if(s){this._isDataReceived=true;this._fnOnFinished()}};n.onDataRequested=function t(i,n){const r=i.getSource();const a=this._aBindingRegistrations.find(e=>e.binding===r);if(!a){e.error("PageReady - data requested on an unregistered binding");return}a.requestedCount++;this._isDataReceived=false;if(a.requestedCount-a.receivedCount===1){r.attachEventOnce("dataReceived",{triggeredBySearch:n.triggeredBySearch},this.onDataReceived,this)}};n.onSearch=function t(i){const n=this._aMDCTables.filter(e=>{var t;return i.getSource().sId===e.getFilter()&&e.getVisible()&&!((t=e.getParent())!==null&&t!==void 0&&t.getProperty("bindingSuspended"))});const r=this._aMDCCharts.filter(e=>i.getSource().sId===e.getFilter()&&e.getVisible());if(n.length>0||r.length>0){this._isSearchPending=true}n.forEach(e=>{this.registerTable(e,true)});r.forEach(async t=>{try{if(t.innerChartBoundPromise){await t.innerChartBoundPromise}this.registerChart(t,true)}catch(t){e.error("Cannot find a inner bound chart",t)}})};n.register=function e(t,i){var n,r;const a=i.binding||((n=i.table)===null||n===void 0?void 0:n.getRowBinding())||((r=i.chart)===null||r===void 0?void 0:r.getControlDelegate().getInnerChart(i.chart).getBinding("data"));const s=i.table||i.chart;if(!a){return}let d=this._aBindingRegistrations.find(e=>e.binding===a);if(d){if(s){d.boundControl=s}if(d.requestedCount>0){a.detachEvent("dataRequested",this.onDataRequested,this);a.attachEventOnce("dataRequested",{triggeredBySearch:i.triggeredBySearch},this.onDataRequested,this)}return}if(s){d=this._aBindingRegistrations.find(e=>e.boundControl===s);if(d&&d.binding!==a){d.binding=a;d.requestedCount=0;d.receivedCount=0}}if(!d){d={binding:a,boundControl:s,requestedCount:0,receivedCount:0};this._aBindingRegistrations.push(d)}a.detachEvent("dataRequested",this.onDataRequested,this);a.attachEventOnce("dataRequested",{triggeredBySearch:i.triggeredBySearch},this.onDataRequested,this)};n.registerBinding=function e(t){this.register(null,{binding:t,triggeredBySearch:false})};n.registerTable=function e(t){let i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._aMDCTables.indexOf(t)<0){this._aMDCTables.push(t)}const n=t.getRowBinding();if(n){this.register(null,{table:t,triggeredBySearch:i})}if(this._aOtherEventSources.indexOf(t)===-1){t.attachEvent("bindingUpdated",{table:t,triggeredBySearch:i},this.register,this);this._aOtherEventSources.push(t)}};n.registerChart=function e(t){let i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._aMDCCharts.indexOf(t)<0){this._aMDCCharts.push(t)}const n=t.getControlDelegate().getInnerChart(t);const r=n===null||n===void 0?void 0:n.getBinding("data");if(r){this.register(null,{chart:t,triggeredBySearch:i})}if(this._aOtherEventSources.indexOf(t)===-1){t.attachEvent("bindingUpdated",{chart:t,triggeredBySearch:i},this.register,this);this._aOtherEventSources.push(t)}};n.registerTableOrChart=async function i(n){if(!n.isA("sap.ui.mdc.Table")&&!n.isA("sap.ui.mdc.Chart")){return}try{await n.initialized();if(n.isA("sap.ui.mdc.Table")){this.registerTable(n);if(n.getAutoBindOnInit()&&n.getDomRef()){await t.whenBound(n)}}else{this.registerChart(n)}}catch(t){e.error("PageReady - Cannot register a table or a chart",t)}};n.registerFilterBar=function e(t){t.attachEvent("search",this.onSearch,this);this._aOtherEventSources.push(t)};return i}();return i},false);