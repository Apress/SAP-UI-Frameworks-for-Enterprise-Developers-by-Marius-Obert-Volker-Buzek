/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/extend","sap/base/util/ObjectPath","sap/fe/core/helpers/ClassSupport","sap/m/library","sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/ui/core/routing/HashChanger","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/ui/model/json/JSONModel"],function(e,t,o,r,a,i,n,s,l,c,p,u,h){"use strict";var d,m,g,f,S,y,b,_,w,T,E,O,v,M,P,D,j;var A=r.publicExtension;var I=r.methodOverride;var x=r.finalExtension;var C=r.extensible;var H=r.defineUI5Class;function U(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;L(e,t)}function L(e,t){L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,o){t.__proto__=o;return t};return L(e,t)}function R(e,t,o,r,a){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]});i.enumerable=!!i.enumerable;i.configurable=!!i.configurable;if("value"in i||i.initializer){i.writable=true}i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i);if(a&&i.initializer!==void 0){i.value=i.initializer?i.initializer.call(a):void 0;i.initializer=undefined}if(i.initializer===void 0){Object.defineProperty(e,t,i);i=null}return i}let F;let J=(d=H("sap.fe.core.controllerextensions.Share"),m=I(),g=I(),f=A(),S=x(),y=A(),b=C(l.After),_=A(),w=x(),T=A(),E=x(),O=A(),v=x(),M=A(),P=x(),d(D=(j=function(r){U(s,r);function s(){return r.apply(this,arguments)||this}var l=s.prototype;l.onInit=function e(){const t=new h({url:"",appTitle:"",subTitle:"",minifyUrlForChat:true});this.base.getView().setModel(t,"collaborationInfo")};l.onExit=function e(){var t,o;const r=(t=this.base)===null||t===void 0?void 0:(o=t.getView())===null||o===void 0?void 0:o.getModel("collaborationInfo");if(r){r.destroy()}};l.openShareSheet=function e(t){this._openShareSheetImpl(t)};l.adaptShareMetadata=function e(t){return t};l._openShareSheetImpl=async function o(r){let s;const l=c.getInstance().getHash(),d=c.getInstance().hrefForAppSpecificHash?c.getInstance().hrefForAppSpecificHash(""):"",m={url:window.location.origin+window.location.pathname+window.location.search+(l?d+l:window.location.hash),title:document.title,email:{url:"",title:""},jam:{url:"",title:""},tile:{url:"",title:"",subtitle:"",icon:"",queryUrl:""}};F=r;const g=function(e,o){const r=e.getModel("shareData");const a=t(r.getData(),o);r.setData(a)};try{const o=await Promise.resolve(this.adaptShareMetadata(m));const l={shareEmailPressed:function(){const e=s.getModel("shareData");const t=e.getData();const o=i.getLibraryResourceBundle("sap.fe.core");const r=t.email.title?t.email.title:o.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[t.title]);a.URLHelper.triggerEmail(undefined,r,t.email.url?t.email.url:t.url)},shareMSTeamsPressed:function(){const e=s.getModel("shareData");const t=e.getData();const o=t.email.title?t.email.title:t.title;const r=t.email.url?t.email.url:t.url;const a=window.open("","ms-teams-share-popup","width=700,height=600");a.opener=null;a.location=`https://teams.microsoft.com/share?msgText=${encodeURIComponent(o)}&href=${encodeURIComponent(r)}`},onSaveTilePress:function(){setTimeout(function(){var e;(e=i.byId("bookmarkDialog"))===null||e===void 0?void 0:e.attachAfterClose(function(){F.focus()})},0)},shareJamPressed:()=>{this._doOpenJamShareDialog(o.jam.title?o.jam.title:o.title,o.jam.url?o.jam.url:o.url)}};l.onCancelPressed=function(){s.close()};l.setShareSheet=function(e){r.shareSheet=e};const c=new h({});const d={bindingContexts:{this:c.createBindingContext("/")},models:{this:c}};const f={title:o.tile.title?o.tile.title:o.title,subtitle:o.tile.subtitle,icon:o.tile.icon,url:o.tile.url?o.tile.url:o.url.substring(o.url.indexOf("#")),queryUrl:o.tile.queryUrl};if(r.shareSheet){s=r.shareSheet;const e=s.getModel("share");this._setStaticShareData(e);const a=t(e.getData(),f);e.setData(a);g(s,o);s.openBy(r)}else{const a="sap.fe.macros.share.ShareSheet";const i=u.loadTemplate(a,"fragment");try{const e=await Promise.resolve(p.process(i,{name:a},d));s=await n.load({definition:e,controller:l});s.setModel(new h(f||{}),"share");const c=s.getModel("share");this._setStaticShareData(c);const u=t(c.getData(),f);c.setData(u);s.setModel(new h(o||{}),"shareData");g(s,o);r.addDependent(s);s.openBy(r);l.setShareSheet(s)}catch(t){e.error("Error while opening the share fragment",t)}}}catch(t){e.error("Error while fetching the share model data",t)}};l._setStaticShareData=function e(t){const r=i.getLibraryResourceBundle("sap.fe.core");t.setProperty("/jamButtonText",r.getText("T_COMMON_SAPFE_SHARE_JAM"));t.setProperty("/emailButtonText",r.getText("T_SEMANTIC_CONTROL_SEND_EMAIL"));t.setProperty("/msTeamsShareButtonText",r.getText("T_COMMON_SAPFE_SHARE_MSTEAMS"));if(o.get("sap-ushell-config.renderers.fiori2.componentData.config.sapHorizonEnabled")===true){t.setProperty("/msTeamsVisible",true)}else{t.setProperty("/msTeamsVisible",false)}const a=o.get("sap.ushell.Container.getUser");t.setProperty("/jamVisible",!!a&&a().isJamActive());t.setProperty("/saveAsTileVisible",!!(sap&&sap.ushell&&sap.ushell.Container))};l._doOpenJamShareDialog=function e(t,o){const r=i.createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:o,share:t}}});r.open()};l._triggerEmail=async function e(){const t=await this._adaptShareMetadata();const o=i.getLibraryResourceBundle("sap.fe.core");const r=t.email.title?t.email.title:o.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[t.title]);a.URLHelper.triggerEmail(undefined,r,t.email.url?t.email.url:t.url)};l._triggerShareToJam=async function e(){const t=await this._adaptShareMetadata();this._doOpenJamShareDialog(t.jam.title?t.jam.title:t.title,t.jam.url?t.jam.url:window.location.origin+window.location.pathname+t.url)};l._saveAsTile=async function e(t){const o=await this._adaptShareMetadata(),r=t.getDependents()[0],a=c.getInstance().getHash(),i=c.getInstance().hrefForAppSpecificHash?c.getInstance().hrefForAppSpecificHash(""):"";o.url=a?i+a:window.location.hash;r.setTitle(o.tile.title?o.tile.title:o.title);r.setSubtitle(o.tile.subtitle);r.setTileIcon(o.tile.icon);r.setCustomUrl(o.tile.url?o.tile.url:o.url);r.setServiceUrl(o.tile.queryUrl);r.firePress()};l._adaptShareMetadata=function e(){const t=c.getInstance().getHash(),o=c.getInstance().hrefForAppSpecificHash?c.getInstance().hrefForAppSpecificHash(""):"",r={url:window.location.origin+window.location.pathname+window.location.search+(t?o+t:window.location.hash),title:document.title,email:{url:"",title:""},jam:{url:"",title:""},tile:{url:"",title:"",subtitle:"",icon:"",queryUrl:""}};return this.adaptShareMetadata(r)};return s}(s),R(j.prototype,"onInit",[m],Object.getOwnPropertyDescriptor(j.prototype,"onInit"),j.prototype),R(j.prototype,"onExit",[g],Object.getOwnPropertyDescriptor(j.prototype,"onExit"),j.prototype),R(j.prototype,"openShareSheet",[f,S],Object.getOwnPropertyDescriptor(j.prototype,"openShareSheet"),j.prototype),R(j.prototype,"adaptShareMetadata",[y,b],Object.getOwnPropertyDescriptor(j.prototype,"adaptShareMetadata"),j.prototype),R(j.prototype,"_triggerEmail",[_,w],Object.getOwnPropertyDescriptor(j.prototype,"_triggerEmail"),j.prototype),R(j.prototype,"_triggerShareToJam",[T,E],Object.getOwnPropertyDescriptor(j.prototype,"_triggerShareToJam"),j.prototype),R(j.prototype,"_saveAsTile",[O,v],Object.getOwnPropertyDescriptor(j.prototype,"_saveAsTile"),j.prototype),R(j.prototype,"_adaptShareMetadata",[M,P],Object.getOwnPropertyDescriptor(j.prototype,"_adaptShareMetadata"),j.prototype),j))||D);return J},false);