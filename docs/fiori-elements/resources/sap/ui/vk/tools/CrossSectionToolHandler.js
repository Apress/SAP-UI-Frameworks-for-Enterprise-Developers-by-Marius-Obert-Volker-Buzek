/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/EventProvider","../thirdparty/three"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.CrossSectionToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=20;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._mouse=new e.Vector2;this._rayCaster=new e.Raycaster;this._rayCaster.linePrecision=0;this._gizmoAxis=new e.Vector3;this._dragOrigin=new e.Vector2;this._dragOffset=0;this._dragDelta=0}});i.prototype._updateRayCaster=function(t){var i=this.getViewport().getRenderer().getSize(new e.Vector2);this._mouse.x=(t.x-this._rect.x)/i.width*2-1;this._mouse.y=(t.y-this._rect.y)/i.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};i.prototype._updateArrowHandle=function(t){var e=this._gizmo.getTouchObject();var i=-1;if(t.n===1){this._updateRayCaster(t);var s=this._rayCaster.intersectObject(e,true);i=s.length>0?this._gizmo.getAxis():-1}if(i!==this._axisIndex){this._axisIndex=i;this._gizmo.highlightArrowHandle(i>=0);if(i>=0){this._gizmoAxis.setScalar(0).setComponent(this._axisIndex,1)}this.getViewport().setShouldRenderFrame()}};i.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateArrowHandle(t);t.handled|=this._axisIndex>=0}};i.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateArrowHandle(t);this._gizmo.selectHandle(this._axisIndex);t.handled|=this._axisIndex>=0}};i.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateArrowHandle(t);this._gizmo.selectHandle(this._axisIndex);if(this._axisIndex>=0){this._gesture=true;t.handled=true;this._dragOrigin.set(t.x,t.y);this._dragOffset=this._gizmo._getOffset();this._dragDelta=this._gizmo._getDelta()/500}}};i.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateRayCaster(t);var e=this._gizmoAxis.clone().applyQuaternion(this.getViewport().getCamera().getCameraRef().quaternion.clone().invert());e.z=0;e.normalize();if(e.x===0&&e.y===0){e.y=1}this._gizmo._setOffset(this._dragOffset+((t.x-this._dragOrigin.x)*e.x-(t.y-this._dragOrigin.y)*e.y)*this._dragDelta)}};i.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateArrowHandle(t)}};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){if(this._rect===null||true){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});