/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./Element","./Path","sap/base/util/uid"],function(t,e,i){"use strict";var n=function(e){e=e||{};t.call(this,e);this.type="Text";this.text=e.text;this.content=e.content||(e.children?y(e.children,e.textStyles):[]);this.style=e.style||{};this.style.size=this.style.size||"1em";this.x=e.x||0;this.y=e.y||0;if(e.dx){this.dx=e.dx}if(e.dy){this.dy=e.dy}this.fillStyle=e.fillStyle||{colour:[0,0,0,1]};this.lineStyle=e.lineStyle||{colour:[0,0,0,0],width:1};if(this.style.fill){this.fillStyle.veid="t"+this.style.veid;this.fillStyle.colour=this.style.fill}if(this.style.stroke){this.lineStyle.veid="t"+this.style.veid;this.lineStyle.colour=this.style.stroke}this.setMaterial(e.material)};n.prototype=Object.assign(Object.create(t.prototype),{constructor:n});n.prototype.tagName=function(){return"text"};n.prototype.defaultFillAlpha=1;var s=document.createElement("canvas");var a=s.getContext("2d");n.prototype._expandBoundingBox=function(t,e){if(this.domRef){var i=this.domRef.getBBox();if(i){this._expandBoundingBoxCE(t,e,i.x+i.width*.5,i.y+i.height*.5,i.width*.5,i.height*.5);return}}function n(t){var e="";for(var i=0,s=t.length;i<s;i++){var a=t[i];if(a.text){e+=a.text}if(a.content){e+=n(a.content)}}return e}var s=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;a.font=this.style.size+" "+(this.style.fontFace||"Arial");var r=a.measureText((this.text?this.text:"")+(this.content?n(this.content):""));var o=r.width*.5+s;var f=(r.actualBoundingBoxAscent||this.style.size)*.5+s;this._expandBoundingBoxCE(t,e,this.x+o,this.y-f,o,f)};function r(t,e,i){if(t.size){e("font-size",t.size)}if(t.fontFace){e("font-family",t.fontFace)}if(t.fontStyle){e("font-style",t.fontStyle)}if(t.fontWeight){e("font-weight",t.fontWeight)}if(t.textDecoration){e("text-decoration",t.textDecoration)}if(!i){if(t.fill){e("fill",t.fill)}if(t.stroke){e("stroke",t.stroke)}}}n.prototype._setSpecificAttributes=function(t){t("x",this.x);t("y",this.y);if(this.dx){t("dx",this.dx)}if(this.dy){t("dy",this.dy)}r(this.style,t,true)};function o(t,e){if(t.x!==undefined){e("x",t.x)}if(t.y!==undefined){e("y",t.y)}if(t.dx){e("dx",t.dx)}if(t.dy){e("dy",t.dy)}}function f(t,i){if(!t||t.length===0){return}var n=i.attr.bind(i);for(var s=0,a=t.length;s<a;s++){var d=t[s];switch(d.type){case 10:case undefined:case"text":i.text(d.text);break;case 11:case"span":i.openStart("tspan");o(d,n);if(d.style){r(d.style,n)}i.openEnd();if(d.text){i.text(d.text)}f(d.content,i);i.close("tspan");break;case 12:case"path":i.openStart("textPath");o(d,n);if(d.style){r(d.style,n)}if(!d.path&&d.pathSegments){d.path=new e({segments:d.pathSegments})}var h=d.path;if(h instanceof e){i.attr("href","#"+h.uid);i.openEnd();i.openStart(h.tagName());i.attr("id",h.uid);h._setSpecificAttributes(n);i.openEnd();i.close(h.tagName())}else{i.openEnd()}if(d.text){i.text(d.text)}f(d.content,i);i.close("textPath");break;default:break}}}n.prototype._renderContent=function(t){if(this.text){t.text(this.text)}f(this.content,t)};function d(i,n){if(!i||i.length===0){return}var s,a;for(var f=0,h=i.length;f<h;f++){var l=i[f];switch(l.type){case 10:case undefined:case"text":n.append(l.text);break;case 11:case"span":s=document.createElementNS(t._svgNamespace,"tspan");a=s.setAttribute.bind(s);o(l,a);if(l.style){r(l.style,a)}if(l.text){s.append(l.text)}d(l.content,s);n.append(s);break;case 12:case"path":s=document.createElementNS(t._svgNamespace,"textPath");a=s.setAttribute.bind(s);o(l,a);if(l.style){r(l.style,a)}if(!l.path&&l.pathSegments){l.path=new e({segments:l.pathSegments})}var c=l.path;if(c instanceof e){s.setAttribute("href","#"+c.uid);var p=document.createElementNS(t._svgNamespace,c.tagName());p.setAttribute("id",c.uid);c._setSpecificAttributes(p.setAttribute.bind(p));s.append(p)}if(l.text){s.append(l.text)}d(l.content,s);n.append(s);break;default:break}}}n.prototype._createContent=function(t){if(this.text){t.append(this.text)}d(this.content,t)};function h(t){switch(typeof t){case"number":return t;case"string":if(t.endsWith("pt")){return parseFloat(t)*4/3}else if(t.endsWith("em")){return parseFloat(t)*16}return parseFloat(t);default:return 0}}function l(t){var e=[];for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(n.data!==undefined){e.push({type:10,text:n.data})}else if(n.childNodes.length>0){var s={type:11,content:l(n)};var a=n.style;var r={};if(a.fontSize){r.size=a.fontSize}if(a.fontFamily){r.fontFace=a.fontFamily.replaceAll('"',"'")}if(a.textDecoration){r.textDecoration=a.textDecoration}if(a.color){r.fill=a.color}switch(n.tagName){case"EM":r.fontStyle="italic";break;case"STRONG":r.fontWeight="bold";break;default:break}if(Object.keys(r).length){s.style=r}e.push(s)}}return e}function c(t){var e=0;for(var i=0;i<t.length;i++){var n=t[i];var s=n.style&&n.style.size;if(s!==undefined){s=h(s);if(typeof s=="number"&&isFinite(s)){e=Math.max(e,s)}}if(n.content){e=Math.max(e,c(n.content))}}return e}n.prototype.setHtmlTextContent=function(t){var e=document.createElement("html");e.innerHTML=t;var i=[];var n=e.getElementsByTagName("body");var s=n.length>0?n[0].childNodes:[];for(var a=0,r=this.y;a<s.length;a++){var o=s[a];if(o.childNodes.length>0){var f=l(o);var d;if(o.nodeName==="P"){d=Math.max(c(f),h(this.style.size));r+=a>0?d:0}i.push({type:11,x:(o.style.paddingLeft||0)+this.x,y:r,content:l(o)});if(o.nodeName==="P"){r+=d*.25}}else if(o.data){i.push({type:10,text:o.data})}}delete this.text;this.content=i;this.invalidate()};function p(t,e){var i="";var n=[];for(var s=0;s<t.length;s++){var a=t[s];switch(a.type){case 10:case undefined:case"text":i+=a.text;break;case 11:case"span":case 12:case"path":var r=a.style;if(!e||a.y!==undefined||a.dy!==undefined){n.push("p");i+='<p style="text-align: left;';if(a.x){i+=" padding-left: "+(typeof a.x==="number"?a.x+"px":a.x)+";"}i+='">'}if(r){if(r.textDecoration||r.size||r.fontFace||r.fill){n.push("span");i+='<span style="';if(r.textDecoration){i+="text-decoration: "+r.textDecoration+";"}if(r.size){i+="font-size: "+h(r.size)*.75+"pt;"}if(r.fill){i+="color: "+r.fill+";"}if(r.fontFace){i+="font-family: "+r.fontFace+";"}i+='">'}if(r.fontStyle==="italic"){n.push("em");i+="<em>"}if(r.fontWeight==="bold"){n.push("strong");i+="<strong>"}}if(n.length===0){n.push("span");i+="<span>"}if(a.text){i+=a.text}i+=p(a.content,true);var o=n.pop();while(o!==undefined){i+="</"+o+">";o=n.pop()}break;default:break}}return i}n.prototype.getHtmlTextContent=function(){var t=p(this.content,false);return this.text?this.text+t:t};function y(t,e){var i=[];for(var n=0;n<t.length;n++){var s=t[n];switch(s.type){case undefined:case"text":i.push({type:10,text:s.text});break;default:case"span":case"path":var a={type:s.type==="path"?12:11};if(s.x!==undefined){a.x=s.x}if(s.y!==undefined){a.x=s.y}if(s.dx!==undefined){a.x=s.dx}if(s.dy!==undefined){a.x=s.dy}if(s.style_id){a.style=e.get(s.style_id)}if(s.text){a.text=s.text}if(s.children){a.content=y(s.children,e)}i.push(a);break}}return i}function x(t,e){var n=[];for(var s=0;s<t.length;s++){var a=t[s];switch(a.type){case 10:case undefined:n.push({text:a.text});break;case 11:case"span":case 12:case"path":var r={type:"span"};if(a.x!==undefined){r.x=a.x}if(a.y!==undefined){r.y=a.y}if(a.dx!==undefined){r.dx=a.dx}if(a.dy!==undefined){r.dy=a.dy}if(a.text){r.text=a.text}var o=a.style;if(o){o.veid=o.veid||i();r["style_id"]=o.veid;e.push(o)}if(a.content){r.children=x(a.content,e)}n.push(r);break;default:break}}return n}n.prototype._getParametricShape=function(e,n,s){var a=t.prototype._getParametricShape.call(this,e,n,s);a.type="text";if(a.s){a.s[1]*=-1}if(this.x){a.x=this.x}if(this.y){a.y=this.y}if(this.dx){a.dx=this.dx}if(this.dy){a.dy=this.dy}var r=this.style;if(r){r.veid=r.veid||i();a["style_id"]=r.veid;s.push(r)}if(this.text){a.text=this.text}a.children=x(this.content,s);return a};n.prototype.copy=function(e,i){t.prototype.copy.call(this,e,i);this.text=e.text;this.content=e.content;this.style=e.style;this.x=e.x;this.y=e.y;if(e.dx){this.dx=e.dx}if(e.dy){this.dy=e.dy}return this};return n});