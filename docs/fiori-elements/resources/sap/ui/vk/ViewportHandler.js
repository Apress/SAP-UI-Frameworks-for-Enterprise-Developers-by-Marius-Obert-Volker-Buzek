/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/EventProvider","sap/base/Log"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.ViewportHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(t){this._viewport=t;this._rect=null;this._evt={x:0,y:0,z:0,d:0,tdx:0,tdy:0,tdd:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false}});i.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){if(this._rect==null||true){var e=this._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};i.prototype._onresize=function(t){this._gesture=false;this._rect=null};i.prototype.hover=function(t){if(this._viewport.hover&&this._inside(t)){this._viewport.queueCommand(function(){this._viewport.hover(t.x-this._rect.x,t.y-this._rect.y)}.bind(this));t.handled=true}};i.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._gesture=true;var i=t.x-this._rect.x,s=t.y-this._rect.y;this._evt.tdx=0;this._evt.tdy=0;this._evt.tdd=0;this._evt.x=i;this._evt.y=s;this._evt.d=t.d;this._evt.initd=t.d;this._evt.avgd=t.d;this._evt.avgx=0;this._evt.avgy=0;e.debug("Loco: beginGesture: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.beginGesture(i,s)}.bind(this));t.handled=true}this._nomenu=false};i.prototype.move=function(t){if(this._gesture){var i=t.x-this._rect.x,s=t.y-this._rect.y;var n=i-this._evt.x;var o=s-this._evt.y;var r=t.d-this._evt.d;this._evt.tdx=this._evt.tdx+n;this._evt.tdy=this._evt.tdy+o;this._evt.tdd=this._evt.tdd+r;this._evt.x=i;this._evt.y=s;this._evt.d=t.d;this._evt.avgx=this._evt.avgx*.99+n*.01;this._evt.avgy=this._evt.avgy*.99+o*.01;var h=1;if(this._evt.initd>0){h=1+r*(1/this._evt.initd)}else if(t.n==2){if(t.points[0].y>t.points[1].y){h=1-r*.005;if(h<.333){h=.333}}else{h=1+r*.005;if(h>3){h=3}}}if(this._evt.initd>0){var _=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);e.debug("AvgDist: "+_);if(Math.abs(t.d-this._evt.avgd)/this._evt.avgd<_/10){h=1}}this._evt.avgd=this._evt.avgd*.97+t.d*.03;this._evt.n=t.n;switch(t.n){case 1:e.debug("Loco: Rotate: "+n+", "+o);this._viewport.queueCommand(function(){this._viewport.rotate(n,o)}.bind(this));break;case 2:e.debug("Loco: Pan: "+n+", "+o);if(h!=0&&h!=1){e.debug("Loco: Zoom: "+h)}this._viewport.queueCommand(function(){if(this._evt.tdx!==0&&this._evt.tdy!==0){this._viewport.pan(n,o)}if(n<10&&o<10&&h!=0&&h!=1&&this._evt.tdd!==0){this._viewport.zoom(h)}}.bind(this));break;default:break}this._nomenu=true;t.handled=true}};i.prototype.endGesture=function(t){if(this._gesture){var i=t.x-this._rect.x,s=t.y-this._rect.y;e.debug("Loco: endGesture: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.endGesture()}.bind(this));this._gesture=false;t.handled=true}};i.prototype.click=function(t){if(this._inside(t)&&t.buttons<=1){var i=t.x-this._rect.x,s=t.y-this._rect.y;e.debug("Loco: click: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.tap(i,s,false)}.bind(this));t.handled=true}};i.prototype.doubleClick=function(t){if(this._inside(t)&&t.buttons<=1){var i=t.x-this._rect.x,s=t.y-this._rect.y;e.debug("Loco: doubleClick: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.tap(i,s,true)}.bind(this));t.handled=true}};i.prototype.contextMenu=function(t){if(this._inside(t)||this._nomenu||t.buttons==5){this._nomenu=false;t.handled=true}};i.prototype.keyEventHandler=function(t){};i.prototype.getViewport=function(){return this._viewport};return i});