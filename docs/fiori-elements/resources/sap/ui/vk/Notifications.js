/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/Log","./library","sap/ui/core/Control","./Messages","sap/m/ToggleButton","./NotificationsRenderer","./getResourceBundle"],function(e,t,s,i,o,a,r){"use strict";var g=s.extend("sap.ui.vk.Notifications",{metadata:{library:"sap.ui.vk",publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});g.prototype.init=function(){if(s.prototype.init){s.prototype.init.call(this)}var t;var i=new o({icon:"sap-icon://message-popup",type:sap.m.ButtonType.Emphasized,tooltip:r().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(i.getPressed()){t.openBy(i)}else{t.close()}}});i.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",i);t=new sap.m.MessagePopover({headerButton:new sap.m.Button({text:r().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:sap.m.ButtonType.Emphasized,tooltip:r().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){t.getParent().clearAllMessages()}}),afterClose:i.setPressed.bind(i,false)});t.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",t);e.addLogListener(this)};g.prototype.exit=function(){e.removeLogListener(this);if(s.prototype.exit){s.prototype.exit.call(this)}};g.prototype.onLogEntry=function(t){if(t.component.startsWith("sap.ui.vk")&&(t.level===e.Level.WARNING||t.level===e.Level.ERROR||t.level===e.Level.FATAL)){var s=t.details,o,a,g;if(i[t.details]){s=r().getText(i[t.details].summary);o=r().getText(i[t.details].cause);a=r().getText(i[t.details].resolution);g=r().getText("ERROR_DESCRIPTION_CODE")}var l=r().getText("ERROR_DESCRIPTION_COMPONENT");var n=r().getText("ERROR_DESCRIPTION_DATE");var p=r().getText("ERROR_DESCRIPTION_TIME");var v=r().getText("ERROR_DESCRIPTION_LEVEL");var d=r().getText("ERROR_DESCRIPTION_MESSAGE");var R=r().getText("ERROR_DESCRIPTION_CAUSE");var T=r().getText("ERROR_DESCRIPTION_RESOLUTION");var E="<div><b>"+l+":</b><br>"+t.component+"</div><br>"+"<div><b>"+n+":</b><br>"+t.date+"</div><br>"+(g?"<div><b>"+g+":</b><br>"+t.details+"</div><br>":"")+"<div><b>"+p+":</b><br>"+t.time.slice(0,t.time.indexOf("."))+"</div><br>"+"<div><b>"+v+":</b><br>"+t.level+"</div><br>"+"<div><b>"+d+":</b><br>"+s+"</div><br>"+(o?"<div><b>"+R+":</b><br>"+o+"</div><br>":"")+(a?"<div><b>"+T+":</b><br>"+a+"</div>":"");var m=new sap.m.MessageItem({markupDescription:true,title:t.message,description:E});var b=this.getAggregation("_messagePopover");b.addItem(m);this.getAggregation("_messagePopoverToggleButton").setText(b.getItems().length);this.fireMessageAdded()}};g.prototype.clearAllMessages=function(){var e=this.getAggregation("_messagePopover");e.removeAllItems();e.close();this.getAggregation("_messagePopoverToggleButton").setText(e.getItems().length);this.fireAllMessagesCleared();return this};return g});