/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./Utils","sap/base/Log"],function(e,r){"use strict";function t(e,a){this._uid=e.uid;var i=Math.sqrt(a[2]*a[2]+a[3]*a[3]);this._samplingKoeff=1e4/i;this._tagName=e.tagName();this._matrix=e._matrixWorld();this._invMatrix=t.invertMatrix3x2(this._matrix);switch(this._tagName){case"ellipse":this.cx=e.cx;this.cy=e.cy;this.rx=e.rx;this.ry=e.ry;break;case"image":this.x=e.x;this.y=e.y;this.width=e.width;this.height=e.height;break;case"line":case"linearGradient":this.x1=e.x1;this.y1=e.y1;this.x2=e.x2;this.y2=e.y2;break;case"path":this.segments=e.segments;break;case"polygon":case"polyline":this.points=e.points;break;case"rect":this.x=e.x;this.y=e.y;this.rx=e.rx;this.ry=e.ry;this.width=e.width;this.height=e.height;break;case"text":break;default:r.error("Unknown svg tag: "+this._tagName);break}}t.invertMatrix3x2=function(e){var t=e[0];var a=e[1];var i=e[2];var n=e[3];var s=e[4];var l=e[5];var o=t*n-a*i;if(!o){r.error("Empty determinant of matrix 'a'");return null}o=1/o;var v=[];v.push(n*o);v.push(-a*o);v.push(-i*o);v.push(t*o);v.push((i*l-n*s)*o);v.push((a*s-t*l)*o);return v};t.transform2d=function(e,r){var t=e[0];var a=e[1];return[r[0]*t+r[2]*a+r[4],r[1]*t+r[3]*a+r[5]]};t.distanceToRectangle=function(r,t,a,i,n,s,l,o,v){var u=a*a;var c=Number.MAX_VALUE;var h;var f=Number.MAX_VALUE;var m;var p;var d=[r,t,0];var g=[];for(var x=0;x<4;++x){var P=s+(x===0||x===3?0:o);var y=l+(x===0||x===1?0:v);g.push(P,y);if(n){p=e.computePointToPointDistance2([P,y,0],d);if(p<c){c=p;h=[P,y]}}if(i){var T=(x+1)%4;var b=s+(T===0||T===3?0:o);var D=l+(T===0||T===1?0:v);p=e.computeEdgeToPointDistance2([P,y,0],[b,D,0],d);if(p<f){f=p;m=[P,y,b,D]}}}var _=c<u?h:null;var M=f<u?m:null;g.push(g[0],g[1]);return[_,M,!_&&M?g:null]};t.distanceToLine=function(r,t,a,i,n,s,l,o,v){var u=null;var c=null;var h=a*a;var f=[s,l,0];var m=[o,v,0];var p=[r,t,0];if(i&&e.computeEdgeToPointDistance2(f,m,p)<h){c=[f[0],f[1],m[0],m[1]]}if(n){var d=e.computePointToPointDistance2(f,p);var g=e.computePointToPointDistance2(m,p);if(d<g&&d<h){u=f}else if(g<d&&g<h){u=m}}return[u,c]};t.distanceToPolyLine=function(r,t,a,i,n,s,l){var o=null;var v=null;var u=a*a;var c=Number.MAX_VALUE;var h;var f=Number.MAX_VALUE;var m;var p;var d=[r,t,0];var g;var x;var P;var y;var T=l.length;if(T<2){return[]}for(var b=0;b<T;b+=2){g=l[b];x=l[b+1];if(n){p=e.computePointToPointDistance2([g,x,0],d);if(p<c){c=p;h=[g,x]}}if(i){if(b>0){p=e.computeEdgeToPointDistance2([P,y,0],[g,x,0],d);if(p<f){f=p;m=[P,y,g,x]}}else if(s){P=l[T-2];y=l[T-1];f=e.computeEdgeToPointDistance2([P,y,0],[g,x,0],d);m=[P,y,g,x]}}P=g;y=x}if(c<u){o=h}if(f<u){v=m}var D=null;if(!o&&v){D=Array.from(l);if(s){D.push(l[0],l[1])}}return[o,v,D]};t.distanceToEllipse=function(r,t,a,i,n,s,l,o,v){var u=null;var c=[r,t,0];var h=[i,n,0];var f=e.computePointToPointDistance2(h,c);u=[i,n];var m=e.computeEdgeDirection(h,c);var p=e.angleBetweenVectors2D(1,0,m[0],m[1]);if(o!=null&&v!=null){p=e.clampAngle(p,o,v)}m=[i+s*Math.cos(p),n+l*Math.sin(p),0];var d=e.computePointToPointDistance2(m,c);if(d<f){f=d;u=m}return f<a*a?u:null};t.computeArcCenter=function(r,t,a,i,n,s,l,o){var v=l===false;var u=o!==false;var c=.5*(r-a);var h=.5*(t-i);var f=c*c/(n*n)+h*h/(s*s);if(f>1){f=Math.sqrt(f);n=n*f;s=s*f}var m=n*s;var p=n*h;var d=s*c;f=p*p+d*d;if(!f){return null}var g=Math.sqrt(Math.abs((m*m-f)/f));if(v==u){g=-g}var x=g*p/s;var P=-g*d/n;var y=x+.5*(r+a);var T=P+.5*(t+i);var b=(c-x)/n;var D=(c+x)/n;var _=(h-P)/s;var M=(h+P)/s;var A=e.angleBetweenVectors2D(1,0,b,_);var E=e.clampAngle2PI(e.angleBetweenVectors2D(b,_,-D,-M));if(!u){E-=2*Math.PI}return{cx:y,cy:T,rx:n,ry:s,startAngle:A,deltaAngle:E}};t.sampleBezier=function(r,t,a,i,n){return n?e.bezierCubic2D(r,t,i,n,a):e.bezierQuadric2D(r,t,i,a)};t.sampleBezierCurve=function(r,a,i,n,s){var l=e.computePointToPointDistance2D(r,i);if(n){l+=e.computePointToPointDistance2D(i,n);l+=e.computePointToPointDistance2D(n,a)}else{l+=e.computePointToPointDistance2D(i,a)}var o=Math.min(Math.max(l*s,35),200);var v=[];for(var u=0;u<o;++u){var c=t.sampleBezier(u/o,r,a,i,n);v.push(c[0],c[1])}return v};t.sampleEllipse=function(e,r,t,a,i,n,s){var l=Math.max(t,a)*n;var o=Math.min(Math.max(l*s,35),200);var v=[];for(var u=0;u<o;++u){var c=i+u*n/o;v.push(e+t*Math.cos(c),r+a*Math.sin(c))}return v};t.distanceToBezier=function(r,a,i,n,s,l,o){var v=[r,a,0];var u=Number.MAX_VALUE;var c;var h;var f;var m;var p;var d=100;var g=function(e){if(e<=0){return n}if(e>=1){return s}return t.sampleBezier(e,n,s,l,o)};for(p=0;p<=d;++p){f=p/d;h=g(f);m=e.computePointToPointDistance2(h,v);if(m<u){u=m;c=f}}p=.5/d;while(p>1e-8){for(d=0;d<2;++d){f=d==0?c-p:c+p;h=g(f);m=e.computePointToPointDistance2(h,v);if(m<u){u=m;c=f}}p*=.5}return u>i*i?null:g(c)};t.distanceToPath=function(r,a,i,n,s,l,o,v,u){var c=[];var h=[];var f=null;var m=null;var p=0;var d=i*i;var g=Number.MAX_VALUE;var x;var P=Number.MAX_VALUE;var y;var T;var b=[r,a,0];var D;var _;var M;var A;var E;var k=0;var w=0;var I=0;var L=0;var N=null;var z=null;var B=null;var C=null;var V=function(e,r,t,a,i){var n=c.length;if(!n||c[n-2]!==e||c[n-1]!==r){p++;h.push(i?-p:p);c.push(e,r)}h.push(i?-p:p);c.push(t,a)};var U=function(e,r,t,a,i){var n=e;var s=r;var l,o;for(var v=0,u=t.length;v<u;v+=2){l=t[v];o=t[v+1];V(n,s,l,o,true);n=l;s=o}V(n,s,a,i,true)};var X=function(){if(s){T=e.computePointToPointDistance2([k,w,0],b);if(T<g){g=T;x=[k,w];m=null}}if(N!=null){if(l){V(N,z,k,w,false)}if(n){T=e.computeEdgeToPointDistance2([N,z,0],[k,w,0],b);if(T<P){P=T;y=[N,z,k,w];f=h.length-1}}}N=k;z=w};for(var q=0,K=v.length;q<K;++q){D=v[q];_=D.points;M=D.dimension||2;switch(D.type){case"arc":N=k;z=w;if(D.relative){k+=_[0];w+=_[1]}else{k=_[0];w=_[1]}var S=t.computeArcCenter(N,z,k,w,D.major,D.minor,D.short,D.clockwise);if(S){if(l){U(N,z,t.sampleEllipse(S.cx,S.cy,S.rx,S.ry,S.startAngle,S.deltaAngle,u),k,w)}if(s){var G=t.distanceToEllipse(r,a,i,S.cx,S.cy,S.rx,S.ry,S.startAngle,S.deltaAngle);if(G){var R=e.computePointToPointDistance2(G,b);if(R<g){g=R;x=G;f=h.length-1;if(o&&e.computePointToPointDistance2(G,[N,z,0])>d&&e.computePointToPointDistance2(G,[k,w,0])>d){m=[N,z].concat(t.sampleEllipse(S.cx,S.cy,S.rx,S.ry,S.startAngle,S.deltaAngle,u),[k,w])}}}}}break;case"move":N=null;z=null;k=_[0];w=_[1];I=k;L=w;X();for(A=M,E=_.length-1;A<E;A+=M){if(D.relative){k+=_[A];w+=_[A+1]}else{k=_[A];w=_[A+1]}X()}break;case"line":N=k;z=w;for(A=0,E=_.length-1;A<E;A+=M){if(D.relative){k+=_[A];w+=_[A+1]}else{k=_[A];w=_[A+1]}X()}break;case"close":N=k;z=w;k=I;w=L;X();break;case"bezier":var j=D.degree||2;var Q=0;var W=j-1;if(D.smooth){W--;B=k;C=w}var F=[null,null];for(A=0,E=_.length-1;A<E;A+=M){if(Q===0){I=k;L=w;N=null;z=null}if(Q<W){if(D.relative){F[Q]=[k+_[A],w+_[A+1]]}else{F[Q]=[_[A],_[A+1]]}Q++}else{if(D.relative){k+=_[A];w+=_[A+1]}else{k=_[A];w=_[A+1]}var H=[2*I-B,2*L-C];var J=D.smooth||j===2?0:1;B=F[J][0];C=F[J][1];var O=D.smooth?H:F[0];var Y=j===2?null:[B,C];var Z=[I,L];var $=[k,w];if(l){U(Z[0],Z[1],t.sampleBezierCurve(Z,$,O,Y,u),$[0],$[1])}if(s){var ee=t.distanceToBezier(r,a,i,Z,$,O,Y);if(ee){var re=e.computePointToPointDistance2(ee,b);if(re<g){g=re;x=ee;f=h.length-1;if(o&&e.computePointToPointDistance2(ee,[I,L,0])>d&&e.computePointToPointDistance2(ee,[k,w,0])>d){m=[Z[0],Z[1]].concat(t.sampleBezierCurve(Z,$,O,Y,u),[$[0],$[1]])}}}}Q=0}}break;default:break}}var te=g<d?x:null;var ae=P<d?y:null;var ie=l&&(te||ae)?e.findClosedContour(c,h,f):null;return[te,ae,ie,te?m:null]};t.prototype.intersectSphere=function(r,a,i,n,s,l,o){var v={faceId:null,edgeId:null,vertexId:null,contourId:null,curvedEdgeId:null,edge:null,vertex:null,contour:null,curvedEdge:null};var u=r[0];var c=r[1];var h=t.transform2d([u,c],this._invMatrix);var f=t.transform2d([u+a,c],this._invMatrix);u=h[0];c=h[1];var m=Math.sqrt((f[0]-u)*(f[0]-u)+(f[1]-c)*(f[1]-c));var p=[];switch(this._tagName){case"ellipse":if(s){var d=t.distanceToEllipse(u,c,m,this.cx,this.cy,this.rx,this.ry,null,null);if(d){if(l){var g=t.sampleEllipse(this.cx,this.cy,this.rx,this.ry,0,2*Math.PI,this._samplingKoeff);g.push(g[0],g[1]);p.push(d,null,g)}else{p.push(d)}}}break;case"rect":case"image":p=t.distanceToRectangle(u,c,m,n,s,this.x,this.y,this.width,this.height);break;case"line":case"linearGradient":p=t.distanceToLine(u,c,m,n,s,this.x1,this.y1,this.x2,this.y2);break;case"path":p=t.distanceToPath(u,c,m,n,s,l,o,this.segments,this._samplingKoeff);break;case"polygon":p=t.distanceToPolyLine(u,c,m,n,s,true,this.points);break;case"polyline":p=t.distanceToPolyLine(u,c,m,n,s,false,this.points);break;default:break}f=p.length>0?p[0]:null;if(f){var x=t.transform2d([f[0],f[1]],this._matrix);v.vertex=[x[0],x[1],0];v.vertexId="v"+x[0]+":"+x[1]}f=p.length>1?p[1]:null;if(f){var P=t.transform2d([f[0],f[1]],this._matrix);var y=t.transform2d([f[2],f[3]],this._matrix);v.edge=[P[0],P[1],0,y[0],y[1],0];v.edgeId="e"+P[0]+":"+P[1]+":"+y[0]+":"+y[1]}f=p.length>2?p[2]:null;var T;if(l&&f&&f.length>=6){var b=[];for(var D=0,_=f.length/2;D<_;++D){T=t.transform2d([f[D*2],f[D*2+1]],this._matrix);b.push(T[0],T[1],0)}if(e.isClosedContour(b)&&!e.hasSelfIntersections(b,false)){v.contour=b;v.contourId="cc:"+(this._uid?this._uid:"")+":"+b[0]+":"+b[1]}}f=p.length>3?p[3]:null;if(o&&f&&f.length>=6){var M=[];for(var A=0,E=f.length/2;A<E;++A){T=t.transform2d([f[A*2],f[A*2+1]],this._matrix);M.push(T[0],T[1],0)}if(!e.hasSelfIntersections(M,true)){v.curvedEdge=M;v.curvedEdgeId="ce:"+(this._uid?this._uid:"")+":"+M[0]+":"+M[1]}}return v};return t});