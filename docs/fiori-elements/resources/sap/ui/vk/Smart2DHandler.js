/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.Smart2DHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(t,e){this._viewport=t;this._rect=null;this._x=0;this._y=0;this._gesture=false;this._hitEndTimer=0;this._lastRender=0;this._viewport.attachEvent("resize",this,this._onresize);this._viewStateManager=e;this._previousColoring={nodeRef:null,nodeId:null,color:null}}});i.prototype.destroy=function(){this._viewport=null;this._rect=null;this._gesture=false;this._viewport.detachEvent("resize",this,this._onresize);this._viewStateManager=null;this._previousColoring=null};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._viewport.getDomRef();if(e==null){return false}var i=this._getOffset(e);this._rect={x:i.x,y:i.y,w:e.offsetWidth,h:e.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};i.prototype._onresize=function(t){this._gesture=false;this._rect=null};i.prototype.beginGesture=function(t){if(this._inside(t)){this._gesture=true;this._x=t.x;this._y=t.y}};i.prototype.callbackHover=function(){var t=this._viewStateManager.getNodeHierarchy();this._lastRender=Date.now();this._hitEndTimer=0;var e=this._viewport.hitTest(this._x,this._y);if(this._highlightedNodeRef!==e){if(this._highlightedNodeRef!==sap.ve.dvl.DVLID_INVALID){var i=this._highlightedNodeRef===this._previousColoring.nodeRef?this._previousColoring.color:0;this._viewport.showHotspots(this._highlightedNodeRef,true,i)}if(t.getHotspotNodeIds().indexOf(e)!==-1){var o=t.createNodeProxy(e);this._previousColoring={nodeRef:e,nodeId:e,color:o.getTintColorABGR()};t.destroyNodeProxy(o);this._viewport.showHotspots(e,true)}this._highlightedNodeRef=e}this._viewport.renderFrame()};i.prototype.hover=function(t){if(t.n==1&&this._inside(t)){this._x=t.x-this._rect.x;this._y=t.y-this._rect.y;if(!this.getViewport().getShowAllHotspots()){var e=Date.now();if(e-this._lastRender>20){this.callbackHover()}if(this._hitEndTimer!=0){clearTimeout(this._hitEndTimer)}this._hitEndTimer=setTimeout(this.callbackHover.bind(this),20)}t.handled=true}};i.prototype.move=function(t){if(this._gesture&&t.n==1){this._viewport.pan(t.x-this._x,t.y-this._y);this._x=t.x;this._y=t.y;t.handled=true}};i.prototype.endGesture=function(t){this._gesture=false};i.prototype.click=function(t){};i.prototype.doubleClick=function(t){};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._viewport};return i});