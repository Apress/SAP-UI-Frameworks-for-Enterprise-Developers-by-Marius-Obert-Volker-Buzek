/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/Log","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/flexibility/Util","sap/ui/fl/changeHandler/condenser/Classification"],function(e,n,t,i,r){"use strict";var o=function(e,n){var t=function(n){if(e._pQueue===n){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(n):n();e._pQueue.then(t.bind(null,e._pQueue));return e._pQueue};var a=function(e){return new Promise(function(n,t){sap.ui.require([e],n,t)})};var u=function(r,u,f,d){var c=d===i.REVERT;var l=c?r.getRevertData():r.getContent();var s,g=null,v=f.modifier;return o(u,function(){return v.getProperty(u,"filterConditions").then(function(i){s=e({},i);if(s){for(var o in s){if(o===l.name){g=s[o];break}}}if(!g){s[l.name]=[];g=s[l.name]}if(!c){r.setRevertData({name:l.name,condition:l.condition})}var d=t.indexOfCondition(l.condition,g);if(d<0){g.push(l.condition);v.setProperty(u,"filterConditions",s);return v.getProperty(u,"delegate").then(function(e){return a(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?e.getFilterDelegate().addCondition:e.addCondition);if(t){return t(l.name,u,f).catch(function(e){n.error("Error during Delegate.addCondition call: "+e)})}}).finally(function(){if(c){r.resetRevertData()}})}})})};var f=function(r,u,f,d){var c=d===i.REVERT;var l=c?r.getRevertData():r.getContent();var s,g,v=-1,p=f.modifier;return o(u,function(){return p.getProperty(u,"filterConditions").then(function(i){s=e({},i);if(s){for(var o in s){if(o===l.name){g=s[o];break}}}if(!c){r.setRevertData({name:l.name,condition:l.condition})}if(g&&g.length>0){v=t.indexOfCondition(l.condition,g);if(v>=0){g.splice(v,1);p.setProperty(u,"filterConditions",s);return p.getProperty(u,"delegate").then(function(e){return a(e.name)}).then(function(e){var t=e&&(e.getFilterDelegate?e.getFilterDelegate().removeCondition:e.removeCondition);if(t){return t(l.name,u,f).catch(function(e){n.error("Error during Delegate.removeCondition call: "+e)})}}).finally(function(){if(c){r.resetRevertData()}})}}})})};var d=function(e,n){var t=e.getContent();return{classification:r.Reverse,affectedControl:e.getSelector(),uniqueKey:t.name+"_"+JSON.stringify(t.condition)}};var c={};c.addCondition=i.createChangeHandler({apply:u,revert:f,getCondenserInfo:d});c.removeCondition=i.createChangeHandler({apply:f,revert:u,getCondenserInfo:d});return c});