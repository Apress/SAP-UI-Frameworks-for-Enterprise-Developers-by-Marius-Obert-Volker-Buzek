/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./TableTypeBase","../library","sap/ui/core/library"],function(e,t,o){"use strict";var i,n,r,a,s,l,u,d;var c=t.RowCountMode;var g=o.SortOrder;var p=e.extend("sap.ui.mdc.table.GridTableType",{metadata:{library:"sap.ui.mdc",properties:{rowCountMode:{type:"sap.ui.mdc.RowCountMode",defaultValue:c.Auto},rowCount:{type:"int",defaultValue:10},selectionLimit:{type:"int",defaultValue:200},showHeaderSelector:{type:"boolean",defaultValue:true},fixedColumnCount:{type:"int",defaultValue:0}}}});p.prototype.exit=function(){e.prototype.exit.apply(this,arguments);this.disableColumnResize()};p.prototype.updateTableByProperty=function(e,t){var o=this.getInnerTable();var i=this._getMultiSelectionPlugin();if(!o){return}if(e==="rowCountMode"){var n=o.getRowMode();var r=false;if(n&&(t===c.Fixed&&!n.isA("sap.ui.table.rowmodes.FixedRowMode")||t===c.Auto&&!n.isA("sap.ui.table.rowmodes.AutoRowMode"))){r=n.getHideEmptyRows();n.destroy();n=null}if(!n){var a=t===c.Fixed?l:u;o.setRowMode(new a({hideEmptyRows:r}))}this._updateTableRowCount()}else if(e==="rowCount"){this._updateTableRowCount()}else if(e==="selectionLimit"){if(i){i.setLimit(t).setEnableNotification(t>0)}}else if(e==="showHeaderSelector"){if(i){i.setShowHeaderSelector(t)}}else if(e==="fixedColumnCount"){o.setFixedColumnCount(t)}};p.prototype._updateTableRowCount=function(){var e=this.getInnerTable();if(this.getRowCountMode()===c.Fixed){e.getRowMode().setRowCount(this.getRowCount())}else{e.getRowMode().setMinRowCount(this.getRowCount())}};p.prototype.loadUiTableLibrary=function(){if(!this._oGridTableLibLoaded){this._oGridTableLibLoaded=sap.ui.getCore().loadLibrary("sap.ui.table",true)}return this._oGridTableLibLoaded};p.prototype.loadModules=function(){if(i){return Promise.resolve()}return this.loadUiTableLibrary().then(function(){return new Promise(function(e,t){sap.ui.require(["sap/ui/table/Table","sap/ui/table/Column","sap/ui/table/RowAction","sap/ui/table/RowActionItem","sap/ui/table/plugins/MultiSelectionPlugin","sap/ui/table/rowmodes/FixedRowMode","sap/ui/table/rowmodes/AutoRowMode","sap/ui/table/RowSettings"],function(t,o,c,g,p,h,f,b){i=t;n=o;r=c;a=g;s=p;l=h;u=f;d=b;e()},function(){t("Failed to load some modules")})})})};p.prototype.createTable=function(e){var t=this.getTable();if(!t||!i){return null}return new i(e,this.getTableSettings())};p.prototype.getTableSettings=function(){var t=this.getTable();return Object.assign({},e.prototype.getTableSettings.apply(this,arguments),{enableBusyIndicator:true,enableColumnReordering:false,threshold:this.getThreshold(),cellClick:[this._onCellClick,this],noData:t._getNoDataText(),extension:[t._oToolbar],ariaLabelledBy:[t._oTitle],plugins:[this._createSelectionPlugin()],rowSettingsTemplate:this.getRowSettingsConfig(),selectionBehavior:this._getSelectionBehavior()})};p.prototype._onCellClick=function(e){this.callHook("RowPress",this.getTable(),{bindingContext:e.getParameter("rowBindingContext")})};p.prototype._onSelectionChange=function(e){this.callHook("SelectionChange",this.getTable(),{bindingContext:e.getParameter("rowContext"),selected:e.getSource().isIndexSelected(e.getParameter("rowIndex")),selectAll:e.getParameter("selectAll")})};p.createColumn=function(e,t){return new n(e,t)};p.prototype._createSelectionPlugin=function(){return new s({selectionMode:this._getSelectionMode(),selectionChange:[this._onSelectionChange,this]})};p.prototype._getMultiSelectionPlugin=function(){var e=this.getInnerTable();var t=e?e.getPlugins()[0]:undefined;return t&&t.isA("sap.ui.table.plugins.MultiSelectionPlugin")?t:null};p.prototype.enableColumnResize=function(){var e=this.getTable();var t=this.getInnerTable();if(!e||!t){return}t.getColumns().forEach(function(e){e.setResizable(true);e.setAutoResizable(true)});t.detachColumnResize(this._onColumnResize,this);t.attachColumnResize(this._onColumnResize,this)};p.prototype.disableColumnResize=function(){var e=this.getTable();var t=this.getInnerTable();if(!e||!t){return}t.getColumns().forEach(function(e){e.setResizable(false);e.setAutoResizable(false)});t.detachColumnResize(this._onColumnResize,this)};p.prototype._onColumnResize=function(e){var t=this.getTable();var o=this.getInnerTable();var i=e.getParameter("column");var n=e.getParameter("width");var r=o.indexOfColumn(i);var a=t.getColumns()[r];this.callHook("ColumnResize",t,{column:a,width:n})};p.prototype._getSelectionMode=function(){var e=this.getTable();var t=e?e.getSelectionMode():undefined;var o={Single:"Single",SingleMaster:"Single",Multi:"MultiToggle",None:"None",undefined:"None"};return o[t]};p.prototype._getSelectionBehavior=function(){var e=this.getTable();var t={SingleMaster:"RowOnly"};return t[e?e.getSelectionMode():undefined]};p.prototype.updateSelectionSettings=function(){var e=this.getTable();var t=this.getInnerTable();var o=this._getMultiSelectionPlugin();if(!e||!t){return}t.setSelectionBehavior(this._getSelectionBehavior());if(o){o.setSelectionMode(this._getSelectionMode())}};p.prototype.updateRowSettings=function(){var e=this.getInnerTable();if(!e){return}e.destroyRowSettingsTemplate();e.setRowSettingsTemplate(new d(this.getRowSettingsConfig()));this.updateRowActions()};p.prototype.updateRowActions=function(){var e=this.getInnerTable();if(!e){return}var t=this.getTable().getRowSettings();this._removeRowActions();if(!t||!t.isBound("rowActions")&&(!t.getRowActions()||t.getRowActions().length==0)){return}var o=t.getAllActions();if("templateInfo"in o){var i=o.templateInfo;o.items.template=new a({type:i.type,visible:i.visible,icon:i.icon,text:i.text,press:[this._onRowActionPress,this]});delete o.templateInfo}else{o.items=o.items.map(function(e){var t=new a({type:e.isBound("type")?e.getBindingInfo("type"):e.getType(),visible:e.isBound("visible")?e.getBindingInfo("visible"):e.getVisible(),icon:e.isBound("icon")?e.getBindingInfo("icon"):e._getIcon(),text:e.isBound("text")?e.getBindingInfo("text"):e._getText(),press:[this._onRowActionPress,this]});t.data("rowAction",e);return t},this)}e.setRowActionTemplate(new r(o));e.setRowActionCount(t.getRowActionCount())};p.prototype._removeRowActions=function(){var e=this.getInnerTable();var t=e.getRowActionTemplate();if(t){t.destroy()}e.setRowActionTemplate();e.setRowActionCount()};p.prototype._onRowActionPress=function(e){var t=this.getTable();var o=e.getParameter("item");var i=t.getRowSettings();var n=i.getAllActions();if(i.isBound("rowActions")){var r=n.items.model;var a=o.getBindingContext(r);if(!this._oRowActionItem){this._oRowActionItem=n.items.template.clone()}this._oRowActionItem.setBindingContext(a,n.items.model);this._oRowActionItem.setModel(this.getModel(r),r);i.addDependent(this._oRowActionItem)}else{this._oRowActionItem=o.data("rowAction")}this.callHook("Press",this._oRowActionItem,{bindingContext:e.getParameter("row").getBindingContext()})};p.prototype.removeToolbar=function(){var e=this.getInnerTable();if(e){e.removeExtension(this.getTable()._oToolbar)}};p.prototype.scrollToIndex=function(e){var t=this.getTable();var o=this.getInnerTable();if(!o){return Promise.reject()}return new Promise(function(i){if(e===-1){e=t._getRowCount(false)}if(o._setFirstVisibleRowIndex(e)){o.attachEventOnce("rowsUpdated",function(){i()})}else{i()}})};p.prototype.getRowBinding=function(){var e=this.getInnerTable();return e?e.getBinding():undefined};p.prototype.bindRows=function(e){var t=this.getInnerTable();if(t){t.bindRows(e)}};p.prototype.isTableBound=function(){var e=this.getInnerTable();return e?e.isBound("rows"):false};p.prototype.insertFilterInfoBar=function(e,t){var o=this.getInnerTable();if(o){o.insertExtension(e,1);if(!o.getAriaLabelledBy().includes(t)){o.addAriaLabelledBy(t)}}};p.prototype.updateSortIndicator=function(e,t){var o=e.getInnerColumn();o.setSorted(t!==g.None);o.setSortOrder(t===g.None?undefined:t)};p.prototype.getSelectedContexts=function(){var e=this.getInnerTable();var t=this._getMultiSelectionPlugin();if(!t){return[]}return t.getSelectedIndices().map(function(t){return e.getContextByIndex(t)},this)};p.prototype.clearSelection=function(){var e=this._getMultiSelectionPlugin();if(e){e.clearSelection()}};return p});