/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/field/ConditionsType","sap/ui/mdc/condition/ConditionValidateException","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/condition/Operator","sap/ui/mdc/condition/Condition","sap/ui/mdc/enum/ConditionValidated","sap/ui/mdc/enum/BaseType","sap/ui/mdc/util/DateUtil","sap/ui/model/SimpleType","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/m/library","sap/base/util/merge"],function(e,t,a,i,o,r,n,s,l,p,u,d,c,v){"use strict";var y=e.extend("sap.ui.mdc.field.DynamicDateRangeConditionsType",{constructor:function(e,t){l.apply(this,arguments);this.sName="ConditionsDateRange";this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc")}});y.prototype.destroy=function(){l.prototype.destroy.apply(this,arguments);this._bDestroyed=true};y.prototype.formatValue=function(e,t){if(e==undefined||e==null||this._bDestroyed){return null}if(!Array.isArray(e)){throw new p("No valid conditions provided")}var o=f.call(this);var r;if(o!==1){throw new p("MaxConditions must be 1")}if(e.length===1){var l=e[0];var u=a.getOperator(l.operator);if(!l.operator||!u){throw new p("No valid condition provided, Operator wrong.")}var d=[];var v=T.call(this);var y=a.getDynamicDateOptionForOperator(u,c.StandardDynamicDateRangeKeys,v);for(var m=0;m<u.valueTypes.length;m++){if(u.valueTypes[m]&&u.valueTypes[m]!==i.ValueType.Static){if(y){if(u.valueTypes[m]===i.ValueType.Self){d.push(s.typeToDate(l.values[m],h.call(this),v))}else{var D=g.call(this,u.valueTypes[m]);if(D===n.Date||D===n.DateTime){d.push(s.typeToDate(l.values[m],O.call(this,u,m),D))}else{d.push(l.values[m])}}}else{d.push(l.values[m])}}}if(!y){y=a.getCustomDynamicDateOptionForOperator(u,v)}r={operator:y,values:d}}return r};y.prototype.parseValue=function(e,t){if(this._bDestroyed){return null}if(f.call(this)!==1){throw new u("Only one condition supported for parsing")}var l=m.call(this);var p=[];if(e&&e.operator){if(e.operator==="PARSEERROR"){throw new u(e.values[0])}var d=e.operator;var v=a.getOperatorForDynamicDateOption(d,T.call(this));if(v){var y=T.call(this);var D=[];for(var w=0;w<v.valueTypes.length;w++){if(v.valueTypes[w]&&v.valueTypes[w]!==i.ValueType.Static){if(c.StandardDynamicDateRangeKeys[d]){if(v.valueTypes[w]===i.ValueType.Self){D.push(s.dateToType(e.values[w],h.call(this),y))}else{var C=v.valueTypes[w]===i.ValueType.Self?y:g.call(this,v.valueTypes[w]);if(C===n.Date||C===n.DateTime){D.push(s.dateToType(e.values[w],O.call(this,v,w),C))}else{D.push(e.values[w])}}}else{D.push(e.values[w])}}}var V=o.createCondition(v.name,D,undefined,undefined,r.NotValidated);a.updateConditionValues(V);a.checkConditionsEmpty(V,l);p.push(V)}}return p};y.prototype.validateValue=function(e){if(e===undefined||e===null||this._bDestroyed){return}if(!Array.isArray(e)){throw new t("No valid conditions provided",undefined,undefined,e)}var i=h.call(this);var o=m.call(this);for(var r=0;r<e.length;r++){var n=e[r];if(typeof n!=="object"||!n.operator||!n.values||!Array.isArray(n.values)){throw new t(this._oResourceBundle.getText("field.VALUE_NOT_VALID"),undefined,typeof n==="object"?v({},n):n,e)}var s=a.getOperator(n.operator);if(!s||o.indexOf(s.name)===-1){throw new t("No valid condition provided, Operator wrong.",undefined,v({},n),e)}try{s.validate(n.values,i)}catch(a){if(a instanceof d){throw new t(a.message,a.violatedConstraints,v({},n),e)}throw a}}};function f(){var e=1;if(this.oFormatOptions.hasOwnProperty("maxConditions")){e=this.oFormatOptions.maxConditions}return e}function h(){var e=this.oFormatOptions.valueType;if(!e){throw new Error("Type missing")}return e}function m(){var e=this.oFormatOptions.operators;if(!e||e.length===0){e=a.getOperatorsForType(T.call(this))}return e}function T(){var e=h.call(this);var t=e.getMetadata().getName();var a=e.getFormatOptions();var i=e.getConstraints();return g.call(this,{name:t,formatOptions:a,constraints:i})}function g(e){var t=this.oFormatOptions.delegate;var a=this.oFormatOptions.payload;var i=t?t.getTypeUtil(a).getBaseType(e.name,e.formatOptions,e.constraints):n.Date;return i}function O(e,t){return e._createLocalType(e.valueTypes[t])}return y});