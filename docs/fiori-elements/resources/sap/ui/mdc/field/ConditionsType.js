/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/field/ConditionType","sap/ui/mdc/condition/ConditionValidateException","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/model/SimpleType","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/base/util/merge","sap/ui/base/SyncPromise"],function(t,e,i,n,o,s,r,a,u){"use strict";var l=n.extend("sap.ui.mdc.field.ConditionsType",{constructor:function(e,i){n.apply(this,arguments);this.sName="Conditions";e=p(e);this._oConditionType=new t(e,this.oConstraints);this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc")}});l.prototype.destroy=function(){n.prototype.destroy.apply(this,arguments);if(this._oConditionType){this._oConditionType.destroy();this._oConditionType=undefined}this._bDestroyed=true};l.prototype.setFormatOptions=function(t){n.prototype.setFormatOptions.apply(this,arguments);t=p(t);if(this._oConditionType){this._oConditionType.setFormatOptions(t)}};function p(t){t=a({},t);if(t.asyncParsing){delete t.asyncParsing}return t}l.prototype.setConstraints=function(t){n.prototype.setConstraints.apply(this,arguments);if(this._oConditionType){this._oConditionType.setConstraints(this.oConstraints)}};l.prototype.formatValue=function(t,e){if(t==undefined||t==null||this._bDestroyed){return null}if(!Array.isArray(t)){throw new o("No valid conditions provided")}var i;if(!e||e==="string"||e==="any"){i=""}else if(e==="float"||e==="int"){i=0}if(v.call(this)){return m.call(this)||i}var n=f.call(this);var s=[];var r=function(t,e){return u.resolve().then(function(){return this._oConditionType.formatValue(t,e)}.bind(this))};for(var a=0;a<t.length;a++){s.push(r.call(this,t[a],e));if(n>0&&a>=n-1){break}}return u.all(s).then(function(t){return d.call(this,t,i)}.bind(this)).unwrap()};function d(t,e){for(var i=0;i<t.length;i++){if(e){e=e+this._oResourceBundle.getText("field.SEPARATOR")+t[i]}else{e=t[i]}}return e}l.prototype.parseValue=function(t,e){if(this._bDestroyed){return null}if(v.call(this)&&t===""){return this.oFormatOptions.getConditions?this.oFormatOptions.getConditions():[]}var i=u.resolve().then(function(){return this._oConditionType.parseValue(t,e)}.bind(this)).then(function(t){return h.call(this,t)}.bind(this)).unwrap();if(i instanceof Promise&&this.oFormatOptions.asyncParsing){this.oFormatOptions.asyncParsing(i)}return i};function h(t){var e=c(this.oFormatOptions.valueType);var n=this.oFormatOptions.getConditions&&this.oFormatOptions.getConditions();var o=f.call(this);if(o!==1&&this.oFormatOptions.getConditions){if(t){if(y(this.oFormatOptions.valueType)&&!e&&n.length===1&&(n[0].values[0][0]===null||n[0].values[0][0]===undefined||n[0].values[0][1]===null||n[0].values[0][1]===undefined)&&(t.values[0][0]!==null&&t.values[0][0]!==undefined&&t.values[0][1]!==null&&t.values[0][1]!==undefined)){n.splice(0,1)}if(i.indexOfCondition(t,n)===-1){n.push(t)}else{throw new s(this._oResourceBundle.getText("field.CONDITION_ALREADY_EXIST",[t.values[0]]))}if(o>0&&o<n.length){n.splice(0,n.length-o)}}return n}else if(e&&this.oFormatOptions.getConditions&&n.length>1){var r=t&&t.values[0][1];var a=t&&t.inParameters;var u=t&&t.outParameters;var l=t&&t.payload;for(var p=0;p<n.length;p++){n[p].values[0][1]=r;if(r===undefined){n[p].values[0][0]=t.values[0][0]}n[p].values[0].splice(2);if(n[p].operator==="BT"){n[p].values[1][1]=r;if(r===undefined){n[p].values[1][0]=t.values[0][0]}n[p].values[1].splice(2)}if(a||n[p].inParameters){n[p].inParameters=a}if(u||n[p].outParameters){n[p].outParameters=u}if(l||n[p].payload){n[p].payload=l}}if(n.length===0){n.push(t)}return n}else if(t){return[t]}else{return[]}}l.prototype.validateValue=function(t){if(t===undefined||t===null||this._bDestroyed){return}if(!Array.isArray(t)){throw new e("No valid conditions provided",undefined,undefined,t)}try{for(var i=0;i<t.length;i++){var n=t[i];this._oConditionType.validateValue(n)}var o=f.call(this);if(t.length===0&&o===1){this._oConditionType.validateValue(null)}}catch(i){if(i instanceof e){i.setConditions(t)}else if(i instanceof r){throw new e(i.message,i.violatedConstraints,a({},n))}throw i}};function f(){var t=1;if(this.oFormatOptions.hasOwnProperty("maxConditions")){t=this.oFormatOptions.maxConditions}return t}function c(t){if(y(t)){var e=t.getFormatOptions();var i=!e||!e.hasOwnProperty("showMeasure")||e.showMeasure;var n=!e||!e.hasOwnProperty("showNumber")||e.showNumber;var o=!e||!e.hasOwnProperty("showTimezone")||e.showTimezone;var s=!e||!e.hasOwnProperty("showDate")||e.showDate;var r=!e||!e.hasOwnProperty("showTime")||e.showTime;if(i&&!n||o&&!s&&!r){return true}}return false}function y(t){return t&&t.isA("sap.ui.model.CompositeType")}function v(){var t=false;if(this.oFormatOptions.hasOwnProperty("noFormatting")){t=this.oFormatOptions.noFormatting}return t}function m(){if(this.oFormatOptions.hasOwnProperty("keepValue")){return this.oFormatOptions.keepValue}return null}return l});