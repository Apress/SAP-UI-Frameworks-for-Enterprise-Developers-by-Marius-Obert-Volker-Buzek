/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/mdc/enum/EditMode","sap/ui/mdc/enum/FieldDisplay","sap/ui/mdc/enum/ConditionValidated","sap/ui/mdc/field/FieldBaseRenderer","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/condition/Condition","sap/ui/mdc/condition/ConditionValidateException","sap/ui/mdc/field/ConditionType","sap/ui/mdc/field/ConditionsType","sap/ui/mdc/enum/BaseType","sap/ui/mdc/field/content/ContentFactory","sap/ui/mdc/Control","sap/ui/mdc/util/loadModules","sap/ui/core/library","sap/ui/core/LabelEnablement","sap/ui/core/message/MessageMixin","sap/base/util/deepEqual","sap/base/util/merge","sap/base/Log","sap/ui/dom/containsOrEquals","sap/ui/model/BindingMode","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/ui/model/base/ManagedObjectModel","sap/ui/base/ManagedObjectObserver","sap/ui/base/SyncPromise","sap/base/util/restricted/_debounce","sap/ui/events/KeyCodes"],function(t,e,i,n,a,o,s,r,l,h,d,g,p,u,c,f,y,v,C,_,m,F,b,D,I,T,P,V,E,O){"use strict";var M=c.ValueState;var H=c.TextAlign;var A=c.TextDirection;var x=p.extend("sap.ui.mdc.field.FieldBase",{metadata:{interfaces:["sap.ui.core.IFormContent","sap.ui.core.ISemanticFormContent","sap.m.IOverflowToolbarContent"],designtime:"sap/ui/mdc/designtime/field/FieldBase.designtime",library:"sap.ui.mdc",properties:{dataType:{type:"string",group:"Data",defaultValue:"sap.ui.model.type.String"},dataTypeConstraints:{type:"object",group:"Data",defaultValue:null},dataTypeFormatOptions:{type:"object",group:"Data",defaultValue:null},editMode:{type:"sap.ui.mdc.enum.EditMode",group:"Data",defaultValue:e.Editable},required:{type:"boolean",group:"Data",defaultValue:false},display:{type:"sap.ui.mdc.enum.FieldDisplay",defaultValue:i.Value},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:H.Initial},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:A.Inherit},placeholder:{type:"string",group:"Misc",defaultValue:""},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:M.None},valueStateText:{type:"string",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},multipleLines:{type:"boolean",group:"Appearance",defaultValue:false},maxConditions:{type:"int",group:"Behavior",defaultValue:-1},conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true,bindable:"bindable"},label:{type:"string",group:"Misc",defaultValue:""},delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/field/FieldBaseDelegate",payload:{}}},showEmptyIndicator:{type:"boolean",group:"Appearance",defaultValue:false},_fieldHelpEnabled:{type:"boolean",group:"Appearance",defaultValue:false,visibility:"hidden"},_ariaAttributes:{type:"object",defaultValue:{},byValue:true,visibility:"hidden"}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false},contentEdit:{type:"sap.ui.core.Control",multiple:false},contentDisplay:{type:"sap.ui.core.Control",multiple:false},_content:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden"},fieldInfo:{type:"sap.ui.mdc.field.FieldInfoBase",multiple:false}},associations:{fieldHelp:{type:"sap.ui.mdc.ValueHelp",multiple:false},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{liveChange:{parameters:{value:{type:"string"},escPressed:{type:"boolean"},previousValue:{type:"string"}}},press:{},submit:{parameters:{promise:{type:"Promise"}}}},publicMethods:[],defaultAggregation:"content"},renderer:a,_oManagedObjectModel:null,_oInvalidInput:null});y.call(x.prototype);var B={onsapup:nt,onsapdown:nt,onsaphome:nt,onsapend:nt,onsappageup:nt,onsappagedown:nt,onsapbackspace:nt};var w={onsapenter:G};var S;x._init=function(){if(S&&S.bool&&S.bool.control){S.bool.control.destroy()}if(S&&S.defineConditions&&S.defineConditions.control){S.defineConditions.control.destroy()}S={bool:{modules:["sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Popover","sap/ui/mdc/valuehelp/content/Bool"],id:"BoolDefaultHelp",getDelegate:"getDefaultValueHelpDelegate",contentProperties:{},dialog:false,control:undefined,updateTitle:function(t,e){}},defineConditions:{modules:["sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Dialog","sap/ui/mdc/valuehelp/content/Conditions"],id:"Field-DefineConditions-Help",getDelegate:"getDefaultValueHelpDelegate",contentProperties:{},dialog:true,control:undefined,updateTitle:function(t,e){t.getDialog().setTitle(e);t.getDialog().getContent()[0].setLabel(e)}}}};x._init();x.prototype.init=function(){p.prototype.init.apply(this,arguments);this._oObserver=new P(this._observeChanges.bind(this));this._oObserver.observe(this,{properties:["display","editMode","dataType","dataTypeFormatOptions","dataTypeConstraints","multipleLines","maxConditions","conditions","delegate"],aggregations:["fieldInfo","content","contentEdit","contentDisplay"],associations:["fieldHelp","ariaLabelledBy"]});this.attachEvent("modelContextChange",this._handleModelContextChange,this);this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this._aAsyncChanges=[];this._bPreventGetDescription=false;this._oContentFactory=this._getContentFactory();this._oCreateContentPromise=undefined;this._sFilterValue=""};x.prototype._getContentFactory=function(){if(this._bIsBeingDestroyed||this.bIsDestroyed){return}if(!this._oContentFactory){this._oContentFactory=new g(this.getId()+"-contentFactory",{field:this,handleTokenUpdate:mt.bind(this),handleContentChange:ft.bind(this),handleContentLiveChange:vt.bind(this),handleValueHelpRequest:Tt.bind(this),handleEnter:G.bind(this),handleContentPress:_t.bind(this)})}return this._oContentFactory};var U=function(t){var e=Dt.call(this);if(e&&!this._iFocusTimer&&e.shouldOpenOnFocus()&&!e.isOpen()){this._iFocusTimer=setTimeout(function(){e.open(true);this._redirectFocus(t,e);this._iFocusTimer=null}.bind(this),300)}};var N=function(){if(this._iFocusTimer){clearTimeout(this._iFocusTimer);this._iFocusTimer=null}};x.prototype.exit=function(){N.call(this);var t=this.getFieldInfo();if(t){t.detachEvent("dataUpdate",Ut,this)}var e=this.getContent();if(e){X.call(this,e)}var i=this.getContentEdit();if(i){X.call(this,i)}var n=this.getContentDisplay();if(n){X.call(this,n)}if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel}this._oObserver.disconnect();this._oObserver=undefined;this._oCreateContentPromise=undefined;var a=Dt.call(this);if(a){a.detachEvent("dataUpdate",Ht,this);if(this._bConnected){xt.call(this,a);a.connect()}}if(this._oContentFactory){this._oContentFactory.destroy();this._oContentFactory=undefined}Ct.call(this);delete this._fnLiveChangeTimer};x.prototype.applySettings=function(){p.prototype.applySettings.apply(this,arguments);if(!this.bDelegateInitialized&&!this.bDelegateLoading){this.initControlDelegate()}this._triggerCheckCreateInternalContent();this._bSettingsApplied=true;return this};x.prototype.setProperty=function(t,i,n){if(t==="editMode"){var a=this.getEditMode();if(a!==e.Display&&a!==e.EditableDisplay&&i!==e.Display&&i!==e.EditableDisplay){n=true}}else if(t!=="width"&&t!=="multipleLines"&&t!=="showEmptyIndicator"){n=true}return p.prototype.setProperty.apply(this,[t,i,n])};x.prototype.onBeforeRendering=function(){Z.call(this)};x.prototype.onAfterRendering=function(){};x.prototype.onfocusin=function(t){Bt.call(this);U.call(this,t)};x.prototype.onsapfocusleave=function(t){N.call(this);Ct.call(this)};function L(t){var e=t.indexOf(this.getId());if(e>-1){if(this._bPendingChange){var i=document.activeElement;var n=Dt.call(this);if(!(i&&n&&m(n.getDomRef(),i))){var a=Lt.call(this);if(a){R.call(this,undefined,undefined,undefined,a)}else{R.call(this,this.getConditions(),!this._isInvalidInput())}}}if(t.length>1){t.splice(e,1);this.fireValidateFieldGroup({fieldGroupIds:t})}}}x.prototype.onsapup=function(t){this._handleNavigate(t,-1)};x.prototype.onsapdown=function(t){this._handleNavigate(t,1)};x.prototype.onsaphome=function(t){this._handleNavigate(t,-9999)};x.prototype.onsappageup=function(t){this._handleNavigate(t,-10)};x.prototype.onsappagedown=function(t){this._handleNavigate(t,10)};x.prototype.onsapend=function(t){this._handleNavigate(t,9999)};x.prototype._handleNavigate=function(t,i){if(this.getEditMode()===e.Editable){var n=Dt.call(this);var a=t.srcControl;if(n){if(n.isNavigationEnabled(i)&&(!this._getContentFactory().isMeasure()||a.getShowValueHelp())){t.preventDefault();t.stopPropagation();n.setFilterValue(this._sFilterValue);n.navigate(i)}}}};x.prototype.onsapenter=function(t){var e=Dt.call(this);if(e&&e.isOpen()){e.close()}this._sFilterValue=""};x.prototype.onsapescape=function(t){this.onsapenter(t)};x.prototype._redirectFocus=function(t,e){var i=t.srcControl;if(e.isOpen()&&(!this._getContentFactory().isMeasure()||i.getShowValueHelp&&i.getShowValueHelp())){i.addStyleClass("sapMFocus");e.removeFocus()}};x.prototype.ontap=function(t){var e=Dt.call(this);if(e){if(e.shouldOpenOnClick()&&!e.isOpen()){e.open(true)}this._redirectFocus(t,e)}};x.prototype.clone=function(t,e){this.detachEvent("modelContextChange",this._handleModelContextChange,this);var i=this.getContent();if(i){X.call(this,i)}var n=this.getContentEdit();if(n){X.call(this,n)}var a=this.getContentDisplay();if(a){X.call(this,a)}var o=this.getFieldInfo();if(o){o.detachEvent("dataUpdate",Ut,this)}var s=p.prototype.clone.apply(this,arguments);this.attachEvent("modelContextChange",this._handleModelContextChange,this);if(i){Y.call(this,i)}if(n){Y.call(this,n)}if(a){Y.call(this,a)}if(o){o.attachEvent("dataUpdate",Ut,this)}if(this._bTriggerable){s._bTriggerable=this._bTriggerable}return s};x.prototype.getFieldPath=function(){var t=this.getBindingPath("conditions");if(t&&t.startsWith("/conditions/")){return t.slice(12)}else{return""}};function k(t,e,i,n){if(this._getContent().length>1){this._bPendingChange=true}else{R.call(this,t,e,i,n)}}function R(t,e,i,n){if(!n){if(e){n=Promise.resolve(this._getResultForPromise(t))}else{var a=this._getInvalidInputException();if(a){n=Promise.reject(a)}else{n=Promise.reject(i)}}}this._fireChange(t,e,i,n);this._bPendingChange=false}x.prototype._fireChange=function(t,e,i,n){};function G(t){var e=this.getEditMode();if(g._getEditable(e)&&(this.hasListeners("submit")||this._bPendingChange)){var i=Lt.call(this);var n=false;if(i){n=true}else if(this._isInvalidInput()){i=Promise.reject()}else{i=Promise.resolve(this._getResultForPromise(this.getConditions()))}if(this._bPendingChange){if(n){R.call(this,undefined,undefined,undefined,i)}else{R.call(this,this.getConditions(),!this._isInvalidInput(),undefined,i)}}this.fireSubmit({promise:i})}}x.prototype._initDataType=function(){if(this._getContentFactory().getDataType()){this._getContentFactory().getDataType().destroy();this._getContentFactory().setDataType(undefined)}if(this._getContentFactory().getDateOriginalType()){if(this._getContentFactory().getDateOriginalType()._bCreatedByField){this._getContentFactory().getDateOriginalType().destroy()}this._getContentFactory().setDateOriginalType(undefined)}if(this._getContentFactory().getUnitOriginalType()){if(this._getContentFactory().getUnitOriginalType()._bCreatedByField){this._getContentFactory().getUnitOriginalType().destroy()}this._getContentFactory().setUnitOriginalType(undefined)}this._getContentFactory().setIsMeasure(false)};function j(){var t=this._getContentFactory().getDateOriginalType()||this._getContentFactory().getUnitOriginalType()||this._getContentFactory().getDataType();if(t&&typeof t==="object"){return t.getMetadata().getName()}else if(this.bDelegateInitialized){return this.getTypeUtil().getDataTypeClassName(this.getDataType())}else{return this.getDataType()}}function $(){var t=this._getContentFactory().getDateOriginalType()||this._getContentFactory().getUnitOriginalType()||this._getContentFactory().getDataType();if(t&&typeof t==="object"&&t.getConstraints()){return t.getConstraints()}else{return this.getDataTypeConstraints()}}function q(){var t=this._getContentFactory().getDateOriginalType()||this._getContentFactory().getUnitOriginalType()||this._getContentFactory().getDataType();if(t&&typeof t==="object"&&t.getFormatOptions()){return t.getFormatOptions()}else{return this.getDataTypeFormatOptions()}}x.prototype.getBaseType=function(){var t=j.call(this);var e=$.call(this);var i=q.call(this);var n=this.getTypeUtil().getBaseType(t,i,e);return n};function z(t,e){var i=Dt.call(this);if(i&&this._bConnected){It.call(this,t,i)}}x.prototype._getContent=function(){var t=this.getContent();if(!t){if(this.getEditMode()===e.Display){t=this.getContentDisplay()}else{t=this.getContentEdit()}}if(t){return[t]}else{return this.getAggregation("_content",[])}};x.prototype._handleModelContextChange=function(t){};x.prototype._removeUIMessage=function(){this.setValueState(M.None);this.setValueStateText()};x.prototype._observeChanges=function(t){if(t.name==="dataType"){if(this._getContentFactory().getDataType()){var i=function(t){this._getContentFactory().checkDataTypeChanged(t).then(function(t){if(t&&!this._bIsBeingDestroyed){this._initDataType();this.destroyAggregation("_content");this._getContentFactory().updateConditionType()}}.bind(this)).catch(function(t){throw t})}.bind(this);if(!this.bDelegateInitialized){this.awaitControlDelegate().then(function(){i.call(this,t.current)}.bind(this));return}i.call(this,t.current)}}if(t.name==="dataTypeFormatOptions"||t.name==="dataTypeConstraints"){if(this._getContentFactory().getDataType()){this._initDataType();this.destroyAggregation("_content");this._getContentFactory().updateConditionType()}}if(t.name==="maxConditions"){this._updateInternalContent()}if(t.name==="conditions"){this._resetInvalidInput();z.call(this,t.current,t.old);var n=false;var a=0;for(a=0;a<this._aAsyncChanges.length;a++){var o=this._aAsyncChanges[a];if(o.waitForUpdate&&v(o.result,t.current)){yt.call(this,o);n=true;break}}if(n){this._aAsyncChanges.splice(a,1)}if((t.current.length===0||t.old.length===0)&&this.getShowEmptyIndicator()&&this.getEditMode()===e.Display&&!this.getContent()&&!this.getContentDisplay()){this.invalidate()}}if(t.name==="display"){this._destroyInternalContent();this._getContentFactory().updateConditionType()}if(t.name==="fieldHelp"&&t.ids){Ft.call(this,t.ids,t.mutation);this._getContentFactory().updateConditionType()}if(t.name==="fieldInfo"&&t.child){St.call(this,t.child,t.mutation)}if(t.name==="content"&&t.child){K.call(this,t.child,t.mutation,t.name)}if(t.name==="contentEdit"&&t.child){K.call(this,t.child,t.mutation,t.name)}if(t.name==="contentDisplay"&&t.child){K.call(this,t.child,t.mutation,t.name)}if(t.name==="delegate"&&!this.bDelegateInitialized&&!this.bDelegateLoading){this.initControlDelegate.call(this)}if(t.name==="ariaLabelledBy"&&t.ids){Q.call(this,t.ids,t.mutation)}if(t.name==="editMode"){J.call(this);if(this._bSettingsApplied&&(t.old===e.Display||t.old===e.EditableDisplay||t.current===e.Display||t.current===e.EditableDisplay)){this._triggerCheckCreateInternalContent()}}};x.prototype._updateInternalContent=function(){if(this.getAggregation("_content",[]).length>0){Z.call(this);this._getContentFactory().updateConditionType()}};x.prototype.getFocusDomRef=function(){var t=this._getContent();if(t.length>0){return t[0].getFocusDomRef()}else{return this.getDomRef()}};x.prototype.getIdForLabel=function(){var t;var e=this._getContent();if(e.length>0){t=e[0].getIdForLabel()}else{t=et.call(this)}return t};x.prototype.getEditable=function(){return g._getEditable(this.getEditMode())};x.prototype.getControlForSuggestion=function(){var t=this._getContent();if(t.length>0){if(this._getContentFactory().isMeasure()){return t[1]}else{return t[0]}}else{return this}};x.prototype.getFocusElementForValueHelp=function(t){var e=this.getControlForSuggestion();var i=e&&e.getMetadata().getAllPrivateAggregations()._endIcon&&e.getAggregation("_endIcon",[]);var n;if(i){for(var a=0;a<i.length;a++){if(i[a].getVisible()){n=i[a];break}}}return t||!n?e:n};x.prototype.getMaxConditionsForHelp=function(){if(this._getContentFactory().isMeasure()){return 1}else{return this.getMaxConditions()}};x.prototype.getFormFormattedValue=function(){var t=this.getConditions();var e=this.getShowEmptyIndicator()&&t.length===0&&!this.getContent()&&!this.getContentDisplay();if(e){if(!this._oResourceBundleM){this._oResourceBundleM=sap.ui.getCore().getLibraryResourceBundle("sap.m")}return this._oResourceBundleM.getText("EMPTY_INDICATOR")}else if(this._getContentFactory().isMeasure()&&this._getContentFactory().getUnitOriginalType()){var i=t.length>0?t[0].values[0]:[0,null];return this._getContentFactory().getUnitOriginalType().formatValue(i,"string")}else if(this._getContentFactory().getDateOriginalType()){var n=t.length>0?t[0].values[0]:null;return this._getContentFactory().getDateOriginalType().formatValue(n,"string")}else{var a=this._getContentFactory().getConditionsType();var o=a.getFormatOptions();var s=o.noFormatting;o.noFormatting=false;a.setFormatOptions(o);var r=a.formatValue(t);o.noFormatting=s;a.setFormatOptions(o);return r}};x.prototype.getFormValueProperty=function(){return"conditions"};x.prototype.getOverflowToolbarConfig=function(){return{canOverflow:true,invalidationEvents:[],propsUnrelatedToSize:["conditions","editMode","display","valueState","valueStateText"]}};x.prototype.enhanceAccessibilityState=function(t,e){var i=this.getParent();if(i&&i.enhanceAccessibilityState){i.enhanceAccessibilityState(this,e)}};x.prototype.getAccessibilityInfo=function(){var t=this._getContent();if(t.length>0&&t[0].getAccessibilityInfo){return t[0].getAccessibilityInfo()}else{return{}}};function Q(t,e){var i=this.getAggregation("_content",[]);var n=this.getContent();if(n){i.push(n)}n=this.getContentDisplay();if(n){i.push(n)}n=this.getContentEdit();if(n){i.push(n)}for(var a=0;a<i.length;a++){n=i[a];if(n.getMetadata().getAllAssociations().ariaLabelledBy){if(e==="remove"){n.removeAriaLabelledBy(t)}else if(e==="insert"){n.addAriaLabelledBy(t)}}}}function W(t,e){var i={aria:{}};var n=Dt.call(this);if(n){var a=n.getAriaAttributes(this.getMaxConditionsForHelp());var o=a.roleDescription;i["role"]=a.role;if(o){i.aria["roledescription"]=o}i.aria["haspopup"]=a.ariaHasPopup;i["autocomplete"]="off";if(t){if(a.role){i.aria["expanded"]="true"}i.aria["controls"]=a.contentId;if(e){i.aria["activedescendant"]=e}}else if(a.role){i.aria["expanded"]="false"}i["valueHelpEnabled"]=a.valueHelpEnabled}this.setProperty("_ariaAttributes",i,true)}x.prototype.connectLabel=function(t){it.call(this,t);t.bindProperty("text",{path:"$field>/label"});t.setLabelFor(this);return this};function J(){var t=f.getReferencingLabels(this);for(var e=0;e<t.length;e++){var i=sap.ui.getCore().byId(t[e]);i.invalidate()}}function K(t,e,i){if(e==="remove"){X.call(this,t);ot.call(this,t);rt.call(this,t);if(this._getContentFactory().getContentConditionTypes()){delete this._getContentFactory().getContentConditionTypes()[i]}t.setModel(null,"$field")}else if(e==="insert"){if(!t.isA("sap.ui.core.IFormContent")){throw new Error(t+" is not a valid content! Only use valid content in "+this)}at.call(this,t,true);Y.call(this,t);st.call(this,t,true);if(this.getAggregation("_content",[]).length>0){this._destroyInternalContent()}if(!this._getContentFactory().getContentConditionTypes()){this._getContentFactory().setContentConditionTypes({})}if(!this._getContentFactory().getContentConditionTypes()[i]){this._getContentFactory().getContentConditionTypes()[i]={}}this._getContentFactory().setNoFormatting(false);this.awaitControlDelegate().then(function(){if(!this.bIsDestroyed){var t=gt.call(this,this._getOperators());if(t!==this._getContentFactory().getHideOperator()){this._getContentFactory().setHideOperator(t);this._getContentFactory()._setUsedConditionType(this.getContent(),this.getContentEdit(),this.getContentDisplay(),this.getEditMode())}}}.bind(this));var n;var a;var o=false;for(a in t.getMetadata().getAllProperties()){if(t.getBindingPath(a)==="/conditions"){n=t.getBindingInfo(a);if(n&&n.type&&n.type instanceof h){this._getContentFactory().getContentConditionTypes()[i].oConditionsType=n.type}o=true}if(a==="editable"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/editMode",formatter:g._getEditable})}if(a==="enabled"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/editMode",formatter:g._getEnabled})}if(a==="displayOnly"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/editMode",formatter:g._getDisplayOnly})}if(a==="required"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/required"})}if(a==="textAlign"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/textAlign"})}if(a==="textDirection"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/textDirection"})}if(a==="valueState"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/valueState"})}if(a==="valueStateText"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/valueStateText"})}if(a==="placeholder"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/placeholder"})}if(a==="showValueHelp"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.bindProperty(a,{path:"$field>/_fieldHelpEnabled"})}if(a==="valueHelpIconSrc"&&!t.getBindingPath(a)&&t.isPropertyInitial(a)){t.setValueHelpIconSrc(this._getFieldHelpIcon())}}for(var s in t.getMetadata().getAllAggregations()){if(t.getBindingPath(s)==="/conditions"){n=t.getBindingInfo(s);if(n&&n.template){for(a in n.template.getMetadata().getAllProperties()){var r=n.template.getBindingInfo(a);if(r&&r.type&&r.type instanceof l){this._getContentFactory().getContentConditionTypes()[i].oConditionType=r.type;if(o){this._getContentFactory().setNoFormatting(true)}break}}}}if(s==="tooltip"&&!t.getBindingPath(s)&&!t.getAggregation(s)){t.bindProperty(s,{path:"$field>/tooltip"})}}if(t.getMetadata().getAllAssociations().ariaLabelledBy){this._getContentFactory().setAriaLabelledBy(t)}}}function Y(t){if(t.getMetadata().getEvents().change){t.attachEvent("change",ft,this)}if(t.getMetadata().getEvents().liveChange){t.attachEvent("liveChange",vt,this)}if(t.getMetadata().getEvents().press){t.attachEvent("press",_t,this)}if(t.getMetadata().getEvents().valueHelpRequest){t.attachEvent("valueHelpRequest",Tt,this)}if(t.getMetadata().getEvents().tokenUpdate){t.attachEvent("tokenUpdate",mt,this)}}function X(t){if(t.getMetadata().getEvents().change){t.detachEvent("change",ft,this)}if(t.getMetadata().getEvents().liveChange){t.detachEvent("liveChange",vt,this)}if(t.getMetadata().getEvents().press){t.detachEvent("press",_t,this)}if(t.getMetadata().getEvents().valueHelpRequest){t.detachEvent("valueHelpRequest",Tt,this)}if(t.getMetadata().getEvents().tokenUpdate){t.detachEvent("tokenUpdate",mt,this)}}function Z(){var t=function(){if(!this.bDelegateInitialized){this.awaitControlDelegate().then(function(){Z.call(this)}.bind(this))}else{tt.call(this)}};if(this._oCreateContentPromise){this._oCreateContentPromise.then(function(){Z.call(this)}.bind(this))}else{t.call(this)}}x.prototype._checkCreateInternalContent=function(){if(!this.bIsDestroyed&&this.getVisible()&&this._getContentFactory().getDataType()){Z.call(this)}};x.prototype._triggerCheckCreateInternalContent=function(){if(!this._oCheckCreateInternalContentPromise){this._oCheckCreateInternalContentPromise=this.awaitControlDelegate().then(function(){delete this._oCheckCreateInternalContentPromise;this._checkCreateInternalContent()}.bind(this))}};function tt(){if(this._bIsBeingDestroyed||this.bIsDestroyed){return}var t=this.getEditMode();var i=this.getContent();var n=this.getContentEdit();var a=this.getContentDisplay();this._getContentFactory()._setUsedConditionType(i,n,a,t);bt.call(this,this.getFieldHelp());W.call(this,false);if(i||t===e.Display&&a||t!==e.Display&&n){this._destroyInternalContent();var o=this._getContent();if(o.length===1){it.call(this,o[0])}return}var s=this.getMaxConditions();var r=this._getOperators();var l;var h=this.getAggregation("_content",[]);var d;var g;var p=this.getMultipleLines();var u=this._bTriggerable;var c=this._getContentFactory().getContentType(this.getBaseType(),this.getMaxConditions(),u);if(h.length>0){d=h[0];g=d.getMetadata().getName().replace(/\./g,"/")}var f=this._getContentFactory().getContentMode(c,t,s,p,r);var y=c.getControlNames(f,r[0]);l=y[0];if(l!==g){this._getContentFactory().setHideOperator(gt.call(this,r));if(d){this._destroyInternalContent();if(d.isA("sap.m.DateTimeField")){this._initDataType()}this._getContentFactory().updateConditionType()}if(dt.call(this,c,r,t,s)){lt.call(this,c.getUseDefaultFieldHelp().name)}else if(this._sDefaultFieldHelp){delete this._sDefaultFieldHelp}var v=et.call(this);this._oCreateContentPromise=this._getContentFactory().createContent(c,f,v);this._oCreateContentPromise.then(function(t){delete this._oCreateContentPromise;for(var e=0;e<t.length;e++){var i=t[e];i.attachEvent("parseError",pt,this);i.attachEvent("validationError",ut,this);i.attachEvent("validationSuccess",ct,this);at.call(this,i,c.getUseDefaultEnterHandler());st.call(this,i,false);it.call(this,i);if(this._bConnected&&(e===0&&!this._getContentFactory().isMeasure()||e===1&&this._getContentFactory().isMeasure())){wt.call(this,i)}this.addAggregation("_content",i)}J.call(this)}.bind(this)).catch(function(t){delete this._oCreateContentPromise;throw t}.bind(this))}}function et(){return this.getId()+"-inner"}x.prototype._destroyInternalContent=function(){this.destroyAggregation("_content");if(this._getContentFactory().getDateOriginalType()){this._getContentFactory().setDataType(this._getContentFactory().getDateOriginalType());this._getContentFactory().setDateOriginalType(undefined)}else if(this._getContentFactory().getUnitOriginalType()){this._getContentFactory().setDataType(this._getContentFactory().getUnitOriginalType());this._getContentFactory().setUnitOriginalType(undefined)}if(this._isInvalidInput()){this._resetInvalidInput();this._removeUIMessage()}if(this._getContentFactory().isMeasure()){this._getContentFactory().setIsMeasure(false)}};function it(t){if(!this._oManagedObjectModel&&!this._bIsBeingDestroyed){this._oManagedObjectModel=new T(this)}t.setModel(this._oManagedObjectModel,"$field")}function nt(t){var e=false;var i=Dt.call(this);if(!i){return}else{switch(t.type){case"sapup":e=i.isNavigationEnabled(-1);break;case"sapdown":e=i.isNavigationEnabled(1);break;case"saphome":e=i.isNavigationEnabled(-9999);break;case"sapend":e=i.isNavigationEnabled(9999);break;case"sappageup":e=i.isNavigationEnabled(-10);break;case"sappagedown":e=i.isNavigationEnabled(10);break;default:e=i.isOpen();break}}if(e){t.stopPropagation();t.stopImmediatePropagation(true);switch(t.type){case"sapup":this.onsapup(t);break;case"sapdown":this.onsapdown(t);break;case"saphome":this.onsaphome(t);break;case"sapend":this.onsapend(t);break;case"sappageup":this.onsappageup(t);break;case"sappagedown":this.onsappagedown(t);break;default:break}}}function at(t,e){t.addDelegate(B,true,this);if(e){t.addDelegate(w,false,this)}}function ot(t){t.removeDelegate(B);t.removeDelegate(w)}function st(t,e){if(e){t._OriginalGetFieldGroupIds=t._getFieldGroupIds;t._OriginalTriggerValidateFieldGroup=t.triggerValidateFieldGroup}t._getFieldGroupIds=function(){var t=this.getFieldGroupIds();var e=this.getParent();if(e){t=t.concat(e._getFieldGroupIds())}return t};t.triggerValidateFieldGroup=function(t){var e=this.getParent();if(e){var i=t.indexOf(e.getId());if(i>-1){L.call(e,t)}else{e.fireValidateFieldGroup({fieldGroupIds:t})}}}}function rt(t){if(t._OriginalGetFieldGroupIds&&t._OriginalTriggerValidateFieldGroup){t._getFieldGroupIds=t._OriginalGetFieldGroupIds;delete t._OriginalGetFieldGroupIds;t.triggerValidateFieldGroup=t._OriginalTriggerValidateFieldGroup;delete t._OriginalTriggerValidateFieldGroup}}function lt(t){this._sDefaultFieldHelp=S[t].id;var e=S[t].control;if(e&&e.bIsDestroyed){S[t].control=undefined;e=undefined}if(!e){if(S[t].promise){S[t].promise.then(ht.bind(this,S[t].id))}else{S[t].promise=u(S[t].modules).catch(function(e){throw new Error("loadModules promise rejected in sap.ui.mdc.field.FieldBase:_createDefaultFieldHelp function call - could not load controls "+JSON.stringify(S[t].modules))}).then(function(i){var n=i[0];var a=i[1];var o=i[2];var s=this.bDelegateInitialized&&this.getControlDelegate()[S[t].getDelegate]();e=new n(S[t].id,{delegate:s});var r=new a(S[t].id+"-container",{content:[new o(S[t].id+"-content",S[t].contentProperties)]});e._bIsDefaultHelp=true;e._sDefaultHelpType=t;S[t].control=e;if(S[t].dialog){e.setDialog(r)}else{e.setTypeahead(r)}e.connect(this);ht.call(this,S[t].id)}.bind(this)).unwrap()}}else{ht.call(this,S[t].id)}W.call(this,false)}function ht(t){Ft.call(this,t,"insert")}function dt(t,i,n,a){var o=t.getUseDefaultFieldHelp();if(o&&!this.getFieldHelp()&&n!==e.Display){if(a===1&&o.single||a!==1&&o.multi){if(i.length===1){var s=gt.call(this,i);if(a===1){if(!(t.getEditOperator()&&t.getEditOperator()[i[0]])&&(o.oneOperatorSingle||!s)){return true}}else if(o.oneOperatorMulti||!s){return true}}else{return true}}}return false}function gt(t){if(t.length===1){var e=o.getOperator(t[0]);return!e||e.isSingleValue()}else{return false}}x.prototype._setInvalidInput=function(t,e,i){this._oInvalidInput={exception:t,value:e,reason:i}};x.prototype._getInvalidInputException=function(){return this._oInvalidInput&&this._oInvalidInput.exception};x.prototype._resetInvalidInput=function(){this._oInvalidInput=null};x.prototype._isInvalidInput=function(){return!!this._oInvalidInput};function pt(t){var e=t.getParameter("newValue");var i=t.getParameter("exception");this._setInvalidInput(i,e,"ParseError");this._sFilterValue=""}function ut(t){var e=t.getParameter("newValue");var i=t.getParameter("exception");this._setInvalidInput(i,e,"ValidationError");this._sFilterValue="";var n=i&&i instanceof r&&i.getConditions();var a=false;var o=0;for(o=0;o<this._aAsyncChanges.length;o++){var s=this._aAsyncChanges[o];if(s.waitForUpdate&&Array.isArray(s.result)){if(s.result.length===0&&e===""){s.reject(t.getParameter("exception"));a=true;break}else if(v(s.result,n)){s.reject(i);a=true;break}}}if(a){this._aAsyncChanges.splice(o,1)}}function ct(t){this._resetInvalidInput()}function ft(t){var e={parameters:C({},t.getParameters()),source:t.getSource()};var i=this._aAsyncChanges.length;if(i>0&&!this._aAsyncChanges[i-1].changeFired){this._aAsyncChanges[i-1].changeFired=true;this._aAsyncChanges[i-1].changeEvent=e;k.call(this,undefined,undefined,undefined,this._aAsyncChanges[i-1].promise);return}var n={changeEvent:e};yt.call(this,n)}function yt(t){var e=this.getConditions();var i=true;var n;var a=t.changeEvent.source;if(t.changeEvent.parameters.hasOwnProperty("valid")){i=t.changeEvent.parameters["valid"]}else if(this._isInvalidInput()){i=false}if(!i&&t.changeEvent.parameters.hasOwnProperty("value")){n=t.changeEvent.parameters["value"]}var o=Dt.call(this);if(o&&this._bConnected){if(sap.ui.getCore().getCurrentFocusedControlId()===a.getId()){o.close()}this._sFilterValue="";if(i){It.call(this,e,o);o.onControlChange()}Ct.call(this)}if(this._oNavigateCondition){this._oNavigateCondition=undefined;this._getContentFactory().updateConditionType()}if(t.resolve){kt.call(this,t)}else{k.call(this,e,i,n)}}function vt(t){var e;var i;var n=false;var a=t.getSource();this._oNavigateCondition=undefined;this._getContentFactory().updateConditionType();if("value"in t.getParameters()){e=t.getParameter("value")}else if("newValue"in t.getParameters()){e=t.getParameter("newValue")}if("escPressed"in t.getParameters()){n=t.getParameter("escPressed")}if("previousValue"in t.getParameters()){i=t.getParameter("previousValue")}else{var s=this.getConditions();i=s[0]&&s[0].values[0]}var r=Dt.call(this);if(r&&(!this._getContentFactory().isMeasure()||a.getShowValueHelp())){if(n){if(r.isOpen()){r.close();It.call(this,this.getConditions(),r);Ct.call(this);this._sFilterValue=""}}else{var l=this._getOperators();var h=false;for(var d=0;d<l.length;d++){var g=o.getOperator(l[d]);if(g.validateInput){h=true;break}}if(h){this._bIgnoreInputValue=false;this._vLiveChangeValue=e;if(!this._fnLiveChangeTimer){N.call(this);this._fnLiveChangeTimer=E(function(){var t=this.getDisplay();if(typeof this._vLiveChangeValue!=="undefined"){this._sFilterValue=""}if(this._vLiveChangeValue){var e=o.getEQOperator();var i=e.getValues(this._vLiveChangeValue,t,true);if(i[0]){this._sFilterValue=i[0];if(i[1]){this._sFilterValue=this._sFilterValue+" "}}if(i[1]){this._sFilterValue=this._sFilterValue+i[1]}}var n=function(){var t=document.activeElement;if(t&&m(this.getDomRef(),t)){var e=r.isOpen();r.setFilterValue(this._sFilterValue);if(this.getMaxConditionsForHelp()===1&&r.getConditions().length>0){r.setConditions([])}if(!e){r.open(true)}W.call(this,true);delete this._vLiveChangeValue}}.bind(this);if(this._bConnected&&this._getContent()[0]){r.isTypeaheadSupported().then(function(t){return!!t&&n()});delete this._vLiveChangeValue}}.bind(this),300,{leading:false,trailing:true});r.initBeforeOpen(true)}var p=r.isTypeaheadSupported();if(p instanceof Promise){p.then(function(t){var e=document.activeElement;if(e&&m(this.getDomRef(),e)&&this._fnLiveChangeTimer){this._fnLiveChangeTimer()}this._bOpenByTyping=t}.bind(this))}this._fnLiveChangeTimer()}}}this.fireLiveChange({value:e,escPressed:n,previousValue:i})}function Ct(){if(this._fnLiveChangeTimer){this._fnLiveChangeTimer.cancel();delete this._vLiveChangeValue}}function _t(t){var e=this.getFieldInfo();if(e){e.getTriggerHref().then(function(t){if(!t){e.open(this._getContent()[0]);W.call(this,true)}}.bind(this))}this.firePress()}function mt(t){if(t.getParameter("type")==="removed"){var e=t.getParameter("removedTokens");var i=this.getConditions();var n;var a;var o;for(o=0;o<e.length;o++){var r=e[o];var l=r.getBindingContext("$field").sPath;var h=parseInt(l.slice(l.lastIndexOf("/")+1));i[h].delete=true}for(o=i.length-1;o>=0;o--){if(i[o].delete){if(this._getContentFactory().isMeasure()){n=i[o].values[0][1];a=i[o].payload}i.splice(o,1)}}if(this._getContentFactory().isMeasure()&&n&&i.length===0){i=[s.createItemCondition([undefined,n],undefined,undefined,undefined,a)]}this.setProperty("conditions",i,true);R.call(this,i,true);t.preventDefault(true)}}function Ft(t,e){var i;if(e==="remove"){i=sap.ui.getCore().byId(t);if(i){xt.call(this,i);i.detachEvent("dataUpdate",Ht,this)}this.resetProperty("_fieldHelpEnabled")}else if(e==="insert"){if(this._sDefaultFieldHelp&&t!==this._sDefaultFieldHelp){Ft.call(this,this._sDefaultFieldHelp,"remove");delete this._sDefaultFieldHelp}bt.call(this,t);var n=this._getContent()[0];if(n&&n.setValueHelpIconSrc){n.setValueHelpIconSrc(this._getFieldHelpIcon())}}z.call(this,this.getConditions())}function bt(t){if(t&&this.isPropertyInitial("_fieldHelpEnabled")){var e=sap.ui.getCore().byId(t);if(e){e.attachEvent("dataUpdate",Ht,this);if(e.getIcon()){this.setProperty("_fieldHelpEnabled",true,true)}}}}function Dt(){var t=this.getFieldHelp();var e;if(!t&&this._sDefaultFieldHelp){t=this._sDefaultFieldHelp}if(t){e=sap.ui.getCore().byId(t)}return e}function It(t,e){if(!e){e=Dt.call(this)}var i;if(this._isInvalidInput()&&this.getMaxConditionsForHelp()===1){i=[]}else if(this._getContentFactory().isMeasure()){i=[];for(var n=0;n<t.length;n++){var a=t[n];if(a.values[0]&&a.values[0][1]){var o=s.createItemCondition(a.values[0][1],undefined,a.inParameters,a.outParameters,a.payload);i.push(o)}}}else{i=t}e.setConditions(i)}function Tt(t){var e=Dt.call(this);if(e){if(this._fnLiveChangeTimer){this._fnLiveChangeTimer.flush()}e.setFilterValue(this._sFilterValue);var i=this.getConditions();It.call(this,i,e);e.toggleOpen(false);if(!e.isFocusInHelp()){var n=t.getSource();if(n.bValueHelpRequested){n.bValueHelpRequested=false}}}}function Pt(t){var e=this.getConditions();var i=t.getParameter("conditions");var a=t.getParameter("add");var r=t.getParameter("close");var l=t.oSource;var h=this.getMaxConditions();var d;var g=this.getControlForSuggestion();var p;var u=0;if(this._getContentFactory().isMeasure()){if(i.length>1){throw new Error("Only one item must be selected! "+this)}if(i[0].operator!=="EQ"){throw new Error("Only EQ allowed! "+this)}if(e.length>0){for(u=0;u<e.length;u++){e[u].values[0][1]=i[0].values[0];if(e[u].operator==="BT"){e[u].values[1][1]=i[0].values[0]}if(i[0].inParameters){e[u].inParameters=i[0].inParameters}if(i[0].outParameters){e[u].outParameters=i[0].outParameters}if(i[0].payload){e[u].payload=i[0].payload}}}else{var c=o.getEQOperator(this._getOperators());var f=this.getControlDelegate().enhanceValueForUnit(this.getPayload(),[null,i[0].values[0]],this._oTypeInitialization);d=s.createCondition(c.name,[f],i[0].inParameters,i[0].outParameters,n.NotValidated,i[0].payload);e.push(d);var y=this._getContentFactory().getConditionType(true);var C=this._getContentFactory().getUnitConditionsType(true);if(y){p=y.formatValue(d)}else if(C){p=C.formatValue(e)}}}else{if(!a){e=[]}for(u=0;u<i.length;u++){d=i[u];if(!Gt.call(this,d.operator)){continue}var _=o.indexOfCondition(d,e);if(_===-1){e.push(d)}else if(d.validated===n.Validated&&d.values.length>1&&(e[_].values.length===1||d.values[1]!==e[_].values[1])){e[_].values=d.values}}}if(h>0&&h<e.length){e.splice(0,e.length-h)}var m=false;if(g&&g.setDOMValue){if(this.getMaxConditionsForHelp()===1&&e.length>0){if(this._getContentFactory().isMeasure()&&this._getContentFactory().getUnitConditionsType()){p=this._getContentFactory().getUnitConditionsType().formatValue(e)}else if(this._getContentFactory().getConditionType(true)){p=this._getContentFactory().getConditionType().formatValue(e[0])}else if(this._getContentFactory().getConditionsType(true)){p=this._getContentFactory().getConditionsType().formatValue(e)}var F=function(t){var i=g.getDOMValue();g.setDOMValue("");g.setDOMValue(t);if(i!==t&&h===1){this.fireLiveChange({value:e[0].values[0]})}}.bind(this);if(p instanceof Promise){p.then(function(t){F(t)})}else{F(p)}this._sFilterValue=""}else if(r){g.setDOMValue("");this._sFilterValue="";this._bIgnoreInputValue=false}else{this._bIgnoreInputValue=true}if(this._isInvalidInput()){this._resetInvalidInput();this._removeUIMessage();m=true}}var b=this.getConditions();if(!v(e,b)){this._oNavigateCondition=undefined;this._getContentFactory().updateConditionType();this.setProperty("conditions",e,true);if(!o.compareConditionsArray(e,b)){l.onControlChange();k.call(this,e,true)}}else if(m){k.call(this,e,true)}}function Vt(t){var e=t.getParameter("value");var a=t.getParameter("key");var r=t.getParameter("condition");var l=t.getParameter("itemId");var h=t.getParameter("leaveFocus");if(!r&&a){r=s.createItemCondition(a,e)}var d;var g;var p=this.getControlForSuggestion();var u=o.getEQOperator(this._getOperators());var c=Dt.call(this);if(h){p.addStyleClass("sapMFocus");p.focus();c.removeFocus();return}if(r){this._oNavigateCondition=C({},r);this._oNavigateCondition.operator=u.name;a=r.values[0];e=r.values[1]}else{this._oNavigateCondition=s.createCondition(u.name,[a,e],undefined,undefined,n.Validated)}if(this._getContentFactory().isMeasure()){var f=this.getConditions();if(f.length>0){this._oNavigateCondition.operator=f[0].operator;this._oNavigateCondition.values[0]=[f[0].values[0][0],a];if(f[0].operator==="BT"){this._oNavigateCondition.values[1]=[f[0].values[1][0],this._oNavigateCondition.values[0][1]]}else if(this._oNavigateCondition.values.length>1){this._oNavigateCondition.values.splice(1)}}else{this._oNavigateCondition.values=[this.getControlDelegate().enhanceValueForUnit(this.getPayload(),[null,a],this._oTypeInitialization)]}}this._bPreventGetDescription=true;this._getContentFactory().updateConditionType();if(this.getDisplay()!==i.Value){d=a}else if(e){d=e}else{d=a}var y=c.isOpen();if(p&&p.setDOMValue){if(!g){if(this._getContentFactory().isMeasure()&&this._getContentFactory().getUnitConditionsType()&&this._oNavigateCondition){g=this._getContentFactory().getUnitConditionsType().formatValue([this._oNavigateCondition])}else if(this._getContentFactory().getConditionType(true)&&this._oNavigateCondition){g=this._getContentFactory().getConditionType().formatValue(this._oNavigateCondition)}else if(this._getContentFactory().getConditionsType(true)&&this._oNavigateCondition){g=this._getContentFactory().getConditionsType().formatValue([this._oNavigateCondition])}else{g=e||a}}p.setDOMValue(g);if(p._doSelect){p._doSelect()}if(y){p.removeStyleClass("sapMFocus")}}this._bPreventGetDescription=false;this._getContentFactory().updateConditionType();W.call(this,y,l);this._bIgnoreInputValue=false;this.fireLiveChange({value:d})}function Et(t){if(this._bIgnoreInputValue){var e=this.getControlForSuggestion();this._bIgnoreInputValue=false;e.setDOMValue("");this._sFilterValue="";this._getContentFactory().updateConditionType();if(this.getMaxConditions()!==1){this._oManagedObjectModel.checkUpdate(true)}}W.call(this,false);var i=t.getSource();var n=this.getConditions();It.call(this,n,i)}function Ot(t){W.call(this,true)}function Mt(t){var e=this.getControlForSuggestion();e.focus();if(e.fireValueHelpRequest){e.bValueHelpRequested=true;e.fireValueHelpRequest()}}function Ht(t){var n=this.getEditMode()===e.Editable&&this._getContent().length>0&&sap.ui.getCore().getCurrentFocusedControlId()===this._getContent()[0].getId();if(!n&&!this._bPendingConditionUpdate&&this.getConditions().length>0&&(this.getMaxConditions()!==1||this.getDisplay()!==i.Value&&!this._isInvalidInput())&&this._oManagedObjectModel){this._oManagedObjectModel.checkUpdate(true)}}function At(t){var e=Dt.call(this);xt.call(this,e)}function xt(t){if(this._bConnected){t.detachEvent("select",Pt,this);t.detachEvent("navigated",Vt,this);t.detachEvent("disconnect",At,this);t.detachEvent("afterClose",Et,this);t.detachEvent("switchToValueHelp",Mt,this);t.detachEvent("closed",Et,this);t.detachEvent("opened",Ot,this);this._bConnected=false}}function Bt(){var t=Dt.call(this);if(t){var e;var n=this._getContentFactory().isMeasure();if(n){var a=this._getContentFactory().getCompositeTypes();if(a&&a.length>1){e=a[1]}}else{e=this._getContentFactory().getDataType()}var o={maxConditions:this.getMaxConditions(),dataType:e,operators:this._getOperators(),display:n?i.Value:this.getDisplay(),delegate:this.getControlDelegate(),delegateName:this.getDelegate()&&this.getDelegate().name,payload:this.getPayload(),defaultOperatorName:this.getDefaultOperator?this.getDefaultOperator():null};t.connect(this,o);if(!this._bConnected){this._bConnected=true;t.attachEvent("select",Pt,this);t.attachEvent("navigated",Vt,this);t.attachEvent("disconnect",At,this);t.attachEvent("afterClose",Et,this);t.attachEvent("switchToValueHelp",Mt,this);t.attachEvent("closed",Et,this);t.attachEvent("opened",Ot,this);var s=this.getConditions();It.call(this,s,t);var r=this.getControlForSuggestion();wt.call(this,r);if(t._bIsDefaultHelp){S[t._sDefaultHelpType].updateTitle(t,this.getLabel())}}}}function wt(t){if(t&&!t.orgOnsapfocusleave&&t.onsapfocusleave){t.orgOnsapfocusleave=t.onsapfocusleave;t.onsapfocusleave=function(t){var e=Dt.call(this.getParent());if(e){var i=sap.ui.getCore().byId(t.relatedControlId);if(i){if(m(e.getDomRef(),i.getFocusDomRef())){t.stopPropagation();if(this.bValueHelpRequested){this.bValueHelpRequested=false}return}else{e.skipOpening()}}}this.orgOnsapfocusleave(t)}}}x.prototype._getFieldHelpIcon=function(){var t=Dt.call(this);if(t){return t.getIcon()}};function St(t,e){if(e==="remove"){t.detachEvent("dataUpdate",Ut,this)}else if(e==="insert"){t.attachEvent("dataUpdate",Ut,this);Ut.call(this)}}function Ut(){var t=this.getFieldInfo();var i=this;t.isTriggerable().then(function(n){i._bTriggerable=n;var a=i.getAggregation("_content",[]);if(a.length>0&&i.getEditMode()===e.Display){Z.call(i);if(i._bTriggerable){a=i.getAggregation("_content",[]);var o=a[0];t.getDirectLinkHrefAndTarget().then(function(t){g._updateLink(o,t)})}}})}x.prototype._getFormatOptions=function(){if(!this._asyncParsingCall){this._asyncParsingCall=Nt.bind(this)}return{valueType:this._getContentFactory().retrieveDataType(),originalDateType:this._getContentFactory().getDateOriginalType()||this._getContentFactory().getUnitOriginalType(),additionalType:this._getContentFactory().getUnitType(),compositeTypes:this._getContentFactory().getCompositeTypes(),display:this._getContentFactory().isMeasure()?i.Value:this.getDisplay(),fieldHelpID:this._getContentFactory().isMeasure()?undefined:this.getFieldHelp()||this._sDefaultFieldHelp,operators:this._getOperators(),hideOperator:this._getContentFactory().getHideOperator(),maxConditions:this.getMaxConditions(),bindingContext:this.getBindingContext(),asyncParsing:this._asyncParsingCall,navigateCondition:this._oNavigateCondition,delegate:this.getControlDelegate(),delegateName:this.getDelegate()&&this.getDelegate().name,payload:this.getPayload(),preventGetDescription:this._bPreventGetDescription,convertWhitespaces:this.getEditMode()===e.Display||this.getMaxConditions()!==1,control:this,defaultOperatorName:this.getDefaultOperator?this.getDefaultOperator():null,getConditions:this.getConditions.bind(this),noFormatting:this._getContentFactory().getNoFormatting(),keepValue:this._bIgnoreInputValue?this._sFilterValue:null}};x.prototype._checkValueInitial=function(t){if(t===null||t===undefined){return true}if(t===""||typeof t==="string"&&t.match(/^0+$/)){var e=this._getContentFactory().retrieveDataType();var i=e.parseValue("","string");if(i===t){return true}else{try{e.validateValue(i)}catch(t){return true}}}else{var n=j.call(this);if(this.getTypeUtil().getBaseType(n)===d.Unit&&Array.isArray(t)&&t.length>1&&(t[0]===undefined||t[0]===null)&&!t[1]){return true}}return false};x.prototype._getUnitFormatOptions=function(){if(!this._asyncParsingCall){this._asyncParsingCall=Nt.bind(this)}return{valueType:this._getContentFactory().getUnitType(),originalDateType:this._getContentFactory().getDateOriginalType()||this._getContentFactory().getUnitOriginalType(),additionalType:this._getContentFactory().retrieveDataType(),compositeTypes:this._getContentFactory().getCompositeTypes(),display:this.getDisplay(),fieldHelpID:this.getFieldHelp()||this._sDefaultFieldHelp,operators:["EQ"],hideOperator:true,maxConditions:1,bindingContext:this.getBindingContext(),asyncParsing:this._asyncParsingCall,navigateCondition:this._oNavigateCondition,delegate:this.getControlDelegate(),delegateName:this.getDelegate()&&this.getDelegate().name,payload:this.getPayload(),preventGetDescription:this._bPreventGetDescription,convertWhitespaces:this.getEditMode()===e.Display||this.getEditMode()===e.EditableDisplay,control:this,getConditions:this.getConditions.bind(this),noFormatting:false}};function Nt(t){var e=Dt.call(this);if(e&&e.isOpen()){var i=document.activeElement;if(i&&(m(this.getDomRef(),i)||m(e.getDomRef(),i))){e.close()}}var n={};var a=new Promise(function(e,i){n.resolve=e;n.reject=i;t.then(function(t){n.result=t;this._resetInvalidInput();var e=this.getConditions();if(v(t,e)){kt.call(this,n);Rt.call(this,n)}else{n.waitForUpdate=true}}.bind(this)).catch(function(t){if(t&&!(t instanceof D)&&!(t instanceof b)&&!(t instanceof I)){throw t}this._setInvalidInput(t,undefined,"AsyncParsing");i(t);Rt.call(this,n)}.bind(this))}.bind(this));n.promise=a;this._aAsyncChanges.push(n)}function Lt(){var t=[];for(var e=0;e<this._aAsyncChanges.length;e++){t.push(this._aAsyncChanges[e].promise)}if(t.length>0){return Promise.all(t).then(function(){return this._getResultForPromise(this.getConditions())}.bind(this))}return null}x.prototype._getResultForPromise=function(t){return t};function kt(t){t.resolve(this._getResultForPromise(t.result))}function Rt(t){var e=false;var i=0;for(i=0;i<this._aAsyncChanges.length;i++){if(t===this._aAsyncChanges[i]){e=true;break}}if(e){this._aAsyncChanges.splice(i,1)}return e}x.prototype._getOperators=function(){var t=new RegExp("^\\*(.*)\\*|\\$search$");if(t.test(this.getFieldPath())&&this.getMaxConditions()===1){return["Contains"]}var e=this.getBaseType();if(e===d.Unit){e=d.Numeric}return o.getOperatorsForType(e)};function Gt(t){var e=this._getOperators();for(var i=0;i<e.length;i++){if(t===e[i]){return true}}return false}x.prototype._isPropertyInitial=function(t){if(this.isBound(t)&&!this.getBinding(t)){return!Object.prototype.hasOwnProperty.call(this.mProperties,t)}else{return this.isPropertyInitial(t)}};return x});