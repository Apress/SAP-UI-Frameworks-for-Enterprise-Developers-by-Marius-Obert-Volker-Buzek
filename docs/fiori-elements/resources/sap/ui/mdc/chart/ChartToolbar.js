/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/mdc/ActionToolbar","sap/m/OverflowToolbarRenderer","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarToggleButton","sap/m/Title","sap/ui/mdc/library","sap/ui/mdc/chart/ChartTypeButton","./ChartSelectionDetails","sap/m/ToolbarSeparator","sap/m/OverflowToolbarLayoutData","sap/ui/core/library","sap/ui/Device","sap/ui/core/ShortcutHintsMixin"],function(t,e,o,n,i,a,s,r,l,h,c,d,g,u){"use strict";var p=d.aria.HasPopup;var f=e.extend("sap.ui.mdc.chart.ChartToolbar",{metadata:{library:"sap.ui.mdc",interfaces:[],defaultAggregation:"",properties:{},aggregations:{},associations:{},events:{}},renderer:o});var T=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");f.prototype.init=function(){e.prototype.init.apply(this,arguments)};f.prototype.createToolbarContent=function(t){this._chartInternalButtonsToEnable=[];this._oTitle=new a(t.getId()+"-title",{text:t.getHeader(),level:t.getHeaderLevel(),width:t.getHeaderVisible()?undefined:"0px"});this.addBegin(this._oTitle);if(t.getAggregation("variant")){this.addVariantManagement(t.getAggregation("variant"))}if(t.getShowSelectionDetails()){this._oChartSelectionDetails=new l(t.getId()+"-selectionDetails",{});this._oChartSelectionDetails.attachBeforeOpen(function(e){this._updateSelectionDetailsActions(t)}.bind(this));this.addEnd(this._oChartSelectionDetails)}var e=t.getP13nMode()||[];if(e.indexOf("Item")>-1&&(!t.getIgnoreToolbarActions().length||t.getIgnoreToolbarActions().indexOf(s.ChartToolbarActionType.DrillDownUp)<0)){this._oDrillDownBtn=new n(t.getId()+"-drillDown",{icon:"sap-icon://drill-down",tooltip:T.getText("chart.CHART_DRILLDOWN_TITLE"),text:T.getText("chart.CHART_DRILLDOWN_TITLE"),enabled:false,ariaHasPopup:p.ListBox,layoutData:new c({closeOverflowOnInteraction:false}),press:function(e){t._showDrillDown(this._oDrillDownBtn)}.bind(this)});this.addEnd(this._oDrillDownBtn);this._chartInternalButtonsToEnable.push(this._oDrillDownBtn)}if(!t.getIgnoreToolbarActions().length||t.getIgnoreToolbarActions().indexOf(s.ChartToolbarActionType.Legend)<0){this._oLegendBtn=new i(t.getId()+"btnLegend",{type:"Transparent",text:T.getText("chart.LEGENDBTN_TEXT"),tooltip:T.getText("chart.LEGENDBTN_TOOLTIP"),icon:"sap-icon://legend",pressed:"{$mdcChart>/legendVisible}",enabled:false});this.addEnd(this._oLegendBtn);this._chartInternalButtonsToEnable.push(this._oLegendBtn)}if(!t.getIgnoreToolbarActions().length||t.getIgnoreToolbarActions().indexOf(s.ChartToolbarActionType.ZoomInOut)){this.oZoomInButton=new n(t.getId()+"btnZoomIn",{icon:"sap-icon://zoom-in",tooltip:T.getText("chart.TOOLBAR_ZOOM_IN"),text:T.getText("chart.TOOLBAR_ZOOM_IN"),enabled:false,press:function e(o){t.zoomIn();this.toggleZoomButtons(t)}.bind(this)});this.oZoomOutButton=new n(t.getId()+"btnZoomOut",{icon:"sap-icon://zoom-out",tooltip:T.getText("chart.TOOLBAR_ZOOM_OUT"),text:T.getText("chart.TOOLBAR_ZOOM_OUT"),enabled:false,press:function e(o){t.zoomOut();this.toggleZoomButtons(t)}.bind(this)});this.addEnd(this.oZoomInButton);this.addEnd(this.oZoomOutButton)}if(e.indexOf("Sort")>-1||e.indexOf("Item")>-1||e.indexOf("Filter")>-1){this._oSettingsBtn=new n(t.getId()+"-chart_settings",{icon:"sap-icon://action-settings",tooltip:T.getText("chart.SETTINGS"),text:T.getText("chart.SETTINGS"),enabled:false,press:function(e){var o=t.getP13nMode();var n=o.indexOf("Type");if(n>-1){o.splice(n,1)}if(t.isPropertyHelperFinal()){t.getEngine().uimanager.show(t,o)}else{t.finalizePropertyHelper().then(function(){t.getEngine().uimanager.show(t,o)})}}});u.addConfig(this._oSettingsBtn,{addAccessibilityLabel:true,messageBundleKey:g.os.macintosh?"mdc.PERSONALIZATION_SHORTCUT_MAC":"mdc.PERSONALIZATION_SHORTCUT"},this);this.addEnd(this._oSettingsBtn);this._chartInternalButtonsToEnable.push(this._oSettingsBtn)}if(t._getTypeBtnActive()){this._oChartTypeBtn=new r(t,{ariaHasPopup:p.ListBox,layoutData:new c({closeOverflowOnInteraction:false})});this._oChartTypeBtn.setEnabled(false);this.addEnd(this._oChartTypeBtn);this._chartInternalButtonsToEnable.push(this._oChartTypeBtn)}};f.prototype.addVariantManagement=function(t){if(t){if(this._oVariantManagement){this.removeBetween(this._oVariantManagement)}this._oVariantManagement=t;this.addBetween(this._oVariantManagement)}};f.prototype.toggleZoomButtons=function(t){var e=this._getZoomEnablement(t);if(e.enabled){this.oZoomInButton.setEnabled(e.enabledZoomIn);this.oZoomOutButton.setEnabled(e.enabledZoomOut)}else{this.oZoomInButton.setEnabled(false);this.oZoomOutButton.setEnabled(false)}};f.prototype.updateToolbar=function(t){this.toggleZoomButtons(t);if(!this._toolbarInitialUpdated){this.setEnabled(true);this._chartInternalButtonsToEnable.forEach(function(t){t.setEnabled(true)});this._toolbarInitialUpdated=true}var e=t.getSelectionHandler();if(e&&t.getShowSelectionDetails()){this._oChartSelectionDetails.attachSelectionHandler(e.eventId,e.listener)}};f.prototype._getVariantReference=function(){return this._oVariantManagement};f.prototype._getZoomEnablement=function(t){var e;try{e=t.getZoomState()}catch(t){e={enabled:false}}if(e&&e.hasOwnProperty("currentZoomLevel")&&e.currentZoomLevel!=null&&e.enabled){var o={enabled:true};o.enabledZoomOut=e.currentZoomLevel>0;o.enabledZoomIn=e.currentZoomLevel<1;return o}else{return{enabled:false}}};f.prototype._updateSelectionDetailsActions=function(t){if(!t.getShowSelectionDetails()){return}var e=t.getSelectionDetailsActions(),o;if(e){var n=this._oChartSelectionDetails.getItems();n.forEach(function(t){var n=e.getDetailsItemActions();n.forEach(function(e){o=e.clone();t.addAction(o)})});var i=e.getDetailsActions();this._oChartSelectionDetails.removeAllActions();i.forEach(function(t){o=t.clone();this._oChartSelectionDetails.addAction(o)}.bind(this));var a=e.getActionGroups();this._oChartSelectionDetails.removeAllActionGroups();a.forEach(function(t){o=t.clone();this._oChartSelectionDetails.addActionGroup(o)}.bind(this))}};f.prototype._setHeaderLevel=function(t){this._oTitle.setLevel(t)};f.prototype.setHeaderVisible=function(t){if(this._oTitle){this._oTitle.setWidth(t?undefined:"0px")}};f.prototype.getSettingsButton=function(){return this._oSettingsBtn};return f});