/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/m/ResponsivePopover","sap/m/List","sap/m/Bar","sap/m/StandardListItem","sap/ui/core/InvisibleText","sap/m/library","sap/ui/Device","sap/base/Log","sap/m/IllustratedMessage","sap/m/SearchField","sap/ui/model/json/JSONModel","sap/ui/model/Filter"],function(e,t,n,r,a,i,o,s,l,c,d,u,m){"use strict";var p=o.PlacementType;var f=o.ListMode;function g(e){var t=e.getControlDelegate().getDrillStack(e);var n=[];t.forEach(function(e){e.dimension.forEach(function(e){if(e!=null&&e!=""&&n.indexOf(e)==-1){n.push(e)}})});return n}var v=function(){};v.createDrillDownPopover=function(r){var l;var u=e.getLibraryResourceBundle("sap.ui.mdc");var g=new d({placeholder:u.getText("chart.CHART_DRILLDOWN_SEARCH"),liveChange:function(e){if(!l){return}var t=e.getParameter("newValue");var n=[];if(t){n=new m("text","Contains",t)}l.getBinding("items").filter(n)}});var v=new t({id:r.getId()+"-drilldownPopover",contentWidth:"25rem",contentHeight:"20rem",placement:p.VerticalPreferredBottom,subHeader:g,afterClose:function(){v.destroy()}});var D=new a({title:"{$ChartDrilldown>text}"});l=new n({noData:new c({enableVerticalResponsiveness:true,title:u.getText("chart.NO_DRILLABLE_DIMENSION"),description:u.getText("chart.NO_DRILLABLE_DIMENSION_DESC"),illustrationType:o.IllustratedMessageType.NoDimensionsSet}),mode:f.SingleSelectMaster,items:{path:"$ChartDrilldown>/items",template:D},selectionChange:function(e){var t=e.getParameter("listItem");if(t){var n=t.getBindingContext("$ChartDrilldown");var a=n.getObject().id;r.getEngine().createChanges({control:r,key:"Item",state:[{name:a,position:r.getItems().length}]})}v.close()}});if(s.system.desktop){var h=new i({text:u.getText("chart.CHART_DRILLDOWN_TITLE")});v.setShowHeader(false);v.addContent(h);v.addAriaLabelledBy(h)}else{v.setTitle(u.getText("chart.CHART_DRILLDOWN_TITLE"))}v.addContent(l);r._oDrillDownPopover=v;return v};v.showDrillDownPopover=function(e,t){var n=e.getControlDelegate().getSortedDimensions(e);return n.then(function(n){var r=e._oDrillDownPopover;var a;a=g(e);n=n.filter(function(e){return a.indexOf(e.name)<0});var i={items:[]};n.forEach(function(e){i.items.push({text:e.label,id:e.name})});r.setModel(new u(i),"$ChartDrilldown");if(i.items.length<7){r.getSubHeader().setVisible(false)}return new Promise(function(e,n){r.attachEventOnce("afterOpen",function t(n){e(r)});r.openBy(t)})})};return v});