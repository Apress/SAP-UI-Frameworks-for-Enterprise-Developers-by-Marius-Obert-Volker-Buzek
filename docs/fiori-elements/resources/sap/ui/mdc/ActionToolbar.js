/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/OverflowToolbar","sap/m/OverflowToolbarRenderer","sap/m/ToolbarSpacer","sap/m/ToolbarSeparator","sap/m/library","sap/ui/mdc/enum/ActionToolbarActionAlignment","sap/ui/mdc/p13n/subcontroller/ActionToolbarController","sap/m/p13n/Engine"],function(t,e,o,n,r,i,a,s){"use strict";var g=r.OverflowToolbarPriority;var p=t.extend("sap.ui.mdc.ActionToolbar",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/actiontoolbar/ActionToolbar.designtime",defaultAggregation:"actions",properties:{useAsHeader:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{begin:{type:"sap.ui.core.Control",multiple:true},between:{type:"sap.ui.core.Control",multiple:true},actions:{type:"sap.ui.mdc.actiontoolbar.ActionToolbarAction",multiple:true},end:{type:"sap.ui.core.Control",multiple:true}}},renderer:e});var l=["begin","between","actions","end"];var h=function(){var t={canOverflow:true,getCustomImportance:function(){return g.NeverOverflow}};return t};p.prototype.init=function(){t.prototype.init.apply(this,arguments);this._oBeginSeparator=new n({visible:false});this._oBeginSeparator.getOverflowToolbarConfig=h;this._oEndActionsBeginSeparator=new n({visible:false});this._oEndActionsBeginSeparator.getOverflowToolbarConfig=h;this._oEndActionsEndSeparator=new n({visible:false});this._oEndActionsEndSeparator.getOverflowToolbarConfig=h;this._oSpacer=new o;this.setUseAsHeader(true);s.getInstance().register(this,{controller:{actionsKey:new a({control:this})}})};p.prototype.exit=function(){t.prototype.exit.apply(this,arguments);if(this._oBeginSeparator){this._oBeginSeparator.destroy()}if(this._oEndActionsBeginSeparator){this._oEndActionsBeginSeparator.destroy()}if(this._oEndActionsEndSeparator){this._oEndActionsEndSeparator.destroy()}if(this._oSpacer){this._oSpacer.destroy()}};p.prototype.addAggregation=function(e,o){if(e==="content"){throw new Error("Mutator functions of the content aggregation of the ActionToolbar '"+this.getId()+"' must not be used.")}var n=arguments;if(l.includes(e)){this._registerControlListener(o);this._resetAndInvalidateToolbar(false);if(o){this._moveControlInSuitableCollection(o,this._getControlPriority(o))}this._informNewFlexibleContentAdded(o);var r=this._callToolbarMethod("addAggregation",n);this._updateSeparators();return r}return t.prototype.addAggregation.apply(this,arguments)};p.prototype.destroyAggregation=function(e){if(e==="content"){throw new Error("Mutator functions of the content aggregation of the ActionToolbar '"+this.getId()+"' must not be used.")}if(l.includes(e)){var o=this.removeAllAggregation(e);for(var n=0;n<o.length;n++){o[n].destroy()}this._updateSeparators();return this}return t.prototype.destroyAggregation.apply(this,arguments)};p.prototype.insertAggregation=function(e,o,n){if(e==="content"){throw new Error("Mutator functions of the content aggregation of the ActionToolbar '"+this.getId()+"' must not be used.")}if(l.includes(e)){this._registerControlListener(o);this._resetAndInvalidateToolbar(false);if(o){this._moveControlInSuitableCollection(o,this._getControlPriority(o))}this._informNewFlexibleContentAdded(o);var r=this._callToolbarMethod("insertAggregation",arguments);this._updateSeparators();return r}return t.prototype.insertAggregation.apply(this,arguments)};p.prototype.removeAllAggregation=function(e){if(e==="content"){throw new Error("Mutator functions of the content aggregation of the ActionToolbar '"+this.getId()+"' must not be used.")}return t.prototype.removeAllAggregation.apply(this,arguments)};p.prototype.removeAggregation=function(e,o){if(e==="content"){throw new Error("Mutator functions of the content aggregation of the ActionToolbar '"+this.getId()+"' must not be used.")}if(l.includes(e)){var n=this._callToolbarMethod("removeAggregation",arguments);if(n){this._getPopover().removeAssociatedContent(n.getId())}this._resetAndInvalidateToolbar(false);this._deregisterControlListener(n);this._removeContentFromControlsCollections(n);this._updateSeparators();return n}return t.prototype.removeAggregation.apply(this,arguments)};p.prototype.setUseAsHeader=function(t){this.setProperty("useAsHeader",t,true);this.toggleStyleClass("sapMTBHeader-CTX",!!t);return this};p.prototype.getEndActionsBegin=function(){return this.getActionsWithLayoutInformation({aggregationName:"end",alignment:i.Begin})};p.prototype.getEndActionsEnd=function(){return this.getActionsWithLayoutInformation({aggregationName:"end",alignment:i.End})};p.prototype.getActionsWithLayoutInformation=function(t){return this.getActions().filter(function(e){var o=e.getLayoutInformation();return o.aggregationName===t.aggregationName&&o.alignment===t.alignment})};p.prototype.onAfterRendering=function(){t.prototype.onAfterRendering.apply(this,arguments);this._updateSeparators()};p.prototype._onContentPropertyChangedOverflowToolbar=function(e){if(this._bIsBeingDestroyed){return}t.prototype._onContentPropertyChangedOverflowToolbar.apply(this,arguments);if(e.getParameter("name")==="visible"||e.getParameter("name")==="width"&&e.getSource()!=this._oBeginSeparator){this._updateSeparators()}};p.prototype._hasVisible=function(t){var e=this.getAggregation("_popover")?this.getAggregation("_popover")._getAllContent():[];var o=t.filter(function(t){return e.indexOf(t)===-1});return o.some(function(t){var e=t.getWidth?t.getWidth()!=="0px":true;return t.getVisible()&&e})};p.prototype._updateSeparators=function(){var t=this._hasVisible(this.getEnd());if(this._oBeginSeparator){var e=this._hasVisible(this.getBegin());var o=this._hasVisible(this.getBetween());this._oBeginSeparator.setVisible(e&&o)}if(this._oEndActionsBeginSeparator){var n=this._hasVisible(this.getEndActionsBegin());this._oEndActionsBeginSeparator.setVisible(t&&n)}if(this._oEndActionsEndSeparator){var r=this._hasVisible(this.getEndActionsEnd());this._oEndActionsEndSeparator.setVisible(t&&r)}};p.prototype.indexOfContent=function(t){return this.getContent().indexOf(t)};p.prototype.getContent=function(){var t=this.getBegin();t.push(this._oBeginSeparator);t=t.concat(this.getBetween());t.push(this._oSpacer);t=t.concat(this.getEndActionsBegin());t.push(this._oEndActionsBeginSeparator);t=t.concat(this.getEnd());t.push(this._oEndActionsEndSeparator);t=t.concat(this.getEndActionsEnd());return t};p.prototype.getCurrentState=function(){var t=[],e;this.getActions().forEach(function(o,n){e=o&&o.getId();if(o.getVisible()){t.push({name:e,alignment:o.getLayoutInformation().alignment})}});return{items:t}};p.prototype.initPropertyHelper=function(){return Promise.resolve({getProperties:function(){var t=[];this.getActions().forEach(function(e){t.push({name:e.getId(),alignment:e.getLayoutInformation().alignment,label:e.getLabel(),visible:true})});return t}.bind(this)})};return p});