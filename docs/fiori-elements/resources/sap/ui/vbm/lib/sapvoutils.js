/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["./sapvbi"],function(){"use strict";VBI.Utilities.SceneBindDesignSpotBoxSize=function(t){var e=this.m_Scene;if(t.m_Design&&t.m_Hit==VBI.HTBOXHANDLE&&this.m_Scale.IsChangeable(e.m_Ctx)){if(t.m_Handle>6){return}var i=e.GetStretchFactor4Mode();var a=t.m_ClientX/i[0];var r=t.m_ClientY/i[0];var s=t.m_DhOrig[0];var n=(s[0]+s[2])/2;var m=(s[2]-s[0])/2;var l=s[3]-s[1];var _=1,u=1;switch(t.m_Handle){case 1:u=Math.abs(r-s[3])/l;break;case 2:case 5:if(t.m_Handle==2){u=Math.abs(r-s[3])/l}_=Math.abs(a-n)/m;break;case 0:case 3:if(t.m_Handle==0){u=Math.abs(r-s[3])/l}_=Math.abs(a-n)/m;break;default:break}var o=t.m_ScaleOrig.slice(0);o[0]*=_;o[1]*=u;this.m_Scale.SetValueVector(e.m_Ctx,o)}};VBI.Utilities.SceneBindDesignBoxBoxSize=function(t,e){var i=this.m_Scene;if(e.m_Design&&e.m_Hit==VBI.HTBOXHANDLE&&this.m_Scale.IsChangeable(i.m_Ctx)){var a=i.GetStretchFactor4Mode();var r=e.m_ClientX/a[0];var s=e.m_ClientY/a[0];var n=e.m_DhOrig[0];var m=(n[0]+n[2])/2;var l=(n[1]+n[3])/2;var _=(n[2]-n[0])/2;var u=(n[3]-n[1])/2;var o=1,h=1;switch(e.m_Handle){case 0:case 2:case 6:case 8:o=Math.abs(r-m)/_;h=Math.abs(s-l)/u;if(t){o=h=Math.max(o,h)}break;case 1:case 7:h=Math.abs(s-l)/u;if(t){o=h}break;case 3:case 5:o=Math.abs(r-m)/_;if(t){h=o}break;default:break}var f=e.m_ScaleOrig.slice(0);f[0]*=o;f[1]*=h;this.m_Scale.SetValueVector(i.m_Ctx,f)}};VBI.Utilities.SceneBindMeterRadiusDesignBoxSize=function(t){var e=this.m_Scene;if(t.m_Design){var i=this.m_Pos.GetValueVector(e.m_Ctx);var a=e.GetPosFromPoint([t.m_ClientX,t.m_ClientY,0]);var r=0;switch(t.m_Handle){case 1:case 7:r=VBI.MathLib.Distance(VBI.MathLib.DegToRad(i),VBI.MathLib.DegToRad([i[0],a[1]]));break;case 3:case 5:r=VBI.MathLib.Distance(VBI.MathLib.DegToRad(i),VBI.MathLib.DegToRad([a[0],i[1]]));break;default:break}this.m_Radius.SetValueFloat(e.m_Ctx,Math.abs(r))}};VBI.Utilities.SceneBindRadiusDesignBoxSize=function(t){var e=this.m_Scene;if(t.m_Design){var i=this.m_Pos.GetValueVector(e.m_Ctx);var a=e.GetPointFromPos(i);a[0]+=t.m_IO;var r=0;switch(t.m_Handle){case 1:case 7:r=a[1]-t.m_ClientY;break;case 3:case 5:r=a[0]-t.m_ClientX;break;default:break}this.m_Radius.SetValueFloat(e.m_Ctx,Math.abs(r))}};VBI.Utilities.SceneBindPosArrayDesignBoxSize=function(t){var e=this.m_Scene;if(t.m_Design){var i=e.GetPosFromPoint([t.m_ClientX-t.m_IO,t.m_ClientY,0]);var a=Number.MAX_VALUE;var r=-Number.MAX_VALUE;var s=Number.MAX_VALUE;var n=-Number.MAX_VALUE;var m=t.m_PosOrig.slice(0);var l,_=m.length/3,u;for(l=0;l<_;++l){u=l*3;if(a>m[u]){a=m[u]}if(r<m[u]){r=m[u]}if(s>m[u+1]){s=m[u+1]}if(n<m[u+1]){n=m[u+1]}}var o=0,h=1;var f=0,c=1;switch(t.m_Handle){case 0:case 1:if(t.m_Handle==0){o=r;h=(i[0]-r)/(a-r)}f=s;c=(i[1]-s)/(n-s);break;case 2:case 5:if(t.m_Handle==2){f=s;c=(i[1]-s)/(n-s)}o=a;h=(i[0]-a)/(r-a);break;case 6:case 3:if(t.m_Handle==6){f=n;c=(i[1]-n)/(s-n)}o=r;h=(i[0]-r)/(a-r);break;case 8:case 7:if(t.m_Handle==8){o=a;h=(i[0]-a)/(r-a)}f=n;c=(i[1]-n)/(s-n);break;default:break}for(l=0;l<_;++l){u=l*3;m[u]=o+(m[u]-o)*h;m[u+1]=f+(m[u+1]-f)*c}this.m_Pos.SetValueVector(e.m_Ctx,m)}};VBI.Utilities.BackupFont=function(t){t.m_BackupFont=[];t.m_BackupFont.m_font=t.m_font=t.font;t.m_BackupFont.m_fillStyle=t.fillStyle;t.m_BackupFont.m_strokeStyle=t.strokeStyle;t.m_BackupFont.m_textAlign=t.textAlign;t.m_BackupFont.m_textBaseline=t.textBaseline};VBI.Utilities.RestoreFont=function(t){t.m_font=t.font=t.m_BackupFont.m_font;t.fillStyle=t.m_BackupFont.m_fillStyle;t.strokeStyle=t.m_BackupFont.m_strokeStyle;t.textAlign=t.m_BackupFont.m_textAlign;t.textBaseline=t.m_BackupFont.m_textBaseline};VBI.Utilities.SetTextAttributes=function(t,e,i,a,r,s){if(e!=undefined&&t.m_font!=e){t.m_font=t.font=e}var n;if(i){n=VBI.Types.string2rgba(i);t.fillStyle=VBI.Utilities.RgbToHex(n[0],n[1],n[2])}if(a){n=VBI.Types.string2rgba(a);t.strokeStyle=VBI.Utilities.RgbToHex(n[0],n[1],n[2])}t.textAlign=r;t.textBaseline=s};VBI.Utilities.SetFont=function(t,e){if(e!=undefined&&t.m_font!=e){t.m_font=t.font=e}};VBI.DnDInfo=function(){var t={};t.m_datasource=null;t.m_boundtype=null;t.m_type=[];t.clear=function(){for(var e=0;e<t.m_type.length;++e){t.m_type[e].clear()}if(t.m_boundtype){t.m_boundtype.clear()}if(t.m_datasource){t.m_datasource.clear()}t.m_datasource=null;t.m_boundtype=null;t.m_type=[]};t.load=function(e,i,a){if(e){if(jQuery.type(e)=="array"){for(var r=0;r<e.length;++r){if(jQuery.type(e[r])=="object"){if(e[r].datasource){t.m_datasource=new VBI.NodeProperty(e[r],"datasource",a.m_DataSource,i);t.m_boundtype=new VBI.AttributeProperty(e[r],"type",t.m_datasource,i)}else{t.m_type.push(new VBI.AttributeProperty(e[r],"type",null,i))}}}}else if(jQuery.type(e)=="object"){if(e.datasource){t.m_datasource=new VBI.NodeProperty(e,"datasource",a.m_DataSource,i);t.m_boundtype=new VBI.AttributeProperty(e,"type",t.m_datasource,i)}else{t.m_type.push(new VBI.AttributeProperty(e,"type",null,i))}}}};t.getItemArray=function(e){var i=[];var a;if(t.m_datasource){var r=t.m_datasource;var s;if(s=r.GetCurrentNode(e)){for(a=0;a<s.m_dataelements.length;++a){r.Select(a);i.push(t.m_boundtype.GetValueString(e))}}}if(t.m_type.length){for(a=0;a<t.m_type.length;++a){i.push(t.m_type[a].GetValueString(e))}}return i};return t};VBI.NodeProperty=function(t,e,i,a){var r=null;if(!(r=t[e])){r=t[e+".bind"]}var s=r.split("::");var n=s[s.length-1].split(".");s.splice(-1,1);s.push(n[0]);n[0]=s.join("::");this.m_NPath=n;this.m_Path=n;this.m_PNP=i;this.m_nCurElement=0;this.m_CurElement=null;this.m_DTN=a.m_DataTypeProvider.FindTypeNodeFromPath(this.m_Path);var m=this;while(m=m.m_PNP){if(a.m_DataTypeProvider.isParentOf(m.m_DTN,this.m_DTN)){var l,_=m.m_DTN.GetPath();for(l=0;l<_.length;++l){if(this.m_NPath[0]==_[l]){this.m_NPath.splice(0,1)}else{break}}break}}this.m_PNP=m;this.NotifyDataChange=function(t){this.m_CurElement=null;this.m_DTN=t.m_DataTypeProvider.FindTypeNodeFromPath(this.m_Path)};this.clear=function(){this.m_PNP=null;this.m_CurElement=null;this.m_DTN=null;this.m_NPath=null;this.m_Path=null};this.GetCurrentElement=function(t){if(this.m_CurElement){return this.m_CurElement}var e=this.GetCurrentNode(t);if(!e){return null}this.m_CurElement=e.m_dataelements[this.m_nCurElement];return this.m_CurElement};this.GetIndexedElement=function(t,e){var i=this.GetCurrentNode(t);if(!i){return null}return i.m_dataelements[e]};this.GetCurrentNode=function(t){var e=null;if(this.m_PNP){var i=this.m_PNP.GetCurrentElement(t);e=i.FindNodeFromPath(this.m_NPath)}else{e=t.m_DataProvider.FindNodeFromPath(this.m_NPath)}return e};this.Select=function(t){this.m_CurElement=null;this.m_nCurElement=t};this.SetEditMode=function(t,e){var i;if(i=this.GetCurrentElement(t)){i.m_EditMode=e}};this.GetEditMode=function(t){var e;if((e=this.GetCurrentElement(t))&&e.m_EditMode!=undefined){return e.m_EditMode}return VBI.EMHandle};this.IsElementSelected=function(t){var e;if(e=this.GetCurrentElement(t)){return e.IsSelected()}return false};this.SetSelected=function(t,e){return};return this};VBI.AttributeProperty=function(t,e,i,a,r){var s;this.m_DefaultValue=r;if(s=t[e]){this.m_Name=e;this.m_Value=s}else if(s=t[e+".bind"]){this.m_PNP=i;this.m_Name=e;var n=s.split("::");var m=n[n.length-1].split(".");n.splice(-1,1);n.push(m[0]);m[0]=n.join("::");this.m_RelBind=m;this.m_AbsBind=m;this.m_DTA=a.m_DataTypeProvider.FindTypeAttributeFromPath(this.m_AbsBind);var l=this;while(l=l.m_PNP){if(a.m_DataTypeProvider.isParentOf(l.m_DTN,this.m_DTA)){var _,u=l.m_DTN.GetPath();for(_=0;_<u.length;++_){if(this.m_RelBind[0]==u[_]){this.m_RelBind.splice(0,1)}else{break}}break}}this.m_PNP=l}this.NotifyDataChange=function(t){if(this.m_AbsBind){this.m_DTA=t.m_DataTypeProvider.FindTypeAttributeFromPath(this.m_AbsBind)}};this.clear=function(){this.m_PNP=null;this.m_DTA=null;this.m_DefaultValue=null;if(this.m_Name){this.m_Name=null}if(this.m_Value){this.m_Value=null}if(this.m_PNP){this.m_PNP=null}if(this.m_RelBind){this.m_RelBind=null}if(this.m_AbsBind){this.m_AbsBind=null}};this.IsChangeable=function(t){var e;if(e=this.GetAttributeObject(t)){return e.IsChangeable()}return false};this.GetAttributeObject=function(t){if(this.m_RelBind){if(this.m_PNP){return this.m_PNP.GetCurrentElement(t).FindAttributeFromPath(this.m_RelBind)}else{return t.m_DataProvider.FindAttributeFromPath(this.m_RelBind)}}return null};this.GetValueFloat=function(t){if(this.m_Value){return VBI.Types.string2float(this.m_Value)}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_float){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2float(e.m_Value)}if(e.m_dta.m_Type==VBI.Types.st_long){return VBI.Types.long2float(e.m_Value)}if(e.m_dta.m_Type==VBI.Types.st_bool){return e.m_Value?1:0}}}return this.m_DefaultValue};this.GetValueString=function(t){if(this.m_Value){return this.m_Value}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_string){return e.m_Value}else{return e.GetStringValue()}}}return this.m_DefaultValue};this.GetValueLong=function(t){if(this.m_Value){return VBI.Types.string2long(this.m_Value)}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_long){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_bool){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2long(e.m_Value)}if(e.m_dta.m_Type==VBI.Types.st_float){return VBI.Types.float2long(e.m_Value)}}}return this.m_DefaultValue};this.GetValueBool=function(t){if(this.m_Value){return VBI.Types.string2bool(this.m_Value)}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_bool){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2bool(e.m_Value)}}}return this.m_DefaultValue};this.GetValueVector=function(t){if(this.m_Value){if(typeof this.m_Value==="string"){return VBI.Types.string2vector(this.m_Value)}else{return VBI.Types.stringarray2vectorarray(this.m_Value)}}if(this.m_RelBind){var e;if(e=this.GetAttributeObject(t)){if(e.m_dta.m_Type==VBI.Types.st_vector||e.m_dta.m_Type==VBI.Types.st_vectorarray||e.m_dta.m_Type==VBI.Types.st_vectorarraymulti){return e.m_Value}if(e.m_dta.m_Type==VBI.Types.st_string){return VBI.Types.string2vector(e.m_Value)}}}return this.m_DefaultValue};this.GetValueColor=function(t){var e;if(this.m_Value){e=VBI.Types.string2rgba(this.m_Value);return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"}if(this.m_RelBind){var i;if(i=this.GetAttributeObject(t)){if(i.m_dta.m_Type==VBI.Types.st_color){return i.m_Value}if(i.m_dta.m_Type==VBI.Types.st_string){e=VBI.Types.string2rgba(i.m_Value);return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"}}}return this.m_DefaultValue};this.SetValueVector=function(t,e){if(this.m_Value){return null}if(this.m_RelBind){var i;if(i=this.GetAttributeObject(t)){if(i.m_dta.m_Type==VBI.Types.st_vector||i.m_dta.m_Type==VBI.Types.st_vectorarray){i.set(e)}if(i.m_dta.m_Type==VBI.Types.st_string){i.set(VBI.Types.float2string(e))}}}return null};this.SetValueFloat=function(t,e){if(this.m_Value){return null}if(this.m_RelBind){var i;if(i=this.GetAttributeObject(t)){if(i.m_dta.m_Type==VBI.Types.st_float){i.set(e)}else if(i.m_dta.m_Type==VBI.Types.st_long){i.set(VBI.Types.float2long(e))}else if(i.m_dta.m_Type==VBI.Types.st_string){i.set(VBI.Types.float2string(e))}}}return null};this.IsBound=function(){return this.m_RelBind?true:false};return this}});