/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["sap/ui/unified/Menu","sap/ui/unified/MenuItem","./sapvbi"],function(e,n){"use strict";VBI.Menus=function(){var t={};t.m_menus=[];t.clear=function(){for(var e=t.m_menus.length-1;e>=0;--e){t.m_menus[e].destroy();t.m_menus.pop()}t.m_menus=[]};t.loadMainMenu=function(n,i){var a=new e;t.loadMenu(a,n,i,a.getId());a.vbi_data={};a.vbi_data.menuRef=n.id;a.vbi_data.VBIName=n.name;a.attachItemSelect(function(e){var n={};n.refid=e.mParameters.item.vbi_data.refid;n.menu=a;t.OnSelected(n)});t.m_menus.push(a);return a};t.loadMenu=function(i,a,u,r){var m=jQuery.type(a.MenuItem)=="object";var d=m?1:a.MenuItem.length;for(var f=0;f<d;++f){var o=m?a.MenuItem:a.MenuItem[f];if(o.active=="false"){continue}var _;_=r+"_"+f;var c=o.Separator==undefined?o.text:"---------------------------";var s=new n("vbimi_"+_,{text:c});s.vbi_data={};if(o.disabled=="true"||o.Separator!=undefined){s.setEnabled(false)}i.addItem(s);if(o.icon){s.setIcon(o.icon)}if(VBI.m_bTrace){VBI.Trace("Adding Menuitem: menuitem_"+_+" with text "+c)}if(o.MenuItem!=undefined){var v=new e("vbim_"+_);s.setSubmenu(v);t.loadMenu(v,o,u,_)}else if(o.id!=""){s.vbi_data.refid=o.id}}};t.deleteMenu=function(e){var n=t.findMenuIdxByName(e);if(n>=0){var i=t.m_menus.length-1;t.m_menus[n].destroy();if(n!=i){t.m_menus[n]=t.m_menus[i]}t.m_menus.pop();return n}return-1};t.getMainScene=function(e){if(e.m_SceneManager.m_SceneArray.length==1){return e.m_SceneManager.m_SceneArray[0].m_ID}return undefined};t.load=function(e,n){sap.ui.getCore().loadLibrary("sap.ui.unified");t.m_context=n;if(e.Set){if(e.Set.name!=undefined){t.deleteMenu(e.Set.name)}else{t.clear()}if(jQuery.type(e.Set)=="object"){if(e.Set.Menu){t.loadMainMenu(e.Set.Menu,n)}}else if(jQuery.type(e.Set)=="array"){for(var i=0;i<e.Set.length;++i){if(e.Set[i].Menu){t.loadMainMenu(e.Set[i].Menu,n)}}}}};t.findMenuByID=function(e){if(t.m_menus){for(var n=0;n<t.m_menus.length;++n){if(t.m_menus[n].vbi_data.menuRef==e){return t.m_menus[n]}}}return null};t.findMenuIdxByName=function(e){if(t.m_menus){for(var n=0;n<t.m_menus.length;++n){if(t.m_menus[n].vbi_data.VBIName==e){return n}}}return-1};t.OnSelected=function(e){var n=e.menu.vbi_data.object;if(e.refid==undefined){return}var i=t.m_context.m_SceneManager.GetSceneByName(e.menu.vbi_data.scene);var a=t.m_context.m_Actions;if(a){if(a.findAction("ContextMenu",i,n)){var u=new VBI.Actions.Action;u.m_name="FCODE_SELECT";u.m_id=e.refid;i.m_Ctx.FireAction(u,i,n,null,null,e.menu.vbi_data.instance)}}};return t}});