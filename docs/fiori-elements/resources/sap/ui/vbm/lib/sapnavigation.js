/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["./sapvbi"],function(){"use strict";VBI.NavigationControl=function(e){var o={};o.scene=null;o.suppressedVisibility=e;o.m_MinLOD=null;o.m_MaxLOD=null;o.m_lengthScrollLine=94-18;o.m_startScrollPoint=null;o.m_ID=null;o.zoomtimerfrq=40;o.zoomtimer=0;o.movetimer=0;o.bInitDrag=false;o.offsetX=0;o.offsetY=0;o.curMoveX=0;o.curMoveY=0;o.curZoomY=0;o.tint=20;o.midpointForZoom=[0,0];o.timer_mapnav=null;o.m_Div=o.m_Divmapnav=o.m_Divmapscrollarea=o.m_Divmapscrollpoint=o.m_Divmapcursorgrip=o.m_Divmapcursor=o.m_Divmapcursorreset=o.m_Divmapcursorleft=o.m_Divmapcursortop=o.m_Divmapcursorright=o.m_Divmapcursordown=o.m_DivmapmobileHome=o.m_DivmapmobileHomeIcon=o.m_DivmapmobileZoomin=o.m_DivmapmobileZoominIcon=o.m_DivmapmobileZoomout=o.m_DivmapmobileZoomoutIcon=null;o.clear=function(){if(o.timer_mapnav){window.clearInterval(o.timer_mapnav)}o.DetachEvents();o.scene=null;o.m_Div=o.m_Divmapnav=o.m_Divmapscrollarea=o.m_Divmapscrollpoint=o.m_Divmapcursorgrip=o.m_Divmapcursor=o.m_Divmapcursorreset=o.m_Divmapcursorleft=o.m_Divmapcursortop=o.m_Divmapcursorright=o.m_Divmapcursordown=o.m_DivmapmobileHome=o.m_DivmapmobileHomeIcon=o.m_DivmapmobileZoomin=o.m_DivmapmobileZoominIcon=o.m_DivmapmobileZoomout=o.m_DivmapmobileZoomoutIcon=null};o.getId=function(e,o){return o+"-"+e};o.DetachEvents=function(){if(VBI.m_bIsMobile){jQuery(o.m_DivmapmobileHome).off();jQuery(o.m_DivmapmobileZoomin).off();jQuery(o.m_DivmapmobileZoomout).off()}else{jQuery(o.m_Divmapnav).off();jQuery(o.m_Divmapscrollpoint).off();jQuery(o.m_Divmapcursorgrip).off();jQuery(o.m_Divmapcursorleft).off();jQuery(o.m_Divmapcursorright).off();jQuery(o.m_Divmapcursortop).off();jQuery(o.m_Divmapcursordown).off();jQuery(o.m_Divmapcursorreset).off();document.removeEventListener("mouseup",o.zoom_processmouseup,true);document.removeEventListener("mousemove",o.zoom_processmousemove,true)}};o.AttachEvents=function(){if(VBI.m_bIsMobile){o.AttachTouchEvents()}else{o.AttachMouseEvents()}};o.AttachTouchEvents=function(){jQuery(o.m_DivmapmobileHome).on("click",function(){if(VBI.m_bTrace){VBI.Trace("Home Button : click")}o.scene.GoToInitialStart()});jQuery(o.m_DivmapmobileHome).on("touchstart",function(){if(VBI.m_bTrace){VBI.Trace("Home Button : touchstart")}o.scene.GoToInitialStart()});jQuery(o.m_DivmapmobileHome).on("touchend",function(e){if(VBI.m_bTrace){VBI.Trace("Home Button : touchend")}e.preventDefault()});jQuery(o.m_DivmapmobileZoomin).on("touchstart",function(){if(VBI.m_bTrace){VBI.Trace("ZoomIn Button : touchstart")}o.StartAnimatedZoom(1)});jQuery(o.m_DivmapmobileZoomin).on("touchend",function(e){if(VBI.m_bTrace){VBI.Trace("ZoomIn Button : touchend")}if(o.zoomtimer){window.clearInterval(o.zoomtimer);o.ZoomToNextIntegerLOD(true)}e.preventDefault()});jQuery(o.m_DivmapmobileZoomin).on("touchleave",function(){if(VBI.m_bTrace){VBI.Trace("ZoomIn Button : touchleave")}if(o.zoomtimer){window.clearInterval(o.zoomtimer);o.ZoomToNextIntegerLOD(true)}});jQuery(o.m_DivmapmobileZoomout).on("touchstart",function(){if(VBI.m_bTrace){VBI.Trace("ZoomOut Button : touchstart")}o.StartAnimatedZoom(-1)});jQuery(o.m_DivmapmobileZoomout).on("touchend",function(e){if(VBI.m_bTrace){VBI.Trace("ZoomOut Button : touchend")}if(o.zoomtimer){window.clearInterval(o.zoomtimer);o.ZoomToNextIntegerLOD(false)}e.preventDefault()});jQuery(o.m_DivmapmobileZoomout).on("touchleave",function(){if(VBI.m_bTrace){VBI.Trace("ZoomOut Button : touchleave")}if(o.zoomtimer){window.clearInterval(o.zoomtimer);o.ZoomToNextIntegerLOD(false)}})};o.AttachMouseEvents=function(){var e=1;var i=50;o.timer_mapnav=null;var t=null;if(o.suppressedVisibility.fade){o.m_Divmapnav.style.opacity=1}jQuery(o.m_Divmapnav).on("mouseenter",function(e){t=e.fromElement});jQuery(o.m_Divmapnav).on("mouseup",function(){if(t){t.focus({preventScroll:true})}});jQuery(o.m_Divmapnav).on("mouseleave",function(){if(!o.suppressedVisibility.fade){e=1;o.timer_mapnav=window.setInterval(function(){if(!o.m_Divmapnav||e<=.5){window.clearInterval(o.timer_mapnav)}else{e-=.01;o.m_Divmapnav.style.opacity=e}},i)}});jQuery(o.m_Divmapnav).on("mouseenter",function(){window.clearInterval(o.timer_mapnav);o.m_Divmapnav.style.opacity=1});if(!o.suppressedVisibility.zoom){if(o.suppressedVisibility.move){jQuery(o.m_Divmapscrollarea).css("top",10+"px")}jQuery(o.m_Divmapscrollpoint).on("mousedown",function(e){if(e.which==1){o.midpointForZoom=o.scene.GetCenterPos();o.curZoomY=jQuery(o.m_Divmapscrollpoint).position().top;o.offsetY=e.pageY-o.curZoomY;document.addEventListener("mouseup",o.zoom_processmouseup,true);document.addEventListener("mousemove",o.zoom_processmousemove,true)}});jQuery(o.m_Divmapscrollpoint).on("dragstart",function(e){e.preventDefault()})}if(!o.suppressedVisibility.move){jQuery(o.m_Divmapcursorgrip).on("mouseenter",function(){jQuery(o.m_Divmapcursor).css("background-position","-5px 228px")}).on("mouseleave",function(){jQuery(o.m_Divmapcursor).css("background-position","-5px 305px")});var r=10;jQuery(o.m_Divmapcursorleft).on("mousedown",function(e){if(e.which==1){jQuery(this).css("background-position","-134px 194px");window.clearInterval(o.movetimer);o.movetimer=window.setInterval(function(){o.scene.MoveMap(r,0)},o.tint)}}).on("mouseup",function(e){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-134px 211px")}).on("mouseout",function(e){if(o.bInitDrag==false){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-134px 228px")}}).on("mousemove",function(e){if(o.bInitDrag==true){jQuery(this).css("background-position","-134px 177px")}});jQuery(o.m_Divmapcursorright).on("mousedown",function(e){if(e.which==1){jQuery(this).css("background-position","-116px 194px");window.clearInterval(o.movetimer);o.movetimer=window.setInterval(function(){o.scene.MoveMap(-r,0)},o.tint)}}).on("mouseup",function(e){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-116px 211px")}).on("mouseout",function(e){if(o.bInitDrag==false){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-116px 228px")}}).on("mousemove",function(e){if(o.bInitDrag==true){jQuery(this).css("background-position","-116px 177px")}});jQuery(o.m_Divmapcursortop).on("mousedown",function(e){if(e.which==1){jQuery(this).css("background-position","-82px 192px");window.clearInterval(o.movetimer);o.movetimer=window.setInterval(function(){o.scene.MoveMap(0,r)},o.tint)}}).on("mouseup",function(e){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-82px 210px")}).on("mouseout",function(e){if(o.bInitDrag==false){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-82px 228px")}}).on("mousemove",function(e){if(o.bInitDrag==true){jQuery(this).css("background-position","-82px 174px")}});jQuery(o.m_Divmapcursordown).on("mousedown",function(e){if(e.which==1){jQuery(this).css("background-position","-99px 192px");window.clearInterval(o.movetimer);o.movetimer=window.setInterval(function(){o.scene.MoveMap(0,-r)},o.tint)}}).on("mouseup",function(e){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-99px 210px")}).on("mouseout",function(e){if(o.bInitDrag==false){window.clearInterval(o.movetimer);jQuery(this).css("background-position","-99px 228px")}}).on("mousemove",function(e){if(o.bInitDrag==true){jQuery(this).css("background-position","-99px 174px")}});jQuery(o.m_Divmapcursorreset).on("dragstart",function(e){e.preventDefault()});jQuery(o.m_Divmapcursorreset).on("mousedown",function(e){if(e.which==1){o.curMoveX=jQuery(o.m_Divmapcursorreset).position().left;o.curMoveY=jQuery(o.m_Divmapcursorreset).position().top;jQuery(o.m_Divmapcursorleft).css("background-position","-134px 177px");jQuery(o.m_Divmapcursorright).css("background-position","-116px 177px");jQuery(o.m_Divmapcursordown).css("background-position","-99px 174px");jQuery(o.m_Divmapcursortop).css("background-position","-82px 174px");jQuery(this).css("background-position","-222px 263px");o.offsetX=e.pageX-o.curMoveX;o.offsetY=e.pageY-o.curMoveY;window.clearInterval(o.movetimer);o.movetimer=0;o.bInitDrag=true;document.addEventListener("mouseup",o.processmouseup,true);document.addEventListener("mousemove",o.processmousemove,true)}});jQuery(o.m_Divmapcursorreset).css("position","");jQuery(o.m_Divmapcursorreset).on("dblclick",function(){o.scene.GoToInitialStart()})}};o.AppendButton=function(){o.m_Divmapnav=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-nav",o.m_ID),"vbi-nav");o.m_Divmapnav.setAttribute("role",sap.ui.core.AccessibleRole.Navigation);o.m_Divmapnav.setAttribute("tabindex","-1");o.m_Divmapnav.m_VBIType="N";o.m_DivmapmobileHome=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-navmobile-home",o.m_ID),"vbi-navmobile-home");o.m_DivmapmobileHome.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_DivmapmobileHome.setAttribute("tabindex","-1");o.m_DivmapmobileHome.innerHTML="î°";o.m_Divmapnav.appendChild(o.m_DivmapmobileHome);if(!o.suppressedVisibility.zoom){o.m_DivmapmobileZoomin=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-navmobile-zoomin",o.m_ID),"vbi-navmobile-zoomin");o.m_DivmapmobileZoomin.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_DivmapmobileZoomin.setAttribute("tabindex","-1");o.m_DivmapmobileZoomin.innerHTML="+";o.m_Divmapnav.appendChild(o.m_DivmapmobileZoomin);o.m_DivmapmobileZoomout=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-navmobile-zoomout",o.m_ID),"vbi-navmobile-zoomout");o.m_DivmapmobileZoomout.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_DivmapmobileZoomout.setAttribute("tabindex","-1");o.m_DivmapmobileZoomout.innerHTML="-";o.m_Divmapnav.appendChild(o.m_DivmapmobileZoomout)}o.scene.m_Div.appendChild(o.m_Divmapnav)};o.AppendDiv=function(){var e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vbm.i18n");var i=e.getText("NAVCTL_TITLE_ZOOM",[0]);i=i.substr(0,i.search(/[0-9]/));o.m_Divmapnav=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-nav",o.m_ID),"vbi-nav");o.m_Divmapnav.setAttribute("role",sap.ui.core.AccessibleRole.Navigation);o.m_Divmapnav.setAttribute("tabindex","-1");o.m_Divmapnav.m_VBIType="N";o.m_Divmapcursor=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor",o.m_ID),"vbi-cursor");o.m_Divmapcursor.setAttribute("role",sap.ui.core.AccessibleRole.Presentation);o.m_Divmapcursor.setAttribute("tabindex","-1");o.m_Divmapscrollarea=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrollarea",o.m_ID),"vbi-scrollarea");o.m_Divmapscrollarea.setAttribute("role",sap.ui.core.AccessibleRole.Slider);o.m_Divmapscrollarea.setAttribute("tabindex","0");o.m_Divmapcursorgrip=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-grip",o.m_ID),"vbi-cursor-grip");o.m_Divmapcursorgrip.setAttribute("role",sap.ui.core.AccessibleRole.Img);o.m_Divmapcursorgrip.setAttribute("tabindex","-1");var t=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-middle",o.m_ID),"vbi-cursor-middle");t.setAttribute("role",sap.ui.core.AccessibleRole.Img);t.setAttribute("tabindex","0");var r=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrolllineupperending",o.m_ID),"vbi-scrolllineupperending");r.setAttribute("role",sap.ui.core.AccessibleRole.Img);r.setAttribute("tabindex","-1");var m=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrollline",o.m_ID),"vbi-scrollline");m.setAttribute("role",sap.ui.core.AccessibleRole.Img);m.setAttribute("tabindex","-1");var n=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrolllinelowerending",o.m_ID),"vbi-scrolllinelowerending");n.setAttribute("role",sap.ui.core.AccessibleRole.Img);n.setAttribute("tabindex","-1");o.m_Divmapscrollpoint=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-scrollpoint",o.m_ID),"vbi-scrollpoint",i);o.m_Divmapscrollpoint.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapscrollpoint.setAttribute("aria-label",i);o.m_Divmapscrollpoint.setAttribute("tabindex","0");o.m_Divmapcursorleft=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-left",o.m_ID),"vbi-cursor-left",e.getText("NAVCTL_TITLE_MOVE_LEFT"));o.m_Divmapcursorleft.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursorleft.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE_LEFT"));o.m_Divmapcursorleft.setAttribute("tabindex","2");o.m_Divmapcursorright=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-right",o.m_ID),"vbi-cursor-right",e.getText("NAVCTL_TITLE_MOVE_RIGHT"));o.m_Divmapcursorright.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursorright.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE_RIGHT"));o.m_Divmapcursorright.setAttribute("tabindex","4");o.m_Divmapcursortop=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-top",o.m_ID),"vbi-cursor-top",e.getText("NAVCTL_TITLE_MOVE_UP"));o.m_Divmapcursortop.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursortop.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE_UP"));o.m_Divmapcursortop.setAttribute("tabindex","1");o.m_Divmapcursordown=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-down",o.m_ID),"vbi-cursor-down",e.getText("NAVCTL_TITLE_MOVE_DOWN"));o.m_Divmapcursordown.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursordown.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE_DOWN"));o.m_Divmapcursordown.setAttribute("tabindex","5");o.m_Divmapcursorreset=VBI.Utilities.CreateGeoSceneDivCSS(o.getId("vbi-cursor-reset",o.m_ID),"vbi-cursor-reset",e.getText("NAVCTL_TITLE_MOVE"));o.m_Divmapcursorreset.setAttribute("role",sap.ui.core.AccessibleRole.Button);o.m_Divmapcursorreset.setAttribute("aria-label",e.getText("NAVCTL_TITLE_MOVE"));o.m_Divmapcursorreset.setAttribute("tabindex","3");t.appendChild(o.m_Divmapcursorleft);t.appendChild(o.m_Divmapcursorright);t.appendChild(o.m_Divmapcursortop);t.appendChild(o.m_Divmapcursordown);t.appendChild(o.m_Divmapcursorreset);o.m_Divmapcursorgrip.appendChild(t);o.m_Divmapscrollarea.appendChild(r);o.m_Divmapscrollarea.appendChild(m);o.m_Divmapscrollarea.appendChild(n);o.m_Divmapscrollarea.appendChild(o.m_Divmapscrollpoint);if(!o.suppressedVisibility.zoom){o.m_Divmapnav.appendChild(o.m_Divmapscrollarea)}if(!o.suppressedVisibility.move){o.m_Divmapnav.appendChild(o.m_Divmapcursor);o.m_Divmapnav.appendChild(o.m_Divmapcursorgrip)}o.scene.m_Div.appendChild(o.m_Divmapnav)};o.AdaptMinMaxLOD=function(e){o.m_MinLOD=o.scene.GetMinLOD();o.m_MaxLOD=o.scene.GetMaxLOD()};o.Awake=function(e,i){o.scene=e;o.m_MinLOD=o.scene.GetMinLOD();o.m_MaxLOD=o.scene.GetMaxLOD();var t=jQuery.sap.byId(i);o.m_ID=jQuery(t).attr("id");if(VBI.m_bIsMobile){o.AppendButton()}else{o.AppendDiv();o.m_Divmapnav.style.opacity=.5;o.m_startScrollPoint=0}o.AttachEvents()};o.AdjustScrollPoint=function(e){if(VBI.m_bIsMobile){return}var i;if(e){i=o.m_lengthScrollLine*(e-o.m_MinLOD)/(o.m_MaxLOD-o.m_MinLOD)+o.m_startScrollPoint;jQuery(o.m_Divmapscrollpoint).css("top",i+"px")}else{var t=o.scene.GetCurrentZoomlevel();i=o.m_lengthScrollLine*(t-o.m_MinLOD)/(o.m_MaxLOD-o.m_MinLOD)+o.m_startScrollPoint;jQuery(o.m_Divmapscrollpoint).css("top",i+"px")}};o.StopAnimatedMove=function(){window.clearInterval(o.movetimer);o.movetimer=0;jQuery(o.m_Divmapcursorleft).removeAttr("style");jQuery(o.m_Divmapcursorright).removeAttr("style");jQuery(o.m_Divmapcursordown).removeAttr("style");jQuery(o.m_Divmapcursortop).removeAttr("style");jQuery(o.m_Divmapcursorreset).removeAttr("style");jQuery(o.m_Divmapcursorreset).css("top",o.curMoveX+"px");jQuery(o.m_Divmapcursorreset).css("left",o.curMoveY+"px")};o.ZoomToNextIntegerLOD=function(e){var i=o.scene.m_Canvas[0].m_nExactLOD;var t=e?Math.ceil(i):Math.floor(i);if(i!=t){o.scene.AnimateZoomToGeo(o.scene.GetCenterPos(),t,o.zoomtimerfrq)}else{o.scene.InternalOnZoomLayer(o.scene.m_Canvas[o.scene.m_nOverlayIndex])}};o.StartAnimatedZoom=function(e){var i=o.scene.GetCenterPos();if(o.zoomtimer){window.clearInterval(o.zoomtimer)}o.zoomtimer=window.setInterval(function(){var t=o.scene.GetCurrentZoomlevel()+.2*e;o.scene.ZoomToZoomlevel(i,t,true)},o.zoomtimerfrq)};o.processmouseup=function(){o.bInitDrag=false;o.StopAnimatedMove();document.removeEventListener("mouseup",o.processmouseup,true);document.removeEventListener("mousemove",o.processmousemove,true)};o.zoom_processmouseup=function(e){document.removeEventListener("mouseup",o.zoom_processmouseup,true);document.removeEventListener("mousemove",o.zoom_processmousemove,true);if(o.bInitDrag){var i=e.pageY-o.offsetY;if(i<0){i=0}if(i>o.m_lengthScrollLine){i=o.m_lengthScrollLine}var t=o.m_MinLOD+(o.m_MaxLOD-o.m_MinLOD)*i/o.m_lengthScrollLine;o.scene.AnimateZoomToGeo(o.midpointForZoom,Math.round(t),5)}o.bInitDrag=false};o.processmousemove=function(e){var i,t;if(o.bInitDrag==true){window.clearInterval(o.movetimer);o.movetimer=0;var r=e.pageX-o.offsetX;var m=e.pageY-o.offsetY;var n=parseInt(Math.sqrt(Math.pow(r-o.curMoveX,2)+Math.pow(m-o.curMoveY,2)),10);var s=17;if(n>s){var a=Math.atan2(r-o.curMoveX,m-o.curMoveY);i=Math.ceil(o.curMoveX+Math.sin(a)*s);t=Math.ceil(o.curMoveY+Math.cos(a)*s);n=s}else{i=r;t=m}jQuery(o.m_Divmapcursorreset).css("top",t+"px");jQuery(o.m_Divmapcursorreset).css("left",i+"px");var u=-(jQuery(o.m_Divmapcursorreset).position().left-o.curMoveX)*(n/s);var c=-(jQuery(o.m_Divmapcursorreset).position().top-o.curMoveY)*(n/s);o.movetimer=window.setInterval(function(){o.scene.MoveMap(u,c)},o.tint)}};o.zoom_processmousemove=function(e){var i=e.pageY-o.offsetY;if(!o.bInitDrag){if(i!=o.curZoomY){o.bInitDrag=true}}if(o.bInitDrag){if(i<0){i=0}if(i>o.m_lengthScrollLine){i=o.m_lengthScrollLine}jQuery(o.m_Divmapscrollpoint).css("top",i+"px");var t=o.m_MinLOD+(o.m_MaxLOD-o.m_MinLOD)*i/o.m_lengthScrollLine;o.scene.ZoomToZoomlevel(o.midpointForZoom,t)}};return o}});