/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["./sapvbi"],function(){"use strict";VBI.isInt=function(e){return e-0==e&&e%1==0};VBI.IndexOf=function(e,t){var a=e.length;for(var r=0;r<a;++r){if(t==e[r]){return r}}return-1};VBI.Types={st_unknown:0,st_vector:1,st_string:2,st_vectorarray:3,st_float:4,st_color:5,st_long:6,st_bool:7,st_vectorarraymulti:8,string2bool:function(e){if(typeof e=="boolean"){return e}if(typeof e=="number"){return e?true:false}var t=e.slice(0,1);return t=="t"||t=="1"||t=="X"?true:false},string2vector:function(e){var t=false;var a=e.split(";");for(var r=0,n=a.length;r<n;++r){a[r]=parseFloat(a[r]);if(!t&&(isNaN(a[r])||!isFinite(a[r]))){t=true;jQuery.sap.log.error("The string contains invalid numbers")}}return a},stringarray2vectorarray:function(e){var t=[];for(var a=0,r=e.length;a<r;++a){var n=[];for(var i=0,s=e[a].length;i<s;++i){n.push(this.string2vector(e[a][i]))}t.push(n)}return t},string2rgba:function(e){var t,a;if(t=/^rgba\(([\d]+)[,;]\s*([\d]+)[,;]\s*([\d]+)[,;]\s*([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[+t[1],+t[2],+t[3],+t[4],1]}else if(t=/^rgba\(([\d]+)\%[,;]\s*([\d]+)\%[,;]\s*([\d]+)\%[,;]\s*([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[+Math.round(t[1]*2.55),+Math.round(t[2]*2.55),+Math.round(t[3]*2.55),+t[4],1]}else if(t=/^rgb\(([\d]+)[,;]\s*([\d]+)[,;]\s*([\d]+)\)/.exec(e)){return[+t[1],+t[2],+t[3],1,0]}else if(t=/^rgb\(([\d]+)\%[,;]\s*([\d]+)\%[,;]\s*([\d]+)\%\)/.exec(e)){return[+Math.round(t[1]*2.55),+Math.round(t[2]*2.55),+Math.round(t[3]*2.55),1,0]}else if(e.charAt(0)==="#"){var r;if(e.length<7){r=e.substring(0,2)+e.substring(1,2)+e.substring(2,3)+e.substring(2,3)+e.substring(3,4)+e.substring(3,4)}else{r=e}return[parseInt(r.substring(1,3),16),parseInt(r.substring(3,5),16),parseInt(r.substring(5,7),16),1,1]}else if(t=/^hsla\(([\d]+)[,]\s*([\d]+)\%[,]\s*([\d]+)\%[,]\s*([\d]+|[\d]*.[\d]+)\)/.exec(e)){t=[+t[1],+t[2],+t[3],+t[4]];a=VBI.Utilities.HLS2RGB(t[0]/360,t[2]/100,t[1]/100);return[a[0],a[1],a[2],t[3],1]}else if(t=/^hsl\(([\d]+)[,]\s*([\d]+)\%[,]\s*([\d]+)\%\)/.exec(e)){t=[+t[1],+t[2],+t[3]];a=VBI.Utilities.HLS2RGB(t[0]/360,t[2]/100,t[1]/100);return[a[0],a[1],a[2],1,0]}else if(t=/^RGBA\(([\d]+)[,;]([\d]+)[,;]([\d]+)[,;]([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[+t[1],+t[2],+t[3],parseFloat(+t[4])/255,1]}else if(t=/^RGB\(([\d]+)[,;]([\d]+)[,;]([\d]+)\)/.exec(e)){return[+t[1],+t[2],+t[3],1,0]}else if(t=/^ARGB\((0[xX][0-9A-Fa-f]+)[,;](0[xX][0-9A-Fa-f]+)[,;](0[xX][0-9A-Fa-f]+)[,;](0[xX][0-9A-Fa-f]+)\)/.exec(e)){return[parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseFloat(+t[1])/255,1]}else if(t=/^ARGB\(([\d]+)[,;]([\d]+)[,;]([\d]+)[,;]([\d]+)\)/.exec(e)){return[+t[2],+t[3],+t[4],parseFloat(+t[1])/255,1]}else if(t=/^HLSA\(([\d]+)[,;]([\d]+)[,;]([\d]+)[,;]([\d]+)\)/.exec(e)){t=[+t[1],+t[2],+t[3],+t[4]];a=VBI.Utilities.HLS2RGB(t[0]/600,t[1]/600,t[2]/600);return[a[0],a[1],a[2],t[3]/255,1]}else if(t=/^HLS\(([\d]+)[,;]([\d]+)[,;]([\d]+)\)/.exec(e)){t=[+t[1],+t[2],+t[3]];a=VBI.Utilities.HLS2RGB(t[0]/600,t[1]/600,t[2]/600);return[a[0],a[1],a[2],1,0]}return[255,0,0,1,0]},string2color:function(e){var t=this.string2rgba(e);return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},string2rhls:function(e){var t;if(t=/^RHLS\(([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[parseFloat(+t[1])/360,parseFloat(+t[2]),parseFloat(+t[3]),1]}else if(t=/^RHLSA\(([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)[,;]([\d]+|[\d]*.[\d]+)\)/.exec(e)){return[parseFloat(+t[1])/360,parseFloat(+t[2]),parseFloat(+t[3]),parseFloat(+t[4])]}return null},color2array:function(e){var t;if(t=/^rgba\(([\d]+)[,]([\d]+)[,]([\d]+)[,]([\d]+|[\d]*.[\d]+)\)/.exec(e)){t=[parseInt(+t[1],10),parseInt(+t[2],10),parseInt(+t[3],10),parseFloat(+t[4])];return t}return null},string2long:function(e){if(typeof e=="boolean"){return e?1:0}return parseInt(e,10)},string2float:function(e){if(typeof e=="boolean"){return e?1:0}return parseFloat(e)},float2string:function(e){return e.toString()},vector2string:function(e){var t="";for(var a=0;a<e.length;++a){t+=e[a];if(a+1<e.length){t+=";"}}return t},color2string:function(e){var t;if(t=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(e)){t=[+t[1],+t[2],+t[3],parseInt(parseFloat(+t[4])*255,10)];return"RGBA("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"}return null},long2float:function(e){return parseFloat(e,10)},float2long:function(e){return parseInt(e,10)}};VBI.DataTypeProvider=function(){var e={};e.m_datatypenodes=[];e.vbiclass="DataTypeProvider";e.isParentOf=function(e,t){if(!t){return false}var a=t;while(a=a.m_Parent){if(a==e){return true}}return false};e.clear=function(){var e,t=this.m_datatypenodes.length;for(var a=0;a<t;++a){if(e=this.m_datatypenodes[a]){e.clear()}}this.m_datatypenodes=[]};e.set=function(t,a){if(t.type&&t.name){if(t.type=="N"){if(jQuery.type(t.N)=="object"){var r;if(r=e.GetTypeNode(t.name,true)){r.load(t.N);return}}}}else{this.clear()}var n;if(jQuery.type(t.N)=="object"){this.m_datatypenodes.push(n=new VBI.DataTypeProvider.DataTypeNode(this,this.m_datatypenodes.length));if(t.name){n.m_Name=t.name}if(t.N.key){n.m_Key=t.N.key}n.load(t.N)}else if(jQuery.type(t.N)=="array"){for(var i=0,s=t.N.length;i<s;++i){this.m_datatypenodes.push(n=new VBI.DataTypeProvider.DataTypeNode(this,this.m_datatypenodes.length));if(t.N[i].name){n.m_Name=t.N[i].name}if(t.N[i].key){n.m_Key=t.N[i].key}n.load(t.N[i])}}};e.load=function(t,a){if(t.Set){if(jQuery.type(t.Set)=="object"){e.set(t.Set,a)}else if(jQuery.type(t.Set)=="array"){for(var r=0,n=t.Set.length;r<n;++r){e.set(t.Set[r],a)}}}};e.GetTypeNode=function(e,t){for(var a=0;a<this.m_datatypenodes.length;++a){if(this.m_datatypenodes[a].m_Name==e){return this.m_datatypenodes[a]}}if(!t){return null}var r;this.m_datatypenodes.push(r=new VBI.DataTypeProvider.DataTypeNode(null,this.m_datatypenodes.length));r.m_Name=e;return r};e.FindTypeRefs=function(){var e=[];for(var t=0,a=this.m_datatypenodes.length;t<a;++t){var r=this.m_datatypenodes[t].m_Ref;if(r){e.push({m_Ref:r,m_DTN:this.m_datatypenodes[t]})}}return e};e.FindTypeNodeFromPath=function(e){var t,a=this.GetTypeNode(e[0],false);for(var r=1;r<e.length;++r){if(!(t=a.GetTypeNode(e[r],false))){continue}a=t}return a};e.FindTypeAttributeFromPath=function(e){var t=[];for(var a=0;a<e.length-1;++a){t.push(e[a])}var r=this.FindTypeNodeFromPath(t);return r?r.GetTypeAttribute(e[e.length-1]):null};VBI.DataTypeProvider.DataTypeNode=function(e,t){var a={};a.m_datatypenodes=[];a.m_datatypeattributes=[];a.m_nArrayIndex=t;a.m_Name="";a.m_Key=null;a.m_Ref=null;a.m_Parent=e;a.m_MinSelect=1;a.m_MaxSelect=1;a.clear=function(){var e,t,r;a.m_Parent=null;r=a.m_datatypenodes.length;for(t=0;t<r;++t){if(e=a.m_datatypenodes[t]){e.clear()}}a.m_datatypenodes=[];r=a.m_datatypeattributes.length;for(t=0;t<r;++t){if(e=a.m_datatypeattributes[t]){e.clear()}}a.m_datatypeattributes=[]};a.load=function(e){if(e.name){a.m_Name=e.name}if(e.key){a.m_Key=e.key}if(e.ref){a.m_Ref=e.ref}if(e.minSel){a.m_MinSelect=parseInt(e.minSel,10)}if(e.maxSel){a.m_MaxSelect=parseInt(e.maxSel,10)}var t;if(e.A){var r;if(jQuery.type(e.A)=="array"){for(t=0;t<e.A.length;++t){r=a.GetTypeAttribute(e.A[t].name,true);r.load(e.A[t])}}else if(jQuery.type(e.A)=="object"){r=a.GetTypeAttribute(e.A.name,true);r.load(e.A)}}if(e.N){var n;if(jQuery.type(e.N)=="array"){for(t=0;t<e.N.length;++t){a.m_datatypenodes.push(n=new VBI.DataTypeProvider.DataTypeNode(this,a.m_datatypenodes.length));n.load(e.N[t])}}else if(jQuery.type(e.N)=="object"){a.m_datatypenodes.push(n=new VBI.DataTypeProvider.DataTypeNode(this,a.m_datatypenodes.length));n.load(e.N)}}};a.GetTypeNode=function(e,t){var r=a.m_datatypenodes;for(var n=0,i=r.length;n<i;++n){if(r[n].m_Name==e){return r[n]}}if(!t){return null}var s;r.push(s=new VBI.DataTypeProvider.DataTypeNode(this,r.length));s.m_Name=e;return s};a.GetKeyTypeAttribute=function(){if(a.m_Key){return a.GetTypeAttribute(a.m_Key,true)}else{return a.GetTypeAttribute("VB:ix",true)}return null};a.GetSelectTypeAttribute=function(e){return a.GetTypeAttribute("VB:s",e)};a.GetPath=function(){var e=[];var t=this;do{e.splice(0,0,t.m_Name)}while((t=t.m_Parent)&&t["m_Name"]);return e};a.GetTypeAttribute=function(e,t){var r=a.m_datatypeattributes;for(var n=0,i=r.length;n<i;++n){var s=r[n];if(s.m_Alias==e||s.m_Name==e){return s}}if(t){var l;r.push(l=new VBI.DataTypeProvider.DataTypeAttribute(r.length));l.m_Name=e;l.m_Parent=this;l.m_Type=e=="VB:s"?VBI.Types.st_bool:VBI.Types.st_string;return l}return null};return a};VBI.DataTypeProvider.DataTypeAttribute=function(e){var t={};t.m_Name="";t.m_Alias="";t.m_bChangeable=false;t.m_Type=VBI.Types.st_unknown;t.m_nArrayIndex=e;t.m_Parent=null;t.clear=function(){t.m_Parent=null};t.load=function(e){if(e.name){t.m_Name=e.name}if(e.alias){t.m_Alias=e.alias}if(e.changeable){t.m_bChangeable=VBI.Types.string2bool(e.changeable)}if(e.type){switch(e.type){case"vectorarraymulti":t.m_Type=VBI.Types.st_vectorarraymulti;break;case"vectorarray":t.m_Type=VBI.Types.st_vectorarray;break;case"vector":t.m_Type=VBI.Types.st_vector;break;case"long":t.m_Type=VBI.Types.st_long;break;case"string":t.m_Type=VBI.Types.st_string;break;case"color":t.m_Type=VBI.Types.st_color;break;case"boolean":t.m_Type=VBI.Types.st_bool;break;case"float":t.m_Type=VBI.Types.st_float;break;default:t.m_Type=VBI.Types.st_string;break}}};return t};return e};VBI.DataProvider=function(){var e={};var t=0,a=1,r=2;e.vbiclass="DataProvider";e.m_datanodes=[];e.m_dtp=null;e.m_Ctx=null;e.clear=function(){var t,a=e.m_datanodes.length;for(var r=0;r<a;++r){if(t=e.m_datanodes[r]){t.clear()}}e.m_datanodes=[];e.m_Ctx=null;e.m_dtp=null};e.set=function(e,t){var a=t.m_DataTypeProvider;if(!a){jQuery.sap.log.error("Data types are not available");return}if(e.type&&e.name){if(e.type=="N"){if(jQuery.type(e.N)=="object"){var r;var n=e.name.split(".");if(r=this.FindNodeFromPath(n)){if(e.name!=e.N.name){jQuery.sap.log.error("Node loading delta operation failed");return}r.load(e.N,a.FindTypeNodeFromPath(n));return}}}}else{this.clear()}if(e.N){var i,s,l;if(jQuery.type(e.N)=="object"){i=a.GetTypeNode(l=e.N.name,true);this.m_datanodes[i.m_nArrayIndex]=s=new VBI.DataProvider.DataNode;s.m_Parent=this;s.m_Name=l;s.load(e.N,i)}else if(jQuery.type(e.N)=="array"){for(var m=0;m<e.N.length;++m){i=a.GetTypeNode(l=e.N[m].name,true);this.m_datanodes[i.m_nArrayIndex]=s=new VBI.DataProvider.DataNode;s.m_Parent=this;s.m_Name=l;s.load(e.N[m],i)}}}};e.remove=function(e,t){var a,r;if(e.type=="N"&&(r=e.name)){if(a=this.FindNodeFromPath(r.split("."))){a.m_Parent.RemoveNode(a)}}else if(e.type=="E"&&(r=e.name)){if(a=this.FindNodeFromPath(r.split("."))){a.RemoveElements(e.N)}}};e.load=function(t,a){var r=a.m_DataTypeProvider;if(t.Remove){if(jQuery.type(t.Remove)=="object"){this.remove(t.Remove,a)}else if(jQuery.type(t.Remove)=="array"){for(var n=0,i=t.Remove.length;n<i;++n){this.remove(t.Remove[n],a)}}}if(t.Set){if(jQuery.type(t.Set)=="object"){e.set(t.Set,a)}else if(jQuery.type(t.Set)=="array"){for(var s=0;s<t.Set.length;++s){e.set(t.Set[s],a)}}}e.m_dtp=r;e.m_Ctx=a};e.store=function(e){if(this.IsModified()){e.Data={};e.Data.Merge={};var t=e.Data.Merge.N=[];var a;for(var r=0;r<this.m_datanodes.length;++r){if((a=this.m_datanodes[r])&&a.IsModified()){var n={};t.push(n);a.store(n)}}}};e.OnAttributeChanged=function(t){var a;if(a=e.m_Ctx.m_Actions){var r;if(r=a.findAction("AttributeChanged",null,null)){var n=t.m_Parent.GetPath()+"."+t.m_dta.m_Name;e.m_Ctx.FireAction(r,null,null,null,null,n)}}};e.OnNodeChanged=function(t){var a;if(a=e.m_Ctx.m_Actions){var r;if(r=a.findAction("NodeChanged",null,null)){var n=null;if(t.m_Parent&&t.m_Parent.GetPath){n=t.m_Parent.GetPath()+"."}else{n=""}e.m_Ctx.FireAction(r,null,null,null,null,n+t.m_dtn.m_Name)}}};e.OnElementChanged=function(t){var a;if(a=e.m_Ctx.m_Actions){var r;if(r=a.findAction("ElementChanged",null,null)){e.m_Ctx.FireAction(r,null,null,null,null,t.GetPath())}}};e.IsModified=function(){var e;for(var t=0;t<this.m_datanodes.length;++t){if((e=this.m_datanodes[t])&&e.IsModified()){return true}}return false};e.RemoveNode=function(e){var t=e.m_dtn.m_nArrayIndex;this.m_datanodes[t].clear();this.m_datanodes[t]=null};e.FindFromPathEx=function(e,t,n,i,s){var l=false,m=null,d=null,o=null;if(s){l=true;o=s;m=s.m_dtn}else if(i){d=i;m=i.m_Parent.m_dtn}for(var u=t,f=e.length;u<f;++u){if(l){if(m.m_Key){if(d=o.FindElementByKey(e[u])){l=false;continue}}else if(VBI.isInt(e[u])){d=o.m_dataelements[parseInt(e[u],10)];l=false;continue}else{if(o.m_dataelements.length){d=o.m_dataelements[0]}if(!d){VBI.m_bTrace&&VBI.Trace("Error: invalid lead selected element")}}}if(n==r&&u+1==f){var _;if(_=m.GetTypeAttribute(e[u],false)){if(d){return d.m_dataattributes[_.m_nArrayIndex]}else{if(o.m_dataelements.length){d=o.m_dataelements[0];return d.m_dataattributes[_.m_nArrayIndex]}}}}m=m.GetTypeNode(e[u],true);if(!d){VBI.m_bTrace&&VBI.Trace("Error: Invalid Binding Path "+e);return false}o=d.m_datanodes[m.m_nArrayIndex];l=true}if(n==r||n==a){return null}return o};e.FindFromPath=function(t,a){if(!e.m_dtp){return null}var r=e.m_dtp.GetTypeNode(t[0],false);if(!r){return null}var n=e.m_datanodes[r.m_nArrayIndex];if(!n){return null}return e.FindFromPathEx(t,1,a,null,n)};e.FindAttributeFromPath=function(t){return e.FindFromPath(t,r)};e.FindNodeFromPath=function(a){return e.FindFromPath(a,t)};e.SetSelection=function(t,a){var r,n=e.m_datanodes;for(var i=0,s=n.length;i<s;++i){if(r=n[i]){r.SetSelection(t,a)}}};VBI.DataProvider.DataNode=function(){var e={};e.m_Name="";e.m_dataelements=[];e.m_Parent=null;e.m_dtn=null;e.m_bModified=false;e.clear=function(){e.m_dtn=null;for(var t=0;t<e.m_dataelements.length;++t){e.m_dataelements[t].clear();e.m_dataelements[t].m_Parent=null}e.m_dataelements=[];e.m_Parent=null};e.IsModifiedSelection=function(){return e.m_bModified?true:false};e.IsModifiedElements=function(){var t=e.m_dataelements;for(var a=0;a<t.length;++a){if(t[a].IsModified()){return true}}return false};e.IsModified=function(){if(e.IsModifiedSelection()||e.IsModifiedElements()){return true}return false};e.store=function(t){t.name=e.m_dtn.m_Name;if(e.IsModifiedElements()){t.E=[];for(var a=0;a<e.m_dataelements.length;++a){if(e.m_dataelements[a].IsModified()){var r={};t.E.push(r);e.m_dataelements[a].store(r)}}}};e.RemoveNode=function(t){var a=t.m_dtn.m_nArrayIndex;e.m_datanodes[a].clear();e.m_datanodes[a]=null};e.RemoveElements=function(t){var a=e.m_dtn.GetKeyTypeAttribute();var r=e.GetElementKeyMap(a);if(t.E){if(jQuery.type(t.E)=="object"){e.InternalFindAndRemoveExistingElement(t.E,0,a,r)}else if(jQuery.type(t.E)=="array"){for(var n=0;n<t.E.length;++n){e.InternalFindAndRemoveExistingElement(t.E[n],n,a,r)}}}};e.GetElementKeyMap=function(t){var a,r=[];var n=t?t:e.m_dtn.GetKeyTypeAttribute();for(var i=0;i<e.m_dataelements.length;++i){r[(a=e.m_dataelements[i]).m_dataattributes[n.m_nArrayIndex].m_Value]=a}return r};e.FindElementByKey=function(t,a,r){var n;if(r){return(n=r[t])?n:null}var i=a?a:e.m_dtn.GetKeyTypeAttribute();var s,l=this.m_dataelements;for(var m=0,d=l.length;m<d;++m){if(s=l[m]){if(s.m_dataattributes[i.m_nArrayIndex].m_Value==t){return s}}}return null};e.FindElementByIndex=function(e){return this.m_dataelements[e]};e.InternalFindAndRemoveExistingElement=function(e,t,a,r){var n=null,i=null;if(a.m_Alias&&(n=e[a.m_Alias])){i=this.FindElementByKey(n,a,r)}else if(a.m_Name&&(n=e[a.m_Name])){i=this.FindElementByKey(n,a,r)}else{i=this.FindElementByKey(n=t,a,r)}if(i){this.m_dataelements.splice(VBI.IndexOf(this.m_dataelements,i),1);if(r){r.splice(n,1)}i.clear()}};e.InternalFindOrCreateExistingElement=function(t,a,r,n){var i=null,s=null;if(r.m_Alias&&(i=t[r.m_Alias])){s=e.FindElementByKey(i,r,n)}else if(r.m_Name&&(i=t[r.m_Name])){s=e.FindElementByKey(i,r,n)}else{s=e.FindElementByKey(i=a,r,n)}if(s){return s}s=new VBI.DataProvider.DataElement;e.m_dataelements.push(s);if(n){n[i]=s}return s};e.load=function(t,a){e.m_dtn=a;var r=e.m_dtn.GetKeyTypeAttribute();var n=e.GetElementKeyMap(r);if(t.E){var i,s;if(jQuery.type(t.E)=="object"){s=e.InternalFindOrCreateExistingElement(t.E,0,r,n);s.m_Parent=e;s.load(t.E,a);if(s.m_dataattributes[r.m_nArrayIndex]==null){i=new VBI.DataProvider.DataAttribute(r,null,s);i.m_Value=0;s.m_dataattributes[r.m_nArrayIndex]=i}}else if(jQuery.type(t.E)=="array"){for(var l=0,m=t.E.length;l<m;++l){s=e.InternalFindOrCreateExistingElement(t.E[l],l,r,n);s.m_Parent=e;s.load(t.E[l],a);if(s.m_dataattributes[r.m_nArrayIndex]==null){i=new VBI.DataProvider.DataAttribute(r,null,s);i.m_Value=l;s.m_dataattributes[r.m_nArrayIndex]=i}}}}};e.GetName=function(){return this.m_Name};e.GetPath=function(){return this.m_dtn.GetPath()};e.SetModified=function(){this.m_bModified=true;var e=this;while(e.m_Parent){e=e.m_Parent}if(e){e.OnNodeChanged(this)}};e.GetSelectedElements=function(){var e=[];var t=this.m_dataelements;var a=this.m_dtn.GetTypeAttribute("VB:s",true);for(var r=0,n=t.length;r<n;++r){if(t[r].IsSelected(a)){e.push(t[r])}}return e};e.GetNumOfSelectedElements=function(){return e.m_NumSelectedEltes!=undefined?e.m_NumSelectedEltes:e.GetSelectedElements().length};e.SetNumOfSelectedElements=function(){e.m_NumSelectedEltes=e.GetSelectedElements().length};e.UnSetNumOfSelectedElements=function(){e.m_NumSelectedEltes=undefined};e.SetSelection=function(e,t){var a=this.m_dataelements;var r=null,n=this.m_dtn.GetTypeAttribute("VB:s",true);if(!e&&t){this.SetNumOfSelectedElements()}for(var i=0,s=a.length;i<s;++i){if(r=a[i]){if(t){r.Select(e)}else{r.SetElementSelectionState(e,n)}}}this.UnSetNumOfSelectedElements();return null};return e};VBI.DataProvider.DataElement=function(){this.m_dataattributes=[];this.m_datanodes=[];this.m_Parent=null;this.m_bChangeable=false};VBI.DataProvider.DataElement.prototype={m_dataattributes:null,m_datanodes:null,m_Parent:null,m_nModified:0,m_bChangeable:false,clear:function(){var e,t;for(e=0;e<this.m_datanodes.length;++e){if(t=this.m_datanodes[e]){t.clear();t.m_Parent=null}}this.m_datanodes=[];for(e=0;e<this.m_dataattributes.length;++e){if(t=this.m_dataattributes[e]){t.clear();t.m_Parent=null}}this.m_dataattributes=[]},load:function(e,t){var a=false;this.m_nModified=0;if(e["VB:m"]){if(a=VBI.Types.string2bool(e["VB:m"])){this.m_nModified=7}delete e["VB:m"]}if(e["VB:c"]){this.m_bChangeable=VBI.Types.string2bool(e["VB:c"]);delete e["VB:c"]}for(var r in e){if(!e.hasOwnProperty(r)){continue}if(r=="N"&&!(typeof e[r]=="string")){var n,i;if(jQuery.type(e[r])=="object"){n=t.GetTypeNode(e.N.name,true);this.m_datanodes[n.m_nArrayIndex]=i=new VBI.DataProvider.DataNode;i.m_Parent=this;i.m_Name=e.N.name;i.load(e[r],n)}else if(jQuery.type(e[r])=="array"){var s=e[r];for(var l=0;l<s.length;++l){var m=s[l];n=t.GetTypeNode(m.name,true);this.m_datanodes[n.m_nArrayIndex]=i=new VBI.DataProvider.DataNode;i.m_Parent=this;i.m_Name=m.name;i.load(m,n)}}}else{var d=t.GetTypeAttribute(r,true);this.m_dataattributes[d.m_nArrayIndex]=new VBI.DataProvider.DataAttribute(d,e[r],this,a)}}},IsModified:function(e){if(this.m_nModified){return true}var t,a,r;for(t=0,a=this.m_dataattributes.length;t<a;++t){if((r=this.m_dataattributes[t])&&r.IsModified()){return true}}for(t=0,a=this.m_datanodes.length;t<a;++t){if((r=this.m_datanodes[t])&&r.IsModified()){return true}}return false},IsChangeable:function(){return this.m_bChangeable},IsSelected:function(e){var t,a=e?e:this.m_Parent.m_dtn.GetSelectTypeAttribute(false);if(a&&(t=a.m_nArrayIndex)<this.m_dataattributes.length){var r;if(r=this.m_dataattributes[t]){if(a.m_Type==VBI.Types.st_string){return VBI.Types.string2bool(r.m_Value)}else{return r.m_Value?true:false}}}return false},SetModified:function(){this.m_nModified|=1;var e=this;while(e.m_Parent){e=e.m_Parent}if(e){e.OnElementChanged(this)}},store:function(e){var t=this.m_Parent.m_dtn.GetKeyTypeAttribute();var a=t.m_Alias?t.m_Alias:t.m_Name;e[a]=this.m_dataattributes[t.m_nArrayIndex].GetStringValue();if(this.m_nModified&2){e["VB:c"]=this.m_bChangeable?"true":"false"}if(this.m_nModified&4){e["VB:m"]="true"}var r,n,i;for(r=0,n=this.m_dataattributes.length;r<n;++r){if((i=this.m_dataattributes[r])&&i.IsModified()){var s=i.m_dta.m_Alias?i.m_dta.m_Alias:i.m_dta.m_Name;e[s]=i.GetStringValue()}}for(r=0,n=this.m_datanodes.length;r<n;++r){if((i=this.m_datanodes[r])&&i.IsModified()){i.store(e["N"]={})}}},GetKeyValue:function(){var e;if(this.m_Parent&&(e=this.m_Parent.m_dtn.GetKeyTypeAttribute())){return this.m_dataattributes[e.m_nArrayIndex].m_Value}return null},GetPath:function(){var e=null;var t=this;while(t){var a=t.GetKeyValue();if(e){e=a+"."+e}else{e=a}var r;if(r=this.m_Parent){e=this.m_Parent.m_dtn.m_Name+"."+e}else{break}if(r.m_Parent&&r.m_Parent.m_Parent){t=r.m_Parent?r.m_Parent:null}else{break}}return e},SetElementSelectionState:function(e,t){var a=t;if(!a){a=t?t:this.m_Parent.m_dtn.GetTypeAttribute("VB:s",true);a.m_Type=VBI.Types.st_bool}var r=a.m_nArrayIndex;if(this.m_dataattributes[r]==null){this.m_dataattributes[r]=new VBI.DataProvider.DataAttribute(a,null,this)}var n,i=this.m_dataattributes[r];if(n=i.m_Value!=(e?true:false)){i.m_Value=e?true:false;i.m_bModified=true}if(n){this.SetModified();return true}return false},GlobalSingleSelect:function(){var e=this.m_Parent.m_dtn;if(e.m_MaxSelect==0){return 0}this.m_Parent.SetSelection(false,false);this.Select(true);return 1},Select:function(e,t){var a=this.m_Parent.m_dtn;if(!t){t=0}var r;if(e){if(a.m_MaxSelect==0){return 0}if(a.m_MaxSelect<0){r=this.SetElementSelectionState(true)?1:0;return t+r}if(a.m_MaxSelect==1){this.m_Parent.SetSelection(false,false);this.SetElementSelectionState(true);return 1}}else{if(a.m_MinSelect==1&&this.m_Parent.GetNumOfSelectedElements()>1||a.m_MinSelect==0){r=this.SetElementSelectionState(false)?1:0;return t-r}}},FindNodeFromPath:function(a){return e.FindFromPathEx(a,0,t,this,null)},FindAttributeFromPath:function(t){return e.FindFromPathEx(t,0,r,this,null)}};VBI.DataProvider.DataAttribute=function(e,t,a,r){this.m_dta=e;this.m_Parent=a;if(r){this.m_bModified=true}if(t===null){return}var n=VBI.Types;if(e.m_Type==n.st_vectorarraymulti){this.m_Value=n.stringarray2vectorarray(t)}else if(e.m_Type==n.st_vectorarray||e.m_Type==n.st_vector){this.m_Value=n.string2vector(t)}else if(e.m_Type==n.st_long){this.m_Value=n.string2long(t)}else if(e.m_Type==n.st_float){this.m_Value=n.string2float(t)}else if(e.m_Type==n.st_bool){this.m_Value=n.string2bool(t)}else if(e.m_Type==n.st_color){this.m_Value=n.string2color(t)}else if(e.m_Type==n.st_string){this.m_Value=t}else{this.m_Value=t}};VBI.DataProvider.DataAttribute.prototype={m_dta:null,m_Value:null,m_Parent:null,m_bModified:false,clear:function(){this.m_Parent=null;this.m_dta=null},store:function(e){},set:function(e){if(e!=this.m_Value){this.SetModified()}this.m_Value=e},SetModified:function(){this.m_bModified=true;var e=this;while(e.m_Parent){e=e.m_Parent}if(e){e.OnAttributeChanged(this)}},IsModified:function(){return this.m_bModified},IsChangeable:function(){return this.m_dta.m_bChangeable&&this.m_Parent.m_bChangeable},GetStringValue:function(){var e="";switch(this.m_dta.m_Type){case VBI.Types.st_vectorarray:case VBI.Types.st_vector:return VBI.Types.vector2string(this.m_Value);case VBI.Types.st_long:e+=this.m_Value;return e;case VBI.Types.st_float:e+=this.m_Value;return e;case VBI.Types.st_string:return this.m_Value;case VBI.Types.st_bool:return this.m_Value?"true":"false";case VBI.Types.st_color:var t;if(t=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(this.m_Value)){t=[+t[1],+t[2],+t[3],parseInt(parseFloat(+t[4])*255,10)];return"RGBA("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"}break;default:return this.m_Value}}};return e};VBI.Adaptor=function(e){var t=e;this.RecursiveLoadElement=function(e,t,a){var r;for(r=0;r<a.m_datatypeattributes.length;++r){var n=a.m_datatypeattributes[r];var i=t[n.m_Name];if(i===undefined){continue}if(n.m_Type==VBI.Types.st_vector&&jQuery.type(i)=="array"){e[n.m_Alias]=""+i[0]+";"+i[1]+";0"}else{e[n.m_Alias]=i.toString()}}if(a.m_datatypenodes.length){var s=e.N=[];for(r=0;r<a.m_datatypenodes.length;++r){var l=s[r]={};var m=a.m_datatypenodes[r];var d=t[m.m_Name];if(d){this.RecursiveLoad(l,d,m)}}}};this.RecursiveLoad=function(e,t,a){e.name=a.m_Name;e.E=[];var r;if(jQuery.type(t)=="array"){for(var n=0;n<t.length;++n){r=e.E[n]={};this.RecursiveLoadElement(r,t[n],a)}}else{r=e.E[0]={};this.RecursiveLoadElement(r,t,a)}};this.LoadFindRefNode=function(e){var a=t.m_DataTypeProvider.FindTypeRefs();for(var r=0,n=a.length;r<n;++r){var i=e;var s=a[r].m_Ref.split(".");for(var l=0,m=s.length;l<m;++l){i=i[s[l]];if(i&&l+1==m){a[r].m_Root=i;return a[r]}if(!i){break}}}return null};this.CreateLoadData=function(e){if(!t.m_DataTypeProvider){return null}var a=null;if(!(a=this.LoadFindRefNode(e))){return null}var r=a.m_DTN;var n=a.m_Root;var i={SAPVB:{version:"2.0",Data:{Remove:{type:"N",name:r.m_Name},Set:{type:"N",name:r.m_Name,N:{}}}}};var s=n;var l=i.SAPVB.Data.Set.N;this.RecursiveLoad(l,s,r);return i}}});