/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/write/connectors/BaseConnector","sap/ui/fl/initial/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/base/util/restricted/_pick"],function(e,n,t,i,r,s){"use strict";function a(e){var n={};if(e.parentVersion!==undefined){n.parentVersion=e.parentVersion}if(this.isLanguageInfoRequired){i.addLanguageInfo(n)}var t=i.getUrl(this.ROUTES.CHANGES,e,n);delete e.fileName;delete n["sap-language"];var s=i.getUrl(this.ROUTES.TOKEN,e,n);var a=r.getRequestOptions(this.initialConnector,s,e.flexObjects||e.flexObject,"application/json; charset=utf-8","json");return r.sendRequest(t,e.method,a)}function o(e){e.fileName=e.flexObject.fileName;return a.call(this,e)}var l=e({},n,{xsrfToken:null,reset:function(e){var n=["reference","generator"];var t=s(e,n);if(e.selectorIds){t.selector=e.selectorIds}if(e.changeTypes){t.changeType=e.changeTypes}delete e.reference;var a=i.getUrl(this.ROUTES.CHANGES,e,t);var o=i.getUrl(this.ROUTES.TOKEN,e);var l=r.getRequestOptions(this.initialConnector,o);return r.sendRequest(a,"DELETE",l)},write:function(e){e.method="POST";return a.call(this,e).then(function(e){if(e.response&&!Array.isArray(e.response)){e.response=[e.response]}return e})},update:function(e){e.method="PUT";return o.call(this,e)},remove:function(e){var n={namespace:e.flexObject.namespace};if(e.parentVersion!==undefined){n.parentVersion=e.parentVersion}e.fileName=e.flexObject.fileName;var t=i.getUrl(this.ROUTES.CHANGES,e,n);delete e.fileName;var s=i.getUrl(this.ROUTES.TOKEN,e);var a=r.getRequestOptions(this.initialConnector,s,undefined,"application/json; charset=utf-8","json");return r.sendRequest(t,"DELETE",a)},loadFeatures:function(e){if(this.initialConnector.settings){return Promise.resolve({response:this.initialConnector.settings})}var n=i.getUrl(this.ROUTES.SETTINGS,e);return i.sendRequest(n,"GET",{initialConnector:t}).then(function(e){return e.response})}});l.initialConnector=t;return l});