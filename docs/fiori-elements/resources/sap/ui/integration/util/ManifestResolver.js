/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/BindingResolver","sap/ui/integration/util/Utils","sap/m/IllustratedMessageType","sap/m/IllustratedMessageSize","sap/base/Log"],function(e,t,r,n,a,i,s){"use strict";var o={};o.resolveCard=function(e){e.startManifestProcessing();return o._awaitReadyEvent(e).then(function(){return e.getModel("context").waitForPendingProperties()}).then(function(){return o._handleCardReady(e)}).catch(function(t){return o._handleCardSevereError(e,t)})};o._awaitReadyEvent=function(e){if(e.isReady()){return Promise.resolve(e)}return new Promise(function(t,r){e.attachEvent("_ready",function(r){t(e)})})};o._handleCardReady=function(e){var a=e.getManifestEntry("/"),i=[],s=e.getSevereErrors(),o=e.getContentMessage();if(s.length){return Promise.reject(s.join(" "))}try{a=t.createBindingInfos(a,e.getBindingNamespaces());if(e.getAggregation("_filterBar")){i=e.getAggregation("_filterBar")._getFilters().map(function(e){return["/sap.card/configuration/filters/"+e.getKey(),e]})}i.concat([["/sap.card/content",e.getCardContent()],["/sap.card/header",e.getCardHeader()],["/sap.card/footer",e.getCardFooter()],["/sap.card",e]]).filter(function(t){return!!e.getManifestEntry(t[0])}).forEach(function(e){var t=e[0];var i=e[1];var s;var u;if(o&&t==="/sap.card/content"){s={message:o}}else if(i.getStaticConfiguration){s=i.getStaticConfiguration()}else{s=n.getNestedPropertyValue(a,t)}if(s.data){u=s.data.path;delete s.data}s=r.resolveValue(s,i,u,true);n.setNestedPropertyValue(a,t,s)});return Promise.resolve(JSON.parse(JSON.stringify(a)))}catch(e){return Promise.reject(e)}};o._handleCardSevereError=function(t,r){var n=t.getManifestEntry("/"),o=e.getLibraryResourceBundle("sap.ui.integration");s.error(r,"sap.ui.integration.util.ManifestResolver");if(n===null){n={}}n["sap.card"]={content:{message:{type:"error",title:o.getText("CARD_ERROR_OCCURED"),description:r.toString(),illustrationType:a.SimpleError,illustrationSize:i.Spot}}};return JSON.parse(JSON.stringify(n))};return o});