/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Control","sap/m/Label","sap/ui/comp/library","./BindingUtil","./AnnotationHelper","./SmartField","sap/base/strings/capitalize"],function(t,e,i,a,n,s,r){"use strict";var l=e.extend("sap.ui.comp.smartfield.SmartLabel",{metadata:{designtime:"sap/ui/comp/designtime/smartfield/SmartLabel.designtime",interfaces:["sap.ui.core.Label","sap.ui.core.IShrinkable","sap.m.IOverflowToolbarContent","sap.m.IHyphenation"],library:"sap.ui.comp"},renderer:{apiVersion:2}});l.prototype.init=function(){this._sSmartFieldId=null;this._bMetaDataApplied=false;this._fInnerControlsCreatedHandlers=null};l.prototype._bindProperties=function(){var t=this._getField();if(t){var e=new a;var i=null;if(!this.isBound("visible")){this.setVisible(t.getVisible())}if(!this._bTextSetExplicitly){i=t.getBindingInfo("textLabel");if(i){this.bindProperty("text",e.toBinding(i))}else if(!this.getBindingInfo("text")){this._setText(t.getComputedTextLabel())}}i=t.getBindingInfo("tooltipLabel");if(i){this.bindProperty("tooltip",e.toBinding(i))}else{this.setTooltip(t.getTooltipLabel())}}};l.prototype.onFieldVisibilityChange=function(t){if(!this.isBound("visible")){this.setVisible(t.getSource().getVisible())}};l.prototype.getLabelInfo=function(){var t,e;var i=this._getField();if(i){this._bindProperties();t=i.getDataProperty();if(t){e=this._getLabelInfo(t);if(e){if(e.text&&!this._bTextSetExplicitly){this._setProperty(this,"text",e.text)}if(e.quickinfo){this._setProperty(this,"tooltip",e.quickinfo)}}}}};l.prototype._setProperty=function(t,e,i){if(t&&e){if(i.match(/{@i18n>.+}/gi)){t.bindProperty(e,i.slice(1,-1))}else{var a=r(e);if(!t.getBindingInfo(e)&&!t["get"+a]()){t["set"+a](i)}}}};l.prototype.setLabelFor=function(t){var i=this._getField();var a="";if(t){if(typeof t==="string"){a=t}else if(t.getId){a=t.getId()}}if(a.length>0&&a===this._sSmartFieldId){return this}if(i){if(this._fChange){i.detachEvent("_change",this._fChange);this._fChange=null}if(this._fInitialized){i.detachInitialise(this._fInitialized);this._fInitialized=null}this.detachFieldVisibilityChange(i);this._bMetaDataApplied=false}if(a.length>0){this._sSmartFieldId=a;this._setLabelFor()}else{this._sSmartFieldId=null}e.prototype.setLabelFor.apply(this,arguments);var n=sap.ui.getCore().byId(this.getLabelFor());this.detachFieldVisibilityChange(n);this.attachFieldVisibilityChange(n);return this};l.prototype._getField=function(){if(this._sSmartFieldId){return sap.ui.getCore().byId(this._sSmartFieldId)}return null};l.prototype._setLabelFor=function(){var t,e=this._getField();if(e&&!this._bMetaDataApplied){this._bMetaDataApplied=true;if(e.getDataProperty){t=e.getDataProperty();if(t){this.getLabelInfo()}else{if(!this._fInitialized){this._fInitialized=this.getLabelInfo.bind(this);e.attachInitialise(this._fInitialized)}if(!this._fChange){this._fChange=function(t){if(t.getParameter("name")==="textLabel"){this.getLabelInfo()}else if(t.getParameter("name")==="mandatory"){this.invalidate()}}.bind(this);e.attachEvent("_change",this._fChange)}}this._lateUpdateLabelFor(e)}}};l.prototype.updateLabelFor=function(t){var i=t.slice(0);if(i&&i.length>0){this.invalidate();e.prototype.setLabelFor.call(this,i.shift());this.updateAriaLabeledBy(i)}};l.prototype.updateAriaLabeledBy=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];if(typeof i.addAriaLabelledBy==="function"){i.removeAriaLabelledBy(this);i.addAriaLabelledBy(this)}}}};l.prototype.setText=function(t){this.setProperty("text",t);this._bTextSetExplicitly=true;return this};l.prototype._setText=function(t){this.setProperty("text",t)};l.prototype._getLabelInfo=function(t){var e=new n;if(t&&t.property){return{text:e.getLabel(t.property),quickinfo:e.getQuickInfo(t.property)}}};l.prototype._delayUpdateLabelFor=function(t){var e=this;if(t.attachInnerControlsCreated&&!this._fInnerControlsCreatedHandlers){this._fInnerControlsCreatedHandlers=function(t){e.updateLabelFor(t.getParameters())};t.attachInnerControlsCreated(this._fInnerControlsCreatedHandlers)}};l.prototype._lateUpdateLabelFor=function(t){var e;if(t&&t instanceof s){e=t.getInnerControls();if(e&&e.length>0){this.updateLabelFor(e)}else{this._delayUpdateLabelFor(t)}var i=sap.ui.getCore().byId(this.getLabelFor());this.detachFieldVisibilityChange(i);this.attachFieldVisibilityChange(i)}};l.prototype.onBeforeRendering=function(){if(this._sSmartFieldId){var t=this._getField();if(!this._bMetaDataApplied){this._setLabelFor();if(t.getId()===this.getLabelFor()){this._lateUpdateLabelFor(t)}}}};l.prototype.attachFieldVisibilityChange=function(t){if(t&&typeof t.attachVisibleChanged==="function"){t.attachVisibleChanged(this.onFieldVisibilityChange,this)}};l.prototype.detachFieldVisibilityChange=function(t){if(t&&typeof t.detachVisibleChanged==="function"){t.detachVisibleChanged(this.onFieldVisibilityChange,this)}};l.prototype.destroy=function(t){var i=this._getField();delete this._bTextSetExplicitly;if(i){if(this._fInnerControlsCreatedHandlers&&i.detachInnerControlsCreated){i.detachInnerControlsCreated(this._fInnerControlsCreatedHandlers);this._fInnerControlsCreatedHandlers=null}if(this._fInitialized&&i.detachInitialise){i.detachInitialise(this._fInitialized);this._fInitialized=null}if(this._fChange){i.detachEvent("_change",this._fChange);this._fChange=null}}this._sSmartFieldId=null;return e.prototype.destroy.apply(this,arguments)};l.prototype.exit=function(){e.prototype.exit.apply(this,arguments);this.detachFieldVisibilityChange(sap.ui.getCore().byId(this.getLabelFor()))};return l});