/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/m/Link","sap/m/ResponsivePopover","sap/m/Button","sap/m/Title","sap/m/Image","sap/m/Text","sap/m/VBox","sap/m/HBox","./Factory","./LinkData","sap/ui/model/json/JSONModel","sap/ui/base/ManagedObjectObserver","sap/m/FlexItemData","sap/ui/model/BindingMode","sap/ui/Device","sap/m/library","sap/base/Log","sap/ui/core/CustomData"],function(t,e,n,i,a,o,r,s,l,p,h,g,u,v,c,d,f,b){"use strict";var y=d.PlacementType;var m=d.FlexJustifyContent;var A=d.ButtonType;var P=e.extend("sap.ui.comp.navpopover.NavigationPopover",{metadata:{library:"sap.ui.comp",properties:{semanticObjectName:{type:"string",group:"Misc",defaultValue:null},semanticAttributes:{type:"object",group:"Misc",defaultValue:null},appStateKey:{type:"string",group:"Misc",defaultValue:null},mainNavigationId:{type:"string",group:"Misc",defaultValue:null},availableActionsPersonalizationText:{type:"string",group:"Misc",defaultValue:undefined}},aggregations:{availableActions:{type:"sap.ui.comp.navpopover.LinkData",multiple:true,singularName:"availableAction"},mainNavigation:{type:"sap.ui.comp.navpopover.LinkData",multiple:false},ownNavigation:{type:"sap.ui.comp.navpopover.LinkData",multiple:false}},associations:{source:{type:"sap.ui.core.Control",multiple:false},extraContent:{type:"sap.ui.core.Control",multiple:false},component:{type:"sap.ui.core.Element",multiple:false}},events:{targetsObtained:{},navigate:{parameters:{text:{type:"string"},href:{type:"string"}}},availableActionsPersonalizationPress:{}}},renderer:{apiVersion:2}});P.prototype.init=function(){e.prototype.init.call(this);var t=new h({mainNavigationLink:{title:undefined,subtitle:undefined,href:undefined,target:undefined},ownNavigation:undefined,availableActions:[],availableActionsPersonalizationText:undefined,extraContent:undefined});t.setDefaultBindingMode(v.TwoWay);t.setSizeLimit(1e3);this.setModel(t,"$sapuicompNavigationPopover");this._bUseExternalContent=false;this.addStyleClass("navigationPopover");this.setContentWidth("380px");this.setHorizontalScrolling(false);this.setShowHeader(c.system.phone);this.setPlacement(y.Auto);this._oObserver=null};P.prototype.applySettings=function(t){if(t&&t.customData&&t.customData.getProperty("key")==="useExternalContent"){this._bUseExternalContent=true}this._createContent();e.prototype.applySettings.apply(this,arguments)};P.prototype.exit=function(t){if(this._getInternalModel()){this._getInternalModel().destroy()}if(this._oObserver){this._oObserver.disconnect();this._oObserver=null}e.prototype.exit.apply(this,arguments)};P.prototype.retrieveNavTargets=function(){f.warning("sap.ui.comp.navpopover.NavigationPopover#retrieveNavTargets called. This function is deprecated since UI5 version 1.42!");var t=l.getService("CrossApplicationNavigation");var e=l.getService("URLParsing");if(!t||!e){f.error("Service 'CrossApplicationNavigation' could not be obtained");this.fireTargetsObtained();return}var n=this;this.setMainNavigation(null);this.setOwnNavigation(null);this.removeAllAvailableActions();var i=t.getLinks({semanticObject:this.getSemanticObjectName(),params:this.getSemanticAttributes(),appStateKey:this.getAppStateKey(),ui5Component:this._getComponent(),sortResultOnTexts:true});i.done(function(i){if(!i||!i.length){n.fireTargetsObtained();return}var a=t.hrefForExternal();if(a&&a.indexOf("?")!==-1){a=a.split("?")[0]}i.forEach(function(t){if(t.intent.indexOf(a)===0){n.setOwnNavigation(new p({href:t.intent,text:t.text}));return}var i=e.parseShellHash(t.intent);if(i.action&&i.action==="displayFactSheet"){n.setMainNavigation(new p({href:t.intent,text:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_FACTSHEET")}));return}n.addAvailableAction(new p({href:t.intent,text:t.text}))});n.fireTargetsObtained()});i.fail(function(){f.error("'retrieveNavTargets' failed")})};P.prototype.show=function(t){var e=t||this._getControl();if(!e){f.error("no source assigned");return}this.openBy(e)};P.prototype.getDirectLink=function(){if(this._bUseExternalContent){return this.getContent()[0].getDirectLink()}var t=this._getInternalModel();if(t.getProperty("/extraContent")){return null}if(t.getProperty("/mainNavigationLink/href")&&!t.getProperty("/availableActions").length){return this._oHeaderArea.getItems()[0]}if(t.getProperty("/availableActions").length===1&&!t.getProperty("/mainNavigationLink/href")){return this._oActionArea.getItems()[0].getItems()[0]}return null};P.prototype.hasContent=function(){if(this._bUseExternalContent){return this.getContent()[0].hasContent()}var t=this._getInternalModel();return!!t.getProperty("/mainNavigationLink/href")||!!t.getProperty("/availableActions").length||!!t.getProperty("/extraContent")};P.prototype.setMainNavigationId=function(t){if(this._bUseExternalContent){throw"The API should not be used in case that the external content has been set"}this.setProperty("mainNavigationId",t,true);var e=this._getInternalModel();if(typeof t==="string"){e.setProperty("/mainNavigationLink/title",t)}return this};P.prototype.setAvailableActionsPersonalizationText=function(t){if(this._bUseExternalContent){throw"The API should not be used in case that the external content has been set"}this.setProperty("availableActionsPersonalizationText",t,true);var e=this._getInternalModel();e.setProperty("/availableActionsPersonalizationText",t);return this};P.prototype.setExtraContent=function(t){if(this._bUseExternalContent){throw"The API should not be used in case that the external content has been set"}var e=this._getInternalModel();if(e.getProperty("/extraContent")){this._getContentContainer().removeItem(1)}if(typeof t==="string"){t=sap.ui.getCore().byId(t)}this._getContentContainer().insertItem(t,1);this.setAssociation("extraContent",t);e.setProperty("/extraContent",t);return this};P.prototype.setMainNavigation=function(t){if(this._bUseExternalContent){throw"The API should not be used in case that the external content has been set"}this.setAggregation("mainNavigation",t,true);if(!t){return this}var e=this._getInternalModel();if(t.getHref()){e.setProperty("/mainNavigationLink/href",t.getHref());e.setProperty("/mainNavigationLink/internalHref",t.getInternalHref());e.setProperty("/mainNavigationLink/target",t.getTarget())}if(!e.getProperty("/mainNavigationLink/title")&&e.getProperty("/mainNavigationLink/title")!==""){e.setProperty("/mainNavigationLink/title",t.getText())}e.setProperty("/mainNavigationLink/subtitle",t.getDescription());return this};P.prototype.addAvailableAction=function(t){if(this._bUseExternalContent){throw"The API should not be used in case that the external content has been set"}this.addAggregation("availableActions",t);if(!t){return this}t.setPress(this._onLinkPress.bind(this));var e=this._getInternalModel();e.setProperty("/availableActions/"+this.indexOfAvailableAction(t)+"/",t.getJson());return this};P.prototype.insertAvailableAction=function(t,e){if(this._bUseExternalContent){throw"The API should not be used in case that the external content has been set"}this.insertAggregation("availableActions",t,e);if(!t){return this}t.setPress(this._onLinkPress.bind(this));var n=this._getInternalModel();this.getAvailableActions().forEach(function(t,e){n.setProperty("/availableActions/"+e+"/",t.getJson())});return this};P.prototype.removeAvailableAction=function(t){if(this._bUseExternalContent){throw"The API should not be used in case that the external content has been set"}var e=this.indexOfAvailableAction(t);if(e>-1){var n=this._getInternalModel();n.getData().availableActions.splice(e,1);n.refresh(true)}t=this.removeAggregation("availableActions",t);return t};P.prototype.removeAllAvailableActions=function(){if(this._bUseExternalContent){throw"The API should not be used in case that the external content has been set"}var t=this.removeAllAggregation("availableActions");var e=this._getInternalModel();e.setProperty("/availableActions",[]);e.refresh(true);return t};P.prototype.onAfterRenderingActionForm=function(){var t=this._getInternalModel();var e=t.getProperty("/extraContent")?t.getProperty("/extraContent").$()[0]:undefined;if(e&&e.scrollHeight>e.clientHeight){this._getContentContainer().setFitContainer(false).setJustifyContent(m.Start)}};P.prototype._createContent=function(){if(this._bUseExternalContent){return}var e=this;var i=new t({href:{path:"/mainNavigationLink/href"},text:{path:"/mainNavigationLink/title"},target:{path:"/mainNavigationLink/target"},visible:{path:"/mainNavigationLink/title",formatter:function(t){return!!t}},enabled:{path:"/mainNavigationLink/href",formatter:function(t){return!!t}},press:this._onLinkPress.bind(this)});var a=new b({key:"internalHref",value:"/mainNavigationLink/internalHref"});i.addCustomData(a);i.addStyleClass("sapFontHeader5Size");var l=new o({text:{path:"/mainNavigationLink/subtitle"},visible:{path:"/mainNavigationLink/subtitle",formatter:function(t){return!!t}}});this._oHeaderArea=new r({items:[i,l],visible:{path:"/mainNavigationLink/title",formatter:function(t){return!!t}}});this._oHeaderArea.addStyleClass("navigationPopoverTitleH1");this._oHeaderArea.addStyleClass("navigationPopoverHeader");this._oHeaderArea.setModel(this._getInternalModel());this._oObserver=new g(function(t){if(t.type==="property"&&t.name==="visible"){var e=this._getInternalModel().getProperty("/availableActions").filter(function(t){return t.visible===true});p.setVisible(e.length>0||this._getInternalModel().getProperty("/enableAvailableActionsPersonalization"));this._oActionArea.setVisible(e.length>0)}}.bind(this));var p=new r;p.setModel(this._getInternalModel());p.addStyleClass("navigationPopoverSeparator");this._oActionArea=new r({items:{path:"/availableActions",templateShareable:false,factory:function(e,n){var i=new t({visible:"{visible}",text:"{text}",href:"{href}",target:"{target}",press:n.getProperty("press")});var a=new b({key:"internalHref",value:"{internalHref}"});i.addCustomData(a);this._oObserver.observe(i,{properties:["visible"]});return new r({visible:"{visible}",layoutData:new u({styleClass:n.getProperty("description")?"navigationPopoverAvailableLinkGroup":"navigationPopoverAvailableLinkWithoutGroup"}),items:[i,new o({visible:"{visible}",text:"{description}"})]})}.bind(this)}});this._oActionArea.addEventDelegate({onAfterRendering:this.onAfterRenderingActionForm.bind(this)});this._oActionArea.addStyleClass("navigationPopoverAvailableLinks");this._oActionArea.setModel(this._getInternalModel());this._oPersonalizationButton=new s({visible:{parts:[{path:"/enableAvailableActionsPersonalization"}],formatter:function(t){return!!t}},justifyContent:"End",items:new n({type:A.Transparent,text:{path:"/availableActionsPersonalizationText"},press:function(){e.fireAvailableActionsPersonalizationPress()}})});this._oPersonalizationButton.setModel(this._getInternalModel());this._oPersonalizationButton.addStyleClass("navigationPopoverPersonalizationButton");var h=new r({fitContainer:true,justifyContent:m.Start,items:[this._oHeaderArea]});if(this._getInternalModel().getProperty("/extraContent")){h.addItem(this._getInternalModel().getProperty("/extraContent"))}h.addItem(p).addItem(this._oActionArea).addItem(this._oPersonalizationButton);this.addContent(h)};P.prototype._onLinkPress=function(t){this.fireNavigate({text:t.getSource().getText(),href:t.getSource().getHref(),internalHref:t.getSource().data("internalHref")})};P.prototype._getControl=function(){var t=this.getAssociation("source");if(typeof t==="string"){t=sap.ui.getCore().byId(t)}return t};P.prototype._getComponent=function(){var t=this.getComponent();if(typeof t==="string"){t=sap.ui.getCore().getComponent(t)}return t};P.prototype._getContentContainer=function(){return this.getContent()[0]};P.prototype._getInternalModel=function(){return this.getModel("$sapuicompNavigationPopover")};return P});