/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/comp/util/DateTimeUtil","sap/ui/comp/util/FormatUtil","sap/ui/comp/util/FilterUtil","sap/ui/comp/library","sap/ui/core/Configuration"],function(e,i,t,a,l,n,o,s){"use strict";var r=o.smartfilterbar.FilterType,f=o.valuehelpdialog.ValueHelpRangeOperation;var u=e.extend("sap.ui.comp.smartfilterbar.FilterProviderUtils");u.FIELD_NAME_REGEX=/\./g;u.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";u.BASIC_FILTER_AREA_ID="_BASIC";u.FILTER_MODEL_NAME="fi1t3rM0d31";u.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";u.ASSOCIATE_VALUE_LISTS="AssociateValueLists";u.INTL_TIMEZONE=Intl.DateTimeFormat().resolvedOptions().timeZone;u.UI_TIMEZONE=s.getTimezone();u._getStringEmptyFilter=function(e,a,l){var n=l?t.NE:t.EQ;if(a&&a.nullable==="false"){return new i(e,n,"")}else{return new i({and:!!l,filters:[new i(e,n,""),new i(e,n,null)]})}};u._getFieldMetadata=function(e,i){var t=null;e.some(function(e){if(e&&e.fields){e.fields.some(function(e){if(e&&e.fieldName===i){t=e}return t!==null})}return t!==null});return t};u._getTimezone=function(e,i){var t=e&&e.find(function(e){return e.key===i});if(t){return t.value}return null};u.adaptTime=function(e,i){var t;if(!(e instanceof Date)||!i){return e}if(i.filterRestriction===r.single&&i.control&&i.control.isA("sap.m.DynamicDateRange")){return a.normalizeDate(e,true)}if(i.displayFormat==="Date"){return a.normalizeDate(e,true)}t=parseInt(i.precision);return a.adaptPrecision(e,t)};u.generateFilters=function(e,o,s){var r=[],c=null,p=null,m=null,T=null,E=u.FIELD_NAME_REGEX,d=null,g,I,h=null,w=0,D=0,_,O,F,C,v,U,S,y,L,N,A,M=[],V,z,R;if(s){_=s.dateSettings;O=s.useContainsAsDefault;F=s.stringFields;C=s.timeFields;S=s.dateTimeOffsetValueFields;M=s.viewMetadataData||[];y=s.dateTimeOffsetWithTimeZone}if(e){if(o){D=e.length;while(D--){U=false;L=false;T=e[D];N=this._getTimezone(y,T);A=u._getFieldMetadata(M,T);if(A&&A.isCustomFilterField){continue}if(T&&T!==u.BASIC_SEARCH_FIELD_ID){h=null;v=false;if(O&&F){if(F.indexOf(T)>-1){v=true}}else if(C&&C.indexOf(T)>-1){U=true}else if(S&&S.indexOf(T)>-1){L=true}d=o[T];T=T.replace(E,"/");if(d&&d.hasOwnProperty("low")){if(d.low&&d.high){g=d.low;I=d.high;if(!L&&_&&_.UTC&&g instanceof Date&&I instanceof Date){g=a.localToUtc(g);I=a.localToUtc(I)}g=u.adaptTime(g,A);I=u.adaptTime(I,A);r.push(new i(T,t.BT,g,I))}else if(d.low){if(d.low instanceof Date){g=d.low;if(!L&&_&&_.UTC){g=a.localToUtc(g)}g=u.adaptTime(g,A);r.push(new i(T,t.EQ,g))}else if(typeof d.low==="string"){if(L&&A){h=l.parseDateTimeOffsetInterval(d.low);h[0]=A.ui5Type.parseValue(h[0],"string");if(h.length===2){h[1]=A.ui5Type.parseValue(h[1],"string")}}else{h=l.parseFilterNumericIntervalData(d.low)}if(h&&h.length===2){d[0]=u.adaptTime(d[0],A);d[1]=u.adaptTime(d[1],A);r.push(new i(T,t.BT,h[0],h[1]))}else if(h&&h.length===1){d[0]=u.adaptTime(d[0],A);r.push(new i(T,t.EQ,h[0]))}else{r.push(new i(T,v?t.Contains:t.EQ,d.low))}}}}else if(d&&d.hasOwnProperty("items")){c=[];m=[];p=null;if(d&&d.hasOwnProperty("ranges")){h=d.ranges;w=h.length;while(w--){V=h[w];g=V.value1;I=V.value2;if(U){if(g instanceof Date){g=l.getEdmTimeFromDate(g)}if(I instanceof Date){I=l.getEdmTimeFromDate(I)}}else if(A&&A.isCalendarDate){if(g instanceof Date){g=A.ui5Type.parseValue(g)}if(I instanceof Date){I=A.ui5Type.parseValue(I)}}else if(!L&&_&&_.UTC){if(g instanceof Date){g=a.localToUtc(g)}if(I instanceof Date){I=a.localToUtc(I)}}else if(L&&N){if(g){if(u.UI_TIMEZONE!==u.INTL_TIMEZONE){g=a.localToTimezone(g,N)}else{g=a.toTimezone(g,N)}g=a.localToUtc(g)}if(I){if(u.UI_TIMEZONE!==u.INTL_TIMEZONE){I=a.localToTimezone(I,N)}else{I=a.toTimezone(I,N)}I=a.localToUtc(I)}}else if(L&&!N){if(g){if(_&&_.UTC){g=a.uiTimezoneToUtc(g);g=a.localToUtc(g)}else{g=a.toTimezone(g,u.INTL_TIMEZONE)}}if(I){if(_&&_.UTC){I=a.uiTimezoneToUtc(I);I=a.localToUtc(I)}else{I=a.toTimezone(I,u.INTL_TIMEZONE)}}}g=u.adaptTime(g,A);I=u.adaptTime(I,A);z=V.exclude?m:c;if(V.operation===f.Empty){if(A&&["Edm.DateTime","Edm.DateTimeOffset"].indexOf(A.type)>-1){z.push(new i(T,V.exclude?t.NE:t.EQ,null))}else{z.push(u._getStringEmptyFilter(T,A,V.exclude))}}else{if(V.operation!==t.BT&&V.operation!==t.NB){I=undefined}R=V.exclude?n.getTransformedExcludeOperation(V.operation):V.operation;z.push(new i(T,R,g,I))}}if(m.length){p=new i(m,true)}}h=d.items;w=h.length;while(w--){c.push(new i(T,t.EQ,h[w].key))}if(d.value||d.value===0||d.value===false){if(typeof d.value==="string"){d.value=d.value.trim()}c.push(new i(T,v?t.Contains:t.EQ,d.value))}if(c.length){if(p){r.push(new i([new i(c,false),p],true))}else{r.push(new i(c,false))}}else if(p){r.push(p)}}else if(A&&A.control&&A.control.isA("sap.m.ComboBox")&&this.isValueSignificant(A)){if(d===null&&A.control.getSelectedKey()===""){d=""}if(A.control.getSelectedItem()){d=u.adaptTime(d,A);r.push(new i(T,v?t.Contains:t.EQ,d))}}else if(d||d===0||d===false){if(typeof d==="string"){d=d.trim()}if(d&&d instanceof Date){if(U){d=l.getEdmTimeFromDate(d)}else if(!L&&_&&_.UTC){d=a.localToUtc(d)}}if(d||d===0||d===false){d=u.adaptTime(d,A);r.push(new i(T,v?t.Contains:t.EQ,d))}}}}}}return r.length>1?[new i(r,true)]:r};u.isValueSignificant=function(e){var i=e["com.sap.vocabularies.Common.v1.ValueList"]&&e["com.sap.vocabularies.Common.v1.ValueList"].Parameters,t;if(i){t=i.find(function(e){return e.hasOwnProperty("InitialValueIsSignificant")})}if(t&&t["InitialValueIsSignificant"]){return t["InitialValueIsSignificant"].Bool.toLocaleLowerCase()==="true"}return false};return u});