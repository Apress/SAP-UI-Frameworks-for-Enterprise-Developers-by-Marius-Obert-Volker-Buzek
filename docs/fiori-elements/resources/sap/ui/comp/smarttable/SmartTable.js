/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/m/library","sap/ui/core/library","sap/ui/core/Core","sap/ui/core/ShortcutHintsMixin","sap/ui/core/format/ListFormat","sap/ui/events/KeyCodes","sap/ui/comp/util/DateTimeUtil","sap/ui/comp/util/FilterUtil","sap/m/Column","sap/m/ColumnListItem","sap/m/Label","sap/m/MessageBox","sap/m/Table","sap/m/Text","sap/m/Title","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/OverflowToolbarButton","sap/m/ToolbarSeparator","sap/m/VBox","sap/m/FlexItemData","sap/ui/comp/library","sap/ui/comp/providers/TableProvider","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/table/AnalyticalColumn","sap/ui/table/AnalyticalTable","sap/ui/table/Column","sap/ui/table/Table","sap/ui/table/TreeTable","sap/ui/comp/personalization/Controller","sap/ui/comp/personalization/Util","sap/ui/comp/util/FormatUtil","sap/ui/comp/util/FullScreenUtil","sap/ui/comp/odata/ODataModelUtil","sap/ui/comp/odata/ODataType","sap/ui/comp/state/UIState","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/core/format/NumberFormat","sap/ui/Device","sap/base/Log","sap/base/util/deepEqual","sap/base/util/merge","sap/m/ColumnHeaderPopover","sap/m/ColumnPopoverActionItem","sap/m/Menu","sap/m/OverflowToolbarMenuButton","sap/m/MenuItem","sap/m/Button","sap/m/Link","sap/m/MessageStrip","sap/ui/core/InvisibleMessage","sap/ui/util/openWindow","sap/ui/core/theming/Parameters","sap/m/plugins/ColumnResizer","sap/m/ColumnPopoverSelectListItem","sap/m/table/Util","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/table/columnmenu/Menu","sap/m/table/columnmenu/ActionItem","sap/base/util/UriParameters","sap/m/table/columnmenu/QuickActionContainer","sap/m/table/columnmenu/ItemContainer","sap/m/table/columnmenu/QuickAction","sap/m/table/columnmenu/QuickSort","sap/m/table/columnmenu/QuickSortItem","sap/m/table/columnmenu/QuickGroup","sap/m/table/columnmenu/QuickGroupItem","sap/m/table/columnmenu/QuickTotal","sap/m/table/columnmenu/QuickTotalItem","./flexibility/Utils","sap/base/util/isEmptyObject"],function(t,e,i,o,a,n,r,s,l,u,h,d,p,f,g,_,c,m,b,T,y,C,S,v,P,I,E,M,A,x,D,B,F,w,V,L,R,O,U,H,W,N,K,k,z,G,j,Q,q,X,$,Y,Z,J,tt,et,it,ot,at,nt,rt,st,lt,ut,ht,dt,pt,ft,gt,_t,ct,mt,bt,Tt,yt,Ct,St){"use strict";var vt=t.ButtonType;var Pt=t.MenuButtonMode;var It=t.ToolbarDesign;var Et=t.ToolbarStyle;var Mt=e.SortOrder;var At=e.TitleLevel;var xt=S.smarttable.InfoToolbarBehavior;var Dt=y.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smarttable/SmartTable.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},initiallyVisibleFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},enableExport:{type:"boolean",group:"Misc",defaultValue:true},exportType:{type:"sap.ui.comp.smarttable.ExportType",group:"Misc",defaultValue:"UI5ClientPDF"},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},customizeConfig:{type:"object",group:"Misc",defaultValue:null},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:At.Auto},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},placeToolbarInTable:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false},demandPopin:{type:"boolean",group:"Misc",defaultValue:false},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:false},initialNoDataText:{type:"string",group:"Misc",defaultValue:null},useInfoToolbar:{type:"sap.ui.comp.smarttable.InfoToolbarBehavior",group:"Behavior",defaultValue:xt.Auto},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false},detailsButtonSetting:{type:"sap.ui.core.Priority[]",group:"Behavior"},enableAutoColumnWidth:{type:"boolean",group:"Misc",defaultValue:false},showPasteButton:{type:"boolean",group:"Behavior",defaultValue:false},enablePaste:{type:"boolean",group:"Behavior",defaultValue:true}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},noData:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},semanticKeyAdditionalControl:{type:"sap.ui.core.Control",multiple:false},dataStateIndicator:{type:"sap.m.plugins.DataStateIndicator",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataRequested:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fieldChange:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"},filterSettings:{type:"object[]"}}},beforePaste:{allowPreventDefault:true,parameters:{columnInfos:{type:"object[]"}}},paste:{parameters:{result:{type:"object"}}},uiStateChange:{}}},renderer:{apiVersion:2},constructor:function(){this._oTableReady=function(){var t={};t.promise=new Promise(function(e){t.resolve=e});return t}();y.apply(this,arguments);this._aExistingColumns=[];this._aAlwaysSelect=[];this._oTemplate=null;this._mFieldMetadataByKey={};this._bUseLegacyMenu=false;this._createToolbar();this._updateP13nDialogSettings();this._createTable();this.attachModelContextChange(this._initialiseMetadata,this)}});Dt.prototype._getP13nDialogSettings=function(){var t=this.data("p13nDialogSettings");if(typeof this._oP13nDialogSettings==="string"){try{t=JSON.parse(this._oP13nDialogSettings)}catch(e){t=null}}return t};Dt.prototype.getDataStateIndicatorPluginOwner=function(){return this._oTable||this._oTableReady.promise};Dt.prototype.setDataStateIndicator=function(t){this._handeDataStateEvents(this.getDataStateIndicator(),"detach");this.setAggregation("dataStateIndicator",t,true);this._handeDataStateEvents(this.getDataStateIndicator(),"attach");return this};Dt.prototype.setCustomizeConfig=function(t){this.setProperty("customizeConfig",t,true);return this};Dt.prototype.setUseExportToExcel=function(t){var e=this.getUseExportToExcel();this.setProperty("useExportToExcel",t,true);if(e!==this.getUseExportToExcel()){this.setEnableExport(t)}return this};Dt.prototype.setEnableExport=function(t){var e=this.getEnableExport();this.setProperty("enableExport",t,true);if(e!==this.getEnableExport()){this.setUseExportToExcel(t)}return this};Dt.prototype._validateCustomizeConfig=function(t){if(!t){return}if(t.isA){z.error("Invalid config property. Provided configuration has been deleted from the customizeConfig property - "+this.getId());this.setCustomizeConfig(null);return}for(var e in t){switch(e){case"textInEditModeSource":this._validateTextInEditModeSource(t);break;case"ignoreInsertRestrictions":this._validateIgnoreInsertRestrictions(t);break;case"autoColumnWidth":this._validateAutoColumnWidth(t);break;case"clientSideMandatoryCheck":this._validateClientSideMandatoryCheck(t);break;default:z.error(e+" is not a supported configuration for the customizeConfig property - "+this.getId());delete t[e];break}}};Dt.prototype._validateTextInEditModeSource=function(t){if(this._validateCustomizeConfigObjectType(t["textInEditModeSource"])){delete t.textInEditModeSource;z.error("Invalid config property textInEditModeSource. Provided configuration has been deleted from the customizeConfig property - "+this.getId());return}this._checkAllowedValuesForCustomizeConfig(t["textInEditModeSource"],Object.keys(S.smartfield.TextInEditModeSource),"textInEditModeSource")};Dt.prototype._validateCustomizeConfigObjectType=function(t){if(typeof t!=="object"||!Object.keys(t).length||t.isA){return true}return false};Dt.prototype._checkAllowedValuesForCustomizeConfig=function(t,e,i){for(var o in t){if(!e.includes(t[o])){z.error("Invalid config property '"+o+"' for the "+i+" property of the customizeConfig - "+this.getId());delete t[o]}}};Dt.prototype._validateIgnoreInsertRestrictions=function(t){if(this._validateCustomizeConfigObjectType(t["ignoreInsertRestrictions"])){delete t.ignoreInsertRestrictions;z.error("Invalid config property ignoreInsertRestrictions. Provided configuration has been deleted from the customizeConfig property - "+this.getId());return}this._checkAllowedValuesForCustomizeConfig(t["ignoreInsertRestrictions"],[true,false],"ignoreInsertRestrictions")};Dt.prototype._validateClientSideMandatoryCheck=function(t){if(this._validateCustomizeConfigObjectType(t["clientSideMandatoryCheck"])){delete t.clientSideMandatoryCheck;z.error("Invalid config property clientSideMandatoryCheck. Provided configuration has been deleted from the customizeConfig property - "+this.getId());return}this._checkAllowedValuesForCustomizeConfig(t["clientSideMandatoryCheck"],[true,false],"clientSideMandatoryCheck")};Dt.prototype._validateAutoColumnWidth=function(t){if(!this.getEnableAutoColumnWidth()&&t.hasOwnProperty("autoColumnWidth")){delete t.autoColumnWidth;z.error("The autoColumnWidth property is deleted from the customizeConfig, since enableAutoColumnWidth=false on the SmartTable - "+this.getId())}if(this._validateCustomizeConfigObjectType(t["autoColumnWidth"])){delete t.autoColumnWidth;z.error("Invalid config property autoColumnWidth. Provided configuration has been deleted from the customizeConfig property - "+this.getId());return}for(var e in t){if(typeof t[e]!=="boolean"&&typeof t[e]!=="object"){delete t[e];z.error("Invalid config property '"+e+"' for the autColumnWidth property of the customizeConfig - "+this.getId())}if(typeof t[e]==="object"){var i=t[e];for(var o in i){if(typeof i[o]==="boolean"){continue}if(typeof i[o]!=="object"){z.error("Expected 'object' or 'boolean', instead "+typeof i[o]+" was passed for '"+o+"' autoColumnWidth customizeConfig property - "+this.getId());delete i[o];continue}var a=i[o];for(var n in a){var r=null;switch(n){case"truncateLabel":r=typeof a[n];if(r!=="boolean"){z.error("The "+n+" property must be of type boolean, instead "+r+" was passed - "+this.getId());delete a[n]}break;case"min":case"max":case"gap":r=typeof a[n];if(r!=="number"){z.error("The "+n+" property must be of type number, instead "+r+" was passed - "+this.getId());delete a[n]}break;default:z.error("Invalid config property '"+n+"' for the autoColumnWidth property of the customizeConfig - "+this.getId());delete a[n]}}}}}};Dt.prototype._handeDataStateEvents=function(t,e){if(t){t[e+"ApplyFilter"](this._onApplyMessageFilter,this);t[e+"ClearFilter"](this._onClearMessageFilter,this);t[e+"Event"]("filterInfoPress",this._handleInfoToolbarPress,this)}};Dt.prototype.setHeaderLevel=function(t){if(this.getHeaderLevel()===t){return this}this.setProperty("headerLevel",t,true);this._headerText&&this._headerText.setLevel(t);return this};Dt.prototype._getP13nFilterMessageStrip=function(){var t,e;if(this._oMessageFilter){e=i.getLibraryResourceBundle("sap.ui.comp");t=new tt({text:e.getText("SMARTTABLE_P13N_FILTER_MESSAGESTRIP"),link:new J({text:e.getText("SMARTTABLE_MESSAGESTRIP_CLEAR_FILTER"),press:[function(){this._fnClearMessageFilter();t.setVisible(false)},this]})})}return t};Dt.prototype._onApplyMessageFilter=function(t){this._fnClearMessageFilter=t.getParameter("revert");this._oMessageFilter=t.getParameter("filter");t.preventDefault();this._reBindTable()};Dt.prototype._onClearMessageFilter=function(t){this._oMessageFilter=null;t.preventDefault();this._reBindTable()};Dt.prototype.init=function(){y.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._aColumnKeys=[];this._aDeactivatedColumns=[];this._mLazyColumnMap={};this._mMenuShowEntryMap=new window.WeakMap};Dt.prototype._getVariantManagementControl=function(t){var e=null;if(t){if(typeof t==="string"){e=i.byId(t)}else{e=t}if(e){if(!(e instanceof P)){z.error("Control with the id="+t.getId?t.getId():t+" not of expected type");return null}}}return e};Dt.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||!this.getUseVariantManagement()&&!this.getUseTablePersonalisation()||!this.getPersistencyKey()){return}var t=new N({type:"table",keyName:"persistencyKey",dataSource:"TODO"});t.setControl(this);var e=this.getSmartVariant();if(e){this._oVariantManagement=this._getVariantManagementControl(e)}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){e=this._oSmartFilter.getSmartVariant();if(e){this._oVariantManagement=this._getVariantManagementControl(e)}}else{this._oVariantManagement=new P(this.getId()+"-variant",{showShare:true})}if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(t);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this)}};Dt.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD"}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding()}};Dt.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true)}};Dt.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()})};Dt.prototype.setTableBindingPath=function(t){this.setProperty("tableBindingPath",t,true);return this};Dt.prototype.setTableType=function(t){if(this.getTableType()===t){return this}if(this._bInitialising){throw new Error("tableType changed while SmartTable control was initializing - "+this.getId())}this.setProperty("tableType",t);return this};Dt.prototype.setShowTablePersonalisation=function(t){this.setProperty("showTablePersonalisation",t,true);if(this._oTablePersonalisationButton){this._oTablePersonalisationButton.setVisible(t)}return this};Dt.prototype.setUseVariantManagement=function(t){this.setProperty("useVariantManagement",t,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!t)}return this};Dt.prototype.setShowVariantManagement=function(t){this.setProperty("showVariantManagement",t,true);if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(t);if(this._oSeparator){this._oSeparator.setVisible(t)}}return this};Dt.prototype.setToolbarStyleClass=function(t){this.setProperty("toolbarStyleClass",t,true);return this};Dt.prototype.setCustomToolbar=function(t){this._oCustomToolbar=t;return this};Dt.prototype.getCustomToolbar=function(){return this._oCustomToolbar};Dt.prototype.setHeader=function(t){var e=this.getProperty("header"),i;this.setProperty("header",t,true);if(this.bIsInitialised&&this._oToolbar){i=!e===!t;if(!i){this._createToolbarContent()}else{this._refreshHeaderText()}}return this};Dt.prototype.setShowRowCount=function(t){this.setProperty("showRowCount",t,true);this._refreshHeaderText();return this};Dt.prototype.setEditable=function(t){if((t=!!t)==this.getEditable()){return this}this.setProperty("editable",t,true);if(this._oEditModel){this._oEditModel.setProperty("/editable",t)}if(this._oEditButton){this._oEditButton.setIcon(t?"sap-icon://display":"sap-icon://edit")}if(this._isMobileTable&&this._oTable.setKeyboardMode){this._oTable.setKeyboardMode(t?"Edit":"Navigation")}this._updateVisibleColumnsWidthForEdit();return this};Dt.prototype.setDemandPopin=function(t){var e=this.getDemandPopin();if(e===t){return this}this.setProperty("demandPopin",t,true);if(this.bIsInitialised){if(t){this._updateColumnsPopinFeature()}else{this._deactivateColumnsPopinFeature()}}return this};Dt.prototype._refreshHeaderText=function(){if(!this._headerText){return}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=K.getFloatInstance()}var t;var e=this.getHeader();this._headerText.setVisible(!!e);if(this.getShowRowCount()){t=this._getRowCount(true);if(t>0){var i=this._oNumberFormatInstance.format(t);e+=" ("+i+")"}}this._headerText.setText(e);this._updateAriaLabelledByInfo();if(this._bDataLoadPending===false&&this._bUpdateTableAnnouncement){this._bUpdateTableAnnouncement=false;this._updateTableAnnouncement(t)}};Dt.prototype._updateAriaLabelledByInfo=function(){var t=this._headerText.getId();if(this._oTable&&this._oTable.addAriaLabelledBy){if(this._headerText.getVisible()){if(this._oTable.getAriaLabelledBy().indexOf(t)===-1){this._oTable.addAriaLabelledBy(t)}}else{this._oTable.removeAriaLabelledBy(t)}}};Dt.prototype._updateTableAnnouncement=function(t){var e=et.getInstance();if(e){var o=i.getLibraryResourceBundle("sap.ui.comp");var a=this.getHeader();if(t===undefined&&this._getRowCount(false)>0){e.announce(o.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED",[a]))}else if(t>1){e.announce(o.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_MULT",[a,t]))}else if(t===1){e.announce(o.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_SING",[a,t]))}else{e.announce(o.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_NOITEMS",[a]))}}};Dt.prototype._addFullScreenButton=function(){if(this._oFullScreenButton){this._oToolbar.removeContent(this._oFullScreenButton)}if(this.getShowFullScreenButton()){if(!this._oFullScreenButton){this._oFullScreenButton=new b(this.getId()+"-btnFullScreen",{press:[function(){this._toggleFullScreen(!this.bFullScreen)},this]});this._oFullScreenButton.addStyleClass("sapUiCompSmartTableToolbarContent");if(k.system.phone){this._oFullScreenButton.setLayoutData(new c({priority:"NeverOverflow"}))}}this._renderFullScreenButton();this._oToolbar.addContent(this._oFullScreenButton)}};Dt.prototype._addPasteButton=function(){var t=this.getId()+"-btnPaste";var e=i.byId(t);if(e){this._oToolbar.removeContent(e)}if(this.getShowPasteButton()){if(!e){e=new b(t);e.addStyleClass("sapUiCompSmartTableToolbarContent");sap.ui.require(["sap/m/plugins/PasteProvider"],function(t){e.addDependent(new t({pasteFor:this._oTable.getId()}))}.bind(this))}e.setEnabled(this.getEnablePaste());this._oToolbar.addContent(e)}};Dt.prototype._createToolbar=function(){var t=null;if(!this._oToolbar){t=this.getCustomToolbar();if(t){this._oToolbar=t}else{this._oToolbar=new _({design:It.Transparent,style:this.getTableType()==="ResponsiveTable"?Et.Standard:Et.Clear});this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getToolbarStyleClass()){this._oToolbar.addStyleClass(this.getToolbarStyleClass())}}this._oToolbar.setLayoutData(new C({shrinkFactor:0}))}};Dt.prototype._toggleShowHideDetails=function(t){if(!this._oShowHideDetailsButton||t===this.bHideDetails){return}this.bHideDetails=t;if(this.bHideDetails){this._oTable.setHiddenInPopin(this._getImportanceToHide());this._oShowHideDetailsButton.setSelectedKey("hideDetails")}else{this._oTable.setHiddenInPopin([]);this._oShowHideDetailsButton.setSelectedKey("showDetails")}};Dt.prototype._getImportanceToHide=function(){var t=this.getDetailsButtonSetting()||[];var e=[];if(t.length){e=t}else{e=k.system.phone?["Low","Medium"]:["Low"]}return e};Dt.prototype._toggleFullScreen=function(t,e){if(!this._oFullScreenButton||t===this.bFullScreen&&!e){return}this.bFullScreen=t;O.toggleFullScreen(this,this.bFullScreen,this._oFullScreenButton,this._toggleFullScreen);this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:t})};Dt.prototype._renderFullScreenButton=function(){var t=i.getLibraryResourceBundle("sap.ui.comp"),e;e=this.bFullScreen?t.getText("CHART_MINIMIZEBTN_TOOLTIP"):t.getText("CHART_MAXIMIZEBTN_TOOLTIP");this._oFullScreenButton.setTooltip(e);this._oFullScreenButton.setText(e);this._oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen")};Dt.prototype._createToolbarContent=function(){if(!this._oToolbar){this._createToolbar()}this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addPasteButton();this._addEditTogglableToToolbar();this._addShowHideDetailsButton();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();this._addFullScreenButton();this._bToolbarInsertedIntoItems=true;this._placeToolbar()};Dt.prototype._applyToolbarContentOrder=function(){if(!this.bIsInitialised||!this.getCustomToolbar()){return}var t=this.data("p13nData_ToolbarContentMove");if(!t){return}t=Ct.parseChangeContent(t,function(t){this.data("p13nData_ToolbarContentMove",t)}.bind(this));if(!t||!t.order){return}var e=Ct.getAppComponentForControl(this)||null;var i=-1;var o=t.order;var a=[];var n=this._oToolbar.getContent();for(var r=0;r<o.length;r++){for(var s=0;s<n.length;s++){if(o[r].id===Ct.getSelectorForControl(n[s],e).id){if(i<0||i>s){i=s}a.push(n[s])}}}for(var s=0;s<a.length;s++){this._oToolbar.removeContent(a[s]);this._oToolbar.insertContent(a[s],i);i++}};Dt.prototype._placeToolbar=function(){if(!this.getPlaceToolbarInTable()){this.insertItem(this._oToolbar,0)}else if(this._isMobileTable){this._oTable.setHeaderToolbar(this._oToolbar)}else{this._oTable.addExtension(this._oToolbar)}};Dt.prototype.getToolbar=function(){return this._oToolbar};Dt.prototype._addEditTogglableToToolbar=function(){var t;if(this._oEditButton){this._oToolbar.removeContent(this._oEditButton)}if(this.getEditTogglable()){if(!this._oEditButton){t=i.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EDITTOGGLE_TOOLTIP");this._oEditButton=new b(this.getId()+"-btnEditToggle",{icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",text:t,tooltip:t,press:[function(){var t=this.getEditable();t=!t;this.setEditable(t,true);this.fireEditToggled({editable:t})},this]});this._oEditButton.addStyleClass("sapUiCompSmartTableToolbarContent")}this._oToolbar.addContent(this._oEditButton)}};Dt.prototype._addHeaderToToolbar=function(){if(this._headerText){this._oToolbar.removeContent(this._headerText)}if(!this._headerText){this._headerText=new g(this.getId()+"-header");this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");this._headerText.addStyleClass("sapUiCompSmartTableToolbarContent");this._headerText.setLevel(this.getHeaderLevel())}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0)};Dt.prototype._addSeparatorToToolbar=function(){if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator)}if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(!this._oSeparator){this._oSeparator=new T(this.getId()+"-toolbarSeperator");if(!this.getShowVariantManagement()){this._oSeparator.setVisible(false)}this._oSeparator.addStyleClass("sapUiCompSmartTableToolbarContent")}this._oToolbar.insertContent(this._oSeparator,0)}if(this._oToolbar){this._oToolbar.addStyleClass("sapMTBHeader-CTX")}};Dt.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oToolbar.removeContent(this._oVariantManagement);if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);this._oVariantManagement.addStyleClass("sapUiCompSmartTableToolbarContent");this._oVariantManagement.addStyleClass("sapUiCompSmartTableToolbarContentAllowAdaption");if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement())}}}};Dt.prototype._addSpacerToToolbar=function(){var t=false,e=this._oToolbar.getContent(),i,o;if(e){o=e.length;i=0;for(i;i<o;i++){if(e[i]instanceof m){t=true;break}}}if(!t){this._oToolbar.addContent(new m(this.getId()+"-toolbarSpacer").addStyleClass("sapUiCompSmartTableToolbarContent"))}};Dt.prototype._createShowHideDetailsButton=function(){var t=i.getLibraryResourceBundle("sap.ui.comp");this._oShowHideDetailsButton=new st(this.getId()+"-btnShowHideDetails",{visible:false,items:[new lt({icon:"sap-icon://detail-more",key:"showDetails",tooltip:t.getText("TABLE_SHOWDETAILS_TEXT"),press:[function(){this._toggleShowHideDetails(false)},this]}),new lt({icon:"sap-icon://detail-less",key:"hideDetails",tooltip:t.getText("TABLE_HIDEDETAILS_TEXT"),press:[function(){this._toggleShowHideDetails(true)},this]})]});this._oShowHideDetailsButton.addStyleClass("sapUiCompSmartTableToolbarContent");this._oShowHideDetailsButton.setSelectedKey("hideDetails")};Dt.prototype._addShowHideDetailsButton=function(){if(this._oShowHideDetailsButton){this._oToolbar.removeContent(this._oShowHideDetailsButton)}if(this.getShowDetailsButton()&&this._isMobileTable){if(this.bHideDetails===undefined){this.bHideDetails=true}if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton()}this._oToolbar.addContent(this._oShowHideDetailsButton)}};Dt.prototype._addTablePersonalisationToToolbar=function(){var t;if(this._oTablePersonalisationButton){this._oToolbar.removeContent(this._oTablePersonalisationButton)}if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){t=i.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_PERSOBTN_TOOLTIP");this._oTablePersonalisationButton=new b(this.getId()+"-btnPersonalisation",{icon:"sap-icon://action-settings",text:t,tooltip:t,press:[function(t){if(!this._bPersDialogOpen){this._bPersDialogOpen=true;this._bMissingColumnsCreated=true;this._oPersController.openDialog()}},this]});o.addConfig(this._oTablePersonalisationButton,{messageBundleKey:k.os.macintosh?"SMARTTABLE_SHORTCUT_SHOW_SETTINGS_MAC":"SMARTTABLE_SHORTCUT_SHOW_SETTINGS"},this);this._oTablePersonalisationButton.addStyleClass("sapUiCompSmartTableToolbarContent");this._oTablePersonalisationButton.setVisible(this.getShowTablePersonalisation())}this._oToolbar.addContent(this._oTablePersonalisationButton)}};Dt.prototype._triggerGWExport=function(){var t=i.getLibraryResourceBundle("sap.ui.comp");var e=function(){var t=this._getRowBinding();var e=t.getDownloadUrl("xlsx");e=this._removeExpandParameter(e);var i={url:e};this.fireBeforeExport({exportSettings:i});it(i.url)}.bind(this);var o=this._getRowCount(true);if(o>1e4){d.confirm(t.getText("DOWNLOAD_CONFIRMATION_TEXT",o),{actions:[d.Action.YES,d.Action.NO],onClose:function(t){if(t===d.Action.YES){e()}}})}else{e()}};Dt.prototype._addExportToExcelToToolbar=function(){if(this._oExportButton){this._oToolbar.removeContent(this._oExportButton)}if(!this.getEnableExport()){return}if(!this._oExportButton){var t=this.getId()+"-btnExcelExport";var e="sap-icon://excel-attachment";var o=i.getLibraryResourceBundle("sap.ui.comp");if(this.getExportType().indexOf("UI5Client")>-1){this._oExportButton=this._createClientExportButton(t,e)}else if(this._bTableSupportsExcelExport&&this.getExportType()=="GW"){var a;a=o.getText("TABLE_EXPORT_TEXT");this._oExportButton=new b(t,{icon:e,text:a,tooltip:a,press:[this._triggerGWExport,this]})}this._setExcelExportEnableState();if(this._oExportButton){this._oExportButton.addStyleClass("sapUiCompSmartTableToolbarContent")}}this._oToolbar.addContent(this._oExportButton)};Dt.prototype._createClientExportButton=function(t,e){var a=i.getLibraryResourceBundle("sap.ui.comp");var n={fileName:this.getHeader()};if(!this._cachedExcelSettings){this._cachedExcelSettings=n}var r=new $(t,{icon:e,tooltip:a.getText("TABLE_EXPORT_TEXT"),type:vt[ot.get({name:"_sap_ui_comp_SmartTable_ExportButton"})],buttonMode:Pt.Split,useDefaultActionOnly:true,text:a.getText("QUICK_EXPORT"),defaultAction:[function(){this._triggerUI5ClientExport()},this],menu:[new X({items:[new Y({text:a.getText("QUICK_EXPORT"),press:[function(){this._triggerUI5ClientExport()},this]}),new Y({text:a.getText("EXPORT_WITH_SETTINGS"),press:[function(){this._triggerUI5ClientExport(true)},this]})]})]});o.addConfig(r._getButtonControl(),{addAccessibilityLabel:true,messageBundleKey:k.os.macintosh?"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL_MAC":"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL"},this);return r};Dt.prototype.onkeydown=function(t){if(t.isMarked()){return}if((t.metaKey||t.ctrlKey)&&t.shiftKey&&t.which===n.E){if(this.getUseExportToExcel()&&this.getExportType().indexOf("UI5Client")>-1&&this._oExportButton&&this._oExportButton.getEnabled()){this._triggerUI5ClientExport(true);t.setMarked();t.preventDefault()}}else if((t.metaKey||t.ctrlKey)&&t.which===n.COMMA){if(this.getUseTablePersonalisation()&&this._oTablePersonalisationButton&&this._oTablePersonalisationButton.getVisible()){this._oPersController.openDialog();t.setMarked();t.preventDefault()}}};Dt.prototype.onThemeChanged=function(){if(this._oExportButton){var t=vt[ot.get({name:"_sap_ui_comp_SmartTable_ExportButton"})];this._oExportButton.setType(t)}};Dt.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=i.loadLibrary("sap.ui.export",true)}return this._oExportLibLoadPromise};Dt.prototype._getColumnLabel=function(t){var e,i;if(typeof t==="string"){e=t;t=this._getColumnByKey(t)}if(!t){var o=this._oTableProvider.getFieldLabel(this.getEntitySet(),e);if(o&&o.match(/{@i18n>.+}/gi)){var a=this.getModel("@i18n");if(a&&a.isA("sap.ui.model.resource.ResourceModel")){return a.getProperty(o.slice(1,-1).substring(6))||o}}if(!o){var n=this._mFieldMetadataByKey[e];if(n){o=n.label}}return o}if(t.getLabel){i=t.getLabel()}else if(t.getHeader){i=t.getHeader()}return i&&i.getText?i.getText():null};Dt.prototype._getColumnLeadingProperty=function(t,e){var i;if(t.getLeadingProperty){i=t.getLeadingProperty()}if(!i){var o=e||t.data("p13nData");if(o){i=o["leadingProperty"]}}return i};Dt.prototype._getColumnWidthNumber=function(t){if(t.indexOf("em")>0){return Math.round(parseFloat(t))}if(t.indexOf("px")>0){return Math.round(parseInt(t)/16)}return""};Dt.prototype._triggerUI5ClientExport=function(t){var e=this;var o,a,n,r,s,l;o=this._createExportColumnConfiguration();if(!o||!o.length){d.error(i.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS_EXPORT"),{styleClass:this.$()&&this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""});return}l=this._getRowBinding();r=this._getColumnLabel.bind(this);n=this._getColumnByKey.bind(this);s={workbook:{columns:o,context:{title:this.getHeader()}},dataSource:l,fileName:this.getHeader()};a=function(t){var i=t.getParameter("filterSettings");i.forEach(function(t){var e=t.getProperty();var i=n(e);t.setLabel(r(e));if(i&&i.data("p13nData")){t.setType(i.data("p13nData").typeInstance)}});e.fireBeforeExport({exportSettings:t.getParameter("exportSettings"),userExportSettings:t.getParameter("userExportSettings"),filterSettings:i})};this._loadExportLibrary().then(function(){sap.ui.require(["sap/ui/export/ExportHandler"],function(i){var o,n,l;if(!e._oExportHandler){n=e._oTableProvider.getExportCapabilities(e.getExportType());o=new i(n);o.attachBeforeExport(a);e._oExportHandler=o}l=(t?e._oExportHandler.exportAs:e._oExportHandler.export).bind(e._oExportHandler);l(s,r)})})};Dt.prototype._createExportColumnConfiguration=function(){var t,e,i,o,a,n,r,s,l,u,h,d,p,f=[],g,_,c;var m=function(t,e){return"{"+(parseInt(e)-1)+"}"};t=this._isMobileTable?this._oTable.getColumns(true):this._oTable.getColumns();i=t.length;c=this.data("useUTCDateTime");if(c!=null){if(typeof c==="string"){g=c==="true"}else if(typeof c==="boolean"){g=c}}for(e=0;e<i;e++){r=null;s=null;o=t[e];_=g;if(o.getVisible()){a=o.data("p13nData");r=this._getColumnLeadingProperty(o,a);if(Array.isArray(r)){r=r[0]}if(r){n=this._getColumnLabel(o);l=o.getWidth().toLowerCase()||a.width||"";l=this._getColumnWidthNumber(l);u=a.type==="numeric"?"Number":a.type;p=a.typeInstance;d=null;h=null;if(a.unit){u=a.isCurrency?"Currency":"Number"}else if(p&&p.isA("sap.ui.comp.odata.type.FiscalDate")){var b=p.getFormatter();s=b.getTemplate().replace(/\$(\d)/g,m);h=b.getRegExPattern().toString().slice(1,-1);u="String"}else if(u!="date"&&H.isDateOrTime(a.edmType)){u=H.getTypeName(a.edmType);if(u==="DateTimeOffset"){u="DateTime";_=false}}else if(u==="stringdate"){u="Date";h="YYYYMMDD"}else if(u==="boolean"){u="Boolean";d=H.getType(a.edmType)}else if(a.description){u="String";s=R.getFormattedExpressionFromDisplayBehaviour(a.displayBehaviour,"{0}","{1}")}else if(a.isDigitSequence){u="Number"}else if(u==="string"){u="String"}else if(u==="date"){u="Date"}else if(u==="time"){u="Time"}f.push({columnId:o.getId(),property:a.description?[r,a.description]:r,type:u,inputFormat:h,label:n?n:r,width:l,textAlign:o.getHAlign(),template:s,trueValue:u==="Boolean"&&d?d.formatValue(true,"string"):undefined,falseValue:u==="Boolean"&&d?d.formatValue(false,"string"):undefined,unitProperty:u==="Currency"||u==="Number"?a.unit:undefined,displayUnit:u==="Currency"?true:undefined,precision:a.precision,scale:a.scale,autoScale:u==="Number",utc:u==="DateTime"&&_!=null?_:undefined,timezoneProperty:u==="DateTime"?a.additionalProperty:undefined})}}}return f};Dt.prototype._removeExpandParameter=function(t){var e=t.replace(new RegExp("([\\?&]\\$expand=[^&]+)(&?)"),function(t,e,i){return i?e.substring(0,1):""});return e};Dt.prototype._getRowCount=function(t){var e=this._getRowBinding();if(!e){return t?undefined:0}var i;if(!t){i=e.getLength();if(i===1&&e.isA("sap.ui.model.analytics.AnalyticalBinding")){var o=e?e.providesGrandTotal()&&e.hasTotaledMeasures():false;if(o){i=0}}}else if(typeof e.getCount==="function"){i=e.getCount()}else if(!e.isA("sap.ui.model.TreeBinding")&&typeof e.isLengthFinal==="function"&&e.isLengthFinal()){i=e.getLength()}if(i<0||i==="0"){i=0}return i};Dt.prototype._setExcelExportEnableState=function(){if(this._oExportButton){var t=this._getRowCount();this._oExportButton.setEnabled(t>0)}};Dt.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return}var t=this._oP13nDialogSettings;t=this._setIgnoreFromPersonalisationToSettings(t);t=t||{};if(this._isTreeTable){t.stableColumnKeys=[];t.stableColumnKeys.push(this._aColumnKeys[0])}if(this._bIsFilterPanelEnabled){t.filter=t.filter?t.filter:{};t.filter.createMessageStrip=this._getP13nFilterMessageStrip.bind(this)}this._oPersController=new V(this.getId()+"-persoController",{table:this._oTable,columnKeys:this._aColumnKeys,setting:t,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:[this._beforePersonalisationModelDataChange,this],afterPotentialTableChange:[this._afterPersonalisationModelDataChange,this],afterP13nModelDataChange:[this._personalisationModelDataChange,this],requestColumns:[this._personalisationRequestColumns,this]});this._oPersController.attachDialogAfterClose(function(t){if(this._fGetDataForKeyUser){if(t.getParameter("cancel")){this._fGetDataForKeyUser([])}this._cleanUpKeyUser()}this._bPersDialogOpen=false}.bind(this));if(this._aDeactivatedColumns.length>0){this._oPersController.addToSettingIgnoreColumnKeys(this._aDeactivatedColumns)}};Dt.prototype.getVariantManagement=function(){return this._oVariantManagement};Dt.prototype.openDialogForKeyUser=function(t,e){this._fGetDataForKeyUser=e;return this._oPersController.openDialog({showReset:false,useAvailablePanels:true,styleClass:t}).then(function(t){if(t){return sap.ui.getCore().loadLibrary("sap.ui.mdc",{async:true}).then(function(){sap.ui.require(["sap/ui/mdc/p13n/P13nBuilder"],function(e){return e.addRTACustomFieldButton(t,this)}.bind(this))}.bind(this))}}.bind(this))};Dt.prototype._cleanUpKeyUser=function(){this._fGetDataForKeyUser=null};Dt.prototype._createKeyUserChange=function(){return[{selectorControl:this._oVariantManagement._getPersoController(),changeSpecificData:{changeType:"variantContent",content:{key:this._oVariantManagement.getSelectionKey(),persistencyKey:this.getPersistencyKey(),content:this.fetchVariant()}}}]};Dt.prototype._setIgnoreFromPersonalisationToSettings=function(t){var e=L.createArrayFromString(this.getIgnoreFromPersonalisation());if(e.length){if(!t){t={}}var i=function(i){if(!t[i]){t[i]={}}t[i].ignoreColumnKeys=e};i("filter");i("sort");i("group");i("columns")}return t};Dt.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation)}};Dt.prototype.setEntitySet=function(t){if(this.getEntitySet()===t){return this}if(this._bInitialising){throw new Error("entitySet changed while SmartTable control was initializing - "+this.getId())}this.setProperty("entitySet",t,true);this._initialiseMetadata();return this};Dt.prototype._initialiseMetadata=function(t){var e=this,i=e;if(t){i=t.getSource()}if(!i.bIsInitialised){U.handleModelInit(i,i._onMetadataInitialised,[{selector:i},{selector:i._oTable,changeTypes:["addXML","addXMLAtExtensionPoint"]}])}};Dt.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(this.bIsInitialised){return}this._updateInitialColumns();this._fireBeforeInitialiseAndValidate();this._validateCustomizeConfig(this.getCustomizeConfig());this._createTableProvider();if(!this._oTableProvider){return}this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(!this._aTableViewMetadata){return}if(this.getEnableAutoColumnWidth()){this._oTable.getColumns().forEach(this._setWidthForCustomColumn,this)}if(!this._isMobileTable&&this.getDemandPopin()){this.setDemandPopin(false);z.error("use SmartTable property 'demandPopin' only  with responsive table, property has been set to false")}this.detachModelContextChange(this._initialiseMetadata,this);this.bIsInitialised=true;delete this._bInitialising;this._updateP13nDialogSettings(true);this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._bMultiUnitBehaviorEnabled=this._oTableProvider.getMultiUnitBehaviorEnabled();this._listenToSmartFilter();this._createVariantManagementControl();this._createToolbarContent();this._applyToolbarContentOrder();this._aAlwaysSelect=this._oTableProvider.getRequestAtLeastFields();this._createContent();this._createPersonalizationController();this._oEditModel=new A({editable:this.getEditable()});this.setModel(this._oEditModel,"sm4rtM0d3l");this.attachEvent("_change",this._onPropertyChange,this);this.fireInitialise();if(!this._oVariantManagement||this._oVariantManagement&&this._bVariantInitialised){this._checkAndTriggerBinding()}};Dt.prototype._fireBeforeInitialiseAndValidate=function(){if(!this.hasListeners("beforeInitialise")){return}this._bInitialising=true;this.fireEvent("beforeInitialise");this._validateControlConfig();this._updateInitialColumns()};Dt.prototype._validateControlConfig=function(){var t=this.getItems();if(!t.length){throw new Error("Internals of the SmartTable control changed via beforeInitialise event - "+this.getId())}var e=t.find(function(t){return t.isA(["sap.m.Table","sap.ui.table.Table"])});if(!e){throw new Error("Inner Table removed via beforeInitialise event - "+this.getId())}if(e!==this._oTable){throw new Error("Inner table changed via beforeInitialise event for SmartTable - "+this.getId())}};Dt.prototype._updateP13nDialogSettings=function(t){this._oP13nDialogSettings=this._getP13nDialogSettings();this._bIsFilterPanelEnabled=this._oP13nDialogSettings&&this._oP13nDialogSettings.filter?this._oP13nDialogSettings.filter.visible!==false:true;this._bIsSortPanelEnabled=this._oP13nDialogSettings&&this._oP13nDialogSettings.sort?this._oP13nDialogSettings.sort.visible!==false:true;this._bIsGroupPanelEnabled=this._oP13nDialogSettings&&this._oP13nDialogSettings.group?this._oP13nDialogSettings.group.visible!==false:true;this._bIsColumnsPanelEnabled=this._oP13nDialogSettings&&this._oP13nDialogSettings.columns?this._oP13nDialogSettings.columns.visible!==false:true;if(t){this._attachTableCustomFilter()}};Dt.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){if(this._oSmartFilter.isInitialised()){this._oSmartFilter.search()}else{this._oSmartFilter.attachEventOnce("initialise",function(){this._oSmartFilter.search()},this)}}else{this._reBindTable()}}}};Dt.prototype._aStaticProperties=["entitySet","ignoredFields","initiallyVisibleFields","ignoreFromPersonalisation","tableType","useTablePersonalisation","enableAutoBinding","persistencyKey","smartFilterId","showDetailsButton","enableAutoColumnWidth","customizeConfig"];Dt.prototype._aToolbarRelatedProperties=["enableExport","exportType","showFullScreenButton","showPasteButton","editTogglable","placeToolbarInTable"];Dt.prototype._onPropertyChange=function(t){var e=t.getParameter("name");if(this._aStaticProperties.indexOf(e)>-1){z.error("Property "+e+" cannot be changed after the SmartTable with id "+this.getId()+" is initialised")}if(this._oToolbar&&this._aToolbarRelatedProperties.indexOf(e)>-1){if(e==="exportType"&&this._oExportButton){this._oExportButton.destroy();this._oExportButton=null}this._createToolbarContent()}};Dt.prototype._createTableProvider=function(){var t,e,i,o,a;e=this.getEntitySet();i=this.getIgnoredFields();t=this.getModel();o=this.data("preserveDecimals");a=this.getCustomizeConfig();if(a){for(var n in a){this["_oCustomizeConfig"+n.charAt(0).toUpperCase()+n.slice(1)]=a[n]}}if(o!=null){if(o==false||typeof o==="string"&&o==="false"){this._bPreserveDecimals=false}else{this._bPreserveDecimals=true}}else{this._bPreserveDecimals=true}if(t&&e){if(this._aExistingColumns.length){if(i){i+=","+this._aExistingColumns.toString()}else{i=this._aExistingColumns.toString()}}this._oTableProvider=new v({entitySet:e,ignoredFields:i,initiallyVisibleFields:this.getInitiallyVisibleFields(),isEditableTable:this.getEditable(),smartTableId:this.getId(),isAnalyticalTable:!!this._isAnalyticalTable,isMobileTable:!!this._isMobileTable,dateFormatSettings:this.data("dateFormatSettings"),useUTCDateTime:this.data("useUTCDateTime"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),useSmartToggle:this.data("useSmartToggle"),skipAnnotationParse:this.data("skipAnnotationParse"),lineItemQualifier:this.data("lineItemQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),enableInResultForLineItem:this.data("enableInResultForLineItem"),_semanticKeyAdditionalControl:this.getAggregation("semanticKeyAdditionalControl"),model:t,semanticObjectController:this.getSemanticObjectController(),showDetailsButton:this.getShowDetailsButton(),enableAutoColumnWidth:this.getEnableAutoColumnWidth(),preserveDecimals:this._bPreserveDecimals,textInEditModeSource:this._oCustomizeConfigTextInEditModeSource,ignoreInsertRestrictions:this._oCustomizeConfigIgnoreInsertRestrictions,clientSideMandatoryCheck:this._oCustomizeConfigClientSideMandatoryCheck})}};Dt.prototype._listenToSmartFilter=function(){var t,e,o=false;t=this.getSmartFilterId();this._oSmartFilter=this._findControl(t,"sap.ui.comp.filterbar.FilterBar");if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindTable,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);o=true}var a=i.getLibraryResourceBundle("sap.ui.comp"),n,r,s={SMARTTABLE_NO_DATA:a.getText("SMARTTABLE_NO_DATA"),SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR:a.getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"),SMARTTABLE_NO_RESULTS:a.getText("SMARTTABLE_NO_RESULTS")};if(this._oTable){n=!this._isMobileTable&&this._oTable.getNoData;r="noData";if(!n){n=this._oTable.getNoDataText;r="noDataText"}}if(n){var l=n.call(this._oTable);if(l&&(!this._isMobileTable||!this._oTable.isPropertyInitial(r))){if(Object.values(s).indexOf(l)==-1){this._vCustomNoData=l}}}e=this.getInitialNoDataText();if(e){o=e==="$FILTERBAR";if(!o&&e!=="$NO_FILTERBAR"){this._setNoDataText(e);return}}if(o){this._setNoDataText(s["SMARTTABLE_NO_DATA"])}else{this._setNoDataText(s["SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"])}};Dt.prototype._filterChangeEvent=function(){if(this._isTableBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true)}};Dt.prototype._showOverlay=function(t){if(t){var e={show:true};this.fireShowOverlay({overlay:e});t=e.show}this._oTable.setShowOverlay(t)};Dt.prototype._findControl=function(t,e){var o,a;if(t){o=i.byId(t);if(!o||!o.isA(e)){a=this._getView();if(a){o=a.byId(t)}}if(o&&!o.isA(e)){o=undefined}}return o};Dt.prototype._getView=function(){if(!this._oView){var t=this.getParent();while(t){if(t.isA("sap.ui.core.mvc.View")){this._oView=t;break}t=t.getParent()}}return this._oView};Dt.prototype.rebindTable=function(t){if(this.isInitialised()){this._reBindTable(null,t);return}z.error("rebindTable method called before the SmartTable is initialized. Please execute the UI5 Support Assistant 'SmartTable' rules to get more information",this.getId(),"sap.ui.comp.smarttable.SmartTable")};Dt.prototype._reBindTable=function(t,e){var o,a,n,r,s,l,u=[],h,p,f,g,_,c,m,b={},T={preventTableBind:false};this._bUpdateTableAnnouncement=t&&t.getId&&t.getId()==="search";n=this._getTablePersonalisationData()||{};if(this._oMessageFilter){h=this._oMessageFilter}else{h=n.filters;p=n.excludeFilters}m=n.sorters;if(this._oSmartFilter){l=this._oSmartFilter.getFilters();b=this._oSmartFilter.getParameters()||{}}if(l&&l.length){if(p){u=[new E([l[0],p],true)]}else{u=l}}else if(p){u=[p]}if(h){h=u.concat(h)}else{h=u}f=this._getRequestAtLeastFields();_=this._getRelevantColumnPaths();g=_["select"];g=this._getSemanticObjectBindingPaths(g);if(!g||!g.length){g=f}else{s=f.length;for(r=0;r<s;r++){if(g.indexOf(f[r])<0){g.push(f[r])}}}if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.select){this._mSelectExpandForGroup.select.forEach(function(t){if(g.indexOf(t)<0){g.push(t)}})}o=this._oTable.getBinding(this._sAggregation);if(g.length){this._adaptTreeBindingParameters(g,b,o);b["select"]=g.toString();c=_["expand"]||[];if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.expand){this._mSelectExpandForGroup.expand.forEach(function(t){if(c.indexOf(t)<0){c.push(t)}})}if(c.length){b["expand"]=c.join(",")}}b["useBatchRequests"]=true;if(!m){m=[]}T.filters=h;T.sorter=m;T.parameters=b;T.length=undefined;T.startIndex=undefined;T.events={};this.fireBeforeRebindTable({bindingParams:T,messageFilterActive:!!this._oMessageFilter});if(!T.preventTableBind){m=T.sorter;h=T.filters;b=T.parameters;g=T.parameters["select"];if(!g||!g.length){d.error(i.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{styleClass:this.$()&&this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""});return}a=this.getTableBindingPath()||"/"+this.getEntitySet();if(this._oTable.resumeUpdateAnalyticalInfo){this._oTable.resumeUpdateAnalyticalInfo(true,false)}this._bDataLoadPending=true;this._bIgnoreChange=false;if(this._bForceTableUpdate){e=true;this._bForceTableUpdate=false}if(!e){if(o&&o.mParameters){var y=b["select"];b["select"]="";var C=o.mParameters["select"];o.mParameters["select"]="";e=!(G(b,o.mParameters,true)&&G(b.custom,o.mParameters.custom)&&!T.length&&!T.startIndex&&a===o.getPath());if(!e){e=!G(y.split(",").sort(),C.split(",").sort())}b["select"]=y;o.mParameters["select"]=C}}if(!this._bNoDataUpdated){this._bNoDataUpdated=true;this._setNoDataText()}else{this._setNoDataText(undefined,(this.getSmartFilterId()||this._bIsFilterPanelEnabled)&&h&&h.length)}if(!o||!this._bIsTableBound||e){Dt._addBindingListener(T,"change",this._onBindingChange,this);Dt._addBindingListener(T,"dataRequested",this._onDataRequested,this);Dt._addBindingListener(T,"dataReceived",this._onDataReceived,this);if(this._isMobileTable){var S=this._oTable?this._oTable.getColumns():[];var v=this._oTemplate?this._oTemplate.getCells():[];if(S.length===v.length){S.forEach(function(t,e){v[e].setBindingContext(t.getVisible()?undefined:null)})}}this._oTable.bindRows({path:a,filters:h,sorter:m,parameters:b,length:T.length,startIndex:T.startIndex,template:this._oTemplate,events:T.events});this._bIsTableBound=true}else{o.sort(m);o.filter(h,"Application")}this._showOverlay(false)}};Dt.prototype._adaptTreeBindingParameters=function(t,e,i){if(!this._isTreeTable){return}e["numberOfExpandedLevels"]=this._oTable.getExpandFirstLevel()?1:0;e["rootLevel"]=this._oTable.getRootLevel();e["collapseRecursive"]=this._oTable.getCollapseRecursive();if(!i||!i.getTreeAnnotation){return}var o={"hierarchy-level-for":i.getTreeAnnotation("hierarchy-level-for"),"hierarchy-parent-node-for":i.getTreeAnnotation("hierarchy-parent-node-for"),"hierarchy-node-for":i.getTreeAnnotation("hierarchy-node-for"),"hierarchy-drill-state-for":i.getTreeAnnotation("hierarchy-drill-state-for")};for(var a in o){if(o[a]&&t.indexOf(o[a])===-1){t.push(o[a])}}};Dt.prototype._onDataRequested=function(t){if(t&&t.getParameter&&t.getParameter("__simulateAsyncAnalyticalBinding")){return}this._bIgnoreChange=true;this.fireDataRequested(t.getParameters())};Dt.prototype._onDataReceived=function(t){if(t&&t.getParameter&&t.getParameter("__simulateAsyncAnalyticalBinding")){return}this._bIgnoreChange=false;this._onDataLoadComplete(t,true);this.fireDataReceived(t)};Dt.prototype._onBindingChange=function(t){if(this._bIgnoreChange){return}var e,i=false;e=t&&t.getParameter?t.getParameter("reason"):undefined;if(!e||e==="filter"||e==="context"||!this._bDataLoadPending&&e==="change"||e==="add"||e==="remove"){i=true}if(e==="change"||i){this._onDataLoadComplete(t,i)}};Dt._addBindingListener=function(t,e,i,o){if(!t.events){t.events={}}if(!t.events[e]){t.events[e]=i.bind(o)}else{var a=t.events[e];t.events[e]=function(){i.apply(o,arguments);a.apply(o,arguments)}}};Dt.prototype._onDataLoadComplete=function(t,e){if(this._bDataLoadPending||e){this._bDataLoadPending=false;this.updateTableHeaderState()}};Dt.prototype._isTableBound=function(){if(this._bIsTableBound){return true}if(this._oTable){return this._oTable.isBound(this._sAggregation)}return false};Dt.prototype.setNoData=function(t){this._oNoData=t;if(this._bNoDataUpdated||this._isTableBound()){this._setNoDataText()}return this};Dt.prototype.getNoData=function(){return this._oNoData};Dt.prototype._setNoDataText=function(t,e){var o=!this._isMobileTable&&this._oTable.setNoData;if(!o){o=this._oTable.setNoDataText}if(!o){return}if(this._bNoDataUpdated&&this._vCustomNoData){o.call(this._oTable,this._vCustomNoData,true);return}var a=t;if(!a){a=this.getNoData()}if(!a){if(e){a=i.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS")}else{a=i.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR")}}o.call(this._oTable,a,true)};Dt.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState()};Dt.prototype._createContent=function(){var t,e=0,i,o,a,n=[];if(this._aExistingColumns&&this._aExistingColumns.length){this._aColumnKeys=[].concat(this._aExistingColumns.reverse())}if(!this._bUseLegacyMenu){if(this.getUseTablePersonalisation()){this._oColumnHeaderPopover=new ut({id:this.getId()+"-columnHeaderMenu"});this._oQuickActionContainer=new pt;this._oColumnHeaderPopover.addAggregation("_quickActions",this._oQuickActionContainer);this._oItemContainer=new ft;this._oColumnHeaderPopover.addAggregation("_items",this._oItemContainer);this._bMissingColumnsCreated=false;this._oColumnHeaderPopover.attachBeforeOpen(this._createColumnMenuContent,this)}}o=this._parseIndexedColumns();e=this._aTableViewMetadata.length;for(t=0;t<e;t++){i=this._aTableViewMetadata[t];if(i.isInitiallyVisible){this._aColumnKeys.push(i.name)}else{n.push(i.name)}if(!(i.isInitiallyVisible||i.inResult)){this._mLazyColumnMap[i.name]=i}else{a=this._createColumnForField(i);this._oTable.addColumn(a)}this._mFieldMetadataByKey[i.name]=i}this._insertIndexedColumns(o);this._aColumnKeys=this._aColumnKeys.concat(n);if(this._isMobileTable&&this.getEnableAutoColumnWidth()){this.setDemandPopin(true);this._oTable.setFixedLayout("Strict");this._oTable.setContextualWidth("auto");this._oTable.addDependent(new at)}this._updateColumnsPopinFeature();if(this.getShowDetailsButton()){this._oTable.setHiddenInPopin(this._getImportanceToHide())}this._storeInitialColumnSettings()};Dt.prototype._createColumnForField=function(t){var e,i;i=this.getId()+"-"+t.name.replace(/[^A-Za-z0-9_.:-]+/g,"_");e=this._createColumn(t,i);t.isColumnCreated=true;e.data("p13nData",{columnKey:t.name,leadingProperty:t.name,additionalProperty:t.additionalProperty,navigationProperty:t.navigationProperty,sortProperty:t.sortable?t.name:undefined,filterProperty:t.filterable?t.name:undefined,isGroupable:t.sortable&&t.filterable&&t.aggregationRole==="dimension",fullName:t.hasValueListAnnotation?t.fullName:null,type:t.filterType,typeInstance:t.modelType,maxLength:t.maxLength,precision:t.precision,scale:t.scale,align:t.align,edmType:t.type,displayBehaviour:t.displayBehaviour,description:t.description,isDigitSequence:t.isDigitSequence,isCurrency:t.isCurrencyField,unit:t.unit,width:t.width,aggregationRole:t.aggregationRole,nullable:t.nullable!=="false"});if(t.filterable&&e.setFilterProperty){e.setFilterProperty(t.name)}if(t.sortable&&e.setSortProperty){e.setSortProperty(t.name)}if(!this._bUseLegacyMenu&&!e.getAssociation("headerMenu")){e.setAssociation("headerMenu",this.getId()+"-columnHeaderMenu")}if(this.getEnableAutoColumnWidth()){t.width=e.getWidth();if(this.getEditable()){this._updateColumnWidthForEdit(e,t)}}this._registerContentTemplateEvents(t.template);return e};Dt.prototype._parseIndexedColumns=function(){var t,e,i,o,a,n,r,s,l;var u=this._oTable.getColumns();var h=null;if(this._oTemplate&&this._oTemplate.getCells){h=this._oTemplate.getCells()}if(!u){return null}o=[];e=u.length;for(t=0;t<e;t++){i=u[t];a=i.data("p13nData");n=null;r=null;if(a){n=a.columnIndex;r=a.columnKey}s=-1;if(n!==null&&n!==undefined){s=parseInt(n)}if(!isNaN(s)&&s>-1){if(h){l=h[t];this._oTemplate.removeCell(l)}else{l=null}this._aColumnKeys.splice(t-o.length,1);o.push({index:s,columnKey:r,column:i,template:l});this._oTable.removeColumn(i)}}o.sort(function(t,e){return t.index-e.index});return o};Dt.prototype._insertIndexedColumns=function(t){var e,i,o;if(!t){return}i=t.length;for(e=0;e<i;e++){o=t[e];this._aColumnKeys.splice(o.index,0,o.columnKey);this._oTable.insertColumn(o.column,o.index);if(o.template){this._oTemplate.insertCell(o.template,o.index)}}};Dt.prototype._updateColumnsPopinFeature=function(){if(!this._isMobileTable||!this.getDemandPopin()){return}if(!this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(true)}var t=this._oTable.getColumns(true);if(!t){return}t=t.filter(function(t){return t.getVisible()});t.forEach(function(t){if(t.getPopinDisplay()!="WithoutHeader"){t.setPopinDisplay("Inline")}})};Dt.prototype._storeInitialColumnSettings=function(){var t=L.createArrayFromString(this.getIgnoreFromPersonalisation());this._aInitialSorters=[];L.createSort2Json(this._oTable,this._aInitialSorters,t,this._aTableViewMetadata)};Dt.prototype._deactivateColumnsPopinFeature=function(){if(!this._isMobileTable){return}if(this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(false)}var t=this._oTable.getColumns();if(!t){return}var e,i=t.length;for(var o=0;o<i;o++){e=t[o];e.setDemandPopin(false);e.setMinScreenWidth("1px")}};Dt.prototype._registerContentTemplateEvents=function(t){if(t.isA("sap.ui.comp.SmartToggle")){t=t.getEdit()}if(t&&t.attachChange){t.attachChange(function(t){this.fireFieldChange({changeEvent:t})},this)}};Dt.prototype._updateInitialColumns=function(){var t=this._oTable.getColumns(),e=t.length,i,o;var a=this.getEnableAutoColumnWidth();while(e--){i=t[e];o=i.data("p13nData");if(o&&o.columnKey&&this._aExistingColumns.indexOf(o.columnKey)>=0){continue}if(typeof o==="string"){try{o=JSON.parse(o);i.data("p13nData",o)}catch(t){}}if(o&&o.columnKey){this._aExistingColumns.push(o.columnKey);if(!this._bUseLegacyMenu&&!i.getAssociation("headerMenu")){i.setAssociation("headerMenu",this.getId()+"-columnHeaderMenu");if(!this._isMobileTable){this._mMenuShowEntryMap.set(i,{sort:i.getShowSortMenuEntry(),filter:i.getShowFilterMenuEntry()});i.setShowSortMenuEntry(false);i.setShowFilterMenuEntry(false)}}}if(a&&this._isMobileTable){var n=i.getHeader();if(n&&n.isPropertyInitial("wrapping")&&n.getMetadata().getProperty("wrapping")){n.setWrapping(false)}}}};Dt.prototype._getRelevantColumnPaths=function(){var t={},e=[],i=[],o=this._oTable.getColumns(),a,n=o?o.length:0,r,s,l,u,h;var d=function(t,e){var i,o;if(t){o=t.split(",");i=o.length;while(i--){t=o[i];if(t&&e.indexOf(t)<0){e.push(t)}}}};for(a=0;a<n;a++){r=o[a];l=null;if(r.getVisible()||r.getInResult&&r.getInResult()){s=r.data("p13nData");l=this._getColumnLeadingProperty(r,s);if(s){u=s["additionalProperty"];h=s["navigationProperty"]}if(l&&e.indexOf(l)<0){e.push(l)}d(u,e);d(h,i)}}t["select"]=e;t["expand"]=i;return t};Dt.prototype._createTable=function(){var t=this.getItems(),e=t?t.length:0,i,o;this._sAggregation="rows";while(e--){i=t[e];if(i instanceof F||i instanceof p){break}i=null}if(i){this._oTable=i;if(i instanceof D){this._isAnalyticalTable=true}else if(i instanceof p){this._isMobileTable=true;this._oTemplate=i.getItems()&&i.getItems().length>0?i.getItems()[0]:new u;i.removeAllItems()}else if(i instanceof w){this._isTreeTable=true}this._updateInitialColumns()}else{o=this.getId()+"-ui5table";if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new D(o,{enableCustomFilter:true})}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new p(o,{growing:true,autoPopinMode:this.getDemandPopin()});this._oTemplate=new u}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new w(o,{selectionMode:"MultiToggle"})}else{this._oTable=new F(o,{selectionMode:"MultiToggle"})}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode("Auto")}this.insertItem(this._oTable,2)}this._oTableReady.resolve(this._oTable);this._fColumnPaddingBorder=this._isMobileTable?1:1.1875;if(!this._oTable.getLayoutData()){if(this._oTable instanceof p||this._oTable.getVisibleRowCountMode&&this._oTable.getVisibleRowCountMode()!=="Auto"){this._oTable.setLayoutData(new C({growFactor:1,baseSize:"auto"}))}else{this._oTable.setLayoutData(new C({growFactor:1,baseSize:"0%"}))}}this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(100);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter())}if(this._oTable.setShowColumnVisibilityMenu){this._oTable.setShowColumnVisibilityMenu(false)}this._attachTableCustomFilter();if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn}else if(this._isMobileTable){if(this.getUseTablePersonalisation()){this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onColumnPress,this);this._oTable.attachSort=function(){this.attachEvent("sort",arguments[0],arguments[1],arguments[2])};this._oTable.detachSort=function(){this.detachEvent("sort",arguments[0],arguments[1])}}this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;if(this.getShowDetailsButton()){this._oTable.attachEvent("popinChanged",this._onPopinChanged,this)}}if(!this._isMobileTable){this._oTable.attachRowsUpdated(function(){this._setExcelExportEnableState()},this)}if(this._oTable._setLargeDataScrolling){this._oTable._setLargeDataScrolling(true)}this._oTable.attachPaste(this._onInnerTablePaste,this)};Dt.prototype._attachTableCustomFilter=function(){if(this._oTable.detachCustomFilter){this._oTable.detachCustomFilter(this._onCustomFilter,this)}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()&&this._bIsFilterPanelEnabled){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false)}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(this._onCustomFilter,this)}}};Dt.prototype._createResponsivePopover=function(t){this._oFilterButton=new q({text:i.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[function(t){this._onCustomFilter(t)},this]});var e=i.getLibraryResourceBundle("sap.ui.comp");this._aSortButton=[new nt({label:e.getText("SMARTTABLE_RP_SORT_ASCENDING"),icon:"sap-icon://sort-ascending",action:[true,this._onCustomSort,this]}),new nt({label:e.getText("SMARTTABLE_RP_SORT_DESCENDING"),icon:"sap-icon://sort-descending",action:[false,this._onCustomSort,this]})];this._oColumnHeaderPopover=new Q({items:[this._aSortButton,this._oFilterButton]});if(t){this._oColumnHeaderPopover.addItem(new q({text:i.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_RESIZE"),icon:"sap-icon://resize-horizontal",press:[function(){at.getPlugin(this._oTable).startResizing(this._oColumnClicked.getDomRef())},this]}))}};Dt.prototype._createColumnMenuContent=function(t){var e=i.getLibraryResourceBundle("sap.ui.comp");var o=t.getParameter("openBy");var a=o.data("p13nData");var n;var r=window.matchMedia("(hover:none)").matches&&this._isMobileTable&&this.getEnableAutoColumnWidth();this._oColumnClicked=o;this._oQuickActionContainer.removeAllAggregation("quickActions");this._oItemContainer.removeAllAggregation("items");if(!this._bMissingColumnsCreated){this._oPersController&&this._oPersController.preparePersonalization();this._bMissingColumnsCreated=true}if(this.getUseTablePersonalisation()){n=this._mMenuShowEntryMap.get(o);if(this._isMobileTable||!this._aExistingColumns.includes(a.columnKey)||n&&n.sort){if(!this._oQuickSort){this._oQuickSort=this._createQuickSort(o)}this._updateQuickSort(o);this._oQuickActionContainer.addQuickAction(this._oQuickSort)}var s=this._oPersController._oColumnHelper&&this._oPersController._oColumnHelper.getColumnMap();if(this._bIsSortPanelEnabled&&L.hasSortableColumns(s)){if(!this._oSortItem){this._oSortItem=this._createSortItem(e)}this._oItemContainer.addItem(this._oSortItem)}if(this._bIsFilterPanelEnabled&&L.hasFilterableColumns(s)&&(this._isMobileTable||!this._aExistingColumns.includes(a.columnKey)||n&&n.filter)){if(!this._oFilterItem){this._oFilterItem=this._createFilterItem(e)}this._oItemContainer.addItem(this._oFilterItem)}if((this._isAnalyticalTable||this._isMobileTable)&&this._bIsGroupPanelEnabled&&L.hasGroupableColumns(s)){if(!this._oGroupItem){this._oGroupItem=this._createGroupItem(e)}this._oItemContainer.addItem(this._oGroupItem)}if(this._bIsColumnsPanelEnabled){if(!this._oColumnsItem){this._oColumnsItem=this._createColumnsItem(e)}this._oItemContainer.addItem(this._oColumnsItem)}if(r){if(!this._oQuickResize){this._oQuickResize=this._createQuickResize(e)}this._oQuickActionContainer.addQuickAction(this._oQuickResize)}}};Dt.prototype._createQuickSort=function(t){return new _t({items:[],change:[function(t){var e=t.getParameter("item"),i=e.getSortOrder(),o=this._getColumnFromP13nMap(e.getKey());if(!o){return}if(i===Mt.None){var a=o.data("p13nData");this._onCustomSort(t,a.sorted&&a.sorted.ascending,o)}else{this._onCustomSort(t,i===Mt.Ascending,o)}},this]})};Dt.prototype._updateQuickSort=function(t){var e=t.data("p13nData");var i;this._oQuickSort.destroyItems();if(e.unit||e.displayBehaviour!=="descriptionOnly"){var o=this._getColumnSortProperty(t);i=this._getColumnFromP13nMap(o);if(o){this._oQuickSort.addItem(new ct({key:o,label:this._getColumnLabel(t),sortOrder:Bt(i.data("p13nData"))}))}}if(e.displayBehaviour!=="idOnly"&&e.description){i=this._getColumnFromP13nMap(e.description);if(this._getColumnSortProperty(i)){this._oQuickSort.addItem(new ct({key:e.description,label:this._getColumnLabel(i),sortOrder:Bt(i.data("p13nData"))}))}}if(e.unit){i=this._getColumnFromP13nMap(e.unit);if(this._getColumnSortProperty(t)){this._oQuickSort.addItem(new ct({key:e.unit,label:this._getColumnLabel(i),sortOrder:Bt(i.data("p13nData"))}))}}};Dt.prototype._getColumnSortProperty=function(t){if(!t){return}if(t.isA("sap.ui.table.AnalyticalColumn")&&!t.getVisible()&&!t.getInResult()){return}var e;if(t.getSortProperty){e=t.getSortProperty()}if(!e){var i=t.data("p13nData");if(!i){return}e=i.sortProperty}return e};Dt.prototype._createQuickResize=function(t){return new gt({label:t.getText("SMARTTABLE_RP_RESIZE"),content:new Z({icon:"sap-icon://resize-horizontal",press:[function(){this._oColumnHeaderPopover.close();at.getPlugin(this._oTable).startResizing(this._oColumnClicked.getDomRef())},this]})})};Dt.prototype._createSortItem=function(t){return new ht({label:t.getText("SMARTTABLE_RP_SORT"),icon:"sap-icon://sort",press:[this._showTableSortDialog,this]})};Dt.prototype._createFilterItem=function(t){return new ht({label:t.getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[this._onCustomFilter,this]})};Dt.prototype._createGroupItem=function(t){return new ht({label:t.getText("SMARTTABLE_RP_GROUP"),icon:"sap-icon://group-2",press:[this._showTableGroupDialog,this]})};Dt.prototype._createColumnsItem=function(t){return new ht({label:t.getText("SMARTTABLE_RP_COLUMNS"),icon:"sap-icon://table-column",press:[this._showTableColumnsDialog,this]})};function Bt(t){var e=Mt.None;if(t.sorted){e=t.sorted.ascending?Mt.Ascending:Mt.Descending}return e}Dt.prototype._onColumnPress=function(t){if(!this._bUseLegacyMenu){return}this._oColumnClicked=t.getParameter("column");var e=this._oColumnClicked.data("p13nData");var i=window.matchMedia("(hover:none)").matches&&this._isMobileTable&&this.getEnableAutoColumnWidth();if(!e&&!i){return}var o=e.filterProperty;var a=e.sortProperty;if(!this._oColumnHeaderPopover){this._createResponsivePopover(i)}this._oFilterButton.setVisible(!!o&&this._bIsFilterPanelEnabled);var n=!!a&&this._bIsSortPanelEnabled;this._aSortButton.forEach(function(t){t.setVisible(n)});if(o&&this._bIsFilterPanelEnabled||a&&this._bIsSortPanelEnabled||i){this._oColumnHeaderPopover.removeAllAriaLabelledBy();this._oColumnHeaderPopover.addAriaLabelledBy(this._oColumnClicked.getHeader());this._oColumnHeaderPopover.openBy(this._oColumnClicked)}};Dt.prototype._onCustomSort=function(t,e,i){if(!i){i=this._oColumnClicked}var o=i.data("p13nData");var a,n;if(o){if(o.sorted&&o.sorted.ascending===e){delete o.sorted;n=Mt.None;if(this._isMobileTable){i.setSortIndicator(n)}}else{o.sorted={ascending:e};a=o.sorted;n=a&&a.ascending?Mt.Ascending:Mt.Descending}this._oTable.fireEvent("sort",{column:i,sortOrder:n,columnAdded:false})}};Dt.prototype._onCustomFilter=function(t){this._showTableFilterDialog(t.getParameter("column")||this._oColumnClicked)};Dt.prototype._onPopinChanged=function(t){if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton()}var e=t.getParameter("visibleInPopin");var i=t.getParameter("hiddenInPopin");var o=t.getSource().getVisibleItems();var a=e.some(function(t){return this._getImportanceToHide().indexOf(t.getImportance())>-1},this);if(o.length&&(i.length||a)){this._oShowHideDetailsButton.setVisible(true)}else{this._oShowHideDetailsButton.setVisible(false)}};Dt.prototype.getTable=function(){return this._oTable};Dt.prototype._showTableFilterDialog=function(t){if(this._oPersController){var e={filter:{visible:true}};if(t){e.filter["payload"]={column:t}}this._oPersController.openDialog(e)}};Dt.prototype._showTableSortDialog=function(){if(this._oPersController){var t={sort:{visible:true}};this._oPersController.openDialog(t)}};Dt.prototype._showTableGroupDialog=function(){if(this._oPersController){var t={group:{visible:true}};this._oPersController.openDialog(t)}};Dt.prototype._showTableColumnsDialog=function(){if(this._oPersController){var t={columns:{visible:true}};this._oPersController.openDialog(t)}};Dt.prototype._calcColumnWidth=function(t,e,i){var o;if(i===false){o=true}i=Object.assign({label:e?false:true,defaultWidth:e?4:8,padding:this._fColumnPaddingBorder},i);if(!t||o){return i.defaultWidth}var a=0,n=0,r=Math.max(i.min||0,e?1:2),s=Math.max(r,i.max||19),l=t.additionalProperty||"",u=t.displayBehaviour,h=t.modelType,d=t.type||"";if(s<r){return s}if(e||t.unit||!l||u!="descriptionOnly"){if(t.isImageURL||d=="Edm.Byte"||d=="Edm.SByte"){a+=r}else if(h){a+=rt.calcTypeWidth(h,{defaultWidth:i.defaultWidth,maxWidth:i.max})}else{a+=i.defaultWidth}}if(this._isTreeTable&&t.hierarchy&&t.index==0){a+=3}if(!e){t.ownWidth=a=Math.min(a,s)}if(!e&&u!="idOnly"&&l&&this._oTableProvider&&a<s){l.split(",").forEach(function(e){if(e==t.fieldControlProperty){return}var i=this._oTableProvider.getFieldMetadata(e);var o=Object.assign({padding:.4,max:s-a-.4},t.vertical&&{padding:0,max:s});if(e==t.unit){o.min=3}var n=this._calcColumnWidth(i,true,o);if(t.vertical){a=Math.max(n,a)}else{a+=n}},this);if(u=="descriptionOnly"){t.ownWidth=a}else{t.additionalWidth=a-t.ownWidth}}a=a+(i.gap||0);if(i.label){var p=t.label||t.fieldLabel||"";t.labelWidth=n=rt.calcHeaderWidth(p,i.truncateLabel!=false?a:0,s,r)}a=Math.max(r,a,n);a=Math.min(a,s)+i.padding;a=Math.round(a*100)/100;return a};Dt.prototype._fetchAutoColumnWidthConfig=function(t){var e=null;if(this._oCustomizeConfigAutoColumnWidth){if(this._oCustomizeConfigAutoColumnWidth.hasOwnProperty(t.name)){e=this._oCustomizeConfigAutoColumnWidth[t.name]}else if(this._oCustomizeConfigAutoColumnWidth.hasOwnProperty("*")){e=this._oCustomizeConfigAutoColumnWidth["*"]}}if(e&&e===true){e=null}return e};Dt.prototype._setWidthForCustomColumn=function(t){var e=t.data("p13nData");if(!this._oTableProvider||!e||!e.autoColumnWidth||t.getWidth()){return}var i=e.autoColumnWidth;var o=i.visibleProperty||typeof e.additionalProperty==="string";var a=i.visibleProperty||[this._getColumnLeadingProperty(t,e),e.additionalProperty].join(",");var n=a.split(",");var r=this._oTableProvider.getFieldMetadata(n.shift(),true);if(!r){return}var s=Object.assign({},r);s.label=this._getColumnLabel(t);if(o){s.additionalProperty=n?n.join(","):""}var l=this._calcColumnWidth(s,false,{truncateLabel:i.truncateLabel,min:i.min,max:i.max,gap:i.gap});r.width=l+"rem";t.setWidth(r.width);if(this.getEditable()){this._updateColumnWidthForEdit(t,r,i)}};Dt.prototype._updateColumnWidthForEdit=function(t,e){if(!e||!e.isColumnCreated||e.type=="Edm.Boolean"||e.semanticObjects){return}var i=this.data("useSmartField")=="true"||this.data("useSmartField")===true;if(i&&e["sap:updatable"]=="false"){return}var o=t.getWidth();if(!this.getEditable()){if(e.editWidth==o){t.setWidth(e.width)}}else if(e.width==o){if(e.editWidth){return t.setWidth(e.editWidth)}if(!this._aEditableColumnAdditionalWidth){var a=this._fColumnPaddingBorder;var n=this.$().closest(".sapUiSizeCompact").length?"_Compact":"";var r=parseFloat(ot.get({name:"_sap_m_InputBase"+n+"_IconWidth"}));a+=parseFloat(ot.get({name:"_sap_m_InputBaseWrapper_Sum_Border"}));a+=parseFloat(ot.get({name:"_sap_m_InputBase"+n+"_InnerPadding"}).split(" ").pop())*2;this._aEditableColumnAdditionalWidth=[a,a+r-.25]}var s=(e.displayBehaviour||"").includes("And");var l=(e.labelWidth||0)+this._fColumnPaddingBorder;if(i&&s&&e.additionalWidth&&e.hasValueListAnnotation&&!e.hasFixedValues){e.editWidth=Math.max(e.ownWidth+this._aEditableColumnAdditionalWidth[1],l)+"rem";return t.setWidth(e.editWidth)}var u=e.isCalendarDate||H.isDateOrTime(e.type);var h=e.hasValueListAnnotation||u;var d=this._aEditableColumnAdditionalWidth[+h];if(i&&s&&!e.additionalWidth&&e.hasValueListAnnotation&&e.hasFixedValues){d=Math.max(e.ownWidth+3+d,l)}else if(e.ownWidth<4||u){d+=e.ownWidth}else{d+=2}var p=parseFloat(o);if(p<d){e.editWidth=d+"rem";t.setWidth(e.editWidth)}}};Dt.prototype._updateVisibleColumnsWidthForEdit=function(){if(this._oTable&&this._oTableProvider&&this.getEnableAutoColumnWidth()){this._oTable.getColumns().forEach(function(t){if(t.getVisible()){var e=this._getColumnLeadingProperty(t);if(e){var i=this._oTableProvider.getFieldMetadata(e);i&&this._updateColumnWidthForEdit(t,i)}}},this)}};Dt.prototype._createColumn=function(t,e){var i=new B(e,{autoResizable:true,hAlign:t.align,width:t.width,visible:t.isInitiallyVisible,label:new h(e+"-header",{textAlign:t.align,text:t.label}),sorted:t.sorted,sortOrder:t.sortOrder,tooltip:t.quickInfo,showSortMenuEntry:this._bUseLegacyMenu?t.sortable&&this._bIsSortPanelEnabled:!this.getUseTablePersonalisation(),showFilterMenuEntry:this._bUseLegacyMenu?t.filterable&&this._bIsFilterPanelEnabled:!this.getUseTablePersonalisation(),name:t.fieldName,template:t.template});if(!t.width&&this.getEnableAutoColumnWidth()){var o=this._fetchAutoColumnWidthConfig(t);i.setWidth(this._calcColumnWidth(t,false,o)+"rem")}return i};Dt.prototype._createAnalyticalColumn=function(t,e){if(t.aggregationRole!=="measure"&&t.isMeasureField&&t.unit&&t.template.addStyleClass){t.template.addStyleClass("sapUiAnalyticalTableSumCellHidden sapUiAnalyticalTableGroupCellHidden")}else if(t.isCurrencyField&&t.template.addStyleClass){t.template.addStyleClass("sapUiCompCurrencyBold")}var i=this.getModel(),o=i&&i.getMetaModel();var a=new x(e,{autoResizable:true,hAlign:t.align,width:t.width,visible:t.isInitiallyVisible,inResult:t.inResult,label:new h(e+"-header",{textAlign:t.align,text:t.label}),tooltip:t.quickInfo,sorted:t.sorted,sortOrder:t.sortOrder,grouped:t.grouped,showIfGrouped:t.grouped,showSortMenuEntry:this._bUseLegacyMenu?t.sortable&&this._bIsSortPanelEnabled:!this.getUseTablePersonalisation(),showFilterMenuEntry:this._bUseLegacyMenu?t.filterable&&this._bIsFilterPanelEnabled:!this.getUseTablePersonalisation(),summed:t.summed,leadingProperty:t.name,template:t.template,groupHeaderFormatter:R.getInlineGroupFormatterFunction(t,true,this._getDateFormatSettings(),this._bPreserveDecimals,true,o)});if(!t.width&&this.getEnableAutoColumnWidth()){var n=this._fetchAutoColumnWidthConfig(t);a.setWidth(this._calcColumnWidth(t,false,n)+"rem")}return a};Dt.prototype._createMobileColumn=function(e,i){var o=new l(i,{hAlign:e.align,visible:e.isInitiallyVisible,header:new h(i+"-header",{textAlign:e.align,text:e.label,tooltip:e.quickInfo,wrapping:!this.getEnableAutoColumnWidth(),wrappingType:t.WrappingType.Hyphenated}),tooltip:e.quickInfo});if(e.importance&&!this._oTableProvider.isLineItemDefaultImportance(e)){o.setImportance(e.importance)}if(this._oTemplate){this._oTemplate.addCell(e.template)}if(e.width){return o.setWidth(e.width)}if(!this.getEnableAutoColumnWidth()){return o.setWidth(e.isImageURL?"3em":"auto")}var a=this._fetchAutoColumnWidthConfig(e);return o.setWidth(this._calcColumnWidth(e,false,a)+"rem")};Dt.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{}}return this._oCurrentVariant};Dt.prototype.applyVariant=function(t,e){this._oCurrentVariant=t;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null}this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true)}if(this._oPersController){if(this._oCurrentVariant===null||St(this._oCurrentVariant)){this._oPersController.resetPersonalization("ResetFull")}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true)}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()})};Dt.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding()};Dt.prototype.getUiState=function(){var t=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new W({presentationVariant:{SortOrder:t?t.SortOrder:[],GroupBy:t?t.GroupBy:[],Total:t?t.Total:[],RequestAtLeast:this._getRequestAtLeastFields(),Visualizations:t?t.Visualizations:[]},selectionVariant:{SelectOptions:t?t.SelectOptions:[]},variantName:this.getCurrentVariantId()})};Dt.prototype.setUiState=function(t){this._setUiState(t,false)};Dt.prototype.setUiStateAsVariant=function(t){this._setUiState(t,true)};Dt.prototype._setUiState=function(t,e){var i=t.getPresentationVariant()&&t.getPresentationVariant().RequestAtLeast?[].concat(t.getPresentationVariant().RequestAtLeast):[];if(!G(i,this._getRequestAtLeastFields())){this._aAlwaysSelect=i}if(this._oPersController){if(e){this._oPersController.setPersonalizationDataAsDataSuiteFormat(j({},t.getPresentationVariant(),t.getSelectionVariant()),true)}else{var o=this._oVariantManagement&&t.getVariantName()?this._oVariantManagement.getVariantContent(this,t.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(j({},t.getPresentationVariant(),t.getSelectionVariant()),o,true)}}};Dt.prototype._getRequestAtLeastFields=function(){var t=this.getRequestAtLeastFields();var e=t?t.split(","):[];return e.concat(this._aAlwaysSelect)};Dt.prototype._personalisationRequestColumns=function(t){var e=t.getParameter("columnKeys"),i,o,a,n,r,s={};a=e.length;for(o=0;o<a;o++){i=e[o];n=this._mLazyColumnMap[i];if(n){r=this._createColumnForField(n);if(this._isMobileTable){this._oTable.addColumn(r)}s[n.name]=r}}this._oPersController.addColumns(s)};Dt.prototype._beforePersonalisationModelDataChange=function(t){if(this._oTable.suspendUpdateAnalyticalInfo){this._oTable.suspendUpdateAnalyticalInfo()}};Dt.prototype._afterPersonalisationModelDataChange=function(t){this._updateColumnsPopinFeature();if(this.getEditable()){this._updateVisibleColumnsWidthForEdit()}};Dt.prototype._personalisationModelDataChange=function(t){this._oCurrentVariant=t.getParameter("persistentData");if(this._fGetDataForKeyUser){this._fGetDataForKeyUser(this._createKeyUserChange())}var e=t.getParameter("runtimeDeltaDataChangeType");var i=this._getChangeStatus(e);if(i==="Unchanged"){return}if(!(this._bApplyingVariant||this._bDeactivatingColumns)){if(!this.getUseVariantManagement()){this._persistPersonalisation()}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true)}}if(this._isTableBound()){if(i==="ModelChanged"){if(e&&e.columns==="ModelChanged"){this._bForceTableUpdate=true;var o;if(this._isMobileTable&&this._oTable.getHiddenInPopin()){o=t.getParameter("runtimeDeltaData").columns.columnsItems.some(function(t){return t.visible&&this._oTable.getHiddenInPopin().includes(this._getColumnByKey(t.columnKey).getImportance())},this)}if(o){this._toggleShowHideDetails(false)}}if(this._oSmartFilter){this._oSmartFilter.search()}else{this._reBindTable(null)}}else if(i==="TableChanged"&&this._isMobileTable&&this.getEditable()){this._updateMobileHiddenCellBindingContext(t)}}this._adaptCustomSort();this._createInfoToolbar();this.fireUiStateChange()};Dt.prototype._updateMobileHiddenCellBindingContext=function(t){var e=i.getMessageManager().getMessageModel().getData();if(!e.length){return}var o=e.filter(function(t){return t.validation===true});if(!o.length){return}var a=t.getParameter("runtimeDeltaData").columns.columnsItems.filter(function(t){return t.visible===false});a.forEach(function(t){var o=this._getColumnByKey(t.columnKey),a=this._oTemplate.getCells()[this._oTable.indexOfColumn(o)],n;if(a.isA("sap.ui.comp.SmartToggle")){var r=a.getEdit();n=r.getId()}else{n=a.getId()}if(n){var s=e.find(function(t){var e=t.getControlId();if(e){return e.includes(n)}});if(s){var l=i.byId(s.getControlId());if(l){l.setBindingContext(null)}}}},this)};Dt.prototype._updateSortIndicator=function(t,i,o){var a=this._getSortItemsFromVariant();var n=a.filter(function(t){return t.sortProperty===i})[0];if(o){if(n){t.setSortIndicator(n.operation)}else{var r=t.data("p13nData");if(!r.sorted){t.setSortIndicator(e.None)}}}else{if(n){t.setSorted(true);t.setSortOrder(n.operation)}else{var r=t.data("p13nData");if(!r.sorted){t.setSorted(false)}}}};Dt.prototype._getSortItemsFromVariant=function(){var t,e,i=[];if(this._oCurrentVariant.sort&&this._oCurrentVariant.sort.sortItems){this._oCurrentVariant.sort.sortItems.forEach(function(o){t=this._getColumnByKey(o.columnKey);e=this._getColumnSortProperty(t);i.push({sortProperty:e,operation:o.operation})},this)}return i};Dt.prototype._adaptAdditionalProperties=function(t){var e=t.data("p13nData"),i;if(e.unit||e.displayBehaviour!=="descriptionOnly"){i=this._getColumnSortProperty(t);this._updateSortIndicator(t,i,this._isMobileTable)}if(e.displayBehaviour!=="idOnly"&&e.description){var o=this._getColumnFromP13nMap(e.description);if(this._getColumnSortProperty(o)){i=e.description;this._updateSortIndicator(t,i,this._isMobileTable)}}if(e.unit){var o=this._getColumnFromP13nMap(e.unit);if(this._getColumnSortProperty(o)){i=e.unit;this._updateSortIndicator(t,i,this._isMobileTable)}}};Dt.prototype._updateColumnInfo=function(t,e){if(t){if(!e.sorted){e.sorted={ascending:false}}if(t.operation===Mt.None){delete e.sorted}else{e.sorted={ascending:t.operation!==Mt.Descending}}}else if(e&&e.sorted){e.sorted=null}};Dt.prototype._adaptCustomSort=function(){if(this._oCurrentVariant){var t,e,i;var o=this._getSortItemsFromVariant();this._oTable.getColumns().forEach(function(a){e=a.data("p13nData");t=e&&e.sortProperty;if(t){if(o.length){i=o.filter(function(e){return t===e.sortProperty})[0]}this._updateColumnInfo(i,e);this._updateSortIndicator(a,t,this._isMobileTable)}this._adaptAdditionalProperties(a)},this)}};Dt.prototype.setUseInfoToolbar=function(t){this.setProperty("useInfoToolbar",t,true);if(this.getTable()){this._createInfoToolbar()}return this};Dt.prototype._updateInfoToolbar=function(t,e){if(!this._oInfoToolbar){this._oInfoToolbar=new _({active:true,visible:true,design:It.Info,content:[new f({id:this.getId()+"-infoToolbarText",text:t,wrapping:false})],press:[e,this._handleInfoToolbarPress,this]})}else{this._oInfoToolbar.setVisible(true);this._oInfoToolbar.getContent()[0].setText(t);this._oInfoToolbar.detachPress(this._handleInfoToolbarPress,this);this._oInfoToolbar.attachPress(e,this._handleInfoToolbarPress,this)}};Dt.prototype._handleInfoToolbarPress=function(t,e){this._showTableFilterDialog(e)};Dt.prototype._createInfoToolbar=function(){var t=this.getUseInfoToolbar(),e=this.getTable(),o=this.getId()+"-infoToolbarText",n,r=i.getLibraryResourceBundle("sap.ui.comp");if(t===xt.Off){if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);e.removeAriaLabelledBy(o)}return}if(this._isMobileTable){if(e.getInfoToolbar()&&!this._oInfoToolbar){z.error("Custom infoToolbar is used, hence set useInfoToolbar property on the SmartTable with id='"+this.getId()+"' to Off");return}var s=this._oCurrentVariant&&this._oCurrentVariant.filter&&this._oCurrentVariant.filter.filterItems,l=s&&s.length;if(l){var u=[],h=a.getInstance();s.forEach(function(t){var e=this._getColumnLabel(t.columnKey);if(e&&u.indexOf(e)===-1){u.push(e)}},this);var d=r.getText("SMARTTABLE_INFOTOOLBAR_FILTER"+(u.length>1?"S":"")+"_ACTIVE",[u.length,h.format(u)]);n=this._getColumnByKey(s[0].columnKey);this._updateInfoToolbar(d,n);if(!e.getInfoToolbar()){e.setInfoToolbar(this._oInfoToolbar)}if(e.getAriaLabelledBy().indexOf(o)===-1){e.addAriaLabelledBy(o)}}else if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);e.removeAriaLabelledBy(o)}}else if(this._oInfoToolbar){this._oInfoToolbar.setVisible(false)}};Dt.prototype._getChangeStatus=function(t){if(!t){return"ModelChanged"}if(t.sort==="ModelChanged"||t.filter==="ModelChanged"||t.columns==="ModelChanged"||t.group==="ModelChanged"){return"ModelChanged"}if(t.sort==="TableChanged"||t.filter==="TableChanged"||t.columns==="TableChanged"||t.group==="TableChanged"){return"TableChanged"}return"Unchanged"};Dt.prototype._getDateFormatSettings=function(){if(this._oTableProvider&&this._oTableProvider._oDateFormatSettings){return this._oTableProvider._oDateFormatSettings}return undefined};Dt.prototype._getTablePersonalisationData=function(){this._mSelectExpandForGroup=null;if(!this._oCurrentVariant){return null}var t=[],e=[],i=[],o,a,n,l,u,h,d,p,f,g,_={},c={},m="",b;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){a=this._oCurrentVariant.group.groupItems[0];if(this._aDeactivatedColumns.indexOf(a.columnKey)<0){u=this._getColumnByKey(a.columnKey);if(u){m=u.getHeader().getText()}g=this._getPathFromColumnKeyAndProperty(a.columnKey,"sortProperty")}if(g){d=g;p=null;var T=this._mFieldMetadataByKey[a.columnKey],y;if(T){p=T.unit||T.description;var C=this.getModel(),S=C&&C.getMetaModel();y=R.getInlineGroupFormatterFunction(T,false,this._getDateFormatSettings(),this._bPreserveDecimals,true,S)}n=new I(d,a.operation==="GroupDescending",function(t){var e=t.getProperty(d),i;if(y){if(p){i=t.getProperty(p)}e=y(e,i)}if(e===undefined||e===null){e=""}return{key:e,text:m?m+": "+e:e}});this._mSelectExpandForGroup={select:[d]};if(T){if(T.additionalProperty){this._mSelectExpandForGroup.select.push(T.additionalProperty)}if(T.navigationProperty){this._mSelectExpandForGroup.expand=[T.navigationProperty]}}t.push(n)}}if(this._oCurrentVariant.sort){l=this._oCurrentVariant.sort.sortItems}else{l=this._aInitialSorters}if(l){l.forEach(function(e,i){var o=e.operation==="Descending";g=null;f=null;if(this._aDeactivatedColumns.indexOf(e.columnKey)<0){g=this._getPathFromColumnKeyAndProperty(e.columnKey,"sortProperty");if(!g&&e.initiallyNotVisibleColumn){g=e.columnKey}}if(g){if(n&&n.sPath===g){n.bDescending=o}else{var a=this._mFieldMetadataByKey[g];if(!a){u=this._getColumnByKey(e.columnKey);h=u.data("p13nData")}if(this._bMultiUnitBehaviorEnabled&&(a&&a.isCurrencyField||h&&h.isCurrency)){f=a?a.unit:h.unit;var r=this._mFieldMetadataByKey[f];var s,l;if(!r){s=this._getColumnByKey(f);l=s&&s.data("p13nData")}if(f&&(r&&r.sortable||l&&l.sortProperty===f||s&&s.getSortProperty&&s.getSortProperty()===f)&&!_[f]){_[f]={index:i,descending:o}}}c[g]={};if(c[f]){delete _[f]}else if(_[g]){delete _[g]}t.push(new I(g,o))}}},this);var v=Object.keys(_),P;if(v.length){v.reverse().forEach(function(e){P=n?_[e].index+1:_[e].index;t.splice(P,0,new I(e,_[e].descending))})}}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(t){var o=t.value1,a=t.value2,n;g=null;b=false;u=null;if(this._aDeactivatedColumns.indexOf(t.columnKey)<0){u=this._getColumnByKey(t.columnKey)}if(u){if(u.getFilterProperty){g=u.getFilterProperty()}h=u.data("p13nData");if(h){b=h.type==="time";if(!g){g=h["filterProperty"]}}}if(g){if(b){if(o instanceof Date){o=R.getEdmTimeFromDate(o)}if(a instanceof Date){a=R.getEdmTimeFromDate(a)}}else{var l=h&&h.typeInstance&&h.typeInstance.getName()==="sap.ui.model.odata.type.DateTimeOffset";if(o instanceof Date&&!l&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){o=r.localToUtc(o);a=a?r.localToUtc(a):a}}var d=t.exclude?i:e;if(t.operation==="Empty"){var p=t.exclude?M.NE:M.EQ,f=false,_=false,c=this._oTableProvider&&this._oTableProvider.getFieldMetadata(g);if(h.nullable===true||h.nullable==="true"){_=true}else if(h.nullable===undefined&&c&&c.nullable!=="false"){_=true}if(h.edmType==="Edm.String"||h.type==="string"){f=true}else if(!h.edmType&&!h.type&&c&&c.type==="Edm.String"){f=true}if(f){d.push(new E(g,p,""))}if(_){d.push(new E(g,p,null))}}else{n=t.exclude?s.getTransformedExcludeOperation(t.operation):t.operation;d.push(new E(g,n,o,a))}}},this);if(i.length){o=new E(i,true)}}return{filters:e,excludeFilters:o,sorters:t}};Dt.prototype._getColumnByKey=function(t){var e,i,o,a,n;if(this._oTable){e=this._oTable.getColumns();o=e.length;for(a=0;a<o;a++){i=e[a];n=i.data("p13nData");if(n&&n.columnKey===t){return i}}}return null};Dt.prototype._getColumnFromP13nMap=function(t){if(!this._oPersController||!this._oPersController._oColumnHelper){return}var e=this._oPersController._oColumnHelper.getColumnMap();var i=null;for(var o in e){if(o===t){i=e[o];break}else if(e[o].getLeadingProperty&&e[o].getLeadingProperty()===t){i=e[o];break}else if(e[o].data("p13nData").leadingProperty===t){i=e[o];break}}return i};Dt.prototype._getPathFromColumnKeyAndProperty=function(t,e){var i=null,o,a;o=this._getColumnByKey(t);if(o){if(e=="sortProperty"&&o.getSortProperty){i=o.getSortProperty()}else if(e=="filterProperty"&&o.getFilterProperty){i=o.getFilterProperty()}else if(e=="leadingProperty"&&o.getLeadingProperty){i=o.getLeadingProperty()}if(!i){a=o.data("p13nData");if(a){i=a[e]}}}return i};Dt.prototype._persistPersonalisation=function(){var t="Personalisation";if(!i.getConfiguration().getDesignMode()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var e=this._oVariantManagement.getViewIdByName(t);if(e===null){e=this.getCurrentVariantId()}if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:t,implicit:true,global:false,overwrite:!!e,key:e,def:true});delete this._bSaving}}};Dt.prototype.getCurrentVariantId=function(){return this._oVariantManagement?this._oVariantManagement.getCurrentVariantId():""};Dt.prototype.setCurrentVariantId=function(t){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(t)}else{z.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist, or is a page variant")}return this};Dt.prototype.setDetailsButtonSetting=function(t){this.setProperty("detailsButtonSetting",t,true);return this};Dt.prototype.setEnablePaste=function(t){this.setProperty("enablePaste",t,true);var e=i.byId(this.getId()+"-btnPaste");if(e){e.setEnabled(this.getEnablePaste())}return this};Dt.prototype.isInitialised=function(){return!!this.bIsInitialised};Dt.prototype._aAvailablePanels=["Columns","Sort","Filter","Group"];Dt.prototype.openPersonalisationDialog=function(t){if(!t||this._aAvailablePanels.indexOf(t)<0){z.warning("sap.ui.comp.smarttable.SmartTable.prototype.openPersonalisationDialog: "+t+" is not a valid panel!");return}if(this._oPersController){var e={};e[t.toLowerCase()]={visible:true};this._oPersController.openDialog(e)}};Dt.prototype.deactivateColumns=function(t){this._aDeactivatedColumns=t||[];this._bDeactivatingColumns=true;if(this._oPersController){this._oPersController.addToSettingIgnoreColumnKeys(this._aDeactivatedColumns)}this._bDeactivatingColumns=false};Dt.prototype.getDeactivatedColumns=function(){return this._aDeactivatedColumns?this._aDeactivatedColumns.slice():[]};Dt.prototype._onInnerTablePaste=function(t){if(!this.getEnablePaste()||!this.hasListeners("beforePaste")&&!this.hasListeners("paste")){return}var e=t.getParameter("data");var i=e.slice(0);var o=this._getColumnInfoForPaste();if(this.fireBeforePaste({columnInfos:o})){sap.ui.require(["sap/ui/core/util/PasteHelper"],function(t){t.parse(i,o).then(function(t){this.firePaste({result:t})}.bind(this))}.bind(this))}};Dt.prototype._getColumnInfoForPaste=function(){var t=[],e=[],i=this._oTable.getColumns(),o,a=i.length,n,r,s,l,u,h;if(this._isMobileTable&&i.length){i=i.sort(function(t,e){return t.getOrder()-e.getOrder()})}for(o=0;o<a;o++){n=i[o];s=null;h=null;u=null;if(n.getVisible()){r=n.data("p13nData");s=this._getColumnLeadingProperty(n,r);l=r.type==="numeric"?"number":r.type;if(r.type==="date"){var d=this._getDateFormatSettings();if(d&&d["UTC"]){var p={displayFormat:"Date"};u=H.getType("Edm.DateTime",d,p)}}if(!u){u=r["typeInstance"]}if(r.isCurrency||l==="number"){h=r.unit}else if(r.description&&r.displayBehaviour!=="idOnly"){h=r.description}}var f={columnId:n.getId(),property:s,ignore:!s,type:u};if(s){t.push(f)}else{e.push(f)}u=H.getType("Edm.String");if(h){t.push({columnId:n.getId(),additionalProperty:true,property:h,type:u})}}return t.concat(e)};Dt.prototype._getSemanticObjectBindingPaths=function(t){if(!t||!t.length){return t}var e=[];t.forEach(function(i){var o=this._aTableViewMetadata&&this._aTableViewMetadata.find(function(t){return t.name==i});if(o&&o.semanticObjectPath){if(!t.includes(o.semanticObjectPath)){e.push(o.semanticObjectPath)}}},this);return t.concat(e)};Dt.prototype.exit=function(){var t,e;this.detachEvent("_change",this._onPropertyChange,this);if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindTable,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);this._oSmartFilter=null}if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy()}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy()}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy()}}this._oNumberFormatInstance=null;O.cleanUpFullScreen(this);if(this._oEditModel){this._oEditModel.destroy()}if(this._oNoData&&this._oNoData.destroy){this._oNoData.destroy()}this.oNoData=null;if(this._aTableViewMetadata){t=this._aTableViewMetadata.length;while(t--){e=this._aTableViewMetadata[t];if(e&&!e.isColumnCreated&&e.template){e.template.destroy()}}}if(this._oShowHideDetailsButton){this._oShowHideDetailsButton.destroy()}this._oShowHideDetailsButton=null;this._aTableViewMetadata=null;this._mFieldMetadataByKey=null;this._mSelectExpandForGroup=null;this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aExistingColumns=null;this._mLazyColumnMap=null;this._aColumnKeys=null;this._aDeactivatedColumns=null;this._aAlwaysSelect=null;this._oCustomToolbar=null;if(this._oToolbar&&!this._bToolbarInsertedIntoItems){this._oToolbar.destroy()}this._oToolbar=null;if(this._oExportButton){this._oExportButton.destroy()}this._oExportButton=null;if(this._oExportHandler){this._oExportHandler.destroy()}this._oExportHandler=null;this._oTablePersonalisationButton=null;this._oP13nDialogSettings=null;if(this._oTemplate){this._oTemplate.destroy()}this._oTemplate=null;if(this._oColumnHeaderPopover){this._oColumnHeaderPopover.destroy()}this._oColumnHeaderPopover=null;this._bMissingColumnsCreated=null;this._oFilterButton=null;this._aSortButton=null;this._oInfoToolbar=null;this._oTableReady=null;this._oView=null;this._oTable=null};return Dt});