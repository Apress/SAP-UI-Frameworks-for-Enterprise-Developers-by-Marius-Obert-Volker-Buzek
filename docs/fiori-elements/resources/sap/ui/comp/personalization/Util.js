/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/m/library","sap/base/util/deepExtend","sap/ui/core/Configuration"],function(e,t,r,n){"use strict";var a=e.personalization.ChangeType;var i=e.personalization.AggregationRole;var o=e.personalization.TableType;var u=e.personalization.ColumnType;var s={getColumnKeys:function(e){if(!e||!e.length){return[]}return e.map(function(e){return this.getColumnKey(e)},this)},sortItemsByText:function(e,t){var r;try{var r=n.getLocale().toString();if(typeof window.Intl!=="undefined"){var a=window.Intl.Collator(r,{numeric:true});e.sort(function(e,r){return a.compare(e[t],r[t])})}else{e.sort(function(e,n){return e[t].localeCompare(n[t],r,{numeric:true})})}}catch(e){}},getUnionOfAttribute:function(e,t){var r=[];var n=function(e){if(r.indexOf(e)<0){r.push(e)}};for(var a in e){var i=e[a];if(!i[t]){continue}i[t].forEach(n)}return r},getUnionOfColumnKeys:function(e){var t=[];var r=function(e){t=t.concat(e.map(function(e){return e.columnKey}));t=t.filter(function(e,r){return t.indexOf(e)===r})};for(var n in e){for(var a in e[n]){if(!Array.isArray(e[n][a])){continue}r(e[n][a])}}return t},copy:function(e){if(e instanceof Array){return r([],e)}else{return r({},e)}},sort:function(e,t){var r=this.copy(t);r.sort(function(t,r){var n=t[e].toLocaleLowerCase();var a=r[e].toLocaleLowerCase();if(n<a){return-1}if(n>a){return 1}return 0});return r},removeEmptyProperty:function(e){for(var t in e){if(e[t]===null||e[t]===undefined){delete e[t]}}return e},semanticEqual:function(e,t){if(!e||!t){return false}for(var r in e){if(e[r]!==t[r]){return false}}return true},hasChangedType:function(e){for(var t in e){if(e[t]===a.ModelChanged||e[t]===a.TableChanged){return true}}return false},isNamespaceChanged:function(e,t){if(e[t]){return e[t]===a.ModelChanged||e[t]===a.TableChanged}return false},createArrayFromString:function(e){if(!e){return[]}var t=[];var r=e.split(",");r.forEach(function(e){if(e!==""){t.push(e.trim())}});return t},getIndexByKey:function(e,t,r){if(!r||!r.length){return-1}var n=-1;r.some(function(r,a){if(r[e]!==undefined&&r[e]===t){n=a;return true}});return n},getColumnKey:function(e){return this._getCustomProperty(e,"columnKey")||e.getId()},getColumnType:function(e){return this._getCustomProperty(e,"type")},hasSortableColumns:function(e){for(var t in e){if(s.isSortable(e[t])){return true}}return false},hasGroupableColumns:function(e){for(var t in e){if(s.isGroupable(e[t])){return true}}return false},hasFilterableColumns:function(e){for(var t in e){if(s.isFilterable(e[t])){return true}}return false},hasAggregatableColumns:function(e){for(var t in e){if(s.isAggregatable(e[t])){return true}}return false},isGroupable:function(e){if(e&&e.isA("sap.ui.table.AnalyticalColumn")){return e.isGroupableByMenu()||this._getCustomProperty(e,"isGroupable")}if(e&&e.isA("sap.m.Column")){return this.isSortable(e)}return false},isSortable:function(e){if(e.getSortProperty){return!!e.getSortProperty()}return!!this._getCustomProperty(e,"sortProperty")},isFilterable:function(e){if(e.getFilterProperty){return!!e.getFilterProperty()}return!!this._getCustomProperty(e,"filterProperty")},isAggregatable:function(e){if(e.getAggregationRole){return e.getAggregationRole()===i.Dimension||e.getAggregationRole()===i.Measure}return false},getArrayElementByKey:function(e,t,r){if(!r||!r.length){return null}var n=null;r.some(function(r){if(r[e]!==undefined&&r[e]===t){n=r;return true}});return n},isColumnIgnored:function(e,t){if(!t){return false}return t.indexOf(this.getColumnKey(e))>-1},createSort2Json:function(e,t,r,n){if(this.getTableBaseType(e)!==o.Table&&this.getTableType(e)!==o.ChartWrapper){return}this.addSortPersistentData(this._mapTable2P13nSortJson(e),{sort:{sortItems:t}},r,n)},addSortPersistentData:function(e,t,r,n){var a=[];e.sort.sortItems.forEach(function(e){if(!e.isSorted||r.indexOf(e.columnKey)>-1){return}t.sort.sortItems.push({columnKey:e.columnKey,operation:e.operation});a.push(e.columnKey)});if(n){n.forEach(function(e){if(a.indexOf(e.name)>-1||!e.sorted){return}t.sort.sortItems.push({columnKey:e.name,operation:e.sortOrder,initiallyNotVisibleColumn:true})})}},_mapTable2P13nSortJson:function(e){return{sort:{sortItems:e.getColumns().map(function(e){return{columnKey:s.getColumnKey(e),isSorted:e.getSorted(),operation:e.getSortOrder()}})}}},getTableType:function(e){switch(e&&e.getMetadata().getName()){case"sap.ui.comp.personalization.ChartWrapper":return o.ChartWrapper;case"sap.ui.comp.personalization.SelectionWrapper":return o.SelectionWrapper;case"sap.m.Table":return o.ResponsiveTable;case"sap.ui.table.AnalyticalTable":return o.AnalyticalTable;case"sap.ui.table.TreeTable":return o.TreeTable;case"sap.ui.table.Table":return o.Table}return null},getTableBaseType:function(e){switch(this.getTableType(e)){case o.ChartWrapper:return o.ChartWrapper;case o.SelectionWrapper:return o.SelectionWrapper;case o.ResponsiveTable:return o.ResponsiveTable;case o.AnalyticalTable:case o.Table:case o.TreeTable:return o.Table}return null},getColumnBaseType:function(e){switch(e&&e.getMetadata().getName()){case"sap.ui.comp.personalization.ColumnWrapper":return u.ColumnWrapper;case"sap.m.Column":return u.ResponsiveColumn;case"sap.ui.table.AnalyticalColumn":case"sap.ui.table.Column":return u.TableColumn}return null},_getCustomProperty:function(e,t){var r=this._getCustomData(e);if(!r||!t){return null}return r[t]},_getCustomData:function(e){if(!e){return null}var t=e.data("p13nData");if(typeof t==="string"){try{t=JSON.parse(t);e.data("p13nData",t)}catch(e){}}return t},getColumnKeysOfType:function(e,t){var r=[];for(var n in t){if(this.getColumnType(t[n])===e){r.push(n)}}return r},convertFilters:function(e,t){if(e&&e.filter&&e.filter.filterItems){var r=this.getColumnKeysOfType("date",t);var n=this.getColumnKeysOfType("time",t);var a=this.getColumnKeysOfType("datetime",t);e.filter.filterItems.forEach(function(e){var i=t&&t[e.columnKey];if(r.indexOf(e.columnKey)>-1||n.indexOf(e.columnKey)>-1||a.indexOf(e.columnKey)>-1){if(i&&i.data("p13nData")&&i.data("p13nData").edmType==="Edm.String"){return}if(e.value1&&typeof e.value1==="string"){e.value1=new Date(e.value1)}if(e.value2&&typeof e.value2==="string"){e.value2=new Date(e.value2)}}})}},convertSelectOptions:function(e,t){if(e&&e.SelectOptions){var r=this.getColumnKeysOfType("date",t);var n=this.getColumnKeysOfType("time",t);var a=this.getColumnKeysOfType("datetime",t);e.SelectOptions.forEach(function(e){e.Ranges.forEach(function(t){if(r.indexOf(e.PropertyName)>-1||n.indexOf(e.PropertyName)>-1||a.indexOf(e.PropertyName)>-1){if(t.Low&&typeof t.Low==="string"){t.Low=new Date(t.Low)}if(t.High&&typeof t.High==="string"){t.High=new Date(t.High)}}})})}}};return s},true);