/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["./BaseController","sap/m/library","sap/ui/comp/library","./Util"],function(e,t,n,i){"use strict";var o=e.extend("sap.ui.comp.personalization.SelectionController",{constructor:function(n,i){e.apply(this,arguments);this.setType(t.P13nPanelType.selection);this.setItemType(t.P13nPanelType.selection+"Items")},metadata:{events:{afterSelectionModelDataChange:{}}}});o.prototype.getColumn2Json=function(e,t,n){return{columnKey:t,text:e.getLabel(),visible:e.getSelected()}};o.prototype.getColumn2JsonTransient=function(e,t,n,i){return{columnKey:t,text:n,href:e.getHref(),internalHref:e.getInternalHref(),target:e.getTarget(),press:e.getPress(),description:e.getDescription()}};o.prototype.syncJson2Table=function(e){this.fireBeforePotentialTableChange();this.fireAfterPotentialTableChange()};o.prototype.getPanel=function(e){return new Promise(function(e){sap.ui.require(["sap/m/P13nSelectionPanel","sap/m/P13nItem","sap/m/P13nSelectionItem"],function(t,n,i){return e(new t({titleLarge:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_SELECTION_TITLE"),items:{path:"$sapmP13nPanel>/transientData/selection/selectionItems",template:new n({columnKey:"{$sapmP13nPanel>columnKey}",href:"{$sapmP13nPanel>href}",target:"{$sapmP13nPanel>target}",text:"{$sapmP13nPanel>text}",press:"{$sapmP13nPanel>press}"})},selectionItems:{path:"$sapmP13nPanel>/controlDataReduce/selection/selectionItems",template:new i({columnKey:"{$sapmP13nPanel>columnKey}",selected:"{$sapmP13nPanel>visible}"})},beforeNavigationTo:this.setModelFunction(),changeSelectionItems:function(e){if(!e.getParameter("items")){return}var t=this.getControlDataReduce();t.selection.selectionItems=e.getParameter("items").map(function(e){return{columnKey:e.columnKey,visible:e.selected}});this.setControlDataReduce2Model(t);this.fireAfterPotentialModelChange({json:t})}.bind(this)}))}.bind(this))}.bind(this))};o.prototype.retrieveAdaptationUI=function(e){return new Promise(function(e){sap.ui.require(["sap/ui/mdc/p13n/panels/LinkSelectionPanel"],function(t){var n=this.getAdaptationData();var i=new t({showHeader:true,enableCount:true,fieldColumn:sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("info.SELECTION_DIALOG_COLUMNHEADER_WITHOUT_COUNT"),linkPressed:this.getTable().getPress(),enableReorder:false});i.setP13nData(n);i._oListControl.setMultiSelectMode("Default");this.oPanel=i;var o;i.attachChange(function(e){var t=this.getControlDataReduce();o=e.getSource().getP13nData().map(function(e,t){return{columnKey:e.name,visible:e.visible}});t.selection.selectionItems=o;this.setControlDataReduce2Model(t);this.fireAfterPotentialModelChange({json:t})}.bind(this));e(i)}.bind(this))}.bind(this))};o.prototype._transformAdaptationData=function(t,n){var i=e.prototype._transformAdaptationData.apply(this,arguments);i.text=n.text;i.href=n.href;i.internalHref=n.internalHref?n.internalHref:undefined;i.visible=t.visible;i.description=n.description;i.label=n.name;return i};o.prototype.getChangeType=function(e,t){return this.getChangeData(e,t)?n.personalization.ChangeType.ModelChanged:n.personalization.ChangeType.Unchanged};o.prototype.getChangeData=function(e,t){if(!t||!t.selection||!t.selection.selectionItems){return null}var n={selection:i.copy(e.selection)};if(this._isSemanticEqual(e,t)){return null}var o=[];n.selection.selectionItems.forEach(function(e){var n=i.getArrayElementByKey("columnKey",e.columnKey,t.selection.selectionItems);if(i.semanticEqual(e,n)){o.push(e);return}for(var s in e){if(s==="columnKey"||!n){continue}if(e[s]===n[s]){delete e[s]}}if(Object.keys(e).length<2){o.push(e)}});o.forEach(function(e){var t=i.getIndexByKey("columnKey",e.columnKey,n.selection.selectionItems);n.selection.selectionItems.splice(t,1)});return n};o.prototype.getUnionData=function(e,t){var n=i.copy(e);if(!t||!t.selection||!t.selection.selectionItems){return n.selection?{selection:i.copy(n.selection)}:null}if(!n||!n.selection||!n.selection.selectionItems){return{selection:i.copy(t.selection)}}var o=this.createControlDataStructure();n.selection.selectionItems.forEach(function(e){var n=i.getArrayElementByKey("columnKey",e.columnKey,t.selection.selectionItems);if(n){if(n.visible!==undefined){e.visible=n.visible}}o.selection.selectionItems.push(e)});return o};o.prototype._isSemanticEqual=function(e,t){var n=function(e,t){if(e.visible===true&&(t.visible===false||t.visible===undefined)){return-1}else if((e.visible===false||e.visible===undefined)&&t.visible===true){return 1}else if(e.visible===true&&t.visible===true){return 0}else if((e.visible===false||e.visible===undefined)&&(t.visible===false||t.visible===undefined)){if(e.columnKey<t.columnKey){return-1}else if(e.columnKey>t.columnKey){return 1}else{return 0}}};var o=i.copy(e.selection.selectionItems).sort(n);var s=i.copy(t.selection.selectionItems).sort(n);return!o.some(function(e,t){if(!i.semanticEqual(e,s[t])){return true}})};o.prototype.getResetWarningText=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc").getText("info.SELECTION_DIALOG_RESET_WARNING")};return o});