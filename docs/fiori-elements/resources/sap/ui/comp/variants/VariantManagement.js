/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/core/library","sap/m/library","sap/m/VBox","sap/m/SearchField","sap/m/ToggleButton","sap/m/RadioButton","sap/m/Column","sap/m/Text","sap/m/Bar","sap/m/Table","sap/m/Page","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Button","sap/m/CheckBox","sap/m/Dialog","sap/m/Input","sap/m/Title","sap/m/Label","sap/m/ResponsivePopover","sap/m/SelectList","sap/m/ObjectIdentifier","sap/ui/comp/library","./EditableVariantItem","./VariantItem","sap/ui/core/InvisibleText","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/Item","sap/ui/layout/HorizontalLayout","sap/ui/layout/Grid","sap/ui/events/KeyCodes"],function(e,t,a,i,n,s,r,o,l,h,d,u,g,c,p,f,y,m,S,v,V,T,_,A,I,M,E,N,b,C,x,D,R,O,K,L){"use strict";var w=a.VerticalAlign;var P=a.ValueState;var F=i.ButtonType;var B=i.PlacementType;var U=i.PopinDisplay;var k=i.ScreenSize;var G=a.TextAlign;var H=a.TitleLevel;var W=i.OverflowToolbarPriority;var z=i.FlexAlignItems;var Y=x.extend("sap.ui.comp.variants.VariantManagement",{metadata:{interfaces:["sap.m.IOverflowToolbarContent"],library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/variants/VariantManagement.designtime",properties:{initialSelectionKey:{type:"string",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Misc",defaultValue:true},defaultVariantKey:{type:"string",group:"Misc",defaultValue:null},selectionKey:{type:"string",group:"Misc",defaultValue:null},showCreateTile:{type:"boolean",group:"Misc",defaultValue:false},showExecuteOnSelection:{type:"boolean",group:"Misc",defaultValue:false},showShare:{type:"boolean",group:"Misc",defaultValue:false},showSetAsDefault:{type:"boolean",group:"Misc",defaultValue:true},lifecycleSupport:{type:"boolean",group:"Misc",defaultValue:false},standardItemText:{type:"string",group:"Misc",defaultValue:null},useFavorites:{type:"boolean",group:"Misc",defaultValue:false},inErrorState:{type:"boolean",group:"Misc",defaultValue:false},variantCreationByUserAllowed:{type:"boolean",group:"Misc",defaultValue:true},standardItemAuthor:{type:"string",group:"Misc",defaultValue:"SAP"}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.core.Item",multiple:true,singularName:"item",deprecated:true},variantItems:{type:"sap.ui.comp.variants.VariantItem",multiple:true,singularName:"variantItem"}},events:{save:{parameters:{name:{type:"string"},overwrite:{type:"boolean"},key:{type:"string"},exe:{type:"boolean"},def:{type:"boolean"},global:{type:"boolean"},lifecyclePackage:{type:"string"},lifecycleTransportId:{type:"string"}}},manage:{parameters:{renamed:{type:"object[]"},deleted:{type:"string[]"},exe:{type:"object[]"},def:{type:"string"}}},select:{parameters:{key:{type:"string"}}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapUiCompVarMngmt");e.openEnd();e.renderControl(t.oVariantLayout);e.close("div")}}});Y.STANDARD_NAME=E.STANDARD_VARIANT_NAME;Y.MAX_NAME_LEN=100;Y.FAV_COLUMN=0;Y.NAME_COLUMN=1;Y.SHARE_COLUMN=2;Y.DEF_COLUMN=3;Y.EXEC_COLUMN=4;Y.RESTRICT_COLUMN=5;Y.AUTHOR_COLUMN=6;Y.prototype.init=function(){var a=this;this.STANDARDVARIANTKEY="*standard*";this.setStandardVariantKey(this.STANDARDVARIANTKEY);this.aRemovedVariants=[];this.aRenamedVariants=[];this.aRemovedVariantTransports=[];this.aExeVariants=[];this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.lastSelectedVariantKey=this._sStandardVariantKey;this.bVariantItemMode=false;this.oSelectedItem=null;this.sNewDefaultKey="";this.bManagementTableInitialized=false;this.sTransport=null;this.sPackage=null;this.aEvents=[];this.bEventRunning=false;this.oVariantSelectionPage=null;this.bManualVariantKey=false;this.bFireSelect=false;this.bExecuteOnSelectForStandardViaXML=false;this.bExecuteOnSelectForStandardByUser=null;this.bSupportExecuteOnSelectOnSandardVariant=false;this._bInnerControlsCreated=false;this._bIndustrialSolutionMode=false;this._bVendorLayer=false;this.oModel=new t({enabled:false,selectedVariant:"",creationAllowed:true,saveVariantVisible:true});this.setModel(this.oModel,"save_enablement");this.oVariantInvisbletext=new C({text:{parts:[{path:"save_enablement>/selectedVariant"},{path:"save_enablement>/enabled"}],formatter:function(e,t){if(t){e=a.oResourceBundle.getText("VARIANT_MANAGEMENT_SEL_VARIANT_MOD",[e])}else{e=a.oResourceBundle.getText("VARIANT_MANAGEMENT_SEL_VARIANT",[e])}return e}}});this.oVariantText=new T(this.getId()+"-text",{text:"{save_enablement>/selectedVariant}"});this._setStandardText();this.oVariantText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantText.addStyleClass("sapUICompVarMngmtTitle");this.oVariantText.addStyleClass("sapMTitleStyleH4");if(e.system.phone){this.oVariantText.addStyleClass("sapUICompVarMngmtTextPhoneMaxWidth")}else{this.oVariantText.addStyleClass("sapUICompVarMngmtTextMaxWidth")}this.oVariantModifiedText=new h(this.getId()+"-modified",{visible:"{save_enablement>/enabled}"});this.oVariantModifiedText.setText("*");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtModified");this.oVariantPopoverTrigger=new r(this.getId()+"-trigger",{icon:"sap-icon://slim-arrow-down",type:F.Transparent,tooltip:this.oResourceBundle.getText("VARIANT_MANAGEMENT_TRIGGER_TT")});this.oVariantPopoverTrigger.addAriaLabelledBy(this.oVariantInvisbletext);this.oVariantPopoverTrigger.addStyleClass("sapUICompVarMngmtClickable");this.oVariantLayout=new O({content:[this.oVariantText,this.oVariantModifiedText,this.oVariantPopoverTrigger]});this.oVariantLayout.addStyleClass("sapUICompVarMngmtLayout");this.oVariantInvisbletext.setModel(this.oModel,"save_enablement");this.oVariantInvisbletext.toStatic();this.addDependent(this.oVariantLayout)};Y.prototype.getOverflowToolbarConfig=function(){var e={canOverflow:false,invalidationEvents:["save","manage","select"]};return e};Y.prototype._columnVisibilityManagementTable=function(e,t){if(!this.bManagementTableInitialized){return}if(this.oManagementTable){var a=this.oManagementTable.getColumns();if(a&&a.length>=e){a[e].setVisible(t)}}};Y.prototype.setVariantCreationByUserAllowed=function(e){this.setProperty("variantCreationByUserAllowed",e);this.oModel.setProperty("/creationAllowed",e);return this};Y.prototype.setUseFavorites=function(e){this.setProperty("useFavorites",e);this._columnVisibilityManagementTable(Y.FAV_COLUMN,e);return this};Y.prototype.setShowShare=function(e){this.setProperty("showShare",e);this._columnVisibilityManagementTable(Y.SHARE_COLUMN,e);return this};Y.prototype.setShowSetAsDefault=function(e){this.setProperty("showSetAsDefault",e);this._columnVisibilityManagementTable(Y.DEF_COLUMN,e);return this};Y.prototype.setShowExecuteOnSelection=function(e){this.setProperty("showExecuteOnSelection",e);this._columnVisibilityManagementTable(Y.EXEC_COLUMN,e);return this};Y.prototype.setStandardItemText=function(e){this.setProperty("standardItemText",e);var t=this._getSelectedItem();if(!t||t.getKey()===this.getStandardVariantKey()){this.oModel.setProperty("/selectedVariant",e)}return this};Y.prototype._triggerSave=function(){var e=this._createEvent("variantSaveAs",this._handleVariantSaveAs);this._addEvent(e)};Y.prototype._checkNameValidity=function(e,t){var a=false;if(t&&this._getVariantNamesAndKeys){var i=this._getVariantNamesAndKeys();var n=t.getItems();n.forEach(function(e){var t=e.getCells()[Y.NAME_COLUMN];var n=e.getKey();if(t.getValue&&i.hasOwnProperty(t.getValue())&&i[t.getValue()]!==n){t.setValueState(P.Error);t.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_DUPLICATE"));a=true}}.bind(this))}return a};Y.prototype._checkVariantNameConstraints=function(e,t){var a;if(!e){return}a=e.getValue().trim();if(!this._checkIsDuplicate(e,a,this.oManagementTable)){if(a===""){e.setValueState(P.Error);e.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"))}else if(a.indexOf("{")>-1){e.setValueState(P.Error);e.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_NOT_ALLOWED_CHAR",["{"]))}else if(a.length>Y.MAX_NAME_LEN){e.setValueState(P.Error);e.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_MAX_LEN",[Y.MAX_NAME_LEN]))}else{e.setValueState(P.None);e.setValueStateText(null)}}if(e.getValueState()!==P.Error){this._checkIsDuplicate(e,a,t)}if(t&&this._getVariantNamesAndKeys){this._checkNameValidity(a,t)}};Y.prototype._focusOnFirstFilterInError=function(e){e.getDomRef().scrollIntoView()};Y.prototype._anyItemInErrorState=function(){var e,t,a;if(this.oManagementTable){e=this.oManagementTable.getItems();if(e){for(a=0;a<e.length;a++){t=e[a].getCells()[Y.NAME_COLUMN];if(t&&t.getValueState&&t.getValueState()===P.Error){this._checkVariantNameConstraints(t,this.oManagementTable);if(t.getValueState()===P.Error){this._focusOnFirstFilterInError(t);return true}}}for(a=0;a<e.length;a++){t=e[a].getCells()[Y.NAME_COLUMN];if(t&&t.isA("sap.m.Input")){this._checkVariantNameConstraints(t,this.oManagementTable);if(t.getValueState()===P.Error){this._focusOnFirstFilterInError(t);return true}}}}}return false};Y.prototype._anyInErrorState=function(e,t){var a,i,n;if(e){a=e.getItems();if(a){for(n=0;n<a.length;n++){i=a[n].getCells()[Y.NAME_COLUMN];if(t&&t===i){continue}if(i&&i.getValueState&&i.getValueState()===P.Error){if(this._checkIsDuplicate(i,i.getValue(),e)){return true}}}}}return false};Y.prototype._checkIsDuplicate=function(e,t,a){var i=this._isDuplicate(e,t,a);if(i){e.setValueState(P.Error);e.setValueStateText(this.oResourceBundle.getText(t?"VARIANT_MANAGEMENT_ERROR_DUPLICATE":"VARIANT_MANAGEMENT_ERROR_EMPTY"))}else{e.setValueState(P.None);e.setValueStateText(null)}return i};Y.prototype._isDuplicate=function(e,t,a){if(a){return this._isDuplicateManaged(e,t,a)}else{return this._isDuplicateSaveAs(t)}};Y.prototype._isDuplicateManaged=function(e,t,a){var i,n,s;if(a){i=a.getItems();if(i&&i.length>0){for(s=0;s<i.length;s++){n=i[s].getCells()[Y.NAME_COLUMN];if(n===e){continue}if(n){if(n.getValue&&t===n.getValue().trim()){return true}else if(n.getText&&t===n.getText().trim()){return true}else if(n.getTitle&&t===n.getTitle().trim()){return true}}}}else{if(this._isIndustrySolutionModeAndVendorLayer()&&this.bManualVariantKey){return false}}}return false};Y.prototype._isDuplicateSaveAs=function(e){var t=e.trim();if(!t){return true}var a=this._determineStandardVariantName();if(a===t){if(this._isIndustrySolutionModeAndVendorLayer()&&this.bManualVariantKey){return false}return true}var i=this._getItems();for(var n=0;n<i.length;n++){a=i[n].getText().trim();if(a===t){return true}}return false};Y.prototype._createSaveDialog=function(){var t=this;if(!this.oSaveDialog){this.oSaveDialog=new v(this.getId()+"-savedialog",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVEDIALOG"),beginButton:this.oSaveSave,endButton:new m(this.getId()+"-variantcancel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){if(t._fGetDataForKeyUser){t._handleSaveAsCancelPressedForKeyUser()}else{t._bSaveCanceled=true;t.oSaveDialog.close()}}}),content:[this.oLabelName,this.oInputName,this.oLabelKey,this.oInputKey,this.oSaveDialogOptionsGrid],stretch:e.system.phone});this.oSaveDialog.setParent(this);this.oSaveDialog.addStyleClass("sapUiContentPadding");this.oSaveDialog.addStyleClass("sapUiCompVarMngmtSaveDialog")}};Y.prototype._createManagementDialog=function(){var t=this;if(!this.oManagementDialog){this.oManagementDialog=new v(this.getId()+"-managementdialog",{contentWidth:"64%",draggable:true,resizable:true,title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_MANAGEDIALOG"),beginButton:this.oManagementSave,endButton:new m(this.getId()+"-managementcancel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){if(t._fGetDataForKeyUser){t._handleManageCancelPressedForKeyUser()}else{t.aRemovedVariants=[];t.oManagementDialog.close()}}}),content:[this.oManagementTable],stretch:e.system.phone,afterClose:function(){if(t.bFireSelect==true){t.bFireSelect=false;t._fireSelectAsync()}}});this.oManagementDialog.setParent(this);var a=new d;this.oManageDialogSearchField=new s;this.oManageDialogSearchField.attachLiveChange(function(e){this._triggerSearchInManageDialog(e)}.bind(this));a.addContentMiddle(this.oManageDialogSearchField);this.oManagementDialog.setSubHeader(a)}};Y.prototype._handleArrowUpDown=function(e,t){var a=null;var i=this;e.attachBrowserEvent("keydown",function(e){if(e.which===38){if(i.oVariantSelectionPage.getShowSubHeader()){a=document.activeElement.id}}});e.attachBrowserEvent("keyup",function(i){if(i.which===38){if(a&&a===document.activeElement.id){var n=e.getItems();if(n&&n.length>0){var s=sap.ui.getCore().byId(a);if(s===n[0]){t.focus()}}}a=null}});t.attachBrowserEvent("keyup",function(t){if(t.which===40){var a=e.getItems();if(a&&a.length>0){a[0].focus()}}})};Y.prototype._triggerSearch=function(e){if(!e){return}var t=e.getParameters();if(!t){return}this._restoreCompleteList();var a=t.newValue?t.newValue:"";this._triggerSearchByValue(a.toLowerCase())};Y.prototype._triggerSearchByValue=function(e){var t,a,i;this.oSelectedVariantItemKey=null;i=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(i&&i.getText().toLowerCase().indexOf(e)<0){if(this.getSelectionKey()===a){this.oSelectedVariantItemKey=a}this.oVariantList.removeItem(i);i.destroy()}var n=this._getItems();for(var s=0;s<n.length;s++){t=n[s].getText();if(t.toLowerCase().indexOf(e)<0){a=n[s].getKey();i=this.oVariantList.getItemByKey(a);if(i){if(this.getSelectionKey()===a){this.oSelectedVariantItemKey=a}this.oVariantList.removeItem(i);i.destroy()}}}};Y.prototype._triggerSearchInManageDialog=function(e){var t,a,i="",n,s;if(!e){return}var r=e.getParameters();if(!r){return}t=r.newValue?r.newValue.toLowerCase():"";if(this.oManagementTable){var o=this.oManagementTable.getItems();o.forEach(function(e){a=true;i="";s=e.getCells();if(s&&s[Y.NAME_COLUMN]){n=s[Y.NAME_COLUMN];if(n.getTitle){i=n.getTitle()}else if(n.getValue){i=n.getValue()}if(i.toLowerCase().indexOf(t)>=0){a=false}}if(a&&s&&s[Y.AUTHOR_COLUMN]){n=s[Y.AUTHOR_COLUMN];if(n.getText){i=n.getText();if(i.toLowerCase().indexOf(t)>=0){a=false}}}e.setVisible(!a)})}};Y.prototype._considerItem=function(e,t){if(this.getUseFavorites()&&!e){if(this._isIndustrySolutionModeAndVendorLayer()){return true}if(t.getFavorite&&t.getFavorite()){return true}return false}return true};Y.prototype._restoreCompleteList=function(e){var t,a,i,n;this.oVariantList.destroyItems();n=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(!n){n=this._createStandardVariantListItem();if(n){if(this._considerItem(e,n)){this.oVariantList.insertItem(n,0)}else{n.destroy()}}}if(n){if(this.oSelectedVariantItemKey){if(this.oSelectedVariantItemKey===n.getKey()){this.oVariantList.setSelectedItem(n);this.oSelectedVariantItemKey=null}}else{if(this.getSelectionKey()==n.getKey()||this.getSelectionKey()===null){this.oVariantList.setSelectedItem(n)}}}i=this._getItems();i.sort(this._compareItems);for(t=0;t<i.length;t++){a=i[t];if(!this._considerItem(e,a)){continue}if(a.getKey()===this.getStandardVariantKey()){continue}n=this.oVariantList.getItemByKey(a.getKey());if(!n){n=this._createVariantListItem(a,t);this.oVariantList.addItem(n)}if(this.oSelectedVariantItemKey){if(this.oSelectedVariantItemKey===n.getKey()){this.oVariantList.setSelectedItem(n);this.oSelectedVariantItemKey=null}}else{if(this.getSelectionKey()==n.getKey()){this.oVariantList.setSelectedItem(n)}}}};Y.prototype._determineStandardVariantName=function(){var e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD");if(this.bVariantItemMode===false){e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT")}if(this.getStandardVariantKey()===this.STANDARDVARIANTKEY){if(this.getStandardItemText()!==null&&this.getStandardItemText()!=""){e=this.getStandardItemText()}}return e};Y.prototype._createStandardVariantListItem=function(){var e,t=null;var a=this._determineStandardVariantName();if(this.bVariantItemMode===true||this.bVariantItemMode===false&&(this.getSelectionKey()===this.getStandardVariantKey()||this.getSelectionKey()===null)){t=new b(this.oVariantPopoverTrigger.getId()+"-item-standard",{key:this.getStandardVariantKey(),readOnly:true,executeOnSelection:this.getExecuteOnSelectForStandardVariant()});t.setText(a);if(this._isIndustrySolutionModeAndVendorLayer()&&this.bVariantItemMode){t.setGlobal(true);t.setReadOnly(false)}if(this.getStandardVariantKey()!==this.STANDARDVARIANTKEY){e=this.getItemByKey(this.getStandardVariantKey());if(e){this._setVariantListItemProperties(e,t);if(e.getFavorite&&!e.getFavorite()&&this.getSelectionKey()===this.getStandardVariantKey()){t.setFavorite(true)}}}else{t.setAuthor(this.getStandardItemAuthor());t.setReadOnly(true);t.setFavorite(this.getStandardFavorite())}}return t};Y.prototype._createVariantListItem=function(e,t){var a=new b(this.oVariantPopoverTrigger.getId()+"-item-"+t,{key:e.getKey(),text:e.getText()});this._setVariantListItemProperties(e,a);return a};Y.prototype._setVariantListItemProperties=function(e,t){if(e.getReadOnly){t.setReadOnly(e.getReadOnly())}if(e.getExecuteOnSelection){t.setExecuteOnSelection(e.getExecuteOnSelection())}if(e.getGlobal){t.setGlobal(e.getGlobal())}if(e.getLifecyclePackage){t.setLifecyclePackage(e.getLifecyclePackage())}if(e.getLifecycleTransportId){t.setLifecycleTransportId(e.getLifecycleTransportId())}if(e.getNamespace){t.setNamespace(e.getNamespace())}if(e.getAccessOptions){t.setAccessOptions(e.getAccessOptions())}if(e.getLabelReadOnly){t.setLabelReadOnly(e.getLabelReadOnly())}if(e.getAuthor){t.setAuthor(e.getAuthor())}if(e.getFavorite){t.setFavorite(e.getFavorite())}if(e.getContexts){t.setContexts(e.getContexts())}};Y.prototype.exit=function(){if(this.oVariantInvisbletext){this.oVariantInvisbletext.destroy(true);this.oVariantInvisbletext=undefined}if(this.oSearchField){this.oSearchField.destroy();this.oSearchField=undefined}if(this.oManageDialogSearchField){this.oManageDialogSearchField.destroy();this.oManageDialogSearchField=undefined}if(this.oVariantManage){this.oVariantManage.destroy();this.oVariantManage=undefined}if(this.oVariantSave){this.oVariantSave.destroy();this.oVariantSave=undefined}if(this.oVariantList){this.oVariantList.destroy();this.oVariantList=undefined}if(this.oInputName){this.oInputName.destroy();this.oInputName=undefined}if(this.oLabelName){this.oLabelName.destroy();this.oLabelName=undefined}if(this.oDefault){this.oDefault.destroy();this.oDefault=undefined}if(this.oSaveSave){this.oSaveSave.destroy();this.oSaveSave=undefined}if(this.oSaveDialog){this.oSaveDialog.destroy();this.oSaveDialog=undefined}if(this.oManagementTable){this.oManagementTable.destroy();this.oManagementTable=undefined}if(this.oManagementSave){this.oManagementSave.destroy();this.oManagementSave=undefined}if(this.oManagementDialog){this.oManagementDialog.destroy();this.oManagementDialog=undefined}if(this.oVariantText){this.oVariantText.destroy();this.oVariantText=undefined}if(this.oVariantPopoverTrigger){this.oVariantPopoverTrigger.destroy();this.oVariantPopoverTrigger=undefined}if(this.oVariantLayout){this.oVariantLayout.destroy();this.oVariantLayout=undefined}if(this.oVariantPopOver){this.oVariantPopOver.destroy();this.oVariantPopOver=undefined}if(this.oVariantSaveAs){this.oVariantSaveAs.destroy();this.oVariantSaveAs=undefined}if(this.oShare){this.oShare.destroy();this.oShare=undefined}if(this.oExecuteOnSelect){this.oExecuteOnSelect.destroy();this.oExecuteOnSelect=undefined}if(this.oCreateTile){this.oCreateTile.destroy();this.oCreateTile=undefined}if(this.oSaveDialogOptionsGrid){this.oSaveDialogOptionsGrid.destroy();this.oSaveDialogOptionsGrid=undefined}if(this.oVariantSelectionPage){this.oVariantSelectionPage.destroy();this.oVariantSelectionPage=undefined}if(this.oErrorVariantPopOver){this.oErrorVariantPopOver.destroy();this.oErrorVariantPopOver=undefined}if(this.oInputKey){this.oInputKey.destroy();this.oInputKey=undefined}if(this.oLabelKey){this.oLabelKey.destroy();this.oLabelKey=undefined}if(this.oModel){this.oModel.destroy();this.oModel=undefined}};Y.prototype.addItem=function(e){e=this.validateAggregation("items",e,true);this.bVariantItemMode=false;this.addAggregation("items",e,false);var t=this.getInitialSelectionKey();this._setSelection(e,t);this._setStandardText();return this};Y.prototype.insertItem=function(e,t){var a=t;e=this.validateAggregation("items",e,true);this.bVariantItemMode=false;this.insertAggregation("items",e,a);var i=this.getInitialSelectionKey();this._setSelection(e,i);this._setStandardText();return this};Y.prototype.removeItem=function(e){e=this.removeAggregation("items",e);return e};Y.prototype.removeAllItems=function(){var e=this.removeAllAggregation("items");this._setSelectedItem(null);return e};Y.prototype.destroyItems=function(){this.destroyAggregation("items");this._setSelectedItem(null);return this};Y.prototype._getItems=function(){if(this.bVariantItemMode){return this.getVariantItems()}else{return this.getItems()}};Y.prototype._removeItem=function(e){if(this.bVariantItemMode){return this.removeVariantItem(e)}else{return this.removeItem(e)}};Y.prototype.getItemByKey=function(e){var t=this._getItems();for(var a=0;a<t.length;a++){if(e==t[a].getKey()){return t[a]}}return null};Y.prototype.addVariantItem=function(e){e=this.validateAggregation("variantItems",e,true);this.bVariantItemMode=true;this.addAggregation("variantItems",e,false);var t=this.getInitialSelectionKey();this._setSelection(e,t);this._setStandardText();e.attachChange(this._variantItemChange.bind(this,null));return this};Y.prototype.insertVariantItem=function(e,t){var a=t;e=this.validateAggregation("variantItems",e,true);this.bVariantItemMode=true;this.insertAggregation("variantItems",e,a);var i=this.getInitialSelectionKey();this._setSelection(e,i);this._setStandardText();e.attachChange(this._variantItemChange.bind(this,null));return this};Y.prototype._variantItemChange=function(e,t){var a;if(t&&t.oSource&&t.oSource.isA("sap.ui.comp.variants.VariantItem")){a=t.getParameter("propertyName");if(a==="text"){if(t.oSource===this._getSelectedItem()){this.oModel.setProperty("/selectedVariant",this._getSelectedItem().getText())}}}};Y.prototype._setSelectedItem=function(e){this.oSelectedItem=e;if(e!=null&&e.getKey()!=this.getStandardVariantKey()){this._setVariantText(e.getText())}else{this._setStandardText()}};Y.prototype._getSelectedItem=function(){return this.oSelectedItem};Y.prototype.setInitialSelectionKey=function(e){this.setProperty("initialSelectionKey",e,true);this._setSelectionByKey(e);return this};Y.prototype.setEnabled=function(e){this.setProperty("enabled",e,false);if(!e){this.oVariantText.removeStyleClass("sapUICompVarMngmtClickable");this.oVariantModifiedText.removeStyleClass("sapUICompVarMngmtClickable");this.oVariantPopoverTrigger.removeStyleClass("sapUICompVarMngmtClickable");this.oVariantText.addStyleClass("sapUICompVarMngmtDisabled");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtDisabled");this.oVariantPopoverTrigger.addStyleClass("sapUICompVarMngmtDisabled")}else{this.oVariantText.removeStyleClass("sapUICompVarMngmtDisabled");this.oVariantModifiedText.removeStyleClass("sapUICompVarMngmtDisabled");this.oVariantPopoverTrigger.removeStyleClass("sapUICompVarMngmtDisabled");this.oVariantText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantPopoverTrigger.addStyleClass("sapUICompVarMngmtClickable")}return this};Y.prototype.getFocusDomRef=function(){if(this.oVariantPopoverTrigger&&this.getEnabled()){return this.oVariantPopoverTrigger.getFocusDomRef()}};Y.prototype._setSelection=function(e,t){if(e.getKey()===t){this._setSelectedItem(e);this.fireSelect({key:t})}};Y.prototype.addStyleClass=function(e){if(x.prototype.addStyleClass){x.prototype.addStyleClass.apply(this,arguments)}if(this.oVariantPopOver){this.oVariantPopOver.addStyleClass(e)}if(this.oSaveDialog){this.oSaveDialog.addStyleClass(e)}if(this.oManagementDialog){this.oManagementDialog.addStyleClass(e)}};Y.prototype.removeStyleClass=function(e){if(x.prototype.addStyleClass){x.prototype.removeStyleClass.apply(this,arguments)}if(this.oVariantPopOver){this.oVariantPopOver.removeStyleClass(e)}if(this.oSaveDialog){this.oSaveDialog.removeStyleClass(e)}if(this.oManagementDialog){this.oManagementDialog.removeStyleClass(e)}};Y.prototype.clearVariantSelection=function(){this.setInitialSelectionKey(this.getStandardVariantKey());this._setSelectedItem(null)};Y.prototype._setDialogCompactStyle=function(e,t){if(this._checkDialogCompactStyle(e)){t.addStyleClass("sapUiSizeCompact")}else{t.removeStyleClass("sapUiSizeCompact")}};Y.prototype._checkDialogCompactStyle=function(e){if(e.$().closest(".sapUiSizeCompact").length>0){return true}else{return false}};Y.prototype.getSelectionKey=function(){var e=null;var t=this._getSelectedItem();if(t!==null){e=t.getKey()}else if(this.bVariantItemMode){e=this.getStandardVariantKey()}else{e=null}return e};Y.prototype._setSelectionByKey=function(e){var t=this._getItems();var a=false;if(t.length>0){for(var i=0;i<t.length;i++){if(t[i].getKey()===e){this._setSelectedItem(t[i]);a=true;break}}}if(!a){this._setSelectedItem(null)}};Y.prototype.setCurrentVariantKey=function(e){this._setSelectionByKey(e)};Y.prototype.replaceKey=function(e,t){var a=this._getItems();if(a.length>0){for(var i=0;i<a.length;i++){if(a[i].getKey()===e){a[i].setKey(t);if(this.getDefaultVariantKey()==e){this.setDefaultVariantKey(t)}if(this._getSelectedItem()===a[i]){this._setSelectedItem(null)}break}}}};Y.prototype.verifyVariantKey=function(e){return this.getItemByKey(e)?true:false};Y.prototype.createVariantEntry=function(e){var t="SV"+(new Date).getTime();var a=new b({key:t,text:e.name,global:e.global});this.addAggregation("variantItems",a,false);return t};Y.prototype._assignUser=function(e,t){var a=this.getItemByKey(e);if(a&&a.isA("sap.ui.comp.variants.VariantItem")&&!a.getAuthor()){a.setAuthor(t)}};Y.prototype.currentVariantSetModified=function(e){if(this.oModel){this.oModel.setProperty("/enabled",e)}};Y.prototype.currentVariantGetModified=function(){return this.oModel.getProperty("/enabled")};Y.prototype._delayedControlCreation=function(){var e=this;if(this._bInnerControlsCreated){return}this._bInnerControlsCreated=true;this.oVariantManage=new m(this.getId()+"-manage",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_MANAGE"),enabled:true,press:function(){e._openVariantManagementDialog()},layoutData:new p({priority:W.High})});this.oVariantSave=new m(this.getId()+"-mainsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),press:function(){var t=e._createEvent("variantSavePressed",e._variantSavePressed);e._addEvent(t)},visible:{parts:[{path:"save_enablement>/creationAllowed"},{path:"save_enablement>/saveVariantVisible"}],formatter:function(e,t){return e&&t}},type:F.Emphasized,layoutData:new p({priority:W.Low})});this.oVariantSave.setModel(this.oModel);this.oVariantSaveAs=new m(this.getId()+"-saveas",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVEAS"),press:function(){e._openSaveAsDialog()},visible:"{save_enablement>/creationAllowed}",layoutData:new p({priority:W.Low})});this.oVariantList=new I(this.getId()+"-list",{itemPress:function(t){var a=null;if(t&&t.getParameters()){var i=t.getParameters().item;if(i){a=i.getKey()}}if(a){e.lastSelectedVariantKey=a;e._setSelectionByKey(a);e.oVariantPopOver.close();e.oModel.setProperty("/enabled",false);e.bFireSelect=true}}});this.oVariantList.setNoDataText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_NODATA"));this.oSearchField=new s;this.oSearchField.attachLiveChange(function(t){e._triggerSearch(t)});this._handleArrowUpDown(this.oVariantList,this.oSearchField);this.oVariantSelectionPage=new g(this.getId()+"selpage",{subHeader:new f({content:[this.oSearchField]}),content:[this.oVariantList],footer:new c({content:[new y(this.getId()+"-spacer"),this.oVariantSave,this.oVariantSaveAs,this.oVariantManage]}),showSubHeader:false,showNavButton:false,showHeader:false});this.oVariantPopOver=new A(this.getId()+"-popover",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"),titleAlignment:"Auto",contentWidth:"400px",placement:B.VerticalPreferredBottom,content:[this.oVariantSelectionPage],afterOpen:function(){e.bPopoverOpen=true;e.oVariantPopoverTrigger.setPressed(true);e._markSharedVariants()},afterClose:function(){e.oVariantPopoverTrigger.setPressed(false);if(e.bPopoverOpen){if(e.bFireSelect==true){e.bFireSelect=false;e._fireSelectAsync()}setTimeout(function(){e.bPopoverOpen=false},200)}},contentHeight:"300px"});this.oVariantPopOver.setParent(this);this.oVariantPopOver.addStyleClass("sapUICompVarMngmtPopover");this.oInputName=new V(this.getId()+"-name",{liveChange:function(t){e._checkVariantNameConstraints(this)}});this.oLabelName=new _(this.getId()+"-namelabel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_NAME")});this.oLabelName.setLabelFor(this.oInputName);this.oLabelName.addStyleClass("sapUiCompVarMngmtSaveDialogLabel");this.oDefault=new S(this.getId()+"-default",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SETASDEFAULT"),enabled:true,visible:true,width:"100%"});this.oExecuteOnSelect=new S(this.getId()+"-execute",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT"),enabled:true,visible:false,width:"100%"});this.oCreateTile=new S(this.getId()+"-tile",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CREATETILE"),enabled:true,visible:false,width:"100%"});this.oShare=new S(this.getId()+"-share",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SHARE"),enabled:true,visible:false,select:function(t){var a=e._createEvent("inputfieldChange",e._handleShareSelected);a.args.push(t);e._addEvent(a)},width:"100%"});this.oInputKey=new V(this.getId()+"-key",{liveChange:function(t){e._checkVariantNameConstraints(this)}});this.oLabelKey=new _(this.getId()+"-keylabel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_KEY"),required:true});this.oLabelKey.setLabelFor(this.oInputKey);this.oSaveSave=new m(this.getId()+"-variantsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),type:F.Emphasized,press:function(){e._checkVariantNameConstraints(e.oInputName);if(e.oInputName.getValueState()==="Error"){e.oInputName.focus();return}e._bSaveCanceled=false;if(e._fGetDataForKeyUser){e._handleSaveAsPressedForKeyUser()}else{e._triggerSave()}},enabled:true});this.oSaveDialogOptionsGrid=new K({defaultSpan:"L12 M12 S12"});this.oManagementTable=new u(this.getId()+"-managementTable",{contextualWidth:"Auto",fixedLayout:false});this.oManagementSave=new m(this.getId()+"-managementsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),enabled:true,type:F.Emphasized,press:function(){this._saveFromManagementDialog()}.bind(this)})};Y.prototype._saveFromManagementDialog=function(){if(this._anyItemInErrorState()){return}if(!this._fGetDataForKeyUser){var e=this._createEvent("managementSave",this._handleManageSavePressed);this._addEvent(e)}else{this._handleManageSavePressedForKeyUser()}};Y.prototype._openInErrorState=function(){var e=this,t;if(!this.oErrorVariantPopOver){t=new n({fitContainer:true,alignItems:z.Center,items:[new D({size:"4rem",color:"lightgray",src:"sap-icon://message-error"}),new T({titleStyle:H.H2,text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_TEXT1")}),new h({textAlign:G.Center,text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_TEXT2")})]});t.addStyleClass("sapUICompVarMngmtErrorPopover");this.oErrorVariantPopOver=new A(this.getId()+"-errorpopover",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"),contentWidth:"400px",placement:B.VerticalPreferredBottom,content:[new g(this.getId()+"-errorselpage",{showSubHeader:false,showNavButton:false,showHeader:false,content:[t]})],afterOpen:function(){e.bPopoverOpen=true},afterClose:function(){if(e.bPopoverOpen){e.bPopoverOpen=false}},contentHeight:"300px"});this.oErrorVariantPopOver.attachBrowserEvent("keyup",function(e){if(e.which===32){this.oErrorVariantPopOver.close()}}.bind(this))}if(this.bPopoverOpen){return}this.oErrorVariantPopOver.openBy(this.oVariantLayout)};Y.prototype.showSaveButton=function(e){if(e){this.oVariantSaveAs.setType(F.Default)}else{this.oVariantSaveAs.setType(F.Emphasized)}this.oModel.setProperty("/saveVariantVisible",e)};Y.prototype._openVariantSelection=function(){var e=null,t;if(this.getInErrorState()){this._openInErrorState();return}this._delayedControlCreation();if(this.bPopoverOpen){return}if(this.bVariantItemMode===false&&this.getSelectionKey()!==null){this.showSaveButton(true)}else{this.showSaveButton(false)}e=this._getItems();if(e.length<9){this.oVariantSelectionPage.setShowSubHeader(false)}else{this.oVariantSelectionPage.setShowSubHeader(true);this.oSearchField.setValue("")}this._restoreCompleteList();if(this.currentVariantGetModified()){t=this.oVariantList.getItemByKey(this.getSelectionKey());if(t){if(!t.getReadOnly()||this._isIndustrySolutionModeAndVendorLayer()&&this.getStandardVariantKey()===t.getKey()){this.showSaveButton(true)}}}if(this._isIndustrySolutionModeAndVendorLayer()&&this.bManualVariantKey&&this.getStandardVariantKey()===this.STANDARDVARIANTKEY){this.showSaveButton(false)}this._setDialogCompactStyle(this,this.oVariantPopOver);t=this.oVariantList.getSelectedItem();if(t){this.oVariantPopOver.setInitialFocus(t.getId())}var a=this._oCtrlRef?this._oCtrlRef:this.oVariantLayout;this._oCtrlRef=null;this.oVariantPopOver.openBy(a)};Y.prototype._obtainControl=function(e){if(e&&e.target&&e.target.id){var t=e.target.id;var a=t.indexOf("-inner");if(a>0){t=t.substring(0,a)}return sap.ui.getCore().byId(t)}return null};Y.prototype.handleOpenCloseVariantPopover=function(e){if(this.oVariantPopOver&&this.oVariantPopOver.isOpen()){this.oVariantPopOver.close()}else if(!this.bPopoverOpen){this._oCtrlRef=this._obtainControl(e);this._openVariantSelection()}else if(this.getInErrorState()&&this.oErrorVariantPopOver&&this.oErrorVariantPopOver.isOpen()){this.oErrorVariantPopOver.close()}};Y.prototype._initalizeManagementTableColumns=function(){if(this.bManagementTableInitialized){return}this.oManagementTable.addColumn(new l({width:"3rem",visible:this.getUseFavorites()&&!this._isIndustrySolutionModeAndVendorLayer()}));this.oManagementTable.addColumn(new l({header:new h({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_NAME")}),width:"16rem"}));this.oManagementTable.addColumn(new l({header:new h({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTTYPE"),wrappingType:"Hyphenated"}),demandPopin:true,popinDisplay:U.Inline,minScreenWidth:k.Tablet,visible:this.getShowShare()}));this.oManagementTable.addColumn(new l({header:new h({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"),wrappingType:"Hyphenated"}),hAlign:G.Center,demandPopin:true,popinDisplay:U.Block,minScreenWidth:k.Tablet,visible:this.getShowSetAsDefault()}));this.oManagementTable.addColumn(new l({header:new h({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT"),wrappingType:"Hyphenated"}),hAlign:this.getDisplayTextForExecuteOnSelectionForStandardVariant&&this.getDisplayTextForExecuteOnSelectionForStandardVariant()?G.Begin:G.Center,demandPopin:true,popinDisplay:U.Block,minScreenWidth:k.Tablet,visible:this.getShowExecuteOnSelection()}));this.oManagementTable.addColumn(new l({header:new h({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VISIBILITY"),wrappingType:"Hyphenated"}),width:"8rem",demandPopin:true,popinDisplay:U.Inline,minScreenWidth:k.Tablet,visible:false}));this.oManagementTable.addColumn(new l({header:new h({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_AUTHOR")}),demandPopin:true,popinDisplay:U.Block,minScreenWidth:k.Tablet}));this.oManagementTable.addColumn(new l({header:new C({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ACTION_COLUMN")}),hAlign:G.Center}));this.bManagementTableInitialized=true};Y.prototype._initalizeSaveAsDialog=function(){this.oSaveDialogOptionsGrid.removeAllContent();this.oDefault.setVisible(this.getShowSetAsDefault());this.oShare.setVisible(this.getShowShare());this.oExecuteOnSelect.setVisible(this.getShowExecuteOnSelection());this.oCreateTile.setVisible(this.getShowCreateTile());if(this.getShowSetAsDefault()){this.oSaveDialogOptionsGrid.addContent(this.oDefault)}if(this.getShowShare()){this.oSaveDialogOptionsGrid.addContent(this.oShare)}if(this.getShowExecuteOnSelection()){this.oSaveDialogOptionsGrid.addContent(this.oExecuteOnSelect)}if(this.getShowCreateTile()){this.oSaveDialogOptionsGrid.addContent(this.oCreateTile)}};Y.prototype.ontap=function(e){if(this.getEnabled()){if(this.oVariantPopoverTrigger&&!this.bPopoverOpen){this.oVariantPopoverTrigger.focus()}this.handleOpenCloseVariantPopover(e)}};Y.prototype.onkeyup=function(e){if(e.which===L.ENTER||e.which===L.F4||e.which===L.SPACE||e.altKey===true&&e.which===L.ARROW_UP||e.altKey===true&&e.which===L.ARROW_DOWN){if(this.getEnabled()){this._oCtrlRef=this._obtainControl(e);this._openVariantSelection()}}};Y.prototype.onAfterRendering=function(){this.oVariantText.$().off("mouseover").on("mouseover",function(){this.oVariantPopoverTrigger.addStyleClass("sapUICompVarMngmtTriggerBtnHover")}.bind(this));this.oVariantText.$().off("mouseout").on("mouseout",function(){this.oVariantPopoverTrigger.removeStyleClass("sapUICompVarMngmtTriggerBtnHover")}.bind(this))};Y.prototype.onBeforeRendering=function(){var e=function(e){var t,a=0;for(var i=0;i<e.length;i++){t=e[i].$().width();if(t>a){a=t}}return a};if(this.oSaveDialogOptionsGrid&&this.oSaveDialog&&this.oSaveDialog.getVisible()){var t=this.oSaveDialogOptionsGrid.getContent();if(t&&t.length>0){var a=this.oSaveDialogOptionsGrid.$().width();var i=e(t);var n=32;var s=12;if(!this._checkDialogCompactStyle(this.oSaveDialog)){n=48;s=18}if(n+i+s>a/2){this.oSaveDialogOptionsGrid.setDefaultSpan("L12 M12 S12")}}}};Y.prototype._markSharedVariants=function(){var e,t,a=this._getItems();for(var i=0;i<a.length;i++){t=a[i];if(t.getGlobal&&t.getGlobal()){e=this.oVariantList.getItemByKey(t.getKey());if(e){var n=e.$();if(n){n.addClass("sapUiCompVarMngmtSharedVariant")}}}}};Y.prototype._variantSavePressed=function(){var e=this._getSelectedItem();if(!e){if(this.getStandardVariantKey()===this.STANDARDVARIANTKEY){e=new b({key:this.STANDARDVARIANTKEY,global:this._isIndustrySolutionModeAndVendorLayer()});e.setText(this._determineStandardVariantName())}else{e=this.getItemByKey(this.getStandardVariantKey())}}var t=false;if(this.getDefaultVariantKey()===e.getKey()){t=true}if(e.getLifecyclePackage&&e.getGlobal()==true){var a=this;var i=function(i,n){a.oVariantPopOver.close();a.sPackage=i;a.sTransport=n;a.fireSave({name:e.getText(),overwrite:true,key:e.getKey(),def:t,global:a._isIndustrySolutionModeAndVendorLayer()&&a.getStandardVariantKey()===a.getStandardVariantKey(),lifecyclePackage:a.sPackage,lifecycleTransportId:a.sTransport});e.setLifecycleTransportId(a.sTransport);a.oModel.setProperty("/enabled",false);a._eventDone()};var n=function(e){a.sTransport=null;a.sPackage=null;a._cancelAllEvents()};this._assignTransport(e,i,n,this.oVariantText)}else{this.oVariantPopOver.close();this.fireSave({name:e.getText(),overwrite:true,key:e.getKey(),def:t});this.oModel.setProperty("/enabled",false);this._eventDone()}};Y.prototype._assignTransport=function(e,t,a,i){var n={type:"variant",name:"",namespace:""};n["package"]="";if(e!==null){n["package"]=e.getLifecyclePackage();n["name"]=e.getKey();n["namespace"]=e.getNamespace()}var s=function(e){var a;var i;i=e.getParameters().selectedTransport;a=e.getParameters().selectedPackage;t(a,i)};var r=function(e){a(e)};if(this.getLifecycleSupport()){var o=null;if(e){o=e.getLifecycleTransportId()}if(o!=null&&o.trim().length>0){t(n["package"],o)}else{this._getTransportSelection().then(function(e){e.selectTransport(n,s,r,this._checkDialogCompactStyle(i),i)}.bind(this))}}else{t(n["package"],"")}};Y.prototype._getTransportSelection=function(){if(this.getTransportSelection){return this.getTransportSelection()}else{return this._getFlTransportSelection()}};Y.prototype._getFlTransportSelection=function(){return sap.ui.getCore().loadLibrary("sap.ui.fl",{async:true}).then(function(){return new Promise(function(e){sap.ui.require(["sap/ui/fl/write/api/SmartVariantManagementWriteAPI"],function(t){e(t._getTransportSelection())})})})};Y.prototype.getDefaultVariantKey=function(){var e=this.getProperty("defaultVariantKey");if(e===""){if(this.bVariantItemMode){e=this.getStandardVariantKey()}}return e};Y.prototype._compareItems=function(e,t){var a=e.getText();var i=t.getText();var n=a.toUpperCase();var s=i.toUpperCase();if(n==s){if(a==i){return 0}if(a<i){return-1}if(a>i){return 1}}if(n<s){return-1}if(n>s){return 1}};Y.prototype._accessOptionsText=function(e){var t=null;switch(e){case"R":t=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LAYER");break;case"RD":t=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LANGUAGE");break;default:t=null}return t};Y.prototype._openSaveAsDialog=function(){this._initSaveAsDialog();this.oSaveDialog.open()};Y.prototype._initSaveAsDialog=function(){this._initalizeSaveAsDialog();this.oInputName.setValue(this.oModel.getProperty("/selectedVariant"));this.oInputName.setEnabled(true);this.oInputName.setValueState(P.None);this.oInputName.setValueStateText(null);this.oDefault.setSelected(false);this.oShare.setSelected(false);this.oCreateTile.setSelected(false);this.oExecuteOnSelect.setSelected(false);if(this._isIndustrySolutionModeAndVendorLayer()){this.oInputName.setValue(this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD"))}this._createSaveDialog();this._setDialogCompactStyle(this,this.oSaveDialog);this.oVariantPopOver.close();this.sTransport=null;this.sPackage=null;if(this.bManualVariantKey){this.oInputKey.setVisible(true);this.oInputKey.setEnabled(true);this.oInputKey.setValueState(P.None);this.oInputKey.setValueStateText(null);this.oLabelKey.setVisible(true)}else{this.oInputKey.setVisible(false);this.oLabelKey.setVisible(false)}};Y.prototype._checkManageItemNameChange=function(e){var t="";var a=null;var i=this;a=e.getCells()[Y.NAME_COLUMN];t=a.getValue();t=t.trim();var n=e;var s=n.getKey();this._checkVariantNameConstraints(a,this.oManagementTable);if(a.getValueState()===P.Error){this._eventDone();return}if(this.oVariantList.getItemByKey(s).getText().trim()===t){this._eventDone();return}if(n.getGlobal()){var r=function(e,t){n.setLifecyclePackage(e);n.setLifecycleTransportId(t);i._eventDone()};var o=function(e){if(i&&i.oVariantList){var t=i.oVariantList.getItemByKey(s);a.setValue(t.getText())}i._cancelAllEvents()};this._createManagementDialog();this._assignTransport(n,r,o,this.oManagementDialog)}else{this._eventDone()}};Y.prototype._handleManageSavePressed=function(){var e=this.oManagementTable.getItems();var t,a;var i=false;var n="";var s=null;var r=0;var o=[];for(var l=0;l<e.length;l++){t=this.oVariantList.getItemByKey(e[l].getKey());a=e[l].getCells()[Y.NAME_COLUMN];if(a&&a.getValue){n=a.getValue()}else if(a&&a.getTitle){n=a.getTitle()}else if(a&&a.getText){n=a.getText()}n=n.trim();if(t.getText()!==n){this.aRenamedVariants.push({key:t.getKey(),name:n});s=this.getItemByKey(e[l].getKey());s.setText(n);if(s.setLifecyclePackage){s.setLifecyclePackage(e[l].getLifecyclePackage());s.setLifecycleTransportId(e[l].getLifecycleTransportId())}if(this.lastSelectedVariantKey===t.getKey()){this._setVariantText(n)}}if(this.getUseFavorites()&&!this._isIndustrySolutionModeAndVendorLayer()){var h=e[l].getKey();if(this._mFavoriteChanges&&this._mFavoriteChanges[h]!==undefined){var d=this._mFavoriteChanges[h];if(h===this.STANDARDVARIANTKEY){if(this.getStandardFavorite()!==d){o.push({key:h,visible:d});this.setStandardFavorite(d)}}else{s=this.getItemByKey(e[l].getKey());if(s&&t.getFavorite&&t.getFavorite()!==d){o.push({key:h,visible:d});s.setFavorite(d)}}}}if(this.getShowExecuteOnSelection()&&t.getExecuteOnSelection&&e[l].getCells()[Y.EXEC_COLUMN].isA("sap.m.CheckBox")&&t.getExecuteOnSelection()!=e[l].getCells()[Y.EXEC_COLUMN].getSelected()){var u=e[l].getCells()[Y.EXEC_COLUMN].getSelected();var g=this.getItemByKey(e[l].getKey());if(!g&&this.getSupportExecuteOnSelectOnSandardVariant()&e[l].getKey()===this.getStandardVariantKey()){g=new b}if(g&&g.setExecuteOnSelection){g.setExecuteOnSelection(u);if(this.getSupportExecuteOnSelectOnSandardVariant()&e[l].getKey()===this.getStandardVariantKey()){this._executeOnSelectForStandardVariantByUser(u)}this.aExeVariants.push({key:t.getKey(),exe:u});if(g.setLifecyclePackage&&!g.getReadOnly()){g.setLifecyclePackage(e[l].getLifecyclePackage());g.setLifecycleTransportId(e[l].getLifecycleTransportId())}}}}if(this.oManagementDialog){this.oManagementDialog.close()}if(this.bVariantItemMode===false){if(this.getDefaultVariantKey()!=this.sNewDefaultKey){var c=null;if(this.sNewDefaultKey==this.getStandardVariantKey()){c=this.getItemByKey(this.getDefaultVariantKey());this.fireSave({name:c.getText(),overwrite:true,key:c.getKey(),def:false})}else{c=this.getItemByKey(this.sNewDefaultKey);this.fireSave({name:c.getText(),overwrite:true,key:c.getKey(),def:true})}}}if(this.sNewDefaultKey!=this.getDefaultVariantKey()){this.setDefaultVariantKey(this.sNewDefaultKey)}for(r=0;r<this.aRemovedVariants.length;r++){t=this.getItemByKey(this.aRemovedVariants[r]);for(var p=0;p<this.aRemovedVariantTransports.length;p++){if(this.aRemovedVariants[r]===this.aRemovedVariantTransports[p].key){var f=this.aRemovedVariantTransports[p];if(t.setLifecyclePackage){t.setLifecycleTransportId(f.transport)}break}}}this.fireManage({renamed:this.aRenamedVariants,deleted:this.aRemovedVariants,exe:this.aExeVariants,def:this.getDefaultVariantKey(),fav:o});for(r=0;r<this.aRemovedVariants.length;r++){t=this.getItemByKey(this.aRemovedVariants[r]);if(t){this._removeItem(t);t.destroy()}if(this.lastSelectedVariantKey===this.aRemovedVariants[r]){i=true;this._setSelectedItem(null);this.oModel.setProperty("/enabled",false)}}if(i){this.bFireSelect=true}this._eventDone()};Y.prototype._createEvent=function(e,t){var a={name:e,fFunc:t,args:[]};return a};Y.prototype._handleNextEvent=function(){if(this.aEvents.length>0){if(!this.bEventRunning){this.bEventRunning=true;var e=this.aEvents.pop();e.fFunc.apply(this,e.args)}}};Y.prototype._addEvent=function(e){this.aEvents.push(e);this._handleNextEvent()};Y.prototype._cancelAllEvents=function(){this.aEvents=[];this.bEventRunning=false};Y.prototype._eventDone=function(){this.bEventRunning=false;this._handleNextEvent()};Y.prototype._handleManageExecuteOnSelectionChanged=function(e){var t=this;var a=e.getParent();if(a&&a.getGlobal()&&!a.getReadOnly()){var i=function(e,i){a.setLifecyclePackage(e);a.setLifecycleTransportId(i);t._eventDone()};var n=function(a){e.setSelected(!e.getSelected());t._cancelAllEvents()};this._createManagementDialog();this._assignTransport(a,i,n,this.oManagementDialog)}else{this._eventDone()}};Y.prototype._handleManageDeletePressed=function(e){var t=this,a;var i=function(){var e=null,a=t.oManagementTable.getItems();a.some(function(a){if(a.getKey()===t.getStandardVariantKey()){e=a;return true}});return e};this._anyInErrorState(this.oManagementTable,e.getParent().getCells()[Y.NAME_COLUMN]);a=i();var n=e.getParent();if(n.getGlobal()){var s=function(e,i){var s=n.getKey();t.aRemovedVariants.push(s);t.oManagementTable.removeItem(n);if(t.getShowSetAsDefault()){if(n.getKey()===t.sNewDefaultKey){if(a){a.getCells()[Y.DEF_COLUMN].setSelected(true);a.getCells()[Y.DEF_COLUMN].fireSelect({selected:true})}else{t.setStandardVariantKey(t.STANDARDVARIANTKEY)}t.sNewDefaultKey=t.getStandardVariantKey()}}n.destroy();var r={key:s,transport:i};t.aRemovedVariantTransports.push(r);t._eventDone()};var r=function(e){t._cancelAllEvents()};this._createManagementDialog();this._assignTransport(n,s,r,this.oManagementDialog)}else{this.aRemovedVariants.push(n.getKey());this.oManagementTable.removeItem(n);if(this.getShowSetAsDefault()){if(n.getKey()===this.sNewDefaultKey){if(a){a.getCells()[Y.DEF_COLUMN].setSelected(true);a.getCells()[Y.DEF_COLUMN].fireSelect({selected:true})}this.sNewDefaultKey=this.getStandardVariantKey()}}n.destroy();this._eventDone()}var o=sap.ui.getCore().byId(this.getId()+"-managementcancel");if(o){o.focus()}};Y.prototype._handleShareSelected=function(e){var t=this;if(e.getParameters&&e.getParameters()&&e.getParameters().selected){var a=function(e,a){t.sTransport=a;t.sPackage=e;t._eventDone()};var i=function(e){t.oShare.setSelected(false);t.sTransport=null;t.sPackage=null;t._cancelAllEvents()};this._createSaveDialog();this._assignTransport(null,a,i,this.oSaveDialog)}else{this.sTransport=null;this.sPackage=null;this._eventDone()}};Y.prototype._handleVariantSaveAs=function(){var e="SV"+(new Date).getTime();var t=this.oInputName.getValue();var a=this.oInputKey.getValue();var i="";var n="";var s=false;var r=false;var o=null;t=t.trim();if(t==""){this.oInputName.setValueState(P.Error);this.oInputName.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));this._cancelAllEvents();return}a=a.trim();if(this.bManualVariantKey&&a==""){this.oInputKey.setValueState(P.Error);this.oInputKey.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));this._cancelAllEvents();return}if(this.bManualVariantKey){e=a}if(this.oSaveDialog){this.oSaveDialog.close()}if(this.oExecuteOnSelect!==null){s=this.oExecuteOnSelect.getSelected()}if(this.oCreateTile!==null){r=this.oCreateTile.getSelected()}if(this.bVariantItemMode){o=new b({key:e,readOnly:false,executeOnSelection:s,global:this.oShare.getSelected(),lifecycleTransportId:this.sTransport,lifecyclePackage:this.sPackage});o.setText(t);this.addVariantItem(o);this._setSelectedItem(o)}else{o=new R({key:e});o.setText(t);this.addItem(o);this._setSelectedItem(o)}if(this.oDefault.getSelected()){this.setDefaultVariantKey(e)}if(this.oShare.getSelected()){n=this.sPackage;i=this.sTransport}this.fireSave({name:t,overwrite:false,def:this.oDefault.getSelected(),key:e,exe:this.oExecuteOnSelect.getSelected(),tile:r,global:this.oShare.getSelected(),lifecyclePackage:n,lifecycleTransportId:i});this.oModel.setProperty("/enabled",false);this._eventDone()};Y.prototype.setBackwardCompatibility=function(e){this._setBackwardCompatibility(e)};Y.prototype._setBackwardCompatibility=function(e){if(this.getItems().length===0&&this.getVariantItems().length===0){this.bVariantItemMode=!e}this._setStandardText()};Y.prototype._setStandardText=function(){var e=this.getSelectionKey();if(e===null||e===this.getStandardVariantKey()){if(this.bVariantItemMode==false){this._setVariantText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"))}else{this._setVariantText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD"))}if(this.getStandardItemText()!==null&&this.getStandardItemText()!=""){this._setVariantText(this.getStandardItemText())}}};Y.prototype._setVariantText=function(e){var t,a=this.extractBindingInfo(e),i=e;if(typeof a==="object"&&a.model&&a.path){t=this.getModel(a.model);if(t){i=t.getProperty(a.path)}}this.oModel.setProperty("/selectedVariant",i)};Y.prototype._getVariantText=function(e){return this.oModel.getProperty("/selectedVariant")};Y.prototype._updateVariantInvisibletext=function(e,t){if(t){e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_MODIFIED",[e])}return e};Y.prototype._setFavoriteIcon=function(e,t){e.setSrc(t?"sap-icon://favorite":"sap-icon://unfavorite");e.setTooltip(this.oResourceBundle.getText(t?"VARIANT_MANAGEMENT_FAV_DEL_TOOLTIP":"VARIANT_MANAGEMENT_FAV_ADD_TOOLTIP"));e.setAlt(this.oResourceBundle.getText(t?"VARIANT_MANAGEMENT_FAV_DEL_ACC":"VARIANT_MANAGEMENT_FAV_ADD_ACC"))};Y.prototype._isFavoriteSelected=function(e){return e.getSrc()==="sap-icon://unfavorite"};Y.prototype._openVariantManagementDialog=function(){var e;var t=null;var a=0;var i;var n;var s;var r;var l;var d;var u;var g;var c,p,f,y,v,T;var _=this;this._mFavoriteChanges={};this.oManagementSave.setEnabled(true);this.oManagementSave.setTooltip(null);this.oManagementTable.destroyItems();c=function(e){_._checkVariantNameConstraints(this,_.oManagementTable)};p=function(e){var t=_._createEvent("inputfieldChange",_._checkManageItemNameChange);t.args.push(this.getParent());_._addEvent(t)};v=function(e){var t=_._isFavoriteSelected(e.oSource),a=this.getParent();if(a&&_.sNewDefaultKey!==a.getKey()){_._mFavoriteChanges[a.getKey()]=t;_._setFavoriteIcon(e.oSource,t)}};f=function(e){var t=e.getParameters().selected===true,a=this.getParent();if(a){if(t){_.sNewDefaultKey=a.getKey();_._mFavoriteChanges[a.getKey()]=t}var i=a.getCells()[Y.FAV_COLUMN];if(i&&a.getFavorite){if(t){_._setFavoriteIcon(i,true)}else if(_._mFavoriteChanges[a.getKey()]!==undefined){_._setFavoriteIcon(i,_._mFavoriteChanges[a.getKey()])}else{_._setFavoriteIcon(i,a.getFavorite()===true)}}}};y=function(e){var t=_._createEvent("executeOnSelectionChange",_._handleManageExecuteOnSelectionChanged);t.args.push(this);_._addEvent(t)};T=function(e){var t=_._createEvent("manageDeletePressed",_._handleManageDeletePressed);t.args.push(this);_._addEvent(t)};if(this.oManageDialogSearchField){this.oManageDialogSearchField.setValue("")}this._initalizeManagementTableColumns();this.sNewDefaultKey=this.getDefaultVariantKey();this._restoreCompleteList(true);if(this.oVariantList.getItems()[0].getKey()!==this.getStandardVariantKey()&&this.bVariantItemMode==false){e=new b(this.oVariantManage.getId()+"-item-standard",{key:this.getStandardVariantKey(),text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"),readOnly:true,executeOnSelection:false});this.oVariantList.insertItem(e,0)}if(this.getUseFavorites()){e=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(e){this.oVariantList.removeItem(e)}}t=this.oVariantList.getItems();if(this.getUseFavorites()){t.sort(this._compareItems);if(e){this.oVariantList.insertItem(e);t.splice(0,0,e)}}for(var A=0;A<t.length;A++){if(t[A].getReadOnly()||t[A].getLabelReadOnly()){var I=t[A].getAccessOptions();g=this._accessOptionsText(I)}else{g=null}if(t[A].getReadOnly()){g=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LAYER")}else if(t[A].getLabelReadOnly()===true){g=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LANGUAGE")}if(t[A].getKey()===this.getStandardVariantKey()){g=null}i=new N(this.oVariantManage.getId()+"-edit-"+a,{key:t[A].getKey(),global:t[A].getGlobal(),readOnly:t[A].getReadOnly(),lifecyclePackage:t[A].getLifecyclePackage(),lifecycleTransportId:t[A].getLifecycleTransportId(),namespace:t[A].getNamespace(),labelReadOnly:t[A].getLabelReadOnly(),author:t[A].getAuthor(),favorite:t[A].getFavorite(),vAlign:w.Middle});n=new D(this.oVariantManage.getId()+"-fav-"+a,{press:v});n.addStyleClass("sapUICompVarMngmtFavColor");if(t[A].getFavorite){this._setFavoriteIcon(n,t[A].getFavorite())}i.addCell(n);if(t[A].getKey()===this.getStandardVariantKey()||t[A].getReadOnly()===true||t[A].getLabelReadOnly()===true){n=new M(this.oVariantManage.getId()+"-text-"+a,{});n.setTitle(t[A].getText());if(g){n.setTooltip(g)}}else{n=new V(this.oVariantManage.getId()+"-input-"+a,{liveChange:c,change:p});n.setValue(t[A].getText())}i.addCell(n);if(t[A].getGlobal()){u=this.oResourceBundle.getText("VARIANT_MANAGEMENT_SHARED")}else{u=this.oResourceBundle.getText("VARIANT_MANAGEMENT_PRIVATE")}s=new h(this.oVariantManage.getId()+"-type-"+a,{text:u,wrapping:false});s.addStyleClass("sapUICompVarMngmtType");i.addCell(s);r=new o(this.oVariantManage.getId()+"-def-"+a,{groupName:this.oVariantManage.getId(),select:f});if(this.sNewDefaultKey===t[A].getKey()||t[A].getKey()===this.getStandardVariantKey()&&this.sNewDefaultKey===""){r.setSelected(true);if(t[A].getFavorite){this._setFavoriteIcon(i.getCells()[0],true)}}i.addCell(r);l=new S(this.oVariantManage.getId()+"-exe-"+a,{selected:false,enabled:false,select:y});if(t[A].getExecuteOnSelection){if(t[A].getKey()===this.getStandardVariantKey()&&this.getSupportExecuteOnSelectOnSandardVariant()){l.setEnabled(true);if(this.bExecuteOnSelectForStandardByUser!==null){l.setSelected(this.bExecuteOnSelectForStandardByUser)}else{l.setSelected(t[A].getExecuteOnSelection())}}else{l.setEnabled(!t[A].getReadOnly());l.setSelected(t[A].getExecuteOnSelection())}if(g){l.setTooltip(g)}}i.addCell(l);i.addCell(new h);s=new h(this.oVariantManage.getId()+"-author-"+a,{text:t[A].getAuthor(),textAlign:"Begin"});i.addCell(s);d=new m(this.oVariantManage.getId()+"-del-"+a,{icon:"sap-icon://decline",enabled:true,type:F.Transparent,press:T,tooltip:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DELETE")});this._assignColumnInfoForDeleteButton(d);if(t[A].getReadOnly&&t[A].getReadOnly()){d.setEnabled(false);d.setVisible(false)}i.addCell(d);this.oManagementTable.addItem(i);a++}this.aRemovedVariants=[];this.aRemovedVariantTransports=[];this.aRenamedVariants=[];this.aExeVariants=[];this._createManagementDialog();this._setDialogCompactStyle(this,this.oManagementDialog);e=this.oVariantList.getSelectedItem();if(e){this.lastSelectedVariantKey=e.getKey()}this.oVariantPopOver.close();this.oManagementDialog.open()};Y.prototype._assignColumnInfoForDeleteButton=function(e){if(!this._oInvisibleDeleteColumnName){this._oInvisibleDeleteColumnName=new C({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ACTION_COLUMN")});this._createManagementDialog();this.oManagementDialog.addContent(this._oInvisibleDeleteColumnName)}if(this._oInvisibleDeleteColumnName){e.addAriaLabelledBy(this._oInvisibleDeleteColumnName)}};Y.prototype._enableManualVariantKey=function(e){this.bManualVariantKey=e};Y.prototype._fireSelectAsync=function(e){var t;if(e===undefined||e===null){var a=this._getSelectedItem();if(a===null){t=this.getStandardVariantKey()}else{t=a.getKey()}}this.fireSelect({key:t})};Y.prototype.setSupportExecuteOnSelectOnSandardVariant=function(e){this.bSupportExecuteOnSelectOnSandardVariant=e};Y.prototype.getSupportExecuteOnSelectOnSandardVariant=function(){return this.bSupportExecuteOnSelectOnSandardVariant};Y.prototype._executeOnSelectForStandardVariantByXML=function(e){this.bExecuteOnSelectForStandardViaXML=e};Y.prototype._executeOnSelectForStandardVariantByUser=function(e){this.bExecuteOnSelectForStandardByUser=e};Y.prototype.getExecuteOnSelectForStandardVariant=function(){if(this.getSupportExecuteOnSelectOnSandardVariant()){if(this.bExecuteOnSelectForStandardByUser!==null){return this.bExecuteOnSelectForStandardByUser}}return this.bExecuteOnSelectForStandardViaXML};Y.prototype.getStandardVariantKey=function(){return this._sStandardVariantKey};Y.prototype.setStandardVariantKey=function(e){this._sStandardVariantKey=e};Y.prototype._setVendorLayer=function(e){this._bVendorLayer=e};Y.prototype.setStandardFavorite=function(e){this._isFavorite=e};Y.prototype.getStandardFavorite=function(){return this._isFavorite};Y.prototype._isIndustrySolutionModeAndVendorLayer=function(){if(this._getIndustrySolutionMode()&&this._bVendorLayer){return true}return false};Y.prototype._setIndustrySolutionMode=function(e){this._bIndustrialSolutionMode=e};Y.prototype._getIndustrySolutionMode=function(){return this._bIndustrialSolutionMode};return Y});