/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/base/Object","sap/ui/dom/includeScript","sap/collaboration/library"],function(Log,BaseObject,includeScript,library){"use strict";var FeedType=library.FeedType;var JamUtil=BaseObject.extend("sap.collaboration.components.utils.JamUtil",{FeedRenderedControllerConstants:{jamWidgetCSS:{avatar:false,skin:"gr",post_mode:"inline",reply_mode:"inline",mobile_mode:true,live_update:true}},JamFeedType:{Follows:"follows",Company:"company",Group:"group",ObjectGroup:"context",Object:"external"},JamCallback:{autocomplete:"autocomplete",post_status:"post_status",link:"link"},JamEventType:{mouseover:"mouseover",mouseout:"mouseout",click:"click"},loadFeedWidgetScript:function(e,t,a){var o=e+"/assets/feed_widget_v1.js";includeScript(o,"sap.collaboration.feed.JamFeedWidget",t,a);Log.info("Jam Feed Widget Script Loading Asynchronously","sap.collaboration.components.utils.JamUtil.loadFeedWidgetScript()")},initializeJamWidget:function(sJamURL){try{this.sapjam=eval("sapjam");this.sapjam.feedWidget.init(sJamURL+"/widget/v1/feed","single_use_token");Log.info("Jam Feed Widget Initialized","sap.collaboration.components.utils.JamUtil.initializeJamWidget()")}catch(e){Log.error(e,"","sap.collaboration.components.utils.JamUtil.initializeJamWidget()");throw e}},createJamWidget:function(sWidgetContainerID,oWidgetData){try{Log.debug("Jam Feed Widget Properties:","","sap.collaboration.components.utils.JamUtil.createJamWidget()");Log.debug("type: "+JSON.stringify(oWidgetData.type));Log.debug("group_id: "+JSON.stringify(oWidgetData.group_id));Log.debug("external_id: "+JSON.stringify(oWidgetData.external_id));Log.debug("external_type: "+JSON.stringify(oWidgetData.external_type));Log.debug("external_object: "+JSON.stringify(oWidgetData.external_object));this.sapjam=eval("sapjam");this.sapjam.feedWidget.create(sWidgetContainerID,oWidgetData)}catch(e){Log.error(e,"","sap.collaboration.components.utils.JamUtil.createJamWidget()");throw e}},prepareWidgetData:function(e,t,a,o){var i;i={type:t,avatar:this.FeedRenderedControllerConstants.jamWidgetCSS.avatar,live_update:this.FeedRenderedControllerConstants.jamWidgetCSS.live_update,post_mode:this.FeedRenderedControllerConstants.jamWidgetCSS.post_mode,reply_mode:this.FeedRenderedControllerConstants.jamWidgetCSS.reply_mode,mobile_mode:this.FeedRenderedControllerConstants.jamWidgetCSS.mobile_mode,hide_bookmark:true,single_use_token:e};switch(t){case FeedType.follows:case FeedType.company:i.type=t;break;case FeedType.group:case FeedType.objectGroup:i.type=this.JamFeedType.Group;i.group_id=a;break;case FeedType.object:i.type=this.JamFeedType.Object;if(!o){var r=new Error("Object is undefined");Log.error(r,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw r}if(!o.id){var n=new Error("Property 'id' is undefined");Log.error(n,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw n}if(!o.type){var s=new Error("Property 'type' is undefined");Log.error(s,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw s}try{i.external_id=o.id;i.external_type=o.type;i.external_object=o}catch(e){Log.error(e,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw e}break;default:var d="Feed Type not supported";Log.error(d,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw new Error(d)}return i},getJamSinglelUseTokens:function(e,t,a,o){var i=new window.XMLHttpRequest;var r=e+"/single_use_tokens";i.open("POST",r,a);i.onreadystatechange=t;i.setRequestHeader("x-csrf-token",o);i.send()},getCSRFToken:function(e,t,a){var o=new window.XMLHttpRequest;o.open("GET",e,a);o.onreadystatechange=t;o.setRequestHeader("x-csrf-token","fetch");o.send()}});return JamUtil});