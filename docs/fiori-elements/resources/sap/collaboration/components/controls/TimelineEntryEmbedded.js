/*
* ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
*/
sap.ui.define(["sap/ui/core/Control","sap/ui/dom/includeStylesheet","sap/collaboration/components/utils/LanguageBundle","sap/collaboration/components/controls/TimelineEntryEmbeddedRenderer","sap/m/Text","sap/m/Link","sap/m/List","sap/m/FeedListItem","sap/m/Popover","sap/m/library"],function(e,t,i,n,a,r,s,o,l,p){"use strict";var m=p.PlacementType;var T=e.extend("sap.collaboration.components.controls.TimelineEntryEmbedded",{metadata:{interfaces:[],library:"sap.collaboration",properties:{timelineEntry:{type:"object",group:"data"}},events:{},aggregations:{}},renderer:n});T.prototype.init=function(){this._oLangBundle=new i;t(sap.ui.require.toUrl("sap/collaboration/components/resources/css/EmbeddedControl.css"));this._aTimelineItemTextDisplay};T.prototype.onBeforeRendering=function(){if(!this._aTimelineItemTextDisplay){this._createTimelineItemText()}};T.prototype.exit=function(){if(this._aTimelineItemTextDisplay){this._aTimelineItemTextDisplay.forEach(function(e){e.destroy()})}if(this._oPopover){this._oPopover.destroy()}};T.prototype._getTimelineItemTextControls=function(){return this._aTimelineItemTextDisplay};T.prototype._createTimelineItemText=function(){var e=this.getTimelineEntry();this._aTimelineItemTextDisplay=[];if(e.timelineEntryDetails!=undefined&&e.timelineEntryDetails.length>0){var t=this._parseTimelineEntryDetail(e.timelineEntryDetails[0]);this._aTimelineItemTextDisplay.push(new a({text:t+" "}).addStyleClass("alignMiddle"));if(e.timelineEntryDetails.length>1){var i=this._createTLEntryDetailsLink(e.timelineEntryDetails).addStyleClass("alignMiddle");this._aTimelineItemTextDisplay.push(i)}}else{this._aTimelineItemTextDisplay.push(new a({text:e.text}).addStyleClass("alignMiddle"))}};T.prototype._renderTimelineItemText=function(e){var t="Â ";if(this._aTimelineItemTextDisplay.length>0){e.openStart("div",this).openEnd();for(var i=0;i<this._aTimelineItemTextDisplay.length;i++){var n=this._aTimelineItemTextDisplay[i].getMetadata().getName();switch(n){case"sap.m.Text":var a=this._aTimelineItemTextDisplay[i].getText();if(a.search(/\s/)==0){var r=a.search(/\S/);do{e.text(t);r--}while(r>0)}e.renderControl(this._aTimelineItemTextDisplay[i]);if(a[a.length-1]==" "){var s=a.length-1;var o=a[s];do{e.text(t);o=a[--s]}while(o==" "&&o!=undefined)}break;case"sap.m.Link":case"sap.ui.core.HTML":default:e.renderControl(this._aTimelineItemTextDisplay[i])}}e.close("div")}};T.prototype._createTLEntryDetailsLink=function(e){var t=this;var i=e.length-1;var n=this._oLangBundle.getText("TE_LINK_TEXT",i);var a=new r(this.getId()+"_PopoverLink",{text:n});a.attachPress(function(){if(!t._oPopover){t._oPopover=t._createTLEntryDetailsPopover(e)}t._oPopover.openBy(a)});return a};T.prototype._createTLEntryDetailsPopover=function(e){var t=new s(this.getId()+"_ChangeList",{inset:false});for(var i in e){var n=this._parseTimelineEntryDetail(e[i]);var a=new o({text:n,showIcon:false});t.addItem(a)}var r="20em";var p=new l(this.getId()+"_Popover",{contentWidth:r,placement:m.Auto,title:this._oLangBundle.getText("TE_DETAILS_POPOVER_HEADER")+"("+e.length+")",content:[t]});return p};T.prototype._parseTimelineEntryDetail=function(e){var t="";switch(e.changeType){case"U":t=this._oLangBundle.getText("TE_DETAILS_CHANGED",[e.propertyLabel,e.beforeValue,e.afterValue]);break;case"I":t=this._oLangBundle.getText("TE_DETAILS_SET",[e.propertyLabel,e.afterValue]);break;case"D":t=this._oLangBundle.getText("TE_DETAILS_CLEARED",[e.propertyLabel,e.beforeValue]);break}return t};return T});