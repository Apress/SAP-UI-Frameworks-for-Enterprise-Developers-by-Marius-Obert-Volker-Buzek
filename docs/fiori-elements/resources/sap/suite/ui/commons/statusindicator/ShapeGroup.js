/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/Configuration","sap/suite/ui/commons/statusindicator/util/ProgressHandler","sap/base/Log"],function(e,t,i,r,a){"use strict";var o=e.extend("sap.suite.ui.commons.statusindicator.ShapeGroup",{metadata:{library:"sap.suite.ui.commons",properties:{weight:{type:"int",defaultValue:10}},defaultAggregation:"shapes",aggregations:{shapes:{type:"sap.suite.ui.commons.statusindicator.Shape",multiple:true}}},renderer:null});o.prototype.init=function(){this._iTargetValue=0;this._oAnimationPropertiesResolver=null;this._iLastDirectValueUpdate=0};o.prototype.discreteThresholdsChangeHandler=function(e){var t=this._oAnimationPropertiesResolver._getGroupValue(this,e);if(t!==this._iLastDirectValueUpdate){this.getShapes().forEach(function(e){e._updateDom(t,true)});this._iLastDirectValueUpdate=t}};o.prototype.propertyThresholdsChangeHandler=function(e){this.getShapes().forEach(function(t){if(t.getDisplayedValue()!==0){t.getRenderer()._updateDomColor(t,e)}})};o.prototype._injectAnimationPropertiesResolver=function(e){this._oAnimationPropertiesResolver=e;this._oAnimationPropertiesResolver.addDiscreteThresholdChange(this.discreteThresholdsChangeHandler.bind(this));this._oAnimationPropertiesResolver.addPropertyThresholdChange(this.propertyThresholdsChangeHandler.bind(this));this.getShapes().forEach(function(t){t._injectAnimationPropertiesResolver(e)})};o.prototype.addShape=function(e){this.addAggregation("shapes",e,true);e._injectAnimationPropertiesResolver(this._oAnimationPropertiesResolver);return this};o.prototype._setValue=function(e,t){var i=this;t=t||false;this._iTargetValue=e;if(!this._isAnimationAllowed()||t){this.getShapes().forEach(function(e){e._updateDom(i._iTargetValue)});return Promise.resolve()}this.getShapes().forEach(function(e){if(!e.getAnimationOnChange()){e._updateDom(i._iTargetValue)}});if(this.oCurrentProgressHandler&&this.oCurrentProgressHandler.isInProgress()){this.oCurrentProgressHandler.cancel()}this.oCurrentProgressHandler=new r(function(e){var t=performance.now();i._animationStep(t,e,t)});return this.oCurrentProgressHandler.start()};o.prototype._animationStep=function(e,t,i){a.debug("AnimationStep at time: "+i.toString(10),null,this);i=Math.max(i,e);if(t.isCanceled()){t.stop({cancelled:true});return}var r=true;var o=this._iTargetValue;this.getShapes().forEach(function(t){var a=t.getDisplayedValue();if(a===o){return}var n=e+t.getFullAnimationDuration()*Math.abs(o-a)/100;var s=o;if(i<n){var u=o-a;var h=n-e;var p=(i-e)/h;s=u*p+a;r=false}t._updateDom(s)});if(r){t.finish()}else{window.requestAnimationFrame(this._animationStep.bind(this,i,t))}};o.prototype._showsFullProgress=function(){return!this.getShapes().some(function(e){return e.getDisplayedValue()!==100})};o.prototype._setInitialValue=function(e){this._iTargetValue=e;this._iLastDirectValueUpdate=e;this.getShapes().forEach(function(t){t._setInitialValue(e)})};o.prototype._isAnimationAllowed=function(){var e=t.getConfiguration();var r=e.getAnimationMode();return r!==i.AnimationMode.none};return o});