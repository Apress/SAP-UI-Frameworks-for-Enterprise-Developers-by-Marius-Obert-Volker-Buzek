sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/base/ManagedObject","sap/ui/core/delegate/ItemNavigation","sap/ui/core/ResizeHandler"],function(t,e,i,s,o,r,n){"use strict";var l=e.MicroProcessFlowRenderType;var a=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var c=function(t){return t[t.length-1]};var h=i.extend("sap.suite.ui.commons.MicroProcessFlow",{metadata:{library:"sap.suite.ui.commons",interfaces:["sap.ui.core.IFormContent"],properties:{ariaLabel:{type:"string",defaultValue:null},renderType:{type:"sap.suite.ui.commons.MicroProcessFlowRenderType",defaultValue:sap.suite.ui.commons.MicroProcessFlowRenderType.Wrap},width:{type:"sap.ui.core.CSSSize",defaultValue:""}},aggregations:{content:{type:"sap.suite.ui.commons.MicroProcessFlowItem",multiple:true,singularName:"content"}}},renderer:{apiVersion:2,render:function(t,e){var i=e.getContent(),s=e.getWidth(),o=i.length,r=e.getAriaLabel();if(!e._bThemeApplied){return}t.openStart("div",e);t.attr("role","listbox");t.attr("aria-roledescription",a.getText("ACC_CTR_TYPE_MICRO_PROCESS_FLOW"));t.attr("aria-label",r);if(s){t.style("width",s)}t.class("sapSuiteUiCommonsMicroProcessFlow");t.openEnd();if(e._hasScrolling()){t.openStart("div");t.attr("tabindex","0");t.attr("id",e.getId()+"-leftscroller");t.class("sapSuiteUiCommonsMicroProcessFlowScroller").class("sapSuiteUiCommonsMicroProcessFlowLeftScroller");t.openEnd();t.renderControl(e._getLeftScroller());t.openStart("span");t.attr("id",e.getId()+"-leftlabel");t.class("sapSuiteUiCommonsMicroProcessFlowLeftLabel");t.openEnd();t.close("span");t.close("div")}t.openStart("div");t.attr("id",e.getId()+"-content");t.class("sapSuiteUiCommonsMicroProcessFlowContent");t.openEnd();t.openStart("div");t.attr("id",e.getId()+"-scrolling");t.class("sapSuiteUiCommonsMicroProcessFlowScrolling").class("sapSuiteUiCommonsMicroProcessFlowScrollingTransition");if(e.getRenderType()===l.Wrap){t.style("flex-wrap","wrap")}t.openEnd();i.forEach(function(e,i){e._setAccessibilityData(i+1,o);t.renderControl(e)});t.close("div");t.close("div");if(e._hasScrolling()){t.openStart("div");t.attr("id",e.getId()+"-rightscroller");t.attr("tabindex","0");t.class("sapSuiteUiCommonsMicroProcessFlowScroller").class("sapSuiteUiCommonsMicroProcessFlowRightScroller");t.openEnd();t.openStart("span");t.attr("id",e.getId()+"-rightlabel");t.class("sapSuiteUiCommonsMicroProcessFlowRightLabel");t.openEnd();t.close("span");t.renderControl(e._getRightScroller());t.close("div")}t.close("div")}}});h.prototype.exit=function(){if(this._oLeftScroller){this._oLeftScroller.destroy()}if(this._oRightScroller){this._oRightScroller.destroy()}};h.prototype.init=function(){sap.ui.getCore().attachThemeChanged(function(){this._bThemeApplied=true;this.invalidate()},this);this._bThemeApplied=sap.ui.getCore().isThemeApplied();this._iScrollingIndex=0;this._iLastVisibleIndex=0;this._aEdges=[];this._aWidths=[];this._aSeperatorWidth=[]};h.prototype.onAfterRendering=function(){this._correctSeparatorWidth();this._setupKeyboard();if(this._hasScrolling()){this._setupScrolling();this._collectEdgesAndWidths();this._updateScrollingElements();if(this.getRenderType()===l.ScrollingWithResizer){this._oResizer=n.register(this,t.proxy(this._performResizeChanges,this))}}};h.prototype._performResizeChanges=function(){this._collectEdgesAndWidths();this._updateScrollingElements()};h.prototype._isLastItem=function(t){return t===this.getContent()[this.getContent().length-1]};h.prototype._getMaxHeight=function(e){return Math.max.apply(null,this.$().find(".sapSuiteUiCommonsMicroProcessFlowItemWrapper").map(function(){return t(this).height()}).get())};h.prototype._correctSeparatorWidth=function(){var t=this._getMaxHeight();if(t){this.getContent().forEach(function(e){var i=e.getStepWidth(),s;if(i.indexOf("%")!==-1){s=parseInt(i,10);if(!isNaN(s)){e.$("separator").width(t/s*100)}}},this)}};h.prototype._firePress=function(){if(this._oItemNavigation){var t=this._oItemNavigation.getFocusedIndex(),e=this.getContent()[t];if(e){e._firePress()}}};h.prototype._setupKeyboard=function(){var t=this.getDomRef(),e=this.getContent(),i=[];e.forEach(function(t,e){var s=t._getAccessibleItem();i.push(s[0])});if(!this._oItemNavigation){this._oItemNavigation=new r;this.addDelegate(this._oItemNavigation)}this._oItemNavigation.setRootDomRef(t);this._oItemNavigation.setItemDomRefs(i);this._oItemNavigation.setCycling(false);this._oItemNavigation.attachEvent(r.Events.AfterFocus,function(t){if(this._bKeyBoard===true){this._findEdgeItems(t.getParameter("index"));this._updateScrollingElements()}this._bKeyBoard=false}.bind(this))};h.prototype._hasScrolling=function(){var t=this.getRenderType();return t===l.Scrolling||t===l.ScrollingWithResizer};h.prototype._setupScrolling=function(){var t=this.$("leftscroller"),e=this.$("rightscroller");this._iScrollingIndex=0;this._iLastVisibleIndex=0;t.on("click",this._scroll.bind(this,-1));e.on("click",this._scroll.bind(this,1));this._iScrollingIndex<=0?t.hide():t.show()};h.prototype._updateScrollingElements=function(t){var e=this.getContent(),i=this.$("leftscroller"),s=this.$("rightscroller");i[this._iScrollingIndex<=0?"hide":"show"]();this._iLastVisibleIndex=this._findLastVisibleItemIndex(t);s[this._iLastVisibleIndex>=e.length-1?"hide":"show"]();this.$("leftlabel").text(this._iScrollingIndex);this.$("rightlabel").text(e.length-1-this._iLastVisibleIndex)};h.prototype._scroll=function(t,e){e.stopPropagation();var i=this.$("rightscroller"),s=this.$("leftscroller"),o=sap.ui.getCore().getConfiguration().getRTL(),r,n,l;var a=function(){if(t>0){var e=this.$("content").width()-(s.is(":visible")?0:s.width()),o=c(this._aEdges)+c(this._aWidths);if(r+e>o){r-=r+e-o+i.width();for(var n=0;n<this._aEdges;n++){if(this._aEdges[n]+this._aWidths[n]>r){this._iScrollingIndex=n;break}}}}}.bind(this);var h=function(){if(!o&&d[0].scrollLeft!=0){this._clearScroll(d)}if(o){l=d.scrollRightRTL();if(l){this._clearScroll(d)}}}.bind(this);var p=this.$("scrolling"),d=p.parent();this._bKeyBoard=false;if(t<0&&this._iScrollingIndex<=0){return}h();t<0?i.show():s.show();this._iScrollingIndex+=t;r=this._aEdges[this._iScrollingIndex];a();n="translateX("+(o?1:-1)*r+"px)";this.$("scrolling").css("transform",n);if(!p.hasClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition")){setTimeout(function(){p.addClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition")},0)}this._updateScrollingElements(t);h()};h.prototype._clearScroll=function(t){var e=sap.ui.getCore().getConfiguration().getRTL();if(t&&t[0]){e?t.scrollLeftRTL(t[0].scrollWidth-t[0].clientWidth):t[0].scrollLeft=0}};h.prototype._findLastVisibleItemIndex=function(t){var e=this._aEdges[this._iScrollingIndex],i=this.$("content").width(),s=i+this.$("rightscroller").width(),o,r=0,n;for(var l=0;l<this._aEdges.length;l++){o=this._aEdges[l];if(o+this._aWidths[l]-this._aSeperatorWidth[l]<e+i){r=l}else{if(o+this._aWidths[l]<e+s){n=true}else{n=false;break}}}return n&&t!==-1?this.getContent().length-1:r};h.prototype._collectEdgesAndWidths=function(){var t=0;this._aEdges=[];this._aWidths=[];this._aSeperatorWidth=[];this.getContent().forEach(function(e,i){var s=e.$().width(),o=e.$().find(".sapSuiteUiCommonsMicroProcessFlowItemSeparatorWrapper").width();this._aEdges.push(t);this._aWidths.push(s);this._aSeperatorWidth.push(o?o:0);t+=s},this)};h.prototype._getLeftScroller=function(){if(!this._oLeftScroller){this._oLeftScroller=new s(this.getId()+"leftscroller",{src:"sap-icon://nav-back"});this._oLeftScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow")}return this._oLeftScroller};h.prototype._getRightScroller=function(){if(!this._oRightScroller){this._oRightScroller=new s(this.getId()+"rightscroller",{src:"sap-icon://navigation-right-arrow"});this._oRightScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow")}return this._oRightScroller};h.prototype._findEdgeItems=function(t){var e=this.$("scrolling"),i=e.parent(),s=this.getContent(),o=Math.abs(e.position().left),r,n,l=-1,a=-1;if(o<10||t===0){l=0;this._clearScroll(i)}if(t===s.length-1){a=s.length-1}r=e.width();for(var c=0;c<this._aEdges.length;c++){n=this._aEdges[c];if(l===-1&&n>=o){l=c}if(a===-1&&n+this._aWidths[c]>o+r+5){a=c-1;break}}this._iScrollingIndex=l;this._iLastVisibleIndex=a!==-1?a:s.length-2};h.prototype._processKeyPress=function(){if(this._hasScrolling()){var t=this.$("scrolling");this._bKeyBoard=true;t.removeClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition");t.css("transform","")}};h.prototype.onsapspace=function(){this._firePress()};h.prototype.onsapenter=function(){this._firePress()};h.prototype.onsapnext=function(t){this._processKeyPress()};h.prototype.onsapprevious=function(){this._processKeyPress()};h.prototype.onsaphome=function(t){this._processKeyPress()};h.prototype.onsapend=function(){this._processKeyPress()};h.prototype.getAccessibilityInfo=function(){var t="";this.getAggregation("content").forEach(function(e){t=t.concat(e._getAriaText())});return{type:a.getText("ACC_CTR_TYPE_MICRO_PROCESS_FLOW"),description:t}};h.prototype.getFormDoNotAdjustWidth=function(){return true};return h});