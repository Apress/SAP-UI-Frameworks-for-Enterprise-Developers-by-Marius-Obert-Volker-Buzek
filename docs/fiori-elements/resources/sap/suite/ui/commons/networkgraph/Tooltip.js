/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./SvgBase","./Line","./Node","./Group","sap/m/ResponsivePopover","sap/m/Popover","sap/m/List","sap/m/OverflowToolbar","sap/m/Button","sap/m/CustomListItem","sap/m/FlexBox","sap/m/HBox","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/Panel","sap/m/StandardListItem","sap/m/Text","sap/m/ToolbarSpacer","sap/ui/core/Icon","sap/m/FlexItemData","sap/ui/core/library","sap/m/library","sap/ui/Device"],function(t,e,o,i,n,s,p,r,a,l,d,h,c,u,_,m,f,T,g,v,w,C,y,P){"use strict";var S=y.PlacementType;var A=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var x=e.extend("sap.suite.ui.commons.networkgraph.Tooltip",{metadata:{library:"sap.suite.ui.commons",events:{afterOpen:{},afterClose:{}}}});x.prototype.init=function(){this._oPopover=null;this._oElement=null};x.prototype.create=function(e){var o;this._oPopover=new s(this.getId()+"-tooltip",{showHeader:false,placement:this.getParent()._bIsRtl?S.PreferredLeftOrFlip:S.PreferredRightOrFlip,afterOpen:function(){this.fireAfterOpen()}.bind(this),afterClose:function(){this.fireAfterClose()}.bind(this),beforeOpen:function(){this._fnCreate()}.bind(this),contentWidth:"350px"}).addStyleClass("sapSuiteUiCommonsNetworkTooltip");this._oSimpleTooltip=new p({contentMinWidth:"350px",showHeader:false});this.addDependent(this._oPopover);o=this._oPopover.getAggregation("_popup");if(o){o._afterAdjustPositionAndArrowHook=function(){var e=this.$("arrow"),o=this.$().position().top,i=e.position().top,n=15,s=t(window).height(),p=o+i-n;if(s>p+this.$().height()){e.css("top",n+"px");this.$().css("top",p+"px")}}}};x.prototype.instantClose=function(){var t=this._oPopover.getAggregation("_popup");if(t&&t.oPopup&&t.oPopup.close){t.oPopup.close(0)}if(this._oSimpleTooltip.oPopup&&this._oSimpleTooltip.oPopup.close){this._oSimpleTooltip.oPopup.close(0)}};x.prototype.close=function(){this._oPopover.close()};x.prototype.openDetail=function(t){var e=t.opener||this._getOpener(t.item,t.point);if(t.item instanceof i&&!t.item._hasDetailData()){this._oSimpleTooltip.removeAllContent();var o=t.item.getTitle();var n=o?o:t.item.getAltText();this._appendHeader(n,this._oSimpleTooltip);this._oSimpleTooltip.openBy(e);return}this._fnCreate=this._createDetail;this._oElement=t.item;this._oPopover.openBy(e)};x.prototype._createDetail=function(){var t=this._getTooltipCreateFunction(this._oElement);this._oPopover.removeAllContent();this._appendFooter();t(this._oElement)};x.prototype.openLink=function(t){this._oElement=t.item;this._fnCreate=this._createLink;this._oPopover.openBy(t.opener)};x.prototype._createLink=function(t){var e=new r,o=this._oElement;this._oPopover.removeAllContent();this._appendHeader(A.getText("NETWORK_GRAPH_TOOLTIP_EXTERNAL_LINKS"));o.getActionLinks().forEach(function(t){e.addItem(new d({content:[new c({renderType:"Bare",items:t.clone(null,null,{cloneChildren:true,cloneBindings:false}).addStyleClass("sapUiTinyMargin")})]}))});this._oPopover.addContent(e);this._appendFooter()};x.prototype._getOpener=function(t,e){if(t instanceof o&&e){if(this._oElement===t&&this._tooltipRect){var i=parseInt(this._tooltipRect.getAttribute("x"),10),n=parseInt(this._tooltipRect.getAttribute("y"),10),s=10;if(Math.abs(i-e.x)<s&&Math.abs(n-e.y)<s){return this._tooltipRect}}this._cleanUpLineTooltip();this._tooltipRect=this._createElement("rect",{x:e.x,y:e.y,width:P.browser.firefox?.01:0,height:P.browser.firefox?.01:0});this.getParent().$svg.append(this._tooltipRect);return this._tooltipRect}return t};x.prototype._getTooltipCreateFunction=function(t){if(t instanceof i){return this._createNodeTooltip.bind(this)}if(t instanceof o){return this._createLineTooltip.bind(this)}if(t instanceof n){return this._createGroupTooltip.bind(this)}return null};x.prototype._cleanUpLineTooltip=function(){if(this._tooltipRect){t(this._tooltipRect).remove()}};x.prototype._appendDescription=function(t,e){if(t.getDescription()){e=e||this._oPopover;e.addContent(new m({content:new T({textAlign:"Initial",text:t.getDescription()}).addStyleClass("sapSuiteUiCommonsNetworkTooltipDescription")}).addStyleClass("sapSuiteUiCommonsNetworkTooltipArea"))}};x.prototype._appendAttributes=function(t,e){var o=new r,i=e||this._oPopover;if(t.length>0){t.forEach(function(t){o.addItem(new d({content:[new c({items:[new T({layoutData:[new w({baseSize:"50%"})],text:t.getLabel()}),new T({layoutData:[new w({baseSize:"50%"})],text:t.getValue(),width:"100%",textAlign:C.TextAlign.End})]}).addStyleClass("sapSuiteUiCommonsNetworkTooltipLine")]}));i.addContent(o)})}};x.prototype._appendNodesList=function(t,e){var o=new r;t.aNodes.forEach(function(t){var e=t.getTitle();var i=e?e:t.getAltText();if(t.getTitle()){o.addItem(new f({title:i,icon:t.getIcon()}))}});e.addContent(o)};x.prototype._appendFooter=function(){var t=this;this.oCloseButton=new l({text:A.getText("NETWORK_GRAPH_CLOSE"),press:function(){t._oPopover.close()}});this._oPopover.setEndButton(this.oCloseButton);this._oPopover.setInitialFocus(this.oCloseButton)};x.prototype._appendHeader=function(t,e){e=e||this._oPopover;if(t){var o=new T({width:"100%",textAlign:C.TextAlign.Center,text:t});e.insertContent(new m({width:"100%",content:[o]}).addStyleClass("sapSuiteUiCommonsNetworkTooltipArea"),0);e.addAriaLabelledBy(o)}};x.prototype._createGroupTooltip=function(t){var e=function(){return t.getAttributes().length>0||t.getDescription()};var o,i;this._appendHeader(t.getTitle());if(e()){i=new _({text:A.getText("NETWORK_GRAPH_TOOLTIP_LIST_OF_NODES")});o=new _({text:A.getText("NETWORK_GRAPH_TOOLTIP_INFORMATION")});this._oPopover.addContent(new u({items:[o,i]}));this._oPopover.addStyleClass("sapSuiteUiCommonsNetworkGroupTooltipTabBar");this._appendDescription(t,o);this._appendAttributes(t.getAttributes(),o);this._appendNodesList(t,i)}else{this._appendNodesList(t,this._oPopover)}};x.prototype._createNodeTooltip=function(t){this._appendDescription(t);this._appendAttributes(t.getAttributes());var e=t.getTitle();var o=e?e:t.getAltText();this._appendHeader(o)};x.prototype._createLineTooltip=function(t,e){var o=function(){var e=t.getFromNode().getTitle();var o=t.getToNode().getTitle();var i=new T({width:"50%",text:e?e:t.getFromNode().getAltText()}).addStyleClass("sapSuiteUiCommonsNetworkGraphNoPointerEvents sapSuiteUiCommonsNetworkLineTooltipLabel"),n=new v({src:"sap-icon://arrow-right"}).addStyleClass("sapUiTinyMarginEnd sapSuiteUiCommonsNetworkGraphNoPointerEvents sapSuiteUiCommonsNetworkLineTooltipFromToIcon"),s=new v({src:"sap-icon://arrow-left"}).addStyleClass("sapUiTinyMarginBegin sapSuiteUiCommonsNetworkGraphNoPointerEvents sapSuiteUiCommonsNetworkLineTooltipFromToIcon"),p=new T({textAlign:C.TextAlign.End,width:"50%",text:o?o:t.getToNode().getAltText()}).addStyleClass("sapSuiteUiCommonsNetworkGraphNoPointerEvents sapSuiteUiCommonsNetworkLineTooltipLabel"),r=new h({renderType:"Bare",width:"100%",justifyContent:"Center",items:[i]}).addStyleClass("sapSuiteUiCommonsNetworkLineTooltipFromTo");t._isBothArrow()?r.addItem(s):n.addStyleClass("sapUiTinyMarginBegin");r.addItem(n);r.addItem(p);return r},i=function(){var e=t.getTitle();this._oPopover.addContent(o());if(e){this._appendHeader(e)}this._appendDescription(t);this._appendAttributes(t.getAttributes())}.bind(this);i(t)};return x});