/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/theming/Parameters","sap/m/library","sap/base/Log"],function(t,e,a){"use strict";var i;var r={apiVersion:2};r.TOTAL_RADIUS_ABSOLUTE=3.625;r.OUTER_RADIUS_ABSOLUTE=3.25;r.SELECTION_THICKNESS_ABSOLUTE=.375;r.HOLE_SIZE_RATIO_COMPACT=.48;r.HOLE_SIZE_RATIO_COZY=.48;r.SEGMENT_HALF_GAP_SIZE=0;r.SEGMENT_HALF_GAP_SIZE_HCB=.5;r.GHOST_BORDER_HALF_THICKNESS_HCB=.5;r.render=function(t,e){if(!e._bThemeApplied){return}i=i||sap.ui.require("sap/suite/ui/microchart/InteractiveDonutChart");this._aSegments=e.getSegments();var a=e._iVisibleSegments;this._fSegmentHalfGapSize=this.SEGMENT_HALF_GAP_SIZE;this._fGhostHalfGapSize=0;if(this._isThemeHighContrast()){this._fSegmentHalfGapSize=this.SEGMENT_HALF_GAP_SIZE_HCB;this._fGhostHalfGapSize=this.GHOST_BORDER_HALF_THICKNESS_HCB}if(e.getShowError()){t.openStart("div",e);t.class("sapSuiteUiMicroChartNoData");t.openEnd();t.renderControl(e._oIllustratedMessageControl);t.close("div");return}t.openStart("div",e);t.class("sapSuiteIDC");if(!e._isChartEnabled()){var r=e.getTooltip_AsString();if(typeof r==="string"||r instanceof String){t.attr("title",r)}}var s={};s.role="listbox";s.roledescription=e._oRb.getText("INTERACTIVEDONUTCHART");s.multiselectable=true;s.disabled=!e._isChartEnabled();s.labelledby=e.getAriaLabelledBy();t.accessibilityState(e,s);t.openEnd();if(!e.getSelectionEnabled()){this._renderDisabledOverlay(t,e)}this._renderDonut(t,e,a);this._renderLegend(t,e,a);t.close("div")};r._renderDonut=function(t,e,a){var r,s,n,o,l,S,_,c,h=e._bCompact;t.openStart("div");t.class("sapSuiteIDCChart");t.openEnd();t.openStart("svg");t.class("sapSuiteIDCChartSVG");t.attr("viewBox","-2 -2 104 104");t.attr("focusable","false");t.openEnd();t.openStart("g");t.attr("transform","translate(50.5 50.5)");t.openEnd();l=50;_=this.OUTER_RADIUS_ABSOLUTE/this.TOTAL_RADIUS_ABSOLUTE*l;if(h){S=this.HOLE_SIZE_RATIO_COMPACT*_}else{S=this.HOLE_SIZE_RATIO_COZY*_}c=l*(this.SELECTION_THICKNESS_ABSOLUTE/this.TOTAL_RADIUS_ABSOLUTE);s=this._calculateSum(e);n=0;var d;for(d=0;d<a;d++){r=this._aSegments[d];if(r.getValue()>0){o=this._calculateSegmentPath(s,r.getValue(),n,_+c,S-c,this._fGhostHalfGapSize);t.openStart("path");t.attr("d",o);t.attr("data-sap-ui-idc-selection-index",d);t.class(i.CHART_SEGMENT_GHOST.CSSCLASS);if(r.getSelected()){t.class(i.CHART_SEGMENT_GHOST.CSSCLASS_SELECTED)}t.openEnd();if(e._isChartEnabled()){this._renderTitle(r.getTooltip_AsString(),t)}t.close("path");n+=this._aSegments[d].getValue()}}n=0;for(d=0;d<a;d++){r=this._aSegments[d];if(r.getValue()>0){o=this._calculateSegmentPath(s,r.getValue(),n,_,S,0);t.openStart("path");t.attr("d",o);t.attr("fill",this._getSegmentColor(d,a));t.attr("cursor","pointer");t.attr("data-sap-ui-idc-selection-index",d);t.class(i.CHART_SEGMENT.CSSCLASS);if(r.getSelected()){t.class(i.CHART_SEGMENT.CSSCLASS_SELECTED)}t.openEnd();if(e._isChartEnabled()){this._renderTitle(r.getTooltip_AsString(),t)}t.close("path");n+=this._aSegments[d].getValue()}}t.close("g");t.close("svg");t.close("div")};r._renderLegend=function(t,e,a){t.openStart("div");t.class("sapSuiteIDCLegend");t.openEnd();for(var i=0;i<a;i++){this._renderLegendSegment(t,e,i,a)}t.close("div")};r._renderLegendSegment=function(t,a,r,s){var n=this._aSegments[r],o=n.getLabel(),l=n.getDisplayedValue()||String(n.getValue()),S,_=n._getSemanticColor();if(n._bNullValue){l=a._oRb.getText("INTERACTIVECHART_NA")}l=l.substring(0,i.CHART_SEGMENT_LABEL_MAXLENGTH);var S=n.getTooltip_Text();var c;if(S&&S.trim()){c=S}else{c=o;if(c){c=c+" "+l}else{c=l}if(_){c+=" "+_}}var h={};h.role="option";h.label=c.trim();h.selected=n.getSelected();h.posinset=r+1;h.setsize=s;t.openStart("div",a.getId()+"-interactionArea-"+r);t.accessibilityState(n,h);t.attr("data-sap-ui-idc-selection-index",r);t.class("sapSuiteIDCLegendSegment");if(n.getSelected()){t.class(i.SEGMENT_CSSCLASS_SELECTED)}if(r===0&&a.getSelectionEnabled()){t.attr("tabindex","0")}t.openEnd();_=n.getColor();if(_!==e.ValueColor.Neutral){t.openStart("div");t.class("sapSuiteIDCSemanticMarker");t.class("sapSuiteICSemanticColor"+_);t.openEnd();t.close("div")}t.openStart("div");t.class("sapSuiteIDCLegendMarker");t.style("background-color",this._getSegmentColor(r,s));t.openEnd();t.close("div");t.openStart("div");t.class("sapSuiteIDCLegendLabelValue");t.openEnd();t.openStart("div");t.class("sapSuiteIDCLegendLabel");t.openEnd();t.text(o);t.close("div");t.openStart("div");t.class("sapSuiteIDCLegendValue");t.openEnd();t.text(l);t.close("div");t.close("div");t.close("div")};r._getSegmentColor=function(e,a){var i=1-(a-e)/a,r=t.get("_sap_suite_ui_microchart_InteractiveDonutChart_SegmentFillColor")||"white";if(this._isThemeHighContrast()){return r}return this._mixColors(r,"#ffffff",i)};r._calculateSegmentPath=function(t,e,a,i,r,s){var n=.01,o,l,S,_,c,h,d,g,u,f=this._fSegmentHalfGapSize+s,p=Math.pow(2*f,2),E,C,T,m;i=this._formatFloat(i);r=this._formatFloat(r);h=this._calculateCircleFraction(t,a);d=this._calculateCircleFraction(t,a+e);g=this._calculateCircleFraction(t,e);if(g<=Math.PI){u=0}else{u=1}if(t===e){E=r;C=i;T=0;m=0}else{E=Math.sqrt(Math.pow(r,2)+p);C=Math.sqrt(Math.pow(i,2)+p);T=Math.atan(f/r);m=Math.atan(f/i)}l={x:this._formatFloat(E*Math.sin(h+T)),y:this._formatFloat(-E*Math.cos(h+T))};S={x:this._formatFloat(C*Math.sin(h+m)),y:this._formatFloat(-C*Math.cos(h+m))};_={x:this._formatFloat(i*Math.sin(d-m)-n),y:this._formatFloat(-i*Math.cos(d-m))};c={x:this._formatFloat(r*Math.sin(d-T)-n),y:this._formatFloat(-r*Math.cos(d-T))};o="";o+="M"+l.x+" "+l.y+" ";o+="L"+S.x+" "+S.y+" ";o+="A"+i+","+i+" 0 "+u+",1"+" "+_.x+","+_.y+" ";o+="L"+c.x+" "+c.y+" ";o+="A"+r+","+r+" 0 "+u+",0"+" "+l.x+","+l.y;return o};r._formatFloat=function(t){return parseFloat(t.toFixed(2))};r._calculateSum=function(t){var e=0;var a=t.getDisplayedSegments();for(var i=0;i<this._aSegments.length&&i<a;i++){var r=this._aSegments[i].getValue();if(r>0){e+=r}}return e};r._calculateCircleFraction=function(t,e){return 2*Math.PI*e/t};r._renderDisabledOverlay=function(t){t.openStart("div");t.class("sapSuiteIDCDisabledOverlay");t.openEnd();t.close("div")};r._getAriaDescribedBy=function(t,e){var a=[];for(var i=0;i<e;i++){a.push(t.getId()+"-interactionArea-"+i)}return a.join(",")};r._mixColors=function(t,e,a){if(a===1||t.toLowerCase()===e.toLowerCase()){return t}var i=this._hexToRgb(t);var r=this._hexToRgb(e);var s=Math.round((i[0]+Math.abs(i[0]-r[0])*a)%255);var n=Math.round((i[1]+Math.abs(i[1]-r[1])*a)%255);var o=Math.round((i[2]+Math.abs(i[2]-r[2])*a)%255);return"#"+this._intToHex(s)+this._intToHex(n)+this._intToHex(o)};r._isThemeHighContrast=function(){return/(hcw|hcb)/g.test(sap.ui.getCore().getConfiguration().getTheme())};r._hexToRgb=function(t){var e=[];t=t.replace(/[^0-9a-f]+/gi,"");if(t.length===3){e=t.split("")}else if(t.length===6){e=t.match(/(\w{2})/g)}else{a.warning("Invalid color input: hex string must be in the format #FFFFFF or #FFF")}return e.map(function(t){return parseInt(t,16)})};r._intToHex=function(t){var e=t.toString(16);if(e.length===1){e="0"+e}return e};r._renderTitle=function(t,e){if(typeof t==="string"||t instanceof String){e.openStart("title");e.style("visibility","hidden");e.openEnd();e.text(t);e.close("title")}};return r},true);