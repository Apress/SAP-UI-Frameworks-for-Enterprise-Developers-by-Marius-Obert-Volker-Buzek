// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/deepExtend","sap/ui/base/Object","sap/ui/performance/Measurement"],function(e,i,s){"use strict";var t=i.extend("sap.ushell.components._HomepageManager.DashboardLoadingManager",{metadata:{},constructor:function(e,i){var s=sap.ui.getCore().getEventBus();this.currentVisibleTiles=[];this.aRefreshTiles=[];this.oBusyIndicatorTiles={};this.oActiveDynamicTiles={};this.oResolvedTiles={};this.oInProgressTiles={};this.oDashboardManager=i.oDashboardManager;s.subscribe("launchpad","visibleTilesChanged",this._onVisibilityChanged,this);s.subscribe("launchpad","dashboardTileClick",this._addTileToRefreshArray,this);s.subscribe("launchpad","refreshTiles",this._refreshTiles,this);s.subscribe("launchpad","setTilesNoVisibility",this._setTilesNoVisibility,this);s.subscribe("launchpad","onHiddenTab",this._setTilesNoVisibility,this)},_onVisibilityChanged:function(e,i,s){this.currentVisibleTiles=s;if(this.oDashboardManager.isBlindLoading()){this.manageTilesView()}this.oDashboardManager.tabsModeVisibilityChanged();this.manageBusyIndicatorTiles();this.manageDynamicTiles()},manageDynamicTiles:function(){s.average("DashboardLoadingManagerActiveDynamicTile","Manage Active Dynamic Tiles","FLP_SHELL");var i;var t;var a={};var n=e({},this.oActiveDynamicTiles);for(var r=0;r<this.currentVisibleTiles.length;r++){var l=this.currentVisibleTiles[r];if(!l.bIsExtanded){delete n[l.oTile.uuid]}}for(var o in n){i=this.oActiveDynamicTiles[o];t=i.object;this.oDashboardManager.setTileVisible(i,false)}for(var u=0;u<this.currentVisibleTiles.length;u++){var h=this.currentVisibleTiles[u];if(!h.bIsExtanded){i=h.oTile;t=i.object;if(this.oActiveDynamicTiles[i.uuid]===undefined&&t){this.oDashboardManager.setTileVisible(i,true)}a[i.uuid]=i}}this.oActiveDynamicTiles=a;s.end("DashboardLoadingManagerActiveDynamicTile")},isTileViewRequestIssued:function(e){if(this.oInProgressTiles[e.uuid]===undefined&&this.oResolvedTiles[e.uuid]===undefined){return false}return true},manageBusyIndicatorTiles:function(){s.average("DashboardLoadingManagerBusyIndicators","Manage Busy Indicators on Tiles","FLP_SHELL");var e,i,t,a,n=[],r,l=[];for(i in this.oBusyIndicatorTiles){r=true;a=this.oBusyIndicatorTiles[i];if(this.oResolvedTiles[i]===undefined){for(var o=0;o<this.currentVisibleTiles.length;o++){if(this.currentVisibleTiles[o].oTile.uuid===a.oTile.uuid){r=false;break}}if(r){n.push(a)}}}for(e=0;e<this.currentVisibleTiles.length;e++){t=this.currentVisibleTiles[e];if(this.oBusyIndicatorTiles[t.oTile.uuid]===undefined&&this.oResolvedTiles[t.oTile.uuid]===undefined){l.push(t)}}for(e=0;e<n.length;e++){t=n[e];if(t.oTile.content[0]&&t.oTile.content[0].setState){if(t.oTile.content[0].getState){if(t.oTile.content[0].getState()!=="Failed"){t.oTile.content[0].setState()}}else{t.oTile.content[0].setState()}}delete this.oBusyIndicatorTiles[t.oTile.uuid]}for(e=0;e<l.length;e++){t=l[e];if(t.oTile.content[0]&&t.oTile.content[0].setState){if(t.oTile.content[0].getState){if(t.oTile.content[0].getState()!=="Failed"){t.oTile.content[0].setState("Loading")}}else{t.oTile.content[0].setState("Loading")}}this.oBusyIndicatorTiles[t.oTile.uuid]=t}s.end("DashboardLoadingManagerBusyIndicators")},setTileInProgress:function(e){this.oInProgressTiles[e.uuid]=e},setTileResolved:function(e){delete this.oInProgressTiles[e.uuid];this.oResolvedTiles[e.uuid]=e},_addTileToRefreshArray:function(e,i,s){this.aRefreshTiles.push(s.uuid)},_refreshTiles:function(){for(var e=0;e<this.currentVisibleTiles.length;e++){var i=this.currentVisibleTiles[e].oTile;var s=i.object;if(s){for(var t=0;t<this.aRefreshTiles.length;t++){if(i.uuid===this.aRefreshTiles[t]){this.aRefreshTiles.splice(t,1);this.oDashboardManager.setTileVisible(i,true);this.oDashboardManager.refreshTile(i);break}}}}},_setTilesNoVisibility:function(){for(var e=0;e<this.currentVisibleTiles.length;e++){var i=this.currentVisibleTiles[e].oTile;var s=i.object;if(s){this.oDashboardManager.setTileVisible(i,false)}delete this.oActiveDynamicTiles[i.uuid]}},manageTilesView:function(){var e,i,s=[];for(e=0;e<this.currentVisibleTiles.length;e++){i=this.currentVisibleTiles[e];if(this.oInProgressTiles[i.oTile.uuid]===undefined&&this.oResolvedTiles[i.oTile.uuid]===undefined){s.push(i)}}this.oDashboardManager.getTileViewsFromArray(s)}});return t});