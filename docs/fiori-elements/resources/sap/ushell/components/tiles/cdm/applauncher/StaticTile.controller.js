// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/library","sap/ui/core/mvc/Controller","sap/ushell/Config","sap/ushell/utils/WindowUtils","sap/ui/model/json/JSONModel","sap/m/library","sap/base/Log","sap/ushell/utils/UrlParsing"],function(e,t,r,i,o,n,a,s){"use strict";var l=n.GenericTileScope;var p=n.GenericTileMode;var c=e.DisplayFormat;var g=e.AppType;return t.extend("sap.ushell.components.tiles.cdm.applauncher.StaticTile",{_aDoables:[],_getConfiguration:function(){var e=this.getView().getViewData();e.properties.sizeBehavior=r.last("/core/home/sizeBehavior");e.properties.wrappingType=r.last("/core/home/wrappingType");return e},onInit:function(){var e=this.getView();var t=new o;t.setData(this._getConfiguration());e.setModel(t);this._aDoables.push(r.on("/core/home/sizeBehavior").do(function(e){t.setProperty("/properties/sizeBehavior",e)}));var i=this.getView().getViewData();var n=i.properties;var s=i.properties.contentProviderId;n.mode=n.mode||(n.icon?"ContentMode":"HeaderMode");if(n.displayFormat===c.Compact&&n.title&&n.targetURL){t.setProperty("/properties/mode",p.LineMode)}switch(n.displayFormat){case c.Flat:t.setProperty("/properties/frameType","OneByHalf");break;case c.FlatWide:t.setProperty("/properties/frameType","TwoByHalf");break;case c.StandardWide:t.setProperty("/properties/frameType","TwoByOne");break;default:{t.setProperty("/properties/frameType","OneByOne")}}if(r.last("/core/contentProviders/providerInfo/enabled")){sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(e){return e.getSystemContext(s)}).then(function(e){t.setProperty("/properties/contentProviderLabel",e.label);if(r.last("/core/contentProviders/providerInfo/userConfigurable")){t.setProperty("/properties/showContentProviderOnViz",true)}}).catch(function(e){a.error("StaticTile.controller threw an error:",e)})}},onExit:function(){this._aDoables.forEach(function(e){e.off()});this._aDoables=[]},editModeHandler:function(e){var t=e?l.ActionMore:l.Display;this.getView().getModel().setProperty("/properties/scope",t)},onPress:function(e){var t=this.getView().getViewData().properties;if(e.getSource().getScope&&e.getSource().getScope()===l.Display){var o=this._createTargetUrl();if(!o){return}if(o[0]==="#"){hasher.setHash(o)}else{var n=r.last("/core/shell/enableRecentActivity")&&r.last("/core/shell/enableRecentActivityLogging");if(n){var a={title:t.title,appType:g.URL,url:t.targetURL,appId:t.targetURL};sap.ushell.Container.getRenderer("fiori2").logRecentActivity(a)}i.openURL(o,"_blank")}}},updatePropertiesHandler:function(e){var t=this.getView().getContent()[0];var r=t.getTileContent()[0];if(typeof e.title!=="undefined"){t.setHeader(e.title)}if(typeof e.subtitle!=="undefined"){t.setSubheader(e.subtitle)}if(typeof e.icon!=="undefined"){r.getContent().setSrc(e.icon)}if(typeof e.info!=="undefined"){r.setFooter(e.info)}},_createTargetUrl:function(){var e=this.getView().getViewData().properties.targetURL;var t=this.getView().getViewData().configuration["sap-system"];var r;if(e&&t){if(s.isIntentUrl(e)){r=s.parseShellHash(e);if(!r.params){r.params={}}r.params["sap-system"]=t;e="#"+s.constructShellHash(r)}else{e+=(e.indexOf("?")<0?"?":"&")+"sap-system="+t}}return e},_getLeanUrl:function(){return i.getLeanURL(this._createTargetUrl())},_getTileContent:function(e,t){var r=t.getPath().split("/");r.pop();var i=t.getProperty(r.join("/"));if(i!==this.oLastBindingObject||this.oTileContent&&this.oTileContent.bIsDestroyed){this.oLastBindingObject=i;this.oTileContent=this.getView().byId(i.icon?"imageTileContent":"standardTileContent").clone()}return this.oTileContent},_getCurrentProperties:function(){var e=this.getView().getContent()[0];var t=e.getTileContent()[0];var i=r.last("/core/home/sizeBehavior");return{title:e.getHeader(),subtitle:e.getSubheader(),info:t.getFooter(),icon:t.getContent().getSrc(),mode:e.getMode(),sizeBehavior:i}}})},true);