// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/ObjectPath","sap/ushell/utils","sap/ushell/utils/UrlParsing"],function(t,e,a){"use strict";var i={PLACEHOLDERS:{TITLE:"<title>",SUBTITLE:"<subtitle>",ICON:"<icon>",SEARCH_KEYWORDS:"<keywords>",SEMANTIC_OBJECT:"<semantic object>",ACTION:"<action>",PARAMETERS:"<parameters>",TARGET_URL:"<target URL>"},extractCardData:function(a){var i=this._getNavigationAction(a),r,s,n,c,o,g,p,_=t.get(["sap.app","tags","keywords"],a),l;if(i){c=t.get(["parameters","intentSemanticObject"],i);o=t.get(["parameters","intentAction"],i);g=t.get(["parameters","url"],i);s=t.get(["parameters","intentParameters"],i)}if(s){n=e.urlParametersToString(s)}if(g){p=false}else if(c&&o){p=true;g="#"+c+"-"+o;if(n){g+="?"+n}}r=JSON.stringify({display_icon_url:t.get(["sap.card","header","icon","src"],a),navigation_semantic_object:c,navigation_semantic_action:o,navigation_semantic_parameters:n,navigation_use_semantic_object:p,navigation_target_url:g});if(r==="{}"){r=undefined}if(_){l=_.join(",")}return{bagProperties:{display_title_text:t.get(["sap.card","header","title"],a),display_subtitle_text:t.get(["sap.card","header","subTitle"],a),display_search_keywords:l},tileConfiguration:r,manifest:this._replaceDataWithPlaceholders(a)}},mergeCardData:function(e,a){var i=JSON.parse(JSON.stringify(e)),r=this._getNavigationAction(i),s;if(a.display_title_text){t.set(["sap.card","header","title"],a.display_title_text,i)}if(a.display_subtitle_text){t.set(["sap.card","header","subTitle"],a.display_subtitle_text,i)}if(a.display_search_keywords){s=a.display_search_keywords.split(",");t.set(["sap.app","tags","keywords"],s,i)}if(a.display_icon_url){t.set(["sap.card","header","icon","src"],a.display_icon_url,i)}if(a.navigation_semantic_object){t.set(["parameters","intentSemanticObject"],a.navigation_semantic_object,r)}else if(a.navigation_target_url){t.set(["parameters","url"],a.navigation_target_url,r)}if(a.navigation_semantic_action){t.set(["parameters","intentAction"],a.navigation_semantic_action,r)}if(a.navigation_semantic_parameters_as_object){t.set(["parameters","intentParameters"],a.navigation_semantic_parameters_as_object,r)}return i},getTranslatablePropertiesFromBag:function(t){var e={},a;if(t&&t.getText&&t.getTextNames){a=t.getTextNames();a.forEach(function(a){e[a]=t.getText(a)})}return e},getCardData:function(t){var e,a,i,r;if(t.bag){e=t.bag.getBag("tileProperties")}else{e=t.getBag("tileProperties")}if(t.configuration){i=t.configuration.getParameterValueAsString("tileConfiguration")}else{i=t.getConfigurationParameter("tileConfiguration")}a=this.getTranslatablePropertiesFromBag(e);r=JSON.parse(i||"{}");if(r.navigation_semantic_parameters){r.navigation_semantic_parameters_as_object=this._parseParameters(r.navigation_semantic_parameters)}Object.keys(a).forEach(function(t){r[t]=a[t]});return r},_parseParameters:function(t){var e=a.parseParameters("?"+t);Object.keys(e).forEach(function(t){e[t]=e[t][0]});return e},_replaceDataWithPlaceholders:function(e){var a=JSON.parse(JSON.stringify(e)),i=this._getNavigationAction(a);if(t.get(["sap.card","header","title"],a)){t.set(["sap.card","header","title"],this.PLACEHOLDERS.TITLE,a)}if(t.get(["sap.card","header","subTitle"],a)){t.set(["sap.card","header","subTitle"],this.PLACEHOLDERS.SUBTITLE,a)}if(t.get(["sap.app","tags","keywords"],a)){t.set(["sap.app","tags","keywords"],this.PLACEHOLDERS.SEARCH_KEYWORDS,a)}if(t.get(["sap.card","header","icon","src"],a)){t.set(["sap.card","header","icon","src"],this.PLACEHOLDERS.ICON,a)}if(t.get(["parameters","intentSemanticObject"],i)){t.set(["parameters","intentSemanticObject"],this.PLACEHOLDERS.SEMANTIC_OBJECT,i)}if(t.get(["parameters","intentAction"],i)){t.set(["parameters","intentAction"],this.PLACEHOLDERS.ACTION,i)}if(t.get(["parameters","url"],i)){t.set(["parameters","url"],this.PLACEHOLDERS.TARGET_URL,i)}if(t.get(["parameters","intentParameters"],i)){t.set(["parameters","intentParameters"],this.PLACEHOLDERS.PARAMETERS,i)}return a},_getNavigationAction:function(e){var a=t.get(["sap.card","header","actions"],e),i;if(a){for(var r=0;r<a.length;r++){i=a[r];if(i.type==="Navigation"){return i}}}return null}};return i});