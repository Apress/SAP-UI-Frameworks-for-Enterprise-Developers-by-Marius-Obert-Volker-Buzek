// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/Control","sap/ui/performance/Measurement","sap/ushell/library","sap/ushell/ui/launchpad/TileContainerUtils"],function(t,e,i,n,a){"use strict";var s=e.extend("sap.ushell.ui.launchpad.CatalogsContainer",{metadata:{library:"sap.ushell",properties:{categoryFilter:{type:"string",defaultValue:"ALL"},categoryAllocateTiles:{type:"int",defaultValue:"0"}},aggregations:{catalogs:{type:"sap.ushell.ui.launchpad.CatalogEntryContainer",multiple:true}}},renderer:{apiVersion:2,render:function(t,e){var i=e.getCatalogs();t.openStart("div",e);t.class("sapUshellCatalogsContainer");t.openEnd();for(var n=0,a=i.length;n<a;++n){t.renderControl(i[n])}t.close("div")}}});s.prototype.onBeforeRendering=function(){if(this.getCatalogs().length){this.setBusy(false)}};s.prototype.setPagingManager=function(t){i.start("FLP:DashboardManager.CatalogsRendering","CatalogsRendering","FLP");i.pause("FLP:DashboardManager.CatalogsRendering");this.oPagingManager=t};s.prototype.updateAllocatedUnits=function(t){this.nAllocatedUnits=t};s.prototype.applyPagingCategoryFilters=function(t,e){var i=this.getCatalogs();this.nAllocatedUnits=t;if(e&&e!=="All"){this.sCatalogTerm=e}else{this.sCatalogTerm=""}if(!this.filters){this.filters={}}if(!this.filters.catalogEntry){this.filters.catalogEntry=function(t){var e=t.getPath(),i=t.getProperty("title")===this.sCatalogTerm,n;if(!this.sCatalogTerm){return}n=this.indexingMaps.onScreenPathIndexMap[e];if(n){n.isVisible=i}}.bind(this)}if(!this.filters.pagination){this.filters.pagination=function(t){var e=t.getPath(),i;i=this.indexingMaps.onScreenPathIndexMap[e];if(!this.nAllocatedUnits){i.isVisible=false}}.bind(this)}if(!this.indexingMaps){return}this.indexingMaps=a.indexOnScreenElements(i);a.applyFilterOnAllItems(this.mBindingInfos.catalogs,this.filters,this.processFiltering.bind(this));if(this.indexingMaps){a.showHideTilesAndHeaders(this.indexingMaps,this.getCatalogs())}};s.prototype.processFiltering=function(t){var e=this.getCatalogs(),i=t.getPath(),n=this.indexingMaps.onScreenPathIndexMap[i],a=e[n.aItemsRefrenceIndex],s;if(n.isVisible&&(!this.catalogPagination[i]||this.catalogPagination[i]==="start")){if(this.catalogPagination[i]===undefined){this.catalogPagination[i]="start";a.catalogState={}}else if(this.catalogPagination[i]==="start"){var l=a.nNumberOfVisibileElements;this.nAllocatedUnits+=l.appBoxesContainer+l.customTilesContainer}s=this.nAllocatedUnits;a.handleElements("appBoxesContainer");a.handleElements("customTilesContainer");if(a.catalogState.appBoxesContainer==="full"&&a.catalogState.customTilesContainer==="full"){this.catalogPagination[i]="full"}if(s-this.nAllocatedUnits>0){this.bSearchResults=true}else{n.isVisible=false}}else if(n.isVisible&&this.catalogPagination[i]==="full"){var o=a.nNumberOfVisibileElements;var r=o.appBoxesContainer+o.customTilesContainer;if(r===0){n.isVisible=false}}};s.prototype.resetCatalogPagination=function(){this.catalogPagination={}};s.prototype.updateAggregation=function(n){t.debug("Updating TileContainer. Reason: ",n);try{i.resume("FLP:DashboardManager.CatalogsRendering");this.filterElements();i.pause("FLP:DashboardManager.CatalogsRendering")}catch(t){e.prototype.updateAggregation.apply(this,arguments)}};s.prototype.addNewItem=function(t,e){var i,n,s,l=t.getPath();i=a.createNewItem.bind(this)(t,e);if(!i.filters){i.filters={};i.filters.appBoxesContainer={};i.filters.customTilesContainer={};i.filters.appBoxesContainer.pagination=function(t){var e=this.indexingMaps.appBoxesContainer.onScreenPathIndexMap[t.getPath()];if(this.getAllocatedUnits){e.isVisible=!!this.getAllocatedUnits()}}.bind(i);i.filters.customTilesContainer.pagination=function(t){var e=this.indexingMaps.customTilesContainer.onScreenPathIndexMap[t.getPath()];if(this.getAllocatedUnits){e.isVisible=!!this.getAllocatedUnits()}}.bind(i)}i.nAllocatedUnits=this.nAllocatedUnits;i.getAllocatedUnits=function(){return this.nAllocatedUnits}.bind(this);i.elementFiltered=function(t){n=this.oPagingManager.getSizeofSupportedElementInUnits("tile");this.nAllocatedUnits+=t*n;if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0}}.bind(this);i.elementsVisible=function(t){n=this.oPagingManager.getSizeofSupportedElementInUnits("tile");this.nAllocatedUnits-=t*n;if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0}}.bind(this);i.newElementCreated=function(t,e){this.nAllocatedUnits-=this.oPagingManager.getSizeofSupportedElementInUnits("tile");if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0}}.bind(this);i.currElementVisible=function(){this.nAllocatedUnits-=this.oPagingManager.getSizeofSupportedElementInUnits("tile");if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0}}.bind(this);a.addNewItem.bind(this)(i,e);s=this.getCatalogs();this.indexingMaps.onScreenPathIndexMap[l]={aItemsRefrenceIndex:s.length-1,isVisible:true};return true};s.prototype.handleFilters=function(){if(!this.catalogPagination){this.catalogPagination={}}if(!this.catalogsElementsMap){this.catalogsElementsMap={}}if(!this.filters){this.filters={}}};s.prototype.setHandleSearchCallback=function(t){this.handleSearchCallback=t};s.prototype.filterElements=function(){var t="catalogs",e=this.mBindingInfos[t].binding,i=e.getContexts(),n=this.getCatalogs(),s;if(!this.indexingMaps){this.indexingMaps=a.indexOnScreenElements(n)}this.handleFilters();s=a.markVisibleOnScreenElements(i,this.indexingMaps,false);if(!a.validateOrder(i,n,s)){throw true}a.createMissingElementsInOnScreenElements(this.indexingMaps,i,s,this.addNewItem.bind(this),n,this.filters,t);n=this.getCatalogs();a.showHideTilesAndHeaders(this.indexingMaps,n);if(this.handleSearchCallback){this.handleSearchCallback()}};return s});