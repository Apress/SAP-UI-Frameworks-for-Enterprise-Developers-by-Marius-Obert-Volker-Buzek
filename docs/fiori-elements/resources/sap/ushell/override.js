// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/GroupHeaderListItem","sap/ui/base/ManagedObject","sap/base/util/uid","sap/base/util/each"],function(t,e,i,n){"use strict";var r={};r.updateAggregation=function(t){if(this.isTreeBinding(t)){e.prototype.updateAggregation.apply(this,arguments)}else{var n=this.mBindingInfos[t],s=n.binding,o=s.getContexts(),a=n.factory,g=this.getMetadata().getJSONKeys()[t],u=g._sMutator+"Group",d=s.isGrouped()&&this[u],p=[],l=function(t){var e=this.getId()+"-"+i(),r=a(e,t);if(r.isA("sap.ui.integration.widgets.Card")){r.setBindingContext(t,"ushellCardModel")}else{r.setBindingContext(t,n.model)}this[g._sMutator](r)}.bind(this);if(d){e.prototype.updateAggregation.apply(this,arguments)}else{p=this[g._sGetter]();r._adaptCurrentGroup(o,p);r._updateCurrentGroup(o,p,n.model,l);p.length=o.length}}};r._adaptCurrentGroup=function(t,e){var i,n,r;for(i=0;i<t.length;i++){n=!!(e[i]&&e[i].isA("sap.ui.integration.widgets.Card"));r=!!t[i].getProperty(t[i].sPath+"/isCard");if(n||r){var s=i;for(;s<e.length;s++){e[s].destroy()}break}}};r._updateCurrentGroup=function(t,e,i,n){var r;for(r=0;r<t.length;r++){if(r<e.length&&!e[r].bIsDestroyed){e[r].setBindingContext(t[r],i)}else{n(t[r])}}for(;r<e.length;++r){e[r].destroy()}};r.updateAggregationGrouped=function(e){var i=this.mBindingInfos[e],r=i.binding,s=i.factory,o,a=null,g=null,u=null,d=this,p=d.getItems(),l=0,f=0,h,c,y=[];g=r.isGrouped()&&this.addItemGroup;n(r.getContexts(),function(e,m){if(g&&r.aSorters.length>0){a=r.aSorters[0].fnGroup(m);if(typeof a==="string"){a={key:a}}if(a.key!==u){var C,I;if(i.groupHeaderFactory){C=i.groupHeaderFactory(a)}I=C||new t({title:a.text||a.key}).addStyleClass("sapMListHdr");d.insertAggregation("items",I,f,true);f=f+1;u=a.key}}p=d.getItems();for(h=f;h<p.length;h=h+1){if(p[h].constructor===t){y.push(d.removeItem(p[h]));p=d.getItems()}}if(f<p.length){p[f].setBindingContext(m,i.model);if(p[f].aDelegates){n(p[f].aDelegates,function(t,e){e.vThis=m})}}else{c=d.getId()+"-"+f;o=s(c,m);o.setBindingContext(m,i.model);d.addItem(o)}f=f+1;l=f});for(h=p.length-1;h>=l;h=h-1){y.push(d.removeItem(p[h]))}setTimeout(function(){n(y,function(t,e){e.destroy()})},1)};r.updateAggregatesFactory=function(t){return function(){r.updateAggregation.bind(this)(t)}};return r},false);