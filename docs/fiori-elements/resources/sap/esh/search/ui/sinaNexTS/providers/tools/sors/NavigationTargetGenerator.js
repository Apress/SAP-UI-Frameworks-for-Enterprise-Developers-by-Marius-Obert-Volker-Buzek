/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../../../core/util","../../../core/core","./JoinConditions","../../../sina/SinaObject"],function(e,t,r,n){function a(e){return u(e)||c(e)||o(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){if(!e)return;if(typeof e==="string")return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}function c(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function u(e){if(Array.isArray(e))return f(e)}function f(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function l(e,t,r){if(t)p(e.prototype,t);if(r)p(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)y(e,t)}function y(e,t){y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return y(e,t)}function g(e){var t=T();return function r(){var n=d(e),a;if(t){var i=d(this).constructor;a=Reflect.construct(n,arguments,i)}else{a=n.apply(this,arguments)}return b(this,a)}}function b(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return h(e)}function h(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function T(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function d(e){d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return d(e)}var m=r["JoinConditions"];var j=n["SinaObject"];var O=function(r){v(i,r);var n=g(i);function i(e){var t;s(this,i);t=n.call(this,e);t.active=t.checkActive();t.getPropertyMetadata=e.getPropertyMetadata;t.urlPrefix=e.urlPrefix;t.navigationTargetTemplatesInitialized=false;t.navigationTargetTemplatesMap={};t.objectTypeMap={};t.ignoredSemanticObjectTypes={LastChangedByUser:true,CreationDate:true,CreatedByUser:true};return t}l(i,[{key:"checkActive",value:function t(){var r=e.getUrlParameter("sors");if(r==="true"){return true}return false}},{key:"cleanup",value:function e(){this.objectTypeMap=null}},{key:"registerObjectType",value:function e(t){if(!this.active){return}var r={type:t.type,label:t.label,propertyMap:{}};this.objectTypeMap[t.type]=r;for(var n=0;n<t.properties.length;++n){var a=t.properties[n];var i=this.getPropertyMetadata(a);this.filterSemanticObjectType(i);r.propertyMap[i.name]=i}}},{key:"filterSemanticObjectType",value:function e(t){if(this.ignoredSemanticObjectTypes[t.semanticObjectType]){delete t.semanticObjectType}}},{key:"finishRegistration",value:function e(){if(!this.active){return}this.calculateNavigationTargetTemplates()}},{key:"calculateNavigationTargetTemplates",value:function e(){if(this.navigationTargetTemplatesInitialized){return}var t=this.collectJoinConditions();this.navigationTargetTemplatesMap=this.createNavTargetTemplatesFromJoinConditions(t);this.cleanup();this.navigationTargetTemplatesInitialized=true}},{key:"createNavTargetTemplatesFromJoinConditions",value:function e(t){var r={};for(var n in t){var i=t[n];var o=[];for(var c in i){var u=i[c];if(!u){continue}o.push.apply(o,a(u.generateNavigationTargetTemplates()))}if(o.length!==0){r[n]=o}}return r}},{key:"collectJoinConditions",value:function e(){var r=this.createIndex();var n={};for(var a in this.objectTypeMap){var i=this.collectJoinConditionsForObjectType(r,a);if(!t.isEmptyObject(i)){n[a]=i}}return n}},{key:"collectJoinConditionsForObjectType",value:function e(t,r){var n={};var a=this.objectTypeMap[r];var i=function(e){var t=n[e];if(!t){t=new m({sina:this.sina,navigationTargetGenerator:this,sourceObjectType:r,targetObjectType:e});n[e]=t}return t}.bind(this);for(var o in a.propertyMap){var c=a.propertyMap[o];var u=c.semanticObjectType;if(!c.response){continue}if(!u){continue}var f=t[u];for(var s in f){if(s===a.type){continue}var p=this.objectTypeMap[s];var l=f[s];for(var v in l){var y=p.propertyMap[v];if(!y.request){continue}var g=i(s);g.add({sourcePropertyName:o,targetPropertyName:v,semanticObjectType:u})}}}return n}},{key:"createIndex",value:function e(){var t={};for(var r in this.objectTypeMap){this.createIndexForObjectType(t,r)}return t}},{key:"createIndexForObjectType",value:function e(t,r){var n=this.objectTypeMap[r];for(var a in n.propertyMap){var i=n.propertyMap[a];var o=i.semanticObjectType;if(!o){continue}var c=t[o];if(!c){c={};t[o]=c}var u=c[n.type];if(!u){u={};c[n.type]=u}var f=u[a];if(!f){f=true;u[a]=true}}}},{key:"formatItem",value:function e(t){var r=function e(t,r){for(var n=0;n<r.length;++n){var a=r[n];t[a.id]=a}};var n={};r(n,t.detailAttributes);r(n,t.titleAttributes);return n}},{key:"generateNavigationTargetsForItem",value:function e(t){var r=this.navigationTargetTemplatesMap[t.dataSource.id];if(!r){return undefined}var n=this.formatItem(t);var a=[];for(var i=0;i<r.length;++i){var o=r[i];var c=o.generate(n);if(!c){continue}a.push(c)}return a}},{key:"generateNavigationTargets",value:function e(t){if(!this.active){return}for(var r=0;r<t.items.length;++r){var n;var i=t.items[r];var o=this.generateNavigationTargetsForItem(i);i.navigationTargets=i.navigationTargets||[];(n=i.navigationTargets).push.apply(n,a(o))}}}]);return i}(j);var M={__esModule:true};M.NavigationTargetGenerator=O;return M})})();