/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}sap.ui.define(["../../sina/SinaObject","../../core/util","./typeConverter","../tools/WhyfoundProcessor"],function(t,r,i,a){function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function s(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)l(e,t)}function l(e,t){l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return l(e,t)}function f(e){var t=v();return function r(){var i=d(e),a;if(t){var u=d(this).constructor;a=Reflect.construct(i,arguments,u)}else{a=i.apply(this,arguments)}return c(this,a)}}function c(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return p(e)}function p(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function v(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function d(e){d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return d(e)}
/*!
   * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
   */var b=t["SinaObject"];var g=a["WhyfoundProcessor"];var y=function(t){o(n,t);var a=f(n);function n(e){var t;u(this,n);t=a.call(this);t.provider=e;t.sina=e.sina;t.intentsResolver=t.sina._createFioriIntentsResolver();t.suvNavTargetResolver=t.sina._createSuvNavTargetResolver();return t}s(n,[{key:"parse",value:function e(t,r){if(r.ResultList.SearchResults===null){return Promise.resolve([])}var i=r.ResultList.SearchResults.results;return this.parseItems(i)}},{key:"parseItems",value:function e(t){var r=[];for(var i=0;i<t.length;++i){var a=t[i];var u=this.parseItem(a);r.push(u)}return Promise.all(r)}},{key:"parseItem",value:function t(a){try{const t=this;var u;var n={};var s=[];var o=[];var l=[];var f=[];var c=[];var p;var v=t.sina.getDataSource(a.DataSourceId);var d,b,y,h;var m=a.Score/100;var A=[];var T,_,O,I;var S={};var R={};var P=new g(t.sina);for(u=0;u<a.Attributes.results.length;u++){d=a.Attributes.results[u];b=v.getAttributeMetadata(d.Id);y=t.sina._createSearchResultSetItemAttribute({id:d.Id,label:b.label,value:i.odata2Sina(b.type,d.Value),valueFormatted:d.ValueFormatted!==undefined?d.ValueFormatted:d.Value,valueHighlighted:d.Snippet||"",isHighlighted:d.Snippet.indexOf("<b>")>-1&&d.Snippet.indexOf("</b>")>-1,metadata:b,groups:[]});n[y.id]=y;r.appendRemovingDuplicates(A,r.extractHighlightedTerms(y.valueHighlighted));if(b.suvUrlAttribute&&b.suvMimeTypeAttribute){O=n[b.suvUrlAttribute]||b.suvUrlAttribute.id;I=n[b.suvMimeTypeAttribute]||b.suvMimeTypeAttribute.id;S[d.Id]={suvThumbnailAttribute:y,suvTargetUrlAttribute:O,suvTargetMimeTypeAttribute:I}}if(b.usage.Navigation){if(b.usage.Navigation.mainNavigation){p=t.sina._createNavigationTarget({label:y.value,targetUrl:y.value,target:"_blank"})}}l.push(y);if(b.usage.Detail){f.push(y)}if(b.usage.Title){s.push(y)}if(b.usage.TitleDescription){o.push(y)}h=v.attributeMetadataMap[y.id]._private.semanticObjectType;if(h&&h.length>0){c.push({name:h,value:y.value,type:y.metadata.type})}if(y.isHighlighted||y.descriptionAttribute&&y.descriptionAttribute.isHighlighted){if(!t._isVisible(b)&&typeof R[y.id]==="undefined"){R[y.id]=[y.valueHighlighted]}}}for(_ in S){T=S[_];if(typeof T.suvTargetUrlAttribute==="string"){T.suvTargetUrlAttribute=n[T.suvTargetUrlAttribute]}if(typeof T.suvTargetMimeTypeAttribute==="string"){T.suvTargetMimeTypeAttribute=n[T.suvTargetMimeTypeAttribute]}if(!(T.suvTargetUrlAttribute||T.suvTargetMimeTypeAttribute)){delete S[_]}}s.sort(function(e,t){return e.metadata.usage.Title.displayOrder-t.metadata.usage.Title.displayOrder});f.sort(function(e,t){return e.metadata.usage.Detail.displayOrder-t.metadata.usage.Detail.displayOrder});t.suvNavTargetResolver.resolveSuvNavTargets(v,S,A);var j=t.sina._createSearchResultSetItem({dataSource:v,attributes:l,titleAttributes:s,titleDescriptionAttributes:o,detailAttributes:f,defaultNavigationTarget:p,navigationTargets:[],score:m});j._private.allAttributesMap=n;j._private.semanticObjectTypeAttributes=c;var w=t.sina._createItemPostParser({searchResultSetItem:j});var D=j.detailAttributes;return e(w.postParseResultSetItem(),function(r){R=t._pushAdditionalWhyFounds(a,R,D);return e(P.processAdditionalWhyfoundAttributes(R,r))})}catch(e){return Promise.reject(e)}}},{key:"_isVisible",value:function e(t){if(typeof t.usage.Title!=="undefined"||typeof t.usage.Detail!=="undefined"||typeof t.isDescription!=="undefined"){return true}if(Array.isArray(t.groups)){for(var r=0;r<t.groups.length;r++){var i=t.groups[r].group;if(this._isVisible(i)&&this._isInTamplate(t.id,i)){return true}}return false}return false}},{key:"_isInTamplate",value:function e(t,r){if(r.template&&r.attributes&&r.attributes.length>0){var i=this._getNameInGroup(t,r.attributes);if(i&&r.template.includes("{"+i+"}")){return true}}return false}},{key:"_getNameInGroup",value:function e(t,r){for(var i=0;i<r.length;i++){if(r[i].attribute.id===t){return r[i].nameInGroup}}return undefined}},{key:"_pushAdditionalWhyFounds",value:function e(t,r,i){if(t.HitAttributes&&Array.isArray(t.HitAttributes.results)){for(var a=0;a<t.HitAttributes.results.length;a++){var u=t.HitAttributes.results[a];if(typeof r[u.id]==="undefined"&&!this._isUngrouppedDetailAttribute(u.Id,i)){r[u.Id]=[u.Snippet]}}}return r}},{key:"_isUngrouppedDetailAttribute",value:function e(t,r){for(var i=0;i<r.length;i++){if(t===r[i].id){return true}}return false}}]);return n}(b);var h={__esModule:true};h.ItemParser=y;return h})})();