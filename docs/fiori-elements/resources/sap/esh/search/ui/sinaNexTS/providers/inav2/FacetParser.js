/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./pivotTableParser","./typeConverter","../../sina/ComparisonOperator","../../sina/SearchQuery","../../sina/LogicalOperator","../../core/errors"],function(e,t,a,r,i,u){function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function l(e,t,a){if(t)o(e.prototype,t);if(a)o(e,a);Object.defineProperty(e,"prototype",{writable:false});return e}var s=a["ComparisonOperator"];var c=r["SearchQuery"];var $=i["LogicalOperator"];var f=u["FacetsParseError"];var p=function(){function a(e){n(this,a);this.provider=e;this.sina=e.sina}l(a,[{key:"parse",value:function e(t,a){var r=[];if(!a.ResultsetFacets||!a.ResultsetFacets.Elements){return[]}for(var i=0;i<a.ResultsetFacets.Elements.length;i++){var u=a.ResultsetFacets.Elements[i];var n=u.Metadata.Cube.ObjectName;if(n==="$$DataSources$$"){r.push(this.parseDataSourceFacet(t,u))}else{if(t.filter.dataSource.type===t.sina.DataSourceType.Category){continue}r.push(this.parseChartFacet(t,u))}}return Promise.all(r)}},{key:"parseDataSourceFacet",value:function t(a,r){var i=a;if(a instanceof c){i=this.sina.createDataSourceQuery({dataSource:a.filter.dataSource,filter:a.filter.clone()})}var u=e.parse(r.ResultSet);var n=[];for(var o=0;o<u.cells.length;o++){var l=u.cells[o];var s=this.sina.getDataSource(l.$$DataSource$$[0].Value);if(!s){s=this.sina._createDataSource({type:this.sina.DataSourceType.Category,id:l.$$DataSource$$[0].Value,label:l.$$DataSource$$[0].ValueFormatted})}n.push(this.sina._createDataSourceResultSetItem({dataSource:s,dimensionValueFormatted:l.$$DataSource$$[0].ValueFormatted,measureValue:l.Value,measureValueFormatted:l.ValueFormatted}))}var $=this.sina._createDataSourceResultSet({title:a.filter.dataSource.label,items:n,query:i});if(a instanceof c){return i._setResultSet($)}return $}},{key:"createAttributeFilterCondition",value:function e(a,r,i){switch(i.$$AttributeValue$$.length){case 2:return this.sina.createSimpleCondition({attribute:a,value:t.ina2Sina(r.type,i.$$AttributeValue$$[0].Value),attributeLabel:r.label,valueLabel:i.$$AttributeValue$$[0].ValueFormatted});case 3:{var u=this.sina.createComplexCondition({attributeLabel:r.label,valueLabel:i.$$AttributeValue$$[0].ValueFormatted,operator:$.And});var n=[];if(i.$$AttributeValue$$[1].Value){n.push(this.sina.createSimpleCondition({attribute:a,operator:s.Ge,value:t.ina2Sina(r.type,i.$$AttributeValue$$[1].Value)}))}if(i.$$AttributeValue$$[2].Value){n.push(this.sina.createSimpleCondition({attribute:a,operator:s.Le,value:t.ina2Sina(r.type,i.$$AttributeValue$$[2].Value)}))}u.conditions=n;return u}default:throw new f("parse error facets")}}},{key:"parseChartFacet",value:function t(a,r){var i=this.sina.getDataSource(r.Metadata.Cube.DataSource.ObjectName);var u=r.Metadata.Cube.ObjectName;var n=i.getAttributeMetadata(u);var o=a;if(a instanceof c){var l=a.filter.clone();l.setDataSource(i);l.setRootCondition(a.filter.rootCondition.clone());o=this.sina.createChartQuery({filter:l,dimension:r.Metadata.Cube.ObjectName})}var s=e.parse(r.ResultSet);var $=[];for(var f=0;f<s.cells.length;f++){var p=s.cells[f];$.push(this.sina._createChartResultSetItem({filterCondition:this.createAttributeFilterCondition(u,n,p),dimensionValueFormatted:p.$$AttributeValue$$[0].ValueFormatted||p.$$AttributeValue$$[0].Value,measureValue:p.Value,measureValueFormatted:p.ValueFormatted}))}var v=this.sina._createChartResultSet({title:n.label,items:$,query:o});if(a instanceof c){return o._setResultSet(v)}return v}}]);return a}();var v={__esModule:true};v.FacetParser=p;return v})})();