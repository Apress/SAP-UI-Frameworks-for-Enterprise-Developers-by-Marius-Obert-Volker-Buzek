/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../../core/util","./typeConverter","./pivotTableParser","../../core/errors"],function(e,t,a,r){function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function u(e,t,a){if(t)n(e.prototype,t);if(a)n(e,a);Object.defineProperty(e,"prototype",{writable:false});return e}var s=r["WhyFoundAttributeMetadataMissingError"];var l=function(){function r(e){i(this,r);this.provider=e;this.sina=e.sina;this.intentsResolver=this.sina._createFioriIntentsResolver()}u(r,[{key:"parse",value:function e(t,r){var i=this.parseTotalCount(r);r=a.parse(r);if(r.axes.length===0){return Promise.resolve({totalCount:0,items:[]})}var n=r.axes[0];var u=[];for(var s=0;s<n.length;++s){var l=n[s];this.provider.metadataParser.parseSearchRequestMetadata(l);var o=this.parseItem(l);u.push(o)}return Promise.all(u).then(function(e){return{totalCount:i,items:e}})}},{key:"parseTotalCount",value:function e(t){if(t.ItemLists&&t.ItemLists[0]&&t.ItemLists[0].TotalCount){return t.ItemLists[0].TotalCount.Value}return 0}},{key:"parseItem",value:function e(a){var r=[];var i=[];var n=[];var u=this.sina.getDataSource(a.$$DataSourceMetaData$$[0].ObjectName);for(var s=0;s<a.$$ResultItemAttributes$$.length;++s){var l=a.$$ResultItemAttributes$$[s];var o=u.getAttributeMetadata(l.Name);var d=this.sina._createSearchResultSetItemAttribute({id:l.Name,label:u.getAttributeMetadata(l.Name).label,value:t.ina2Sina(o.type,l.Value),valueFormatted:l.ValueFormatted||l.Value,valueHighlighted:l.ValueFormatted||l.Value,isHighlighted:false,metadata:o});if(o.usage.Title){r.push(d)}if(o.usage.Detail){i.push(d)}for(var h=0;h<a.$$AttributeMetadata$$.length;h++){var v=a.$$AttributeMetadata$$[h];if(v.Name==l.Name){if(v.SemanticObjectType&&v.SemanticObjectType.length>0){n.push({name:v.SemanticObjectType,value:d.value,type:d.metadata.type})}break}}}r.sort(function(e,t){return e.metadata.usage.Title.displayOrder-t.metadata.usage.Title.displayOrder});i.sort(function(e,t){return e.metadata.usage.Detail.displayOrder-t.metadata.usage.Detail.displayOrder});this.parseWhyFound(u,r,i,a);var c;for(var g=0;g<a.$$RelatedActions$$.length;++g){var f=a.$$RelatedActions$$[g];if(f.Type==="GeneralUri"||f.Type==="SAPNavigation"){var $=f.Description;var m=encodeURI(f.Uri);c=this.sina._createNavigationTarget({label:$,targetUrl:m})}}var p=a.$$DataSourceMetaData$$[0].SemanticObjectType;var b=a.$$DataSourceMetaData$$[0].SystemId;var y=a.$$DataSourceMetaData$$[0].Client;return this.intentsResolver.resolveIntents({semanticObjectType:p,semanticObjectTypeAttributes:n,systemId:b,client:y,fallbackDefaultNavigationTarget:c}).then(function(e){var t=e&&e.defaultNavigationTarget;var a=e&&e.navigationTargets;var n=this.sina._createSearchResultSetItem({dataSource:u,titleAttributes:r,titleDescriptionAttributes:[],detailAttributes:i,defaultNavigationTarget:t,navigationTargets:a});return n}.bind(this))}},{key:"parseWhyFound",value:function t(a,r,i,n){var u,l,o,d,h;for(u=0;u<n.$$WhyFound$$.length;u++){l=n.$$WhyFound$$[u];o=this.getResponseAttributeId(a,l.Name);for(d=0;d<r.length;++d){h=r[d];if(o===h.id){l.matched=true;h.valueHighlighted=l.Value;h.isHighlighted=true;break}}for(d=0;d<i.length;++d){h=i[d];if(o===h.id){l.matched=true;h.valueHighlighted=l.Value;h.isHighlighted=true;break}}}for(u=0;u<n.$$WhyFound$$.length;u++){l=n.$$WhyFound$$[u];if(l.matched){continue}o=this.getResponseAttributeId(a,l.Name);var v=a.getAttributeMetadata(o);if(!v){throw new s("metadata misssing for "+o)}h=this.sina._createSearchResultSetItemAttribute({id:v.id,label:v.label,value:null,valueFormatted:e.filterString(l.Value,["<b>","</b>"]),valueHighlighted:l.Value,isHighlighted:true,metadata:v});i.push(h)}}},{key:"getResponseAttributeId",value:function e(t,a){var r=this.provider.getInternalMetadataAttribute(t,a);if(!r){return a}var i=this.provider.getInternalMetadataAttribute(t,r.correspondingSearchAttributeName);if(!i){return a}return i.Name}}]);return r}();var o={__esModule:true};o.ItemParser=l;return o})})();