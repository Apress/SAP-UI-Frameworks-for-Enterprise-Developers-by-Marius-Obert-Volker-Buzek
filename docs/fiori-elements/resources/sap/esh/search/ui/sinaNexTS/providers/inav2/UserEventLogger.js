/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./ajaxTemplates","../../core/util","../abap_odata/UserEventLogger"],function(e,t,r){function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function a(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var s=r["UserEventType"];var o=function(){function r(e){i(this,r);this.provider=e;this.sina=e.sina;this.eventLoggingActive=false;this.clickCounterActive=false;this.delayedConsumer=new t.DelayedConsumer({timeDelay:2e3,consumer:this.processEvents,consumerContext:this})}a(r,[{key:"delayedInit",value:function e(){this.eventLoggingActive=this.provider.supports("SearchInteractionLogging","SearchInteractionLogging");this.clickCounterActive=this.provider.supports("PersonalizedSearch")}},{key:"logUserEvent",value:function e(r){r.timeStamp=t.generateTimestamp();if(this.eventLoggingActive&&r.type!==s.ITEM_NAVIGATE){this.delayedConsumer.add(r)}if(this.clickCounterActive&&r.type===s.ITEM_NAVIGATE&&r.sourceUrlArray.length!==0){this.incrementClickCounter(r.sourceUrlArray,r.targetUrl,r.systemAndClient)}}},{key:"processEvents",value:function e(t){var r={SearchInteractionLogging:{SessionID:this.provider.sessionId,EventList:[]}};for(var i=0;i<t.length;++i){var n=t[i];var a={Type:n.type,Timestamp:n.timeStamp,ParameterList:[]};for(var s in n){if(s==="type"||s==="timeStamp"){continue}var o=n[s];a.ParameterList.push({Name:s,Value:o})}r.SearchInteractionLogging.EventList.push(a)}return this.provider.ajaxClient.postJson(this.provider.getResponseUrl,r)}},{key:"incrementClickCounter",value:function t(r,i,n){if(!i){return undefined}if(i.indexOf("#")===-1){return undefined}if(!this.provider.supports("PersonalizedSearch","SetUserStatus")){return undefined}var a=function e(t){return t.split("-")[0]};var s=function e(t){return t.split("-")[1].split("&")[0]};var o=function e(t){var r=t;var i=[];for(var n=0,a=r.length;n<a;n++){var s=r[n];if(s.indexOf("sap-system")!==-1){continue}var o=s.split("=")[0];var c=s.split("=")[1];i.push({Name:o,Value:c})}return i};var c=e.incrementClickCounterRequest.SearchConfiguration.ClientEvent.NavigationEventList;var u=r;var p=a(u[0]);c[0].SourceApplication.SemanticObjectType=p;var l=s(u[0]);c[0].SourceApplication.Intent=l;var v=u[1]!==undefined?o(u[1].split("&")):[];c[0].SourceApplication.ParameterList=v;u=i.split("?");var f=a(u[0]).split("#")[1];c[1].TargetApplication.SemanticObjectType=f;var g=s(u[0]);c[1].TargetApplication.Intent=g;var d=u[1]!==undefined?o(u[1].split("&")):[];c[1].TargetApplication.ParameterList=d;var h={System:n.systemId,Client:n.client};c[1].TargetApplication=jQuery.extend(c[1].TargetApplication,h);return this.provider.ajaxClient.postJson(this.provider.getResponseUrl,e.incrementClickCounterRequest)}}]);return r}();var c={__esModule:true};c.UserEventLogger=o;return c})})();