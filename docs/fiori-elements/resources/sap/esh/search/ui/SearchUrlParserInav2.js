/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}sap.ui.define(["sap/m/MessageBox","./error/errors","./i18n"],function(t,r,a){function o(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function s(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var l=t["Icon"];var u=t["Action"];var c=o(r);var d=o(a);function p(e){if(e&&e.conditions){return true}return false}var f=function(){function r(e){n(this,r);this.model=e.model}s(r,[{key:"parseUrlParameters",value:function r(a){try{const r=this;if(a.top){var o=parseInt(a.top,10);r.model.setTop(o,false)}var n=r.model.sinaNext.allDataSource;if(a.datasource){var i=JSON.parse(a.datasource);var s=i.ObjectName.value;switch(i.Type){case"Category":if(s==="$$ALL$$"){n=r.model.sinaNext.allDataSource}else{n=r.model.sinaNext.getDataSource(s);if(!n){n=r.model.sinaNext.createDataSource({type:r.model.sinaNext.DataSourceType.Category,id:s,label:i.label,labelPlural:i.labelPlural})}}break;case"BusinessObject":n=r.model.sinaNext.getDataSource(s);if(!n){n=r.model.sinaNext.allDataSource;delete a.filter;t.show(d.getText("searchUrlParsingErrorLong")+"\n(Unknow datasource "+s+")",{icon:l.ERROR,title:d.getText("searchUrlParsingError"),actions:[u.OK]})}break;default:{var p=new Error("Unknown datasource type "+i.Type);throw new c.UnknownDataSourceType(p)}}}return e(r.model.sinaNext.loadMetadata(n),function(){var e={dataSource:n};var o;if(a.filter){try{var i=JSON.parse(a.filter);o=r.parseCondition(e,i)}catch(e){o=r.model.sinaNext.createComplexCondition();t.show(d.getText("searchUrlParsingErrorLong")+"\n("+e.toString()+")",{icon:l.ERROR,title:d.getText("searchUrlParsingError"),actions:[u.OK]})}}else{o=r.model.sinaNext.createComplexCondition()}var s=r.model.sinaNext.createFilter({dataSource:n,searchTerm:a.searchterm,rootCondition:o});r.model.setProperty("/uiFilter",s);r.model.setDataSource(s.dataSource,false)})}catch(e){return Promise.reject(e)}}},{key:"parseCondition",value:function e(t,r){if(p(r)){return this.parseComplexCondition(t,r)}return this.parseSimpleCondition(t,r)}},{key:"parseComplexCondition",value:function e(t,r){var a=[];for(var o=0;o<r.conditions.length;++o){var n=r.conditions[o];a.push(this.parseCondition(t,n))}return this.model.sinaNext.createComplexCondition({operator:r.operator,conditions:a,valueLabel:r.label})}},{key:"parseSimpleCondition",value:function e(t,r){t.attribute=r.attribute;return this.model.sinaNext.createSimpleCondition({attribute:r.attribute,attributeLabel:r.attributeLabel,value:this.parseValue(t,r.value),valueLabel:r.valueLabel||r.label,operator:this.parseOperator(t,r.operator)})}},{key:"parseValue",value:function e(t,r){var a=t.dataSource.getAttributeMetadata(t.attribute);return this.model.sinaNext.inav2TypeConverter.ina2Sina(a.type,r)}},{key:"parseOperator",value:function e(t,r){switch(r){case"=":return this.model.sinaNext.ComparisonOperator.Eq;case">":return this.model.sinaNext.ComparisonOperator.Gt;case">=":return this.model.sinaNext.ComparisonOperator.Ge;case"<":return this.model.sinaNext.ComparisonOperator.Lt;case"<=":return this.model.sinaNext.ComparisonOperator.Le;default:throw"Unknown operator "+r}}}]);return r}();return f})})();