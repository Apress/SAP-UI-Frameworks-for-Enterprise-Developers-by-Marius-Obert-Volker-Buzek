/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./i18n","sap/ui/model/Sorter","sap/ui/core/library","./hierarchydynamic/SearchHierarchyDynamicFacet","./SearchFacetDialogHelperDynamicHierarchy","./sinaNexTS/sina/SimpleCondition"],function(e,t,n,a,r,i){function o(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function l(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=g(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var a=0;var r=function(){};return{s:r,n:function(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,o=false,l;return{s:function(){n=n.call(e)},n:function(){var e=n.next();i=e.done;return e},e:function(e){o=true;l=e},f:function(){try{if(!i&&n.return!=null)n.return()}finally{if(o)throw l}}}}function g(e,t){if(!e)return;if(typeof e==="string")return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}function s(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function C(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function d(e,t,n){if(t)C(e.prototype,t);if(n)C(e,n);Object.defineProperty(e,"prototype",{writable:false});return e}var c=o(e);var f=n["MessageType"];var T=o(a);var v=r["updateDetailPageforDynamicHierarchy"];var O=i["SimpleCondition"];var m=function(){function e(){u(this,e);throw new Error("Cannot instantiate static class 'SearchFacetDialogHelper'")}d(e,null,[{key:"injectSearchAdvancedCondition",value:function t(n){e.searchAdvancedCondition=n}},{key:"init",value:function t(n){e.POS_FACET_LIST=0;e.POS_TOOLBAR_SEARCHFIELD=0;e.POS_TOOLBAR_TOGGLEBUTTON=1;e.POS_SETTING_CONTAINER=0;e.POS_ATTRIBUTE_LIST_CONTAINER=1;e.POS_ICONTABBAR=0;e.POS_TABBAR_LIST=0;e.POS_TABBAR_CONDITION=1;e.POS_SORTING_SELECT=0;e.POS_SHOWONTOP_CHECKBOX=1;e.POS_ADVANCED_CHECKBOX=0;e.POS_ADVANCED_INPUT_LAYOUT=1;e.POS_ADVANCED_BUTTON=2;e.bResetFilterIsActive=false;var a={decimals:2};e.oFloatNumberFormat=sap.ui.core.format.NumberFormat.getFloatInstance(a);e.oIntegernumberFormat=sap.ui.core.format.NumberFormat.getIntegerInstance();e.oDateFormatOptions={pattern:"yyyy/MM/dd",UTC:false};e.oTimestampFormatOptions={pattern:"yyyy-MM-dd HH:mm:ss.SSSSSSS",UTC:true};e.oDateFormat=sap.ui.core.format.DateFormat.getDateTimeInstance(e.oDateFormatOptions);e.oTimestampFormat=sap.ui.core.format.DateFormat.getDateTimeInstance(e.oTimestampFormatOptions);e.dialog=n}},{key:"getFacetList",value:function t(){var n=e.dialog.oSplitContainer.getMasterPages()[0];return n.getContent()[e.POS_FACET_LIST]}},{key:"updateDetailPage",value:function t(n,a,r){var i=e.dialog.getModel();var o=e.dialog.getModel("searchModel");var l=n.getBindingContext().sPath;var g=i.getProperty(l);var s=i.getAttributeDataType(g);var u=e.getFacetList().indexOfAggregation("items",n);var C=e.dialog.oSplitContainer.getDetailPages()[u];var d=C.getBindingContext().getObject();if(d.facetType==="hierarchy"){var c=d;v(i,c,i.aFilters);e.dialog.oSplitContainer.toDetail(C.getId(),"show",null,null);return}var f,T,O,m;if(s==="string"||s==="text"){f=C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER];T=C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];O=C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_CONDITION].getContent()[0];m=C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_SETTING_CONTAINER]}else{f=C.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER];T=C.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];O=C.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER];m=C.getContent()[e.POS_SETTING_CONTAINER]}var A=C.getId();e.dialog.oSplitContainer.toDetail(A,"show",null,null);e.dialog.resetIcons(i,l,e.dialog);f.setBusy(true);var S={sAttribute:g.dimension,sBindingPath:l,sAttributeLimit:1e3,bInitialFilters:r};if(s==="number"){S.sAttributeLimit=20}if(!i.chartQuery){i.chartQuery=i.sinaNext.createChartQuery({filter:i.getProperty("/uiFilter").clone(),dimension:g.dimension,top:1e3})}e.applyChartQueryFilter(u);if(a){var _=i.sinaNext.createSimpleCondition({attribute:g.dimension,operator:i.sinaNext.ComparisonOperator.Bw,value:a});if(!e.bResetFilterIsActive){i.chartQuery.filter.autoInsertCondition(_)}}else{if(a===undefined&&(s==="string"||s==="text")){C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getSubHeader().getContent()[e.POS_TOOLBAR_SEARCHFIELD].setValue("")}}i.chartQuery.filter.searchTerm=o.getSearchBoxTerm();i.facetDialogSingleCall(S).then(function(){var t=i.getProperty(C.getBindingContext().getPath()).items;if(O.data("initial")){e.initiateAdvancedConditions(O,t,O.data("dataType"))}var n=m.getItems()[e.POS_SHOWONTOP_CHECKBOX];if(T.getSelectedContexts().length>0){n.setEnabled(true)}e.updateDetailPageListItemsSelected(T,O);e.dialog.updateDetailPageCharts(t)})}},{key:"applyChartQueryFilter",value:function t(n){var a=e.dialog.getModel();a.resetChartQueryFilterConditions();var r=e.dialog.oSplitContainer.getDetailPages();for(var i=0;i<r.length;i++){var o=r[i];if(i===n||o.getContent().length===0){continue}var l=o.getBindingContext().getObject();if(l instanceof T){this.applyDynamicHierarchyChartQueryFilter(l,a);continue}var g=void 0;if(!o.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER]){g=o.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}else{g=o.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}for(var s=0;s<g.getItems().length;s++){var u=g.getItems()[s];var C=u.getBindingContext().getObject();var d=C.filterCondition;if(d.attribute||d.conditions){if(u.getSelected()&&!e.bResetFilterIsActive){a.chartQuery.filter.autoInsertCondition(d)}}}e.applyAdvancedCondition(o,e.getFacetList().getItems()[i].getBindingContext().getObject(),e.dialog.getModel())}}},{key:"applyDynamicHierarchyChartQueryFilter",value:function e(t,n){var a=l(n.aFilters),r;try{for(a.s();!(r=a.n()).done;){var i=r.value;var o=i;var g=o.filterCondition;if(g instanceof O&&g.attribute===t.attributeId){n.chartQuery.filter.autoInsertCondition(g.clone())}}}catch(e){a.e(e)}finally{a.f()}}},{key:"resetChartQueryFilters",value:function t(){var n=e.dialog.getModel();n.resetChartQueryFilterConditions();var a=e.dialog.oSplitContainer.getDetailPages();for(var r=0;r<a.length;r++){if(a[r].getContent().length===0){continue}var i=a[r].getBindingContext().getObject();if(i instanceof T){continue}var o=void 0;if(!a[r].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER]){o=a[r].getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}else{o=a[r].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}for(var l=0;l<o.getItems().length;l++){var g=o.getItems()[l];var s=g.getBindingContext().getObject();var u=s.filterCondition;if(u.attribute||u.conditions){if(g.getSelected()){g.setSelected(false)}}}}}},{key:"applyAdvancedCondition",value:function t(n,a,r){var i=e.dialog.getModel();var o,l,g,s,u,C,d,T;if(n.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER]){var v=n.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER];o=v.data("dataType");l=v.getContent();switch(o){case"timestamp":case"date":e.oDateTimeFormat=o==="timestamp"?e.oTimestampFormat:e.oDateFormat;for(g=1;g<l.length;g++){s=l[g];u=s.getContent()[e.POS_ADVANCED_CHECKBOX];var O=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT];if(u.getSelected()&&O.getDateValue()&&O.getSecondDateValue()){var m=new Date(O.getSecondDateValue().getFullYear(),O.getSecondDateValue().getMonth(),O.getSecondDateValue().getDate(),23,59,59);var A=e.oDateTimeFormat.format(O.getDateValue());var S=e.oDateTimeFormat.format(m);C=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:i.sinaNext.ComparisonOperator.Ge,value:o==="timestamp"?O.getDateValue():A,valueLabel:A});d=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:i.sinaNext.ComparisonOperator.Le,value:o==="timestamp"?m:S,valueLabel:S});T=i.sinaNext.createComplexCondition({valueLabel:O.getValue(),operator:i.sinaNext.LogicalOperator.And,conditions:[C,d],userDefined:true});if(!e.bResetFilterIsActive){r.addFilterCondition(T,false)}}}break;case"integer":case"number":e.oNumberFormat=o==="integer"?e.oIntegernumberFormat:e.oFloatNumberFormat;for(g=1;g<l.length;g++){s=l[g];u=s.getContent()[e.POS_ADVANCED_CHECKBOX];var _=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];var p=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[2];var I=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];var N=e.oNumberFormat.parse(_.getValue());var b=e.oNumberFormat.parse(p.getValue());if(u.getSelected()){if(!isNaN(N)&&!isNaN(b)&&b>=N){C=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:i.sinaNext.ComparisonOperator.Ge,value:N,valueLabel:e.oNumberFormat.format(N),userDefined:true});d=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:i.sinaNext.ComparisonOperator.Le,value:b,valueLabel:e.oNumberFormat.format(b),userDefined:true});T=i.sinaNext.createComplexCondition({valueLabel:e.oNumberFormat.format(N)+I.getText()+e.oNumberFormat.format(b),operator:i.sinaNext.LogicalOperator.And,conditions:[C,d],userDefined:true});if(!e.bResetFilterIsActive){r.addFilterCondition(T,false)}}else{var y=e.dialog.getModel("searchModel");var P={type:f.Error,title:c.getText("filterInputErrorTitle"),description:c.getText("filterInputError")};y.pushUIMessage(P);e.dialog.bConditionValidateError=true}}}break;default:break}}else{var B=n.getContent()[e.POS_ICONTABBAR].getItems()[e.POS_TABBAR_CONDITION].getContent()[0];o=B.data("dataType");l=B.getContent();var h,E,D,L,R;switch(o){case"string":for(g=0;g<l.length-1;g++){s=l[g];h=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];E=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];D=E.getValue();switch(h.getSelectedKey()){case"eq":R=i.sinaNext.ComparisonOperator.Eq;break;case"ew":R=i.sinaNext.ComparisonOperator.Ew;break;case"bw":R=i.sinaNext.ComparisonOperator.Bw;break;case"co":R=i.sinaNext.ComparisonOperator.Co;break;default:R=i.sinaNext.ComparisonOperator.Eq;break}if(E.getValue()){L=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:R,value:D,valueLabel:D,userDefined:true});if(!e.bResetFilterIsActive){r.addFilterCondition(L,false)}}}break;case"text":for(g=0;g<l.length-1;g++){s=l[g];h=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];E=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];D=E.getValue();switch(h.getSelectedKey()){case"co":R=i.sinaNext.ComparisonOperator.Co;break;default:R=i.sinaNext.ComparisonOperator.Eq}if(E.getValue()){L=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:R,value:D,valueLabel:D,userDefined:true});if(!e.bResetFilterIsActive){r.addFilterCondition(L,false)}}}break;default:break}}}},{key:"initiateAdvancedConditions",value:function t(n,a,r){var i,o,l,g,s;var u=e.dialog.getModel();for(var C=a.length;C>0;C--){var d=a[C-1];if(d.advanced){i=n.getContent();if(r==="string"||r==="text"){o=i[i.length-2]}else{o=i[i.length-1]}l=o.getContent()[e.POS_ADVANCED_CHECKBOX];l.setSelected(true);g=o.getContent()[e.POS_ADVANCED_INPUT_LAYOUT];switch(r){case"integer":case"number":{var c=g.getContent()[0];var f=g.getContent()[2];if(d.filterCondition.conditions){for(var T=0;T<d.filterCondition.conditions.length;T++){var v=d.filterCondition.conditions[T];if(v.operator==="Ge"){c.setValue(v.valueLabel||e.oNumberFormat.format(v.value))}if(v.operator==="Le"){f.setValue(v.valueLabel||e.oNumberFormat.format(v.value))}}}break}case"string":s=d.filterCondition.operator;if(s==="Co"){g.getContent()[0].setSelectedKey("co")}else if(s==="Ew"){g.getContent()[0].setSelectedKey("ew")}else if(s==="Bw"){g.getContent()[0].setSelectedKey("bw")}g.getContent()[1].setValue(d.filterCondition.valueLabel);break;case"text":s=d.filterCondition.operator;if(s==="Co"){g.getContent()[0].setSelectedKey("co")}g.getContent()[1].setValue(d.filterCondition.valueLabel);break;default:g.setValue(d.label);break}e.insertNewAdvancedCondition(o,r);u.changeFilterAdvaced(d,true)}}n.data("initial",false)}},{key:"updateDetailPageListItemsSelected",value:function t(n,a){var r=a.data("dataType");e.sortingAttributeList(n.getParent().getParent());n.getParent().setBusy(false);if(r==="date"||r==="timestamp"||r==="number"||r==="integer"){n.focus()}}},{key:"removeAdvancedCondition",value:function t(n,a,r){var i=n.getContent();var o,l,g;if(r==="string"||r==="text"){for(var s=0;s<i.length-1;s++){o=i[s];l=o.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];if(l.getProperty("value")){var u=l.getValue();var C=a.getBindingContext().getObject();if(u===C.filterCondition.value){g=s;break}}}}n.removeContent(g)}},{key:"sortingAttributeList",value:function n(a){var r=a.getContent()[e.POS_SETTING_CONTAINER];var i=r.getItems()[e.POS_SORTING_SELECT].getItems()[0];var o=r.getItems()[e.POS_SHOWONTOP_CHECKBOX];var l=a.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];var g=l.data("dataType");var s=l.getBinding("items");var u=[];if(o.getSelected()){u.push(new t("selected",true,false))}switch(i.getSelectedKey()){case"sortName":u.push(new t("label",false,false));break;case"sortCount":u.push(new t("value",true,false));if(g==="string"||g==="text"){u.push(new t("label",false,false))}break;default:break}s.sort(u)}},{key:"insertNewAdvancedCondition",value:function t(n,a){var r=n.getParent();var i=new e.searchAdvancedCondition("",{type:a});if(a==="string"||a==="text"){var o=r.getContent().length-1;r.insertContent(i,o)}else{var l=r.indexOfContent(n);if(l===r.getContent().length-1){r.addContent(i)}}}},{key:"deleteAdvancedCondition",value:function t(n){var a=n.getParent();var r=n.getParent().getParent().getParent().getParent().getParent();a.removeContent(n);e.updateCountInfo(r)}},{key:"updateCountInfo",value:function t(n){var a=e.getFacetList();var r=a.getSelectedItem();if(!r){r=a.getItems()[0]}var i=r.getBindingContext().getModel();var o=r.getBindingContext().getPath();var g=i.getProperty(o).dimension;var s=i.aFilters;var u=0;var C=l(s),d;try{for(C.s();!(d=C.n()).done;){var c=d.value;if(!c.advanced&&c.facetAttribute===g){u++}}}catch(e){C.e(e)}finally{C.f()}var f;var T=i.getAttributeDataType(i.getProperty(o));if(T==="string"||T==="text"){f=n.getContent()[e.POS_ICONTABBAR].getItems()[e.POS_TABBAR_CONDITION].getContent()[0]}else{f=n.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER]}var v=f.getContent();var O=0;var m=l(v),A;try{for(m.s();!(A=m.n()).done;){var S=A.value;if(typeof S.getContent==="function"){var _=S.getContent()[0];if(_.getSelected()){O++}}}}catch(e){m.e(e)}finally{m.f()}var p=i.getProperty(o).facetType;if(p==="attribute"){var I=u+O;i.setProperty(o+"/count",I);e.dialog.resetEnabledForFilterResetButton()}}}]);return e}();return m})})();