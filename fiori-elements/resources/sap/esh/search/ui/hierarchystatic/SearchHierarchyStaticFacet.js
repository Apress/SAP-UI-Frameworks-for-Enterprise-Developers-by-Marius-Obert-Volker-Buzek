/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}function t(e,t){if(e)throw t;return t}function r(e,t){try{var r=e()}catch(e){return t(true,e)}if(r&&r.then){return r.then(t.bind(null,false),t.bind(null,true))}return t(false,r)}function n(){}function o(e){if(e&&e.then){return e.then(n)}}function i(e,t){if(!t){return e&&e.then?e.then(n):Promise.resolve()}}sap.ui.define(["../tree/TreeNodeFactory","./SearchHierarchyStaticTreeNode","../SearchHelperSequentializeDecorator"],function(n,a,u){function c(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function f(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var o=function(){};return{s:o,n:function(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,a=false,u;return{s:function(){r=r.call(e)},n:function(){var e=r.next();i=e.done;return e},e:function(e){a=true;u=e},f:function(){try{if(!i&&r.return!=null)r.return()}finally{if(a)throw u}}}}function l(e,t){if(!e)return;if(typeof e==="string")return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}function s(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function y(e,t,r){if(t)h(e.prototype,t);if(r)h(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function v(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var p=c(n);var N=c(a);var m=u["sequentializedExecution"];var b=function(){function n(e){d(this,n);this.model=e.model;this.sina=this.model.sinaNext;this.attributeId=e.attributeId;this.dataSource=e.dataSource;this.filter=e.filter;this.facetType="hierarchyStatic";this.title=e.title;this.facetIndex=-1;this.position=-1;this.treeNodeFactory=p.create({model:this.model,rootTreeNodePath:"/facets/".concat(this.facetIndex,"/rootTreeNode"),treeNodeConstructor:N,busyIndicator:this.model.busyIndicator});this.rootTreeNode=this.treeNodeFactory.createRootTreeNode({id:n.rootNodeId,label:"Root",facet:this});this.updateTree=m(this.updateTree)}y(n,[{key:"setFacetIndex",value:function e(t){this.facetIndex=t;this.treeNodeFactory.setRootTreeNodePath("/facets/".concat(this.facetIndex,"/rootTreeNode"))}},{key:"initAsync",value:function t(){try{const t=this;return e(t.rootTreeNode.fetchChildTreeNodes(),function(e){t.rootTreeNode.addChildTreeNodes(e)})}catch(e){return Promise.reject(e)}}},{key:"activateFilters",value:function n(){try{const n=this;return e(o(r(function(){return e(n.model._firePerspectiveQuery({preserveFormerResults:false}),function(){n.model.notifyFilterChanged()})},function(e,r){return t(e,r)})))}catch(e){return Promise.reject(e)}}},{key:"updateTree",value:function e(){return this.doUpdateTree()}},{key:"doUpdateTree",value:function t(){try{const t=this;return e(t.treeNodeFactory.updateRecursively(),function(){return e(t.mixinFilterNodes(),function(){t.treeNodeFactory.updateUI()})})}catch(e){return Promise.reject(e)}}},{key:"getComplexConditionOfFacet",value:function e(){var t=f(this.filter.rootCondition.conditions),r;try{for(t.s();!(r=t.n()).done;){var n=r.value;if(n.containsAttribute(this.attributeId)){return n}}}catch(e){t.e(e)}finally{t.f()}return null}},{key:"getFilterConditions",value:function e(){var t=[];var r=this.getComplexConditionOfFacet();if(!r){return t}var n=f(r.conditions),o;try{for(n.s();!(o=n.n()).done;){var i=o.value;t.push(i)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"mixinFilterNodes",value:function t(){try{const t=this;t.rootTreeNode.hasFilter=false;t.rootTreeNode.visitChildNodesRecursively(function(e){e.hasFilter=false});var r=t.getFilterConditions();var n=f(r),o;try{for(n.s();!(o=n.n()).done;){var a=o.value;var u=t.treeNodeFactory.getTreeNode(a.value);if(!u){continue}u.hasFilter=true}}catch(e){n.e(e)}finally{n.f()}return e(i(t.autoExpandFirstFilterNode()))}catch(e){return Promise.reject(e)}}},{key:"handleModelUpdate",value:function e(){this.treeNodeFactory.updateUI()}},{key:"delete",value:function e(){this.treeNodeFactory["delete"]()}},{key:"autoExpandFirstFilterNode",value:function t(){try{const t=this;var r=null;t.rootTreeNode.visitChildNodesRecursively(function(e){if(e.hasFilter&&!r){r=e}});if(!r){return e()}if(r.isVisible()){return e()}var n=r.getParentTreeNode();while(n){n.expanded=true;n=n.getParentTreeNode()}return e(i(t.treeNodeFactory.updateRecursively()))}catch(e){return Promise.reject(e)}}},{key:"updateNodesFromHierarchyNodePaths",value:function e(t){for(var r=0;r<t.length;++r){var n=t[r];if(n.name!==this.attributeId){continue}this.rootTreeNode.updateNodePath(n.path,0)}}}]);return n}();v(b,"rootNodeId","$$ROOT$$");return b})})();