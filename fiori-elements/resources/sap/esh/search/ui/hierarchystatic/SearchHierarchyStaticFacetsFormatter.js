/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(){}function t(t,r){if(!r){return t&&t.then?t.then(e):Promise.resolve()}}function r(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}function i(e,t){var r=e();if(r&&r.then){return r.then(t)}return t(r)}sap.ui.define(["./SearchHierarchyStaticFacet"],function(e){function a(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function o(e,t,r){if(t)u(e.prototype,t);if(r)u(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var c=a(e);var f=function(){function e(t){n(this,e);this.model=t;this.facetMap={}}o(e,[{key:"getHierarchyDefinitionDataSource",value:function e(t){var r=this.model.sinaNext.dataSources;for(var i=0;i<r.length;++i){var a=r[i];if(a.type!==this.model.sinaNext.DataSourceType.BusinessObject){continue}if(!a.isHierarchyDefinition){continue}if(t===a.hierarchyName){return a}}}},{key:"getFacetAttributes",value:function e(t){var r=t.query.filter.dataSource.attributesMetadata;var i=[];for(var a=0;a<r.length;++a){var n=r[a];if(!n.isHierarchy){continue}if(n.hierarchyDisplayType!==t.sina.HierarchyDisplayType.StaticHierarchyFacet){continue}var u=this.getHierarchyDefinitionDataSource(n.hierarchyName);if(!u){continue}i.push({attributeId:n.id,dataSource:u})}return i}},{key:"getFacet",value:function e(a,n,u,o){try{const e=this;var f=e.facetMap[u.attributeId];return r(i(function(){if(!f){var r=a.query.filter.dataSource.getAttributeMetadata(u.attributeId);f=new c({model:n,attributeId:u.attributeId,dataSource:u.dataSource,filter:n.getProperty("/uiFilter"),title:r.label});e.facetMap[u.attributeId]=f;return t(f.initAsync())}},function(){f.position=o;f.filter=n.getProperty("/uiFilter");f.updateNodesFromHierarchyNodePaths(a.hierarchyNodePaths);return r(f.mixinFilterNodes(),function(){return f})}))}catch(e){return Promise.reject(e)}}},{key:"getFacets",value:function e(t){if(!this.model.config.FF_staticHierarchyFacets){return Promise.resolve([])}var r=this.getFacetAttributes(t);var i=[];for(var a=0;a<r.length;++a){var n=r[a];var u=this.getFacet(t,this.model,n,100+a);i.push(u)}return Promise.all(i)}},{key:"destroy",value:function e(){for(var t in this.facetMap){var r=this.facetMap[t];r["delete"]()}this.facetMap={}}},{key:"handleDataSourceChanged",value:function e(){this.destroy()}}]);return e}();return f})})();