/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../../sina/DataSource","../../sina/ComparisonOperator","../../sina/LogicalOperator","../../sina/ComplexCondition","../../sina/AttributeType","./typeConverter","./eshObjects/src/index","../../core/errors"],function(e,r,a,t,n,i,o,s){function u(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}}function c(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||false;t.configurable=true;if("value"in t)t.writable=true;Object.defineProperty(e,t.key,t)}}function l(e,r,a){if(r)c(e.prototype,r);if(a)c(e,a);Object.defineProperty(e,"prototype",{writable:false});return e}
/*!
   * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
   */var p=e["DataSource"];var v=r["ComparisonOperator"];var d=a["LogicalOperator"];var f=t["ComplexCondition"];var h=n["AttributeType"];var C=o["SearchQueryComparisonOperator"];var O=o["SearchQueryLogicalOperator"];var w=o["Expression"];var y=o["Comparison"];var S=o["Phrase"];var m=o["StringValue"];var b=s["UnknownComparisonOperatorError"];var g=s["UnknownLogicalOperatorError"];var E=function(){function e(r){u(this,e);this.dataSource=r}l(e,[{key:"convertSinaToOdataOperator",value:function e(r){switch(r){case v.Eq:return C.EqualCaseSensitive;case v.Ne:return C.NotEqualCaseSensitive;case v.Lt:return C.LessThanCaseInsensitive;case v.Gt:return C.GreaterThanCaseInsensitive;case v.Le:return C.LessThanOrEqualCaseInsensitive;case v.Ge:return C.GreaterThanOrEqualCaseInsensitive;case v.Co:return C.EqualCaseInsensitive;case v.Bw:return C.EqualCaseInsensitive;case v.Ew:return C.EqualCaseInsensitive;case v.DescendantOf:return C.DescendantOf;case v.ChildOf:return C.ChildOf;default:throw new b("Unknow comparison operator "+r)}}},{key:"convertSinaToOdataLogicalOperator",value:function e(r){switch(r){case d.And:return O.AND;case d.Or:return O.OR;default:throw new g("Unknow logical operator "+r)}}},{key:"serializeComplexCondition",value:function e(r){var a=new w({operator:this.convertSinaToOdataLogicalOperator(r.operator),items:[]});var t=r.conditions;for(var n=0;n<t.length;++n){var i=t[n];a.items.push(this.serialize(i))}return a}},{key:"serializeSimpleCondition",value:function e(r){var a=h.String;var t;if(this.dataSource instanceof p){t=this.dataSource.getAttributeMetadata(r.attribute);if(t&&t.type){a=t.type}}var n=i.sina2Odata(a,r.value,{operator:r.operator});var o=this.convertSinaToOdataOperator(r.operator);return new y({property:r.attribute,operator:o,value:new S({phrase:n})})}},{key:"serializeBetweenCondition",value:function e(r){var a=r.conditions[0];var t=r.conditions[1];var n=h.String;if(this.dataSource instanceof p){var o=this.dataSource.getAttributeMetadata(a.attribute);n=o.type||h.String}var s=i.sina2Odata(n,a.value,{operator:a.operator});var u=i.sina2Odata(n,t.value,{operator:t.operator});return new w({operator:O.AND,items:[new y({property:a.attribute,operator:C.GreaterThanOrEqualCaseInsensitive,value:new m({value:s,isQuoted:true})}),new y({property:a.attribute,operator:C.LessThanOrEqualCaseInsensitive,value:new m({value:u,isQuoted:true})})]})}},{key:"serialize",value:function e(r){if(r instanceof f){if(r.operator===d.And&&r.conditions.length>1&&r.conditions[0]&&(r.conditions[0].operator===v.Ge||r.conditions[0].operator===v.Gt||r.conditions[0].operator===v.Le||r.conditions[0].operator===v.Lt)){return this.serializeBetweenCondition(r)}return this.serializeComplexCondition(r)}return this.serializeSimpleCondition(r)}}]);return e}();function T(e,r){var a=new E(e);var t=a.serialize(r);if(t instanceof y){t=new w({operator:O.TIGHT_AND,items:[t]})}return t}var L={__esModule:true};L.ConditionSerializer=E;L.serialize=T;return L})})();