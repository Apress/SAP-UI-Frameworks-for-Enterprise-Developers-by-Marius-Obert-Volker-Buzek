/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(e,r,t){if(t){return r?r(e):e}if(!e||!e.then){e=Promise.resolve(e)}return r?e.then(r):e}sap.ui.define(["../../core/util","./typeConverter","../../core/Log","../../core/errors","../tools/WhyfoundProcessor","./HierarchyNodePathParser"],function(r,t,a,i,n,s){function o(e){"@babel/helpers - typeof";return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function u(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}}function l(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function v(e,r,t){if(r)l(e.prototype,r);if(t)l(e,t);Object.defineProperty(e,"prototype",{writable:false});return e}function c(e,r,t){if(r in e){Object.defineProperty(e,r,{value:t,enumerable:true,configurable:true,writable:true})}else{e[r]=t}return e}var g=a["Log"];var f=i["InternalServerError"];var h=n["WhyfoundProcessor"];var p=s["HierarchyNodePathParser"];var d=function(){function a(e){u(this,a);c(this,"log",new g("hana_odata item parser"));this.provider=e;this.sina=e.sina;this.intentsResolver=this.sina._createFioriIntentsResolver({sina:this.sina});this.suvNavTargetResolver=this.sina._createSuvNavTargetResolver({sina:this.sina});this.hierarchyNodePathParser=new p(this.sina)}v(a,[{key:"parse",value:function e(r,t){try{const e=this;if(t.error&&!t.value){return Promise.reject(new f(t.error.message))}if(!t.value){return Promise.resolve([])}if(t.error){e.log.warn("Server-side Warning: "+t.error.message)}var a=t.value;var i=[];for(var n=0;n<a.length;++n){var s=a[n];var o=void 0;try{o=e.parseItem(s,r);i.push(o)}catch(r){e.log.warn("Error occurred by parsing result item number "+n+": "+r.message)}}return Promise.all(i)}catch(e){return Promise.reject(e)}}},{key:"parseItem",value:function a(i,n){try{const a=this;var s;var u=[];var l=[];var v=[];var c=[];var g={};var f={};var p=i["@odata.context"]||"";var d=p.lastIndexOf("#");if(d>-1){p=p.slice(d+1)}var m=(s=a.sina.getDataSource(p))!==null&&s!==void 0?s:n.getDataSource();var y=undefined;if(i["@com.sap.vocabularies.Search.v1.ParentHierarchies"]){var b={data:{"@com.sap.vocabularies.Search.v1.ParentHierarchies":i["@com.sap.vocabularies.Search.v1.ParentHierarchies"]}};y=a.hierarchyNodePathParser.parse(b,n)}var S=i["@com.sap.vocabularies.Search.v1.WhyFound"]||{};var A=i["@com.sap.vocabularies.Search.v1.hasChildren"]||false;var P=a.sina._createSearchResultSetItemAttribute({id:"HASHIERARCHYNODECHILD",label:"HASHIERARCHYNODECHILD",value:A.toString(),valueFormatted:A.toString(),valueHighlighted:A.toString(),isHighlighted:false,metadata:undefined,groups:[]});g[P.id]=P;u.push(P);var T;var H="";var N={};var I,R;var _=[];var O;var w=i["@com.sap.vocabularies.Search.v1.Ranking"];var D=new h(a.sina);var C=a.preParseItem(i);for(var U in C){if(n.groupBy&&n.groupBy.aggregateCountAlias&&n.groupBy.aggregateCountAlias===U){continue}var j=C[U];T=m.getAttributeMetadata(U);if(T.id=="LOC_4326"){T.usage.Detail.displayOrder=-1}var M=t.odata2Sina(T.type,j.value);var E=D.processRegularWhyFoundAttributes(U,j,S,T);var k="";if(typeof M==="string"){k=M}else if(M!==null&&M!==undefined){k=JSON.stringify(M)}var W=a.sina._createSearchResultSetItemAttribute({id:T.id,label:T.label,value:M,valueFormatted:k,valueHighlighted:E,isHighlighted:D.calIsHighlighted(E),metadata:T,groups:[]});if(T.iconUrlAttributeName&&C[T.iconUrlAttributeName]){var F=C[T.iconUrlAttributeName];if(o(F)==="object"&&F.value){W.iconUrl=F.value}else{W.iconUrl=F}}r.appendRemovingDuplicates(_,r.extractHighlightedTerms(W.valueHighlighted));if(T.usage.Title){l.push(W)}if(T.usage.TitleDescription){c.push(W)}if(T.usage.Detail){v.push(W)}u.push(W);if(T.usage.Navigation){if(T.usage.Navigation.mainNavigation){O=a.sina._createNavigationTarget({label:W.value,targetUrl:W.value,target:"_blank"})}}g[W.id]=W;H=m.attributeMetadataMap[T.id]._private.semanticObjectType||"";if(H.length>0){f[H]=M}}for(R in N){I=N[R];if(typeof I.suvTargetUrlAttribute==="string"){I.suvTargetUrlAttribute=g[I.suvTargetUrlAttribute]}if(typeof I.suvTargetMimeTypeAttribute==="string"){I.suvTargetMimeTypeAttribute=g[I.suvTargetMimeTypeAttribute]}if(!(I.suvTargetUrlAttribute||I.suvTargetMimeTypeAttribute)){delete N[R]}}l.sort(function(e,r){return e.metadata.usage.Title.displayOrder-r.metadata.usage.Title.displayOrder});v.sort(function(e,r){return e.metadata.usage.Detail.displayOrder-r.metadata.usage.Detail.displayOrder});a.suvNavTargetResolver.resolveSuvNavTargets(m,N,_);var L=a.sina._createSearchResultSetItem({dataSource:m,attributes:u,titleAttributes:l,titleDescriptionAttributes:c,detailAttributes:v,defaultNavigationTarget:O,navigationTargets:[],score:w});if(Array.isArray(y)&&y.length>0){L.hierarchyNodePaths=y}L._private.allAttributesMap=g;L._private.semanticObjectTypeAttributes=f;var x=a.sina._createItemPostParser({searchResultSetItem:L});return e(x.postParseResultSetItem(),function(r){return e(D.processAdditionalWhyfoundAttributes(S,r))})}catch(e){return Promise.reject(e)}}},{key:"preParseItem",value:function e(r){var t={};for(var a in r){if(a[0]==="@"||a[0]==="_"){continue}var i=r[a];var n=a.split("@");var s=n[0];var o=t[s];if(!o){o={};t[s]=o}if(n.length===1){o.value=i;continue}if(n.length===2){o[n[1]]=i;continue}throw"more than two @ in property name"}return t}}]);return a}();var m={__esModule:true};m.ItemParser=d;return m})})();