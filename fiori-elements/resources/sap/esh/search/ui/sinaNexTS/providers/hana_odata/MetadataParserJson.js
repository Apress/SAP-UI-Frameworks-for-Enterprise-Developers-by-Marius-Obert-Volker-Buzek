/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function t(t,e,n){if(n){return e?e(t):t}if(!t||!t.then){t=Promise.resolve(t)}return e?t.then(e):t}sap.ui.define(["../../sina/DataSourceType","./MetadataParser"],function(e,n){function r(t){"@babel/helpers - typeof";return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function a(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(t,r.key,r)}}function i(t,e,n){if(e)o(t.prototype,e);if(n)o(t,n);Object.defineProperty(t,"prototype",{writable:false});return t}function s(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});Object.defineProperty(t,"prototype",{writable:false});if(e)u(t,e)}function u(t,e){u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function t(e,n){e.__proto__=n;return e};return u(t,e)}function c(t){var e=E();return function n(){var r=b(t),a;if(e){var o=b(this).constructor;a=Reflect.construct(r,arguments,o)}else{a=r.apply(this,arguments)}return l(this,a)}}function l(t,e){if(e&&(typeof e==="object"||typeof e==="function")){return e}else if(e!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return f(t)}function f(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function E(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(t){return false}}function b(t){b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function t(e){return e.__proto__||Object.getPrototypeOf(e)};return b(t)}
/*!
   * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
   */var p=e["DataSourceType"];var y=n["MetadataParser"];var A=function(e){s(o,e);var n=c(o);function o(t){a(this,o);return n.call(this,t)}i(o,[{key:"fireRequest",value:function e(n,r){try{return t(n.getJson(r))}catch(t){return Promise.reject(t)}}},{key:"parseResponse",value:function e(n){try{const e=this;var r={businessObjectMap:{},businessObjectList:[],dataSourceMap:{},dataSourcesList:[]};var a=n.data&&n.data.metadata||n.data||n;var o=a["$EntityContainer"];if(typeof o!=="string"||o.length<1){throw"Meta data contains invalid EntityContainer!"}var i=o.split(".");var s=i[0];var u=i[1];var c=a[s];var l=c[u];var f=e._parseEntityType(s,c,u,l);e._parseEntityContainer(l,f,r);return t(r)}catch(t){return Promise.reject(t)}}},{key:"_parseEntityType",value:function t(e,n,r,a){var o={};for(var i in n){if(i===r){continue}var s=n[i];if(s["@EnterpriseSearch.enabled"]!==true){continue}i=i.substring(0,i.length-4);var u={schema:e,keys:[],attributeMap:{},label:a[i]["@SAP.Common.Label"]||"",labelPlural:a[i]["@SAP.Common.Label"]||"",annotations:{}};o[i]=u;var c=0;for(var l in s){var f=s[l];if(l==="$Key"){u.keys=f;continue}if(l.startsWith("@")){this._parseEntityTypeAnnotations(l,f,u);continue}this._parseAttribute(l,f,u,c);c++}}return o}},{key:"_parseEntityTypeAnnotations",value:function t(e,n,r){e=e.substring(1).toUpperCase();switch(e){case"UI.HEADERINFO.TYPENAME":r.label=n;break;case"UI.HEADERINFO.TYPENAMEPLURAL":r.label=n;break;case"UI.HEADERINFO.TITLE.TYPE":this._setAnnotationValue(r.annotations,e,n);break;case"UI.HEADERINFO.TITLE.VALUEQUALIFIER":this._setAnnotationValue(r.annotations,e,n);break;case"UI.HEADERINFO.TYPEIMAGEURL":r.icon=n;break;default:this._setAnnotationValue(r.annotations,e,n)}}},{key:"_parseAttribute",value:function t(e,n,a,o){if(r(n)!=="object"){return}var i={labelRaw:e,label:null,type:"",presentationUsage:[],isFacet:false,isSortable:false,supportsTextSearch:false,displayOrder:o,annotationsAttr:{},unknownAnnotation:[]};a.attributeMap[e]=i;for(var s in n){var u=n[s];if(s==="$Type"||s==="Type"){i["type"]=u;continue}if(s.startsWith("@")){this._parseAttributeAnnotations(s,u,i)}}}},{key:"_parseAttributeAnnotations",value:function t(e,n,r){e=e.substring(1).toUpperCase();if(n!==undefined){this._normalizeAnnotationValueOfArrayOrObject(n);switch(e){case"SAP.COMMON.LABEL":if(!r.label){r.label=n}break;case"ENTERPRISESEARCH.KEY":r.isKey=n;break;case"ENTERPRISESEARCH.PRESENTATIONMODE":r.presentationUsage=n;break;case"ENTERPRISESEARCHHANA.ISSORTABLE":r.isSortable=n;break;case"ENTERPRISESEARCHHANA.SUPPORTSTEXTSEARCH":r.supportsTextSearch=n;break;case"ENTERPRISESEARCH.FILTERINGFACET.DEFAULT":r.isFacet=n;break;case"ENTERPRISESEARCH.FILTERINGFACET.DISPLAYPOSITION":r.facetPosition=n;break;case"ENTERPRISESEARCH.FILTERINGFACET.ICONURL":r.facetIconUrlAttributeName=n;break;case"ENTERPRISESEARCH.FILTERINGATTRIBUTE.DEFAULT":r.isFilteringAttribute=n;break;case"ENTERPRISESEARCH.FILTERINGATTRIBUTE.DISPLAYPOSITION":r.facetPosition=n;break;case"ENTERPRISESEARCH.FILTERINGATTRIBUTE.ICONURL":r.facetIconUrlAttributeName=n;break;case"ENTERPRISESEARCH.DISPLAYORDER":r.displayOrder=n;break;default:if(e.startsWith("UI")||e.startsWith("OBJECTMODEL")||e.startsWith("SEMANTICS")){this._setAnnotationValue(r.annotationsAttr,e,n)}else{r.unknownAnnotation.push(e)}}}}},{key:"_normalizeAnnotationValueOfArrayOrObject",value:function t(e){if(Array.isArray(e)){for(var n=0;n<e.length;n++){this._normalizeAnnotationValueOfObject(e[n])}}else this._normalizeAnnotationValueOfObject(e);return e}},{key:"_normalizeAnnotationValueOfObject",value:function t(e){if(r(e)==="object"){for(var n in e){var a=n.toUpperCase();e[a]=e[n];delete e[n]}}return e}},{key:"_getValueFromArrayWithSingleEntry",value:function t(e){if(Array.isArray(e)&&e.length===1){return e[0]}return e}},{key:"_parseEntityContainer",value:function t(e,n,r){for(var a in e){var o=n[a];if(a==="$Kind"){continue}if(o===undefined){throw"EntityType "+a+" has no corresponding meta data!"}var i=this.sina._createDataSource({id:a,label:o.label||a,labelPlural:o.labelPlural||o.label||a,icon:o.icon||"",type:p.BusinessObject,attributesMetadata:[{id:"dummy"}]});i.annotations=o.annotations;r.dataSourceMap[i.id]=i;r.dataSourcesList.push(i);o.name=a;o.dataSource=i;r.businessObjectMap[a]=o;r.businessObjectList.push(o)}}}]);return o}(y);var R={__esModule:true};R.MetadataParserJson=A;return R})})();