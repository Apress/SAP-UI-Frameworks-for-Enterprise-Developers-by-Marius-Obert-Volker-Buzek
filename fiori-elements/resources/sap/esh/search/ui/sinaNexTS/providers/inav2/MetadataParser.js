/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../../core/errors","../../sina/AttributeFormatType","../../sina/AttributeType","../../sina/MatchingStrategy"],function(e,t,a,r){function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function s(e,t,a){if(t)n(e.prototype,t);if(a)n(e,a);Object.defineProperty(e,"prototype",{writable:false});return e}
/*!
   * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
   */var u=e["UnknownDataTypeError"];var o=e["UnknownPresentationUsageError"];var l=t["AttributeFormatType"];var p=a["AttributeType"];var c=r["MatchingStrategy"];var f=function(){function e(t){i(this,e);this.provider=t;this.sina=t.sina}s(e,[{key:"normalizeAttributeMetadata",value:function e(t){t.IsKey=t.isKey}},{key:"parseRequestAttributes",value:function e(t,a){var r=a.Cube.Dimensions;var i=[];for(var n=0;n<r.length;++n){var s=r[n];if(s.Name.slice(0,2)==="$$"){continue}var u=s.Attributes[0];this.normalizeAttributeMetadata(u);i.push(u)}this.provider.fillInternalMetadata(t,"metadataRequest",i)}},{key:"parseResponseAttributes",value:function e(t,a){var r=[];var i=a.Cube.Dimensions[0].Attributes;for(var n=0;n<i.length;++n){var s=i[n];if(s.Name.slice(0,2)==="$$"){continue}this.normalizeAttributeMetadata(s);r.push(s)}this.provider.fillInternalMetadata(t,"metadataRequest",r)}},{key:"parseMetadataRequestMetadata",value:function e(t,a){var r=this.provider.getInternalMetadataLoadStatus(t);if(r.metadataRequest){return}this.parseRequestAttributes(t,a);this.parseResponseAttributes(t,a);this.fillPublicMetadataBuffer(t)}},{key:"parseSearchRequestMetadata",value:function e(t){var a=this.sina.getDataSource(t.$$DataSourceMetaData$$[0].ObjectName);var r=this.provider.getInternalMetadataLoadStatus(a);if(r.searchRequest){return}this.provider.fillInternalMetadata(a,"searchRequest",t.$$AttributeMetadata$$);this.fillPublicMetadataBuffer(a);this.calculateAttributeDisplayOrder(a,t)}},{key:"fillPublicMetadataBuffer",value:function e(t){t.attributesMetadata=[];t.attributeMetadataMap={};var a=this.provider.getInternalMetadataAttributes(t);for(var r=0;r<a.length;++r){var i=a[r];var n=this._parseAttributeTypeAndFormat(i);var s=this.sina._createAttributeMetadata({type:n.type,format:n.format,id:i.Name,label:i.Description,isSortable:this._parseIsSortable(i),isKey:i.IsKey,matchingStrategy:this._parseMatchingStrategy(i),usage:this._parseUsage(i)});t.attributesMetadata.push(s);t.attributeMetadataMap[i.Name]=s}t._configure()}},{key:"calculateAttributeDisplayOrder",value:function e(t,a){var r,i,n;var s=[];var u=[];var o=[];var l=[];for(var p=0;p<a.$$ResultItemAttributes$$.length;++p){var c=a.$$ResultItemAttributes$$[p];var f=this.provider.getInternalMetadataAttribute(t,c.Name);if(f.presentationUsage.indexOf("Title")>=0||f.IsTitle){s.push(c.Name)}if(f.presentationUsage.indexOf("Summary")>=0||f.presentationUsage.indexOf("Image")>=0||f.presentationUsage.indexOf("Thumbnail")>=0){u.push(c.Name)}else if(f.presentationUsage.indexOf("Detail")>=0){o.push(c.Name)}}for(n=0;n<s.length;++n){r=s[n];i=t.getAttributeMetadata(r);i.usage.Title.displayOrder=n}l.push.apply(l,u);l.push.apply(l,o);for(n=0;n<l.length;++n){r=l[n];i=t.getAttributeMetadata(r);i.usage.Detail.displayOrder=n}}},{key:"_parseIsSortable",value:function e(t){if(typeof t.IsSortable==="undefined"){return false}return t.IsSortable}},{key:"_parseMatchingStrategy",value:function e(t){if(t.hasFulltextIndex){return c.Text}return c.Exact}},{key:"_parseUsage",value:function e(t){var a={};if(t.presentationUsage.indexOf("Title")>=0||t.IsTitle){a.Title={displayOrder:0}}if(t.presentationUsage.indexOf("Summary")>=0||t.presentationUsage.indexOf("Image")>=0||t.presentationUsage.indexOf("Thumbnail")>=0||t.presentationUsage.indexOf("Detail")>=0){a.Detail={displayOrder:0}}if(t.accessUsage.indexOf("AutoFacet")>=0){a.Facet={displayOrder:0}}if(t.accessUsage.indexOf("AdvancedSearch")>=0){a.AdvancedSearch={displayOrder:0}}return a}},{key:"_parseAttributeTypeAndFormat",value:function e(t){for(var a=0;a<t.presentationUsage.length;a++){var r=t.presentationUsage[a];switch(r){case"Summary":continue;case"Detail":continue;case"Title":continue;case"Hidden":continue;case"FactSheet":continue;case"Thumbnail":case"Image":return{type:p.ImageUrl};case"Text":return{type:p.String,format:l.LongText};default:throw new o("Unknown presentation usage "+r)}}switch(t.DataType){case"Integer":case"Long":return{type:p.Integer};case"Double":return{type:p.Double};case"String":return{type:p.String};case"Date":return{type:p.Date};case"Time":return{type:p.Time};case"Timestamp":return{type:p.Timestamp};case"GeoJson":return{type:p.GeoJson};default:throw new u("Unknown data type "+t.DataType)}}}]);return e}();var d={__esModule:true};d.MetadataParser=f;return d})})();