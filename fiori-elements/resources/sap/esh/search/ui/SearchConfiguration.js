/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["sap/esh/search/ui/controls/SearchResultListSelectionHandler","./controls/SearchResultListItemNote","./SearchConfigurationSettings","sap/base/Log","sap/base/assert"],function(e,t,r,o,a){function n(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||false;o.configurable=true;if("value"in o)o.writable=true;Object.defineProperty(e,o.key,o)}}function c(e,t,r){if(t)u(e.prototype,t);if(r)u(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)f(e,t)}function f(e,t){f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return f(e,t)}function d(e){var t=m();return function r(){var o=p(e),a;if(t){var n=p(this).constructor;a=Reflect.construct(o,arguments,n)}else{a=o.apply(this,arguments)}return h(this,a)}}function h(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return g(e)}function g(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function m(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function p(e){p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return p(e)}function y(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var v=n(t);var S=n(r);var C=r["defaultSearchConfigurationSettings"];var b=r["deprecatedParameters"];var P=function(t){l(n,t);var r=d(n);function n(t){var a;s(this,n);a=r.call(this);y(g(a),"log",o.getLogger("sap.esh.search.ui.SearchConfiguration"));y(g(a),"dataSourceConfigurations_Regexes",[]);y(g(a),"defaultDataSourceConfig",{searchResultListItem:undefined,searchResultListItemControl:undefined,searchResultListItemContent:undefined,searchResultListItemContentControl:undefined,searchResultListSelectionHandler:e["getMetadata"]().getName(),searchResultListSelectionHandlerControl:e});jQuery.extend(g(a),t);if(a.isUshell){a.readUshellConfiguration();a.readOutdatedUshellConfiguration()}a.updateConfigFromUrlParameters();a.initDataSourceConfig();a.setModulePaths();a.setSinaLanguageDefault();a.checkForDeprecatedParameters();return a}c(n,[{key:"checkForDeprecatedParameters",value:function e(){for(var t in b){if(t in this){var r="You are using a deprecated configuration property for SearchCompositeControl which will be removed in a future release: '"+t+"'. ";if(b[t]in this){this[b[t]]=this[t];r+="Please use '"+b[t]+"' instead."}a(false,r)}}}},{key:"setSinaLanguageDefault",value:function e(){if(this.isUshell){return}if(this.sinaConfiguration&&!this.sinaConfiguration.getLanguage){var t=function e(){return sap.ui.getCore().getConfiguration().getLanguage()};this.sinaConfiguration["getLanguage"]=t}}},{key:"setModulePaths",value:function e(){if(!this.modulePaths){return}for(var t=0;t<this.modulePaths.length;++t){var r=this.modulePaths[t];var o=r.urlPrefix.replace("${host}",window.location.protocol+"//"+window.location.host);jQuery.sap.registerModulePath(r.moduleName,o)}}},{key:"readUshellConfiguration",value:function e(){try{var t=window["sap-ushell-config"].renderers.fiori2.componentData.config.esearch;jQuery.extend(true,this,t)}catch(e){}}},{key:"readOutdatedUshellConfiguration",value:function e(){try{var t=window["sap-ushell-config"].renderers.fiori2.componentData.config;if(typeof t.searchBusinessObjects!=="undefined"){if(t.searchBusinessObjects==="hidden"||t.searchBusinessObjects===false){this.searchBusinessObjects=false}else{this.searchBusinessObjects=true}}}catch(e){}}},{key:"initDataSourceConfig",value:function e(){this.dataSourceConfigurations={};this.dataSourceConfigurations_Regexes=[];if(this.dataSources){for(var t=0;t<this.dataSources.length;t++){var r=this.dataSources[t];if(r.id){this.dataSourceConfigurations[r.id]=r}else if(r.regex){var o=r.regexFlags||undefined;var a=new RegExp(r.regex,o);if(a){r.regexObject=a;this.dataSourceConfigurations_Regexes.push(r)}}else{var n="Following datasource configuration does neither include a valid id nor a regular expression, therefore it is ignored:\n"+JSON.stringify(r);this.log.warning(n)}}}this.dataSources=undefined;this.documentDataSourceConfiguration={searchResultListItem:"sap.esh.search.ui.controls.SearchResultListItemDocument"};var i=this.dataSourceConfigurations.noteprocessorurl||{};this.dataSourceConfigurations.noteprocessorurl=i;this.dataSourceConfigurations.noteprocessorurl.searchResultListItemControl=this.dataSourceConfigurations.noteprocessorurl.searchResultListItemControl||new v;this.dataSourceConfigurations.noteprocessorurl.searchResultListSelectionHandler=this.dataSourceConfigurations.noteprocessorurl.searchResultListSelectionHandler||"sap.esh.search.ui.controls.SearchResultListSelectionHandlerNote"}},{key:"getParameterType",value:function e(t){if(t in b){if(b[t]){t=b[t]}else{return"string"}}if(!C.hasOwnProperty(t)){return""}return i(C[t])}},{key:"parseBoolean",value:function e(t){if(t.toLowerCase()==="true"){return true}return false}},{key:"parseEsDevConfig",value:function e(t){var r=JSON.parse(t);jQuery.extend(this,r)}},{key:"updateConfigFromUrlParameters",value:function e(){var t=this.parseUrlParameters();for(var r in t){var o=t[r];var a=this.getParameterType(r);if(r.startsWith("sina")){continue}if(r==="demoMode"){this.searchBusinessObjects=true;continue}if(r==="resultViewTypes"){var n=o.split(",");n=n.filter(function(e){return e.length>0});this.resultViewTypes=n;continue}if(r==="esDevConfig"){this.parseEsDevConfig(o);continue}switch(a){case"string":this[r]=o;break;case"number":this[r]=parseInt(o);break;case"boolean":this[r]=this.parseBoolean(o);break;default:}}}},{key:"parseUrlParameters",value:function e(){if(!URLSearchParams){return{}}var t=new URLSearchParams(window.location.search);return Object.fromEntries(t.entries())}},{key:"loadCustomModulesAsync",value:function e(){if(this._loadCustomModulesProm){return this._loadCustomModulesProm}var t;var r=[];for(var o in this.dataSourceConfigurations){t=this.loadCustomModulesForDataSourceIdAsync(o);r.push(t)}this._loadCustomModulesProm=Promise.all(r);return this._loadCustomModulesProm}},{key:"loadCustomModulesForDataSourcesAsync",value:function e(t,r){try{const e=this;var o=[];for(var a=0;a<t.length;a++){var n=Array.isArray(r)&&r.length>a&&r[a]||{};var i=e.loadCustomModulesForDataSourceAsync(t[a],n);o.push(i)}return Promise.all(o)}catch(e){return Promise.reject(e)}}},{key:"loadCustomModulesForDataSourceAsync",value:function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};r=r||{};return this.loadCustomModulesForDataSourceIdAsync(t.id,r)}},{key:"loadCustomModulesForDataSourceIdAsync",value:function e(t,r){if(!t){return Promise.resolve()}this._dataSourceLoadingProms=this._dataSourceLoadingProms||{};var o=this._dataSourceLoadingProms[t];if(!o){var a=[{moduleAttrName:"searchResultListItem",controlAttrName:"searchResultListItemControl"},{moduleAttrName:"searchResultListItemContent",controlAttrName:"searchResultListItemContentControl"},{moduleAttrName:"searchResultListSelectionHandler",controlAttrName:"searchResultListSelectionHandlerControl"}];var n=this._prepareDataSourceConfigurationForDataSource(t,r);var i;var s=[];for(var u=0;u<a.length;u++){i=this._doLoadCustomModulesAsync(t,n,a[u].moduleAttrName,a[u].controlAttrName);s.push(i)}o=Promise.all(s);o._resolvedOrFailed=false;o.then(function(){o._resolvedOrFailed=true});this._dataSourceLoadingProms[t]=o}return o}},{key:"_doLoadCustomModulesAsync",value:function e(t,r,o,a,n,i){var s=this;return new Promise(function(e){if(r[o]&&(!r[a]||r[a]==s.defaultDataSourceConfig[a])){try{sap.ui.require([r[o].replace(/[.]/g,"/")],function(t){r[a]=t;e()})}catch(c){var u="Could not load custom module '"+r[o]+"' for data source with id '"+t+"'. ";u+="Falling back to default data source configuration.";s.log.warning(u);r[o]=n||s.defaultDataSourceConfig[o];r[a]=i||s.defaultDataSourceConfig[a];e()}}else{if(!r[a]){r[o]=n||s.defaultDataSourceConfig[o];r[a]=i||s.defaultDataSourceConfig[a]}e()}})}},{key:"getDataSourceConfig",value:function e(t){if(this._dataSourceLoadingProms&&this._dataSourceLoadingProms[t.id]&&!this._dataSourceLoadingProms[t.id]._resolvedOrFailed){return this.defaultDataSourceConfig}var r=this.dataSourceConfigurations[t.id];if(!r){r=this.defaultDataSourceConfig;this.dataSourceConfigurations[t.id]=r}return r}},{key:"_prepareDataSourceConfigurationForDataSource",value:function e(t,r){var o={};if(this.dataSourceConfigurations[t]){o=this.dataSourceConfigurations[t]}else{for(var a=0;a<this.dataSourceConfigurations_Regexes.length;a++){if(this.dataSourceConfigurations_Regexes[a].regexObject.test(t)){o=this.dataSourceConfigurations_Regexes[a];break}}}if(r&&r.isDocumentConnector){if(!o.searchResultListItem){o.searchResultListItem=this.documentDataSourceConfiguration.searchResultListItem}else{var n="Will attempt to load '"+o.searchResultListItem+"' instead of '"+this.documentDataSourceConfiguration.searchResultListItem+"' for data source '"+t+"'";this.log.warning(n)}}this.dataSourceConfigurations[t]=o;return o}}]);return n}(S);return P})})();