/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./i18n","sap/m/MessageBox","./SearchModel","sap/ui/core/library","./hierarchydynamic/SearchHierarchyDynamicFacet","./SearchFacetDialogHelperDynamicHierarchy"],function(e,t,r,i,n,a){function o(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function u(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var i=0;var n=function(){};return{s:n,n:function(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,o=false,u;return{s:function(){r=r.call(e)},n:function(){var e=r.next();a=e.done;return e},e:function(e){o=true;u=e},f:function(){try{if(!a&&r.return!=null)r.return()}finally{if(o)throw u}}}}function l(e,t){if(!e)return;if(typeof e==="string")return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}function s(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function h(e,t,r){if(t)f(e.prototype,t);if(r)f(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function y(){if(typeof Reflect!=="undefined"&&Reflect.get){y=Reflect.get.bind()}else{y=function e(t,r,i){var n=p(t,r);if(!n)return;var a=Object.getOwnPropertyDescriptor(n,r);if(a.get){return a.get.call(arguments.length<3?t:i)}return a.value}}return y.apply(this,arguments)}function p(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=C(e);if(e===null)break}return e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)d(e,t)}function d(e,t){d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return d(e,t)}function g(e){var t=b();return function r(){var i=C(e),n;if(t){var a=C(this).constructor;n=Reflect.construct(i,arguments,a)}else{n=i.apply(this,arguments)}return m(this,n)}}function m(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return F(e)}function F(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function b(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function C(e){C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return C(e)}var O=o(e);var w=t["Action"];var D=o(r);var P=i["TextDirection"];var j=o(n);var S=a["createFilterFacetItemForDynamicHierarchy"];var I=function(e){v(i,e);var r=g(i);function i(e){var t;c(this,i);t=r.call(this,{searchModel:e.searchModel,configuration:e.searchModel.config});t.aFilters=[];return t}h(i,[{key:"prepareFacetList",value:function e(){var t=this.getDataSource();this.setProperty("/facetDialog",this.oFacetFormatter.getDialogFacetsFromMetaData(t,this));this.initialFillFiltersForDynamicHierarchyFacets()}},{key:"initialFillFiltersForDynamicHierarchyFacets",value:function e(){var t=this.getProperty("/uiFilter");var r=this.getProperty("/facetDialog");var i=u(r),n;try{for(i.s();!(n=i.n()).done;){var a=n.value;if(!(a instanceof j)){continue}var o=t.rootCondition.getAttributeConditions(a.attributeId);var l=u(o),s;try{for(l.s();!(s=l.n()).done;){var c=s.value;var f=c;var h=S(a,f);this.aFilters.push(h)}}catch(e){l.e(e)}finally{l.f()}}}catch(e){i.e(e)}finally{i.f()}}},{key:"facetDialogSingleCall",value:function e(r){var i=this;this.chartQuery.dimension=r.sAttribute;this.chartQuery.top=r.sAttributeLimit;return this.chartQuery.getResultSetAsync().then(function(e){var t;if(r.bInitialFilters){t=i.oFacetFormatter.getDialogFacetsFromChartQuery(e,i,i.chartQuery.dimension)}else{t=i.oFacetFormatter.getDialogFacetsFromChartQuery(e,i,i.chartQuery.dimension,i.aFilters)}var n=jQuery.extend(true,{},t);t.items4pie=n.items;var a=0,o=0,u=0,l=0;for(var s=0;s<t.items4pie.length;s++){if(s<9){t.items4pie[s]["pieReady"]=true;if(parseInt(t.items4pie[s].value)>0){a+=parseInt(t.items4pie[s].value)}}else{t.items4pie[s]["pieReady"]=false;if(parseInt(t.items4pie[s].value)>0){o+=parseInt(t.items4pie[s].value)}}}u=o*100/(a+o);u=Math.ceil(u);l=a/9;l=Math.floor(l);if(u>0){var c=t.items4pie[0].clone();c.value=l.toString();c.label=O.getText("facetPieChartOverflowText2",[u.toString(),"9"]);c["pieReady"]=true;c.valueLabel=""+l;c["isPieChartDummy"]=true;t.items4pie.push(c)}for(var f=0;f<t.items4pie.length;f++){t.items4pie[f]["percentageMissingInBigPie"]=u}i.setProperty(r.sBindingPath+"/items4pie",t.items4pie);i.setProperty(r.sBindingPath+"/items",t.items)},function(e){var r=O.getText("searchError");var i=e.message;t.error(i,{title:r,actions:w.OK,onClose:null,styleClass:"",initialFocus:null,textDirection:P.Inherit})})}},{key:"resetChartQueryFilterConditions",value:function e(){if(this.chartQuery){this.chartQuery.resetConditions()}var t=this.getNonFilterByFilterConditions();if(t.length>0){var r=u(t),i;try{for(r.s();!(i=r.n()).done;){var n=i.value;this.chartQuery.autoInsertCondition(n)}}catch(e){r.e(e)}finally{r.f()}}}},{key:"hasFilterCondition",value:function e(t){for(var r=0;r<this.aFilters.length;r++){if(this.aFilters[r].filterCondition.equals&&this.aFilters[r].filterCondition.equals(t)){return true}}return false}},{key:"hasFilter",value:function e(t){var r=t.filterCondition;return this.hasFilterCondition(r)}},{key:"addFilter",value:function e(t){if(!this.hasFilter(t)){this.aFilters.push(t)}}},{key:"removeFilter",value:function e(t){var r=t.filterCondition;for(var i=0;i<this.aFilters.length;i++){if(this.aFilters[i].filterCondition.equals&&this.aFilters[i].filterCondition.equals(r)){this.aFilters.splice(i,1);return}}}},{key:"changeFilterAdvaced",value:function e(t,r){var i=t.filterCondition;for(var n=0;n<this.aFilters.length;n++){if(this.aFilters[n].filterCondition.equals&&this.aFilters[n].filterCondition.equals(i)){this.aFilters[n].advanced=r;return}}}},{key:"addFilterCondition",value:function e(t){this.chartQuery.filter.autoInsertCondition(t)}},{key:"getAttributeDataType",value:function e(t){switch(t.dataType){case"Integer":return"integer";case"Double":return"number";case"Timestamp":return"timestamp";case"Date":return"date";case"String":if(t.matchingStrategy===this.sinaNext.MatchingStrategy.Text){return"text"}return"string";default:return"string"}}},{key:"destroy",value:function e(){y(C(i.prototype),"destroy",this).call(this);this.oFacetFormatter.destroy()}}]);return i}(D);return I})})();