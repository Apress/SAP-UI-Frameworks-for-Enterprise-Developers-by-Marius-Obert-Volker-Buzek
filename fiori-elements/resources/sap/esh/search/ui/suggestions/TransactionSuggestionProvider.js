/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(e,t,n){if(n){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}function t(e,r,i){if(!e.s){if(i instanceof n){if(i.s){if(r&1){r=i.s}i=i.v}else{i.o=t.bind(null,e,r);return}}if(i&&i.then){i.then(t.bind(null,e,r),t.bind(null,e,2));return}e.s=r;e.v=i;const o=e.o;if(o){o(e)}}}const n=function(){function e(){}e.prototype.then=function(n,r){const i=new e;const o=this.s;if(o){const e=o&1?n:r;if(e){try{t(i,1,e(this.v))}catch(e){t(i,2,e)}return i}else{return this}}this.o=function(e){try{const o=e.v;if(e.s&1){t(i,1,n?n(o):o)}else if(r){t(i,1,r(o))}else{t(i,2,o)}}catch(e){t(i,2,e)}};return i};return e}();function r(e){return e instanceof n&&e.s&1}function i(e,i,o){var s;for(;;){var a=e();if(r(a)){a=a.v}if(!a){return u}if(a.then){s=0;break}var u=o();if(u&&u.then){if(r(u)){u=u.s}else{s=1;break}}if(i){var c=i();if(c&&c.then&&!r(c)){s=2;break}}}var f=new n;var l=t.bind(null,f,2);(s===0?a.then(h):s===1?u.then(g):c.then(v)).then(void 0,l);return f;function g(n){u=n;do{if(i){c=i();if(c&&c.then&&!r(c)){c.then(v).then(void 0,l);return}}a=e();if(!a||r(a)&&!a.v){t(f,1,u);return}if(a.then){a.then(h).then(void 0,l);return}u=o();if(r(u)){u=u.v}}while(!u||!u.then);u.then(g).then(void 0,l)}function h(e){if(e){u=o();if(u&&u.then){u.then(g).then(void 0,l)}else{g(u)}}else{t(f,1,u)}}function v(){if(a=e()){if(a.then){a.then(h).then(void 0,l)}else{h(a)}}else{t(f,1,u)}}}function o(){}function s(e){if(e&&e.then){return e.then(o)}}function a(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}function u(e,t){if(e)throw t;return t}function c(e,t){try{var n=e()}catch(e){return t(true,e)}if(n&&n.then){return n.then(t.bind(null,false),t.bind(null,true))}return t(false,n)}function f(e,t){return e&&e.then?e.then(t):t(e)}sap.ui.define(["../sinaNexTS/sina/DataSourceType","./SuggestionType","./SinaObjectSuggestionFormatter","../flp/BackendSystem","../flp/FrontendSystem"],function(t,n,r,o,l){function g(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function h(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=v(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var r=0;var i=function(){};return{s:i,n:function(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,s=false,a;return{s:function(){n=n.call(e)},n:function(){var e=n.next();o=e.done;return e},e:function(e){s=true;a=e},f:function(){try{if(!o&&n.return!=null)n.return()}finally{if(s)throw a}}}}function v(e,t){if(!e)return;if(typeof e==="string")return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}function d(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function S(e,t,n){if(t)p(e.prototype,t);if(n)p(e,n);Object.defineProperty(e,"prototype",{writable:false});return e}function m(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}var b=t["DataSourceType"];var T=g(n);var C=n["Type"];var w=g(r);var D=g(o);var j=g(l);var A=function(){function t(e){y(this,t);m(this,"suggestionFormatter",new w);m(this,"transactionSuggestions",[]);this.model=e.model;this.suggestionHandler=e.suggestionHandler;this.suggestionLimit=sap.ui.Device.system.phone?5:7;this.sinaNext=this.model.sinaNext;this.suggestionQuery=this.sinaNext.createSuggestionQuery();this.transactionsDS=this.sinaNext.createDataSource({id:"CD$ALL~ESH_TRANSACTION~",label:"Transactions",type:b.BusinessObject});this.suggestionStartingCharacters=this.model.config.suggestionStartingCharacters}S(t,[{key:"abortSuggestions",value:function e(){this.suggestionQuery.abort()}},{key:"getUrl",value:function e(t){var n="#Shell-startGUI?sap-ui2-tcode="+t;var r=D.getSystem(this.model);if(r&&!r.equals(j.getSystem())){n="#Shell-startGUI?sap-system=sid(".concat(r.id,")&sap-ui2-tcode=").concat(t)}return n}},{key:"getSuggestions",value:function t(n){try{const t=this;var r;if(!t.model.config.searchBusinessObjects){return Promise.resolve([])}var o=t.model.getDataSource();var l=t.model.userCategoryManager;var g=(l===null||l===void 0?void 0:l.isFavActive())&&(l===null||l===void 0?void 0:(r=l.getCategory("MyFavorites"))===null||r===void 0?void 0:r.includeApps);if(o!==t.model.allDataSource&&o!==t.model.appDataSource&&!(o===t.model.favDataSource&&g)){return Promise.resolve([])}n=n.clone();var v=n.searchTerm;if(v.toLowerCase().indexOf("/n")===0||v.toLowerCase().indexOf("/o")===0){v=v.slice(2);n.searchTerm=v}t.transactionSuggestions=[];if(v.length<t.suggestionStartingCharacters){return Promise.resolve([])}t.prepareSuggestionQuery(n);return e(t.suggestionQuery.getResultSetAsync(),function(r){var o=r.items;var l=h(o),g;return f(c(function(){return a(function(){l.s();return s(i(function(){return!(g=l.n()).done},void 0,function(){var r=g.value;var i={uiSuggestionType:C.Transaction,dataSource:t.transactionsDS,position:T.properties.Transaction.position,key:r.object.attributesMap.TCODE.value,searchTerm:n.searchTerm,url:t.getUrl(r.object.attributesMap.TCODE.value),icon:"sap-icon://generate-shortcut",label:r.object.attributesMap.TCDTEXT.valueHighlighted,type:r.type,calculationMode:r.calculationMode,object:r.object,sina:r.sina};return e(sap.ushell.Container.getServiceAsync("CrossApplicationNavigation"),function(n){return e(n.isNavigationSupported([{target:{shellHash:i.url}}]),function(e){if(e[0].supported){t.suggestionFormatter.format(t,i)}})})}))},function(e){l.e(e)})},function(e,t){l.f();return u(e,t)}),function(){var e=t.suggestionHandler.getSuggestionLimit(C.Transaction);t.transactionSuggestions=t.transactionSuggestions.slice(0,e);return t.transactionSuggestions})})}catch(e){return Promise.reject(e)}}},{key:"addSuggestion",value:function e(t){this.transactionSuggestions.push(t)}},{key:"prepareSuggestionQuery",value:function e(t){this.suggestionQuery.resetResultSet();this.suggestionQuery.setFilter(t);this.suggestionQuery.setDataSource(this.transactionsDS);this.suggestionQuery.setTypes([this.sinaNext.SuggestionType.Object]);this.suggestionQuery.setCalculationModes([this.sinaNext.SuggestionCalculationMode.Data]);this.suggestionQuery.setTop(10)}}]);return t}();return A})})();