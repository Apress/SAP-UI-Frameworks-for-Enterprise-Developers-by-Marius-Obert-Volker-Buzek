/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./i18n","sap/esh/search/ui/controls/SearchFieldGroup","sap/esh/search/ui/SearchHelper","sap/ui/core/InvisibleText","./SearchFieldStateManager","./SearchShellHelperHorizonTheme","./UIEvents"],function(e,t,a,i,r,s,o){function n(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function c(e,t,a){if(t)l(e.prototype,t);if(a)l(e,a);Object.defineProperty(e,"prototype",{writable:false});return e}var u=n(e);var S=n(r);var d=n(s);var p=n(o);var f=function(){function e(){h(this,e);throw new Error("Cannot instantiate static class 'SearchShellHelper'")}c(e,null,[{key:"init",value:function e(){var r=this;if(this.isInitialized){return}this.isInitialized=true;sap.ushell.Container.getServiceAsync("Search").then(function(e){e.prefetch()});this.oModel=sap.esh.search.ui.getModelSingleton({},"flp");this.oSearchFieldGroup=new t("searchFieldInShell");this.oSearchFieldGroup.setModel(this.oModel);this.oSearchInput=this.oSearchFieldGroup.input;this.oSearchInput.setMaxSuggestionWidth("30rem");this.oSearchInput.setValue(this.oModel.getSearchBoxTerm());this.oSearchSelect=this.oSearchFieldGroup.select;this.oLabel=new i("searchShellSelectLabel",{text:u.getText("searchIn")});if(this.oLabel){this.oSearchSelect.addAriaLabelledBy("searchShellSelectLabel")}this.oSearchSelect.setTooltip(u.getText("searchInTooltip"));this.oSearchSelect.addEventDelegate({onAfterRendering:function e(){jQuery('[id$="searchFieldInShell-select-icon"]').attr("title",u.getText("searchIn"))}},this.oSearchSelect);this.oSearchSelect.setTooltip(u.getText("searchIn"));this.oSearchSelect.attachChange(function(){r.searchFieldStateManager.focusInputField({selectContent:true})});this.oSearchButton=this.oSearchFieldGroup.button;this.oSearchButton.attachPress(function(){r.handleClickSearchButton()});this.oSearchCancelButton=this.oSearchFieldGroup.cancelButton;this.oSearchCancelButton.attachPress(function(){r.collapseSearch(true)});this.oSearchFieldGroup.setCancelButtonActive(false);this.oShellHeader=sap.ui.getCore().byId("shell-header");this.oShellHeader.setSearch(this.oSearchFieldGroup);this.searchFieldStateManager=new S({shellHeader:this.oShellHeader,searchInput:this.oSearchInput,model:this.oModel,cancelButton:this.oSearchCancelButton,isNoResultsScreen:this.isNoSearchResultsScreen.bind(this)});jQuery(document).on("keydown",this.fnEscCallBack.bind(this));sap.ui.getCore().getEventBus().subscribe("shell","searchCompLoaded",this.onSearchComponentLoaded.bind(this),{});this.oModel.subscribe(p.ESHSearchFinished,this.onAllSearchFinished.bind(this),{});sap.ui.getCore().byId("viewPortContainer").attachAfterNavigate(this.onAfterNavigate.bind(this),{});sap.ui.getCore().getEventBus().subscribe("sap.ushell","appComponentLoaded",function(){var e;if(r!==null&&r!==void 0&&(e=r.oModel)!==null&&e!==void 0&&e.focusHandler&&a.isSearchAppActive()){r.oModel.focusHandler.setFocus()}});this.oShellHeader.attachSearchSizeChanged(this.sizeSearchFieldChanged.bind(this))}},{key:"fnEscCallBack",value:function e(t){if(t.keyCode!==27){return}if(!this.oSearchInput.getDomRef().contains(document.activeElement)){return}if(a.isSearchAppActive()){return}t.preventDefault();if(this.oSearchInput.getValue()===""){this.collapseSearch(true)}else if(this.oSearchInput.getValue()===" "){this.oSearchInput.setValue("")}}},{key:"injectSearchModel",value:function e(t){this.SearchModel=this.oModel||t}},{key:"sizeSearchFieldChanged",value:function e(t){var a=t.getParameters()["remSize"];var i=24;if(a<=i){this.oSearchSelect.setDisplayMode("icon")}else{this.oSearchSelect.setDisplayMode("default")}i=9;if(a<i){this.oSearchButton.setVisible(false)}else{this.oSearchButton.setVisible(true)}if(t.getParameter("isFullWidth")){this.oSearchFieldGroup.setCancelButtonActive(true);this.oSearchFieldGroup.addStyleClass("sapUshellSearchInputFullWidth")}else{this.oSearchFieldGroup.setCancelButtonActive(false);this.oSearchFieldGroup.removeStyleClass("sapUshellSearchInputFullWidth")}}},{key:"sizeChanged",value:function e(t){switch(t.name){case"Phone":this.oSearchFieldGroup.setCancelButtonActive(true);break;case"Tablet":this.oSearchFieldGroup.setCancelButtonActive(false);break;case"Desktop":this.oSearchFieldGroup.setCancelButtonActive(false);break;default:break}}},{key:"expandSearch",value:function e(t){this.searchFieldStateManager.expandSearch(t)}},{key:"collapseSearch",value:function e(t){this.searchFieldStateManager.collapseSearch(t)}},{key:"isNoSearchResultsScreen",value:function e(){return a.isSearchAppActive()&&this.oModel.getProperty("/boCount")===0&&this.oModel.getProperty("/appCount")===0}},{key:"onShellSearchButtonPressed",value:function t(){e.init();if(!a.isSearchAppActive()&&this.oShellHeader.getSearchState()==="COL"){this.resetModel()}this.expandSearch(true)}},{key:"handleClickSearchButton",value:function e(){if(this.oSearchInput.getValue()===""&&this.oModel.getDataSource()===this.oModel.getDefaultDataSource()){if(d.isSearchFieldExpandedByDefault()){this.searchFieldStateManager.focusInputField()}else{this.collapseSearch(true);window.setTimeout(function(){sap.ui.getCore().byId("sf").focus()},1e3)}}}},{key:"getSearchInput",value:function e(){return this.oSearchFieldGroup?this.oSearchFieldGroup.input:null}},{key:"onAfterNavigate",value:function e(t){if(t.getParameter("toId")!=="shellPage-Action-search"&&t.getParameter("toId")!=="applicationShellPage-Action-search"&&t.getParameter("toId")!=="application-Action-search"){return}this.oModel.focusHandler.setFocus();this.oModel.notifySubscribers(p.ESHSearchLayoutChanged)}},{key:"onAllSearchFinished",value:function e(){this.oSearchInput.setValue(this.oModel.getSearchBoxTerm())}},{key:"onSearchComponentLoaded",value:function e(){if(!a.isSearchAppActive()){return}this.expandSearch()}},{key:"resetModel",value:function e(){this.oSearchInput.setValue("");this.oModel.resetQuery()}},{key:"setSearchState",value:function e(t){switch(t){case"EXP":case"EXP_S":this.searchFieldStateManager.expandSearch();break;case"COL":this.searchFieldStateManager.collapseSearch();break}}},{key:"setSearchStateSync",value:function e(t){this.setSearchState(t)}},{key:"getDefaultOpen",value:function e(){return this.isDefaultOpen}},{key:"setDefaultOpen",value:function e(t){this.isDefaultOpen=t}}]);return e}();return f})})();