/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../i18n","sap/base/Log","sap/m/Button","sap/m/Title","sap/m/List","sap/m/CustomListItem","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/ActionSheet","sap/m/Link","sap/m/Label","sap/m/VBox","sap/m/library","sap/ui/core/Control","./SearchFacetDialog","./SearchGroupHeaderListItem","./SearchFacet","./SearchFacetPieChart","./SearchFacetBarChart","../SearchFacetDialogModel","../sinaNexTS/providers/abap_odata/UserEventLogger"],function(e,t,a,r,n,o,i,s,l,c,d,f,u,v,p,g,h,m,S,b,y){function B(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function x(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=T(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var r=0;var n=function(){};return{s:n,n:function(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,i=false,s;return{s:function(){a=a.call(e)},n:function(){var e=a.next();o=e.done;return e},e:function(e){i=true;s=e},f:function(){try{if(!o&&a.return!=null)a.return()}finally{if(i)throw s}}}}function T(e,t){if(!e)return;if(typeof e==="string")return F(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return F(e,t)}function F(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,r=new Array(t);a<t;a++){r[a]=e[a]}return r}var w=B(e);var C=u["ButtonType"];var I=u["ListSeparators"];var A=u["PlacementType"];var D=B(p);var M=B(g);var U=B(h);var P=B(m);var L=B(S);var j=B(b);var O=y["UserEventType"];var N=v.extend("sap.esh.search.ui.controls.SearchFacetTabBar",{renderer:{apiVersion:2,render:function e(u,v){var p,g;var h=v.getAggregation("items");if(h.length===0){return}var m=function e(t,a){return function(){var e;var r=$(v.getDomRef()).closest(".sapUshellSearchFacetTabBar")[0];var n=sap.ui.getCore().byId($(r).attr("id"));var o=v.getModel();var i=new j({searchModel:o});i.initBusinessObjSearch().then(function(){var r,s,l;i.setData(o.getData());i.config=o.config;i.sinaNext=o.sinaNext;if(n!==null&&n!==void 0&&(r=n.getBindingContext())!==null&&r!==void 0&&r.getObject()["dimension"]){e=n.getBindingContext().getObject()["dimension"]}if(e===((s=o.config)===null||s===void 0?void 0:s.dimensionNameSpace_Description)&&(l=o.config)!==null&&l!==void 0&&l.openSpaceShowMoreDialog){var c;return(c=o.config)===null||c===void 0?void 0:c.openSpaceShowMoreDialog(e,o)}i.prepareFacetList();var d=new D("".concat(o.config.id,"-SearchFacetDialog"),{selectedAttribute:e,selectedTabBarIndex:t,tabBarItems:a});d.setModel(i);d.setModel(o,"searchModel");var f=v.getParent().getParent().getParent().getParent();f.oFacetDialog=d;d.open();o.eventLogger.logEvent({type:O.FACET_SHOW_MORE,referencedAttribute:e})})}};u.openStart("div",v);u.attr("tabindex","0");u.attr("aria-label",w.getText("filterBy"));u["class"]("sapUshellSearchFacetTabBar");u.openEnd();var S=v.getBindingContext().getObject()["dimension"];var b=v.getBindingContext().getObject()["dataType"];var y=v.getBindingContext().getObject()["title"];var B;var T=v.getModel();var F=T.getPersonalizationStorageInstance().getItem("search-facet-panel-chart-state");if(F&&Object.prototype.toString.call(F)==="[object Array]"){var N=x(F),R;try{for(N.s();!(R=N.n()).done;){var _=R.value;if(_.dimension===S){B=_;break}}}catch(e){N.e(e)}finally{N.f()}}var H=[];var E=[];var k=null;var V=0;if(B&&B.buttonIndex){var z=B.buttonIndex;V=parseInt(z,10)}if(b!=T.sinaNext.AttributeType.String){V=0}v.getBindingContext().getObject()["chartIndex"]=V;var W=new a("",{icon:h[V].getIcon(),type:C.Transparent});var G=0;var Z=x(h),q;try{for(Z.s();!(q=Z.n()).done;){var J=q.value;var K=J.getContent()[0];if(K instanceof U||K instanceof P||K instanceof L){k=new a("",{text:J.getText(),icon:J.getIcon(),press:function e(t){v.storeClickedTabInformation(t);v.setProperty("selectedButtonParameters",t.getParameters())}});k.data("facet-view",J.getText(),true);k.data("facet-view-index",""+G,true);k.data("dimension",S,true);H.push(k);E.push(K)}G++}}catch(e){Z.e(e)}finally{Z.f()}var Q=new l("",{showCancelButton:false,buttons:H,placement:A.Bottom,cancelButtonPress:function e(){t.info("sap.m.ActionSheet: cancelButton is pressed")},afterClose:function e(){window.setTimeout(function(){var e=v.getFocusDomRef().getAttribute("data-facet-dimension");var t=$(".sapUshellSearchFacetTabBarButton");for(var a=0;a<t.length;a++){var r=t[a];var n=r.parentNode.parentNode.getAttribute("data-facet-dimension");if(n===e){r.focus();break}}},100);t.info("=====================");t.info("sap.m.ActionSheet: closed")}});Q.data("facet-dimension",S,true);W.addStyleClass("sapUshellSearchFacetTabBarButton");var X=h[V].getText();var Y=w.getText("displayAs",[X]);W.setTooltip(Y);W.attachPress(function(){Q.openBy(W)});W.onAfterRendering=function(){$(W.getDomRef()).attr("aria-label",w.getText("dropDown"))};if(v.getProperty("headerText")){var ee,te;var ae=new n("",{});ae.setShowNoData(false);ae.setShowSeparators(I.None);ae.data("sap-ui-fastnavgroup","false",true);var re=false;var ne=T.getProperty("/uiFilter/rootCondition");if(ne.hasFilters()){re=true;if(T.filterWithoutFilterByConditions()){re=false}if(typeof T.config.hasSpaceFiltersOnly==="function"){if(T.config.hasSpaceFiltersOnly(ne)===true){re=false}}}else{re=false}var oe=new a("",{icon:"sap-icon://clear-filter",tooltip:w.getText("resetFilterButton_tooltip"),type:C.Transparent,enabled:re,press:function e(){T.eventLogger.logEvent({type:O.CLEAR_ALL_FILTERS});T.resetFilterByFilterConditions(true)}});if(T!==null&&T!==void 0&&(ee=T.config)!==null&&ee!==void 0&&ee.searchInAttibuteFacetPostion[S]){oe.addStyleClass("sapUshellSearchFilterByResetButtonHidden")}else{oe.addStyleClass("sapUshellSearchFilterByResetButton")}oe.onAfterRendering=function(){$(v.getDomRef()).attr("aria-label",w.getText("resetFilterButton_tooltip"))};var ie=new r("",{text:v.getProperty("headerText")});var se=new s;var le=new i("",{content:[ie,se,oe]});le.data("sap-ui-fastnavgroup","false",true);ae.setHeaderToolbar(le);if(S===((te=T.config)===null||te===void 0?void 0:te.dimensionNameSpace_Description)){ae.setVisible(false)}else{ae.addStyleClass("sapUshellSearchFilterByHeaderList")}ae.onAfterRendering=function(){$(".sapUshellSearchFilterByHeaderList").find("ul").attr("tabindex","-1");$(".sapUshellSearchFilterByHeaderList").find("div").attr("tabindex","-1")};u.renderControl(ae)}var ce=new o({content:E[V]});ce.setModel(v.getModel(),"facets");ce.addStyleClass("sapUshellSearchFacetList");var de;if(b===T.sinaNext.AttributeType.String){de=new M("",{title:y,button:W})}else{de=new M("",{title:y})}de.data("facet-dimension",S,true);if((p=T.config)!==null&&p!==void 0&&p.searchInAttibuteFacetPostion[S]){var fe;if(S===((fe=T.config)===null||fe===void 0?void 0:fe.dimensionNameSpace_Description)){}else{de.addStyleClass("sapUshellSearchFacetTabBarHeader");de.addStyleClass("sapUshellSearchFacetTabBarHeaderHidden")}}else{de.addStyleClass("sapUshellSearchFacetTabBarHeader")}var ue=w.getText("showMore");if(S===((g=T.config)===null||g===void 0?void 0:g.dimensionNameSpace_Description)){ue=w.getText("showMoreDwcSpace")}var ve=new c("",{text:ue,press:m(V,h).bind(v)});ve.setModel(v.getModel("i18n"));ve.addStyleClass("sapUshellSearchFacetShowMoreLink");var pe=new d("",{text:""});pe.addStyleClass("sapUshellSearchFacetInfoZeile");var ge=new f("",{items:[pe,ve]});var he=new o({content:ge,visible:{parts:[{path:"/uiFilter/dataSource"}],formatter:function e(t){var a=v.getModel();return t.type!==a.sinaNext.DataSourceType.Category}}});he.addStyleClass("sapUshellSearchFacetShowMoreItem");var me=new n("",{showSeparators:I.None,items:[de,ce,he]});me.data("sap-ui-fastnavgroup","false",true);me.setModel(v.getModel());u.renderControl(me);h[V].addContent(E[V]);u.close("div")}},metadata:{properties:{eshRole:"string",headerText:"string",selectedButtonParameters:{type:"object",defaultValue:null}},aggregations:{items:{type:"sap.m.IconTabFilter",multiple:true}}},constructor:function e(t,a){v.prototype.constructor.call(this,t,a)},getSearchFacetTabBarAndDimensionById:function e(t){var a={};a.index=0;var r=document.getElementById(t);var n=r.dataset.facetView;var o=r.dataset.facetViewIndex;var i=$("#"+t).parent()[0];var s=i.dataset.facetDimension;var l=$(".sapUshellSearchFacetTabBar");for(var c=0;c<l.length;c++){var d=$(".sapUshellSearchFacetTabBar .sapUshellSearchFacetTabBarHeader")[c];var f=d.dataset.facetDimension;if(f===s){a.index=c;a.control=sap.ui.getCore().byId(l[c].id);a.view=n;a.buttonIndex=o;a.dimension=s;break}}return a},storeClickedTabInformation:function e(t){var a=t.getSource()["sId"];var r=this.getSearchFacetTabBarAndDimensionById(a);var n=r.control.getModel();var o=n.getPersonalizationStorageInstance().getItem("search-facet-panel-chart-state");var i=r.dimension;var s=r.control;var l=r.view;var c=r.buttonIndex;var d=s.getBindingContext().getObject()["dimension"];var f=t.getParameter("id");var u=[];var v={};v.tabId=a;v.buttonId=f;v.buttonIndex=c;v.dimension=d;v.view=l;u.push(v);if(o&&Object.prototype.toString.call(o)==="[object Array]"){var p=x(o),g;try{for(p.s();!(g=p.n()).done;){var h=g.value;if(h.dimension!==i){u.push(h)}}}catch(e){p.e(e)}finally{p.f()}}n.getPersonalizationStorageInstance().setItem("search-facet-panel-chart-state",u);s.getBindingContext().getObject()["chartIndex"]=c}});return N})})();