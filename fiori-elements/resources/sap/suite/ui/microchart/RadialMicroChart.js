/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["./library","sap/m/library","sap/ui/core/Control","sap/suite/ui/microchart/RadialMicroChartRenderer","sap/ui/core/ResizeHandler","sap/base/Log","sap/ui/events/KeyCodes","sap/suite/ui/microchart/MicroChartUtils","./RadialMicroChartRenderer"],function(e,t,i,s,r,a,o,n,l){"use strict";var p=t.ValueColor;var u=i.extend("sap.suite.ui.microchart.RadialMicroChart",{constructor:function(e,t){var s;if(t&&typeof t.percentage==="number"){s=true}else if(e&&typeof e.percentage==="number"){s=true}else{s=false}try{i.apply(this,arguments);this._bPercentageMode=s}catch(e){this.destroy();throw e}},metadata:{library:"sap.suite.ui.microchart",properties:{total:{group:"Data",type:"float"},fraction:{group:"Data",type:"float",defaultValue:null},percentage:{group:"Data",type:"float",defaultValue:null},valueColor:{group:"Appearance",type:"sap.m.ValueCSSColor",defaultValue:"Neutral"},size:{group:"Misc",type:"sap.m.Size",defaultValue:"Auto"},width:{group:"Misc",type:"sap.ui.core.CSSSize"},height:{group:"Misc",type:"sap.ui.core.CSSSize"},alignContent:{group:"Misc",type:"sap.suite.ui.microchart.HorizontalAlignmentType",defaultValue:"Left"},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{press:{}}},renderer:l});u.THRESHOLD_LOOK_XS=1.125;u.THRESHOLD_LOOK_S=3.5;u.THRESHOLD_LOOK_M=4.5;u.THRESHOLD_LOOK_L=5.875;u.THRESHOLD_WIDTH_NO_LABEL=6;u.prototype.init=function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=true;if(!sap.ui.getCore().isInitialized()){this._bThemeApplied=false;sap.ui.getCore().attachInit(this._handleCoreInitialized.bind(this))}else{this._handleCoreInitialized()}};u.prototype._handleCoreInitialized=function(){this._bThemeApplied=sap.ui.getCore().isThemeApplied();if(!this._bThemeApplied){sap.ui.getCore().attachThemeChanged(this._handleThemeApplied,this)}};u.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();sap.ui.getCore().detachThemeChanged(this._handleThemeApplied,this)};u.prototype.onBeforeRendering=function(){if(!this._getPercentageMode()){if(this.getTotal()===0){a.info("Total cannot be 0. Please add a valid total value.")}else{this.setProperty("percentage",Math.round(this.getFraction()*100/this.getTotal()*10)/10,true)}}this._unbindMouseEnterLeaveHandler()};u.prototype.onAfterRendering=function(){this._bindMouseEnterLeaveHandler();this._sResizeHandlerId=r.register(this,this._onResize.bind(this));this._onResize()};u.prototype.ontouchstart=function(e){if(this.hasListeners("press")===true){e.setMarked()}};u.prototype.ontap=function(e){if(this.hasListeners("press")===true){e.setMarked()}this.firePress()};u.prototype.onkeydown=function(e){if(e.which===o.SPACE){if(this.hasListeners("press")===true){e.setMarked()}e.preventDefault()}};u.prototype.onkeyup=function(e){if(e.which===o.ENTER||e.which===o.SPACE){if(this.hasListeners("press")===true){e.setMarked()}this.firePress();e.preventDefault()}};u.prototype.attachEvent=function(e,t,s,r){i.prototype.attachEvent.call(this,e,t,s,r);if(e==="press"){this.rerender()}return this};u.prototype.detachEvent=function(e,t,s){i.prototype.detachEvent.call(this,e,t,s);if(e==="press"){this.rerender()}return this};u.prototype.exit=function(){this._deregisterResizeHandler()};u.prototype._getPercentageMode=function(){return this._bPercentageMode};u.prototype.setPercentage=function(e){if(typeof e==="number"){var t=Math.floor(e*10)/10;this._bPercentageMode=true;if(t!==this.getPercentage()){this.setProperty("percentage",t)}}else{this._bPercentageMode=false;this.setProperty("percentage",null)}return this};u.prototype._onResize=function(){var e=this.$(),t=e.height(),i=e.width(),s=e.find(".sapSuiteRMCOutsideLabel"),r=e.find(".sapSuiteRMCInsideLabel"),a=e.find(".sapSuiteRMCInnerContainer");e.removeClass("sapSuiteRMCLookL sapSuiteRMCLookM sapSuiteRMCLookS sapSuiteRMCLookXS");s.removeClass("sapSuiteRMCLabelHide");r.removeClass("sapSuiteRMCLabelHide");a.css("width",a.height());if(t<this.convertRemToPixels(u.THRESHOLD_LOOK_S)){e.addClass("sapSuiteRMCLookXS");r.addClass("sapSuiteRMCLabelHide")}else if(t<this.convertRemToPixels(u.THRESHOLD_LOOK_M)||i<this.convertRemToPixels(u.THRESHOLD_LOOK_M)){e.addClass("sapSuiteRMCLookS");s.addClass("sapSuiteRMCLabelHide")}else if(t<this.convertRemToPixels(u.THRESHOLD_LOOK_L)||i<this.convertRemToPixels(u.THRESHOLD_LOOK_L)){e.addClass("sapSuiteRMCLookM");s.addClass("sapSuiteRMCLabelHide")}else{e.addClass("sapSuiteRMCLookL");s.addClass("sapSuiteRMCLabelHide")}if(this._isAnyLabelTruncated(s)){s.addClass("sapSuiteRMCLabelHide")}if(this._isAnyLabelTruncated(r)){r.addClass("sapSuiteRMCLabelHide")}};u.prototype._getAccessibilityControlType=function(){return this._oRb.getText("ACC_CTR_TYPE_RADIALMICROCHART")};u.prototype._isValueColorValid=function(){return p.hasOwnProperty(this.getValueColor())};u.prototype._isTooltipSuppressed=function(){var e=this.getTooltip_Text();if(e&&e.trim().length===0){return true}else{return false}};u.prototype._getAltHeaderText=function(e){var t=this._oRb.getText("RADIALMICROCHART");if(e){t+=" "+this._oRb.getText("IS_ACTIVE")}t+="\n";if(!this._hasData()){t+=this._oRb.getText("NO_DATA");return t}var i=this.getPercentage();if(i>100){i=100}else if(i<0){i=0}if(this._isValueColorValid()){t+=this._oRb.getText("RADIALMICROCHART_ARIA_LABEL",[this.getPercentage(),this._getStatusText()])}else{t+=this._oRb.getText("RADIALMICROCHART_PERCENTAGE_TEXT",i)}return t};u.prototype._getStatusText=function(){var e=this.getValueColor();switch(e){case p.Error:return this._oRb.getText("SEMANTIC_COLOR_ERROR");case p.Critical:return this._oRb.getText("SEMANTIC_COLOR_CRITICAL");case p.Good:return this._oRb.getText("SEMANTIC_COLOR_GOOD");case p.Neutral:return this._oRb.getText("SEMANTIC_COLOR_NEUTRAL");default:return""}};u.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString())}};u.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title")}};u.prototype._bindMouseEnterLeaveHandler=function(){this.$().on("mouseenter.tooltip",this._addTitleAttribute.bind(this));this.$().on("mouseleave.tooltip",this._removeTitleAttribute.bind(this))};u.prototype._unbindMouseEnterLeaveHandler=function(){this.$().off("mouseenter.tooltip");this.$().off("mouseleave.tooltip")};u.prototype._isActuallyANumber=function(e){return!isNaN(e)&&e!==null&&(e!=="Infinity"&&e!=="-Infinity")};u.prototype._hasData=function(){return this._getPercentageMode()||this._isActuallyANumber(this.getTotal())};u.prototype.firePress=function(){if(this._hasData()){i.prototype.fireEvent.call(this,"press",arguments)}};u.prototype._deregisterResizeHandler=function(){if(this._sResizeHandlerId){r.deregister(this._sResizeHandlerId);this._sResizeHandlerId=null}};n.extendMicroChart(u);return u});