/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define("sap/suite/ui/commons/TimelineRenderManager",["sap/ui/thirdparty/jquery","./library","sap/m/Text","sap/ui/core/Icon","sap/m/ViewSettingsDialog","sap/ui/core/ResizeHandler","sap/ui/core/Item","sap/m/ToolbarSpacer","sap/m/SearchField","sap/m/OverflowToolbar","sap/m/Select","sap/m/RangeSlider","sap/m/Label","sap/m/Panel","sap/m/FlexBox","sap/m/OverflowToolbarButton","sap/m/MessageStrip","sap/m/ViewSettingsFilterItem","sap/m/ViewSettingsCustomItem","sap/m/OverflowToolbarLayoutData","sap/m/library","sap/m/MessageToast","sap/ui/core/InvisibleText","sap/m/SliderTooltip","sap/suite/ui/commons/TimelineRenderManagerTimestamp","sap/suite/ui/commons/util/StringSliderTooltip","sap/m/ResponsiveScale","sap/ui/core/library"],function(e,t,i,s,r,n,o,a,l,m,p,c,g,u,f,h,d,_,S,T,C,b,I,v,y,U,D,x){"use strict";var F=x.CSSSize;var L=C.ButtonType;var R=C.OverflowToolbarPriority;var w=t.TimelineGroupType;var E=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var M=680;var P=Object.freeze({UP:"UP",DOWN:"DOWN",NONE:"NONE"});function H(e,t,i){e.removeClass(t).addClass(i)}function j(e,t){return parseInt(e.css(t).replace("px",""),10)}var V={extendTimeline:function(t){t.prototype._initControls=function(){this._setupMessageStrip();this._setupFilterDialog();this._setupHeaderToolbar();this._setupAccessibilityItems()};t.prototype._registerResizeListener=function(){var t=this.$().parent().get(0);if(t){this.oResizeListener=n.register(t,e.proxy(this._performResizeChanges,this))}};t.prototype._deregisterResizeListener=function(){if(this.oResizeListener){n.deregister(this.oResizeListener)}};t.prototype._performUiChanges=function(e){this._deregisterResizeListener();if(!this.getDomRef()){return}if(this._isVertical()){this._performUiChangesV(e)}else{this._performUiChangesH()}this._setupScrollers();this._startItemNavigation();this._registerResizeListener()};t.prototype._performDoubleSidedChangesLi=function(e,t){var i=e.children().first(),s=this._isLeftAlignment()?"sapSuiteUiCommonsTimelineItemWrapperVLeft":"sapSuiteUiCommonsTimelineItemWrapperVRight";if(this._renderDblSided){if(e.hasClass("sapSuiteUiCommonsTimelineItem")){e.removeClass("sapSuiteUiCommonsTimelineItem").addClass(t?"sapSuiteUiCommonsTimelineItemOdd":"sapSuiteUiCommonsTimelineItemEven");if(!t){H(i,"sapSuiteUiCommonsTimelineItemWrapperVLeft","sapSuiteUiCommonsTimelineItemWrapperVRight")}else{H(i,"sapSuiteUiCommonsTimelineItemWrapperVRight","sapSuiteUiCommonsTimelineItemWrapperVLeft")}}}else{e.removeClass("sapSuiteUiCommonsTimelineItemOdd").removeClass("sapSuiteUiCommonsTimelineItemEven").addClass("sapSuiteUiCommonsTimelineItem");i.removeClass("sapSuiteUiCommonsTimelineItemWrapperVLeft").removeClass("sapSuiteUiCommonsTimelineItemWrapperVRight").addClass(s)}};t.prototype._performDoubleSidedChanges=function(){var t=this.$(),i=t.find(".sapSuiteUiCommonsTimelineItemUlWrapper").not(".sapSuiteUiCommonsTimelineShowMoreWrapper"),s=t.find(".sapSuiteUiCommonsTimelineScrollV .sapSuiteUiCommonsTimelineGroupHeader"),r;if(this._renderDblSided){this._$content.addClass("sapSuiteUiCommonsTimelineDblSided");s.addClass("sapSuiteUiCommonsTimelineGroupHeaderDblSided");s.addClass("sapSuiteUiCommonsTimelineItemWrapperVLeft").removeClass("sapSuiteUiCommonsTimelineItemWrapperVRight")}else{this._$content.removeClass("sapSuiteUiCommonsTimelineDblSided");s.removeClass("sapSuiteUiCommonsTimelineGroupHeaderDblSided sapSuiteUiCommonsTimelineItemWrapperVLeft");s.addClass(this._isLeftAlignment()?"sapSuiteUiCommonsTimelineItemWrapperVLeft":"sapSuiteUiCommonsTimelineItemWrapperVRight")}for(var n=0;n<i.length;n++){var o=e(i[n]),a=o.find("> li").not(".sapSuiteUiCommonsTimelineGroupHeader");a.eq(1).css("margin-top",this._renderDblSided?"40px":"auto");for(var l=0;l<a.length;l++){r=e(a[l]);this._performDoubleSidedChangesLi(r,l%2===0)}}t.find(".sapSuiteUiCommonsTimelineItemBarV").css("height","");t.find(".sapSuiteUiCommonsTimelineItem").css("margin-bottom","")};t.prototype._performUiChangesH=function(){var t=this.$(),i,s;var r=function(e){return t.width()-(e.position().left+e.outerWidth())};if(this.getEnableDoubleSided()&&this._isGrouped()){s=t.find(".sapSuiteUiCommonsTimelineHorizontalBottomLine ul");t.find("[firstgroupevenitem = true]:visible").each(function(t,n){var o=function(e){return e+"-"+(this._bRtlMode?"right":"left")}.bind(this),a=e("#"+n.id+"-line"),l=this._bRtlMode?r(a):a.position().left,m=30,p=e(n),c=j(s,o("padding")),g,u;if(t===0){g=l-m-c}else{i=p.prevAll(".sapSuiteUiCommonsTimelineItemLiWrapperV:visible:first");u=this._bRtlMode?r(i):i.position().left+j(i,o("margin"));g=l-m-(u+i.outerWidth())}p.css(o("margin"),g+"px")}.bind(this))}if(!this.getEnableScroll()){t.find(".sapSuiteUiCommonsTimelineContentsH").css("overflow-x","hidden")}this._calculateTextHeight()};t.prototype._performUiChangesV=function(e){var t=this.$(),i=t.outerWidth()+50;if(this.getEnableDoubleSided()){this._renderDblSided=i>=M;if(this._renderDblSided!==this._lastStateDblSided||e){this._performDoubleSidedChanges()}this._lastStateDblSided=this._renderDblSided}this._calculateTextHeight();this._calculateHeightV()};t.prototype._calculateHeightV=function(){var t=this.$(),i=this.$("headerBar").outerHeight()||0,s=this.$("filterMessage").outerHeight()||0,r=this.$("messageStrip").outerHeight()||0,n=r+s+i,o=function(t,i){var s,r,n,o,a,l,m,p=t.length,c=this.getShowIcons()?".sapSuiteUiCommonsTimelineItemBarIconWrapperV:visible":".sapSuiteUiCommonsTimelineItemNoIcon:visible",g=i.length>0?i.find(c+", .sapSuiteUiCommonsTimelineItemBarIconWrapperV:visible").eq(0):e(),u=8;for(var f=0;f<p;f++){s=e(t[f+1]);r=e(t[f]);n=f<p-1?s.find(c):g;a=r.find(c);if(n.length>0&&a.length>0){l=n.offset().top;m=a.offset().top+a.height();o=r.find(".sapSuiteUiCommonsTimelineItemBarV");u=8;o.height(l-m-u)}}},a=function(t){var i,s,r,n,o,a=40,l=100,m=function(){var e=j(r,"margin-top")+r.position().top+r.height()-i.position().top;s.css("margin-bottom",e+a+"px")};for(var p=2;p<t.length;p++){i=e(t[p]);s=e(t[p-1]);r=e(t[p-2]);n=this._bRtlMode?!i.hasClass("sapSuiteUiCommonsTimelineItemOdd"):i.hasClass("sapSuiteUiCommonsTimelineItemOdd");o=i.position().left;if(!n&&o<l||n&&o>l){m()}else{var c=i.position().top-s.position().top,g=j(r,"margin-bottom");if(c<a){r.css("margin-bottom",g+a-c+"px")}}}},l=function(){var e=5,i=t.position().top,s=t.parent().height(),r=j(this._$content,"padding-bottom"),o=j(this._$content,"padding-top"),a=s-i-n-o-r-e;this._$content.height(a)}.bind(this),m,p,c,g;if(this.getEnableScroll()){l()}if(this._renderDblSided){m=t.find(".sapSuiteUiCommonsTimelineItemUlWrapper");for(var u=0;u<m.length;u++){p=e(m[u]);c=e(m[u+1]);g=p.find(" > li:not(.sapSuiteUiCommonsTimelineGroupHeader):visible");g.css("margin-bottom","");a.call(this,g,p);o.call(this,g,c)}}};t.prototype._performResizeChanges=function(){this._performUiChanges()};t.prototype._calculateTextHeight=function(){var t=this.$(),i=this.getTextHeight(),s,r,n=function(i,s){t.find(".sapSuiteUiCommonsTimelineItemTextWrapper:visible").each(function(t,r){var n=e(r),o=n.children().first(),a=o.get(0).getClientRects(),l=0,m=0,p,c=-1e5,g=0,u=E.getText("TIMELINE_TEXT_SHOW_MORE"),f=n.attr("expanded");f=f=="true";n.height("auto");n.css("-webkit-line-clamp","");if(a&&a.length>0){p=a[0].top;g=0;for(var h=0;h<a.length-1;h++){if(c!==a[h].bottom){c=a[h].bottom;g++}if(i>0&&a[h+1].bottom-p>i){m=g;l=a[h].bottom-p;break}if(s>0&&g===s){l=a[h].bottom-a[0].top;m=s;break}}}if(!f){if(l>0){n.height(l);n.css("-webkit-line-clamp",m.toString());n.next().show()}else if(!n.attr("expandable")){n.next().hide()}}else{for(var d=h;d<a.length-1;d++){if(c!==a[d].bottom){c=a[d].bottom;g++}}if(s>0&&g<=s){n.attr("expanded",false);n.next().children()[0].text=u;n.next().hide()}}})},o=function(e){n(0,parseInt(e,10))},a=function(e){n(e,0)},l=function(){var i=t.find(".sapSuiteUiCommonsTimelineItemTextWrapper");i.css("height","");i.css("-webkit-line-clamp","");t.css("height","100%");var s=this._$content.height(),r=j(this._$content,"padding-bottom"),n=this._$content.get(0).scrollHeight,o=n-s-r,a={height:0},l,m=20;t.find(".sapSuiteUiCommonsTimelineItemTextWrapper").each(function(t,i){var s=e(i).height();if(s>a.height){a.height=s;a.item=e(this)}});if(a.item){l=a.item.parent().find(".sapSuiteUiCommonsTimelineItemShowMore:hidden").height();return a.height-o-l-m}return 1};if(i){if(this._useAutomaticHeight()){a(l.call(this))}else if(e.isNumeric(i)){o(i)}else{s=/([0-9]*\.?[0-9]+)(px)+/i;r=s.exec(i);if(r&&r.length>1){a(r[1])}else if(F.isValid(i)){t.find(".sapSuiteUiCommonsTimelineItemTextWrapper").height(i)}}}};t.prototype._fixScrollerPositionH=function(){var e=this.$(),t=e.find(".sapSuiteUiCommonsTimelineHorizontalMiddleLine"),i=e.find(".sapSuiteUiCommonsTimelineHorizontalScroller"),s,r=this._$content.position().top;if(t.get(0)){s=t.position().top;e.find(".sapSuiteUiCommonsTimelineScrollerIconWrapper").css("top",s-5+"px");i.css("top",r+"px");i.height(this._$content.outerHeight()-15)}};t.prototype._setupScrollers=function(){var t=this.$(),i=450,s="rgba(0, 0, 0, 0)",r,n,o,a,l,m,p,c,g,u,f,h,d,_=function(t){var i=s;t.parents().each(function(t,r){var n=e(r).css("background-color"),o=e(r).css("background-image");if(o!=="none"){i=s;return}if(n!==s&&n!=="transparent"){i=n}});return i};if(this._scrollingFadeout()){r=this._isVertical()?t.height():t.width();if(r<i){t.find(".sapSuiteUiCommonsTimelineVerticalScroller",".sapSuiteUiCommonsTimelineHorizontalScroller").hide();this._scrollersSet=false;return}if(!this._scrollersSet){n=_(this.$());if(n&&n!==s){o=n.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);if(o&&o.length>=4){a=parseInt(o[1],10);l=parseInt(o[2],10);m=parseInt(o[3],10);p="rgba("+a+","+l+","+m+", 0)";g="rgba("+a+","+l+","+m+", 0.7)";c="rgba("+a+","+l+","+m+", 1)";u=t.find(".sapSuiteUiCommonsTimelineHorizontalLeftScroller, .sapSuiteUiCommonsTimelineTopScroller ");f=t.find(".sapSuiteUiCommonsTimelineHorizontalRightScroller, .sapSuiteUiCommonsTimelineBottomScroller");h=this._isVertical()?"top":"left";d=this._isVertical()?"bottom":"right";u.css("background-image","linear-gradient(to "+h+", "+p+", "+c+")");f.css("background-image","linear-gradient(to "+d+", "+p+", "+c+")");u.css("background-image","-webkit-linear-gradient("+d+", "+p+", "+g+" 30%,"+c+")");f.css("background-image","-webkit-linear-gradient("+h+", "+p+", "+g+" 30%,"+c+")");this._scrollersSet=true;if(this.getContent().length>0){if(!this._isVertical()&&this._$content.get(0).scrollWidth>this._$content.outerWidth()||this._isVertical()&&this._$content.get(0).scrollHeight>this._$content.outerHeight()){f.show()}}}}else{t.find(".sapSuiteUiCommonsTimelineHorizontalScroller").hide()}}if(!this._isVertical()){this._fixScrollerPositionH()}}};t.prototype._setupScrollEvent=function(){var t=this.$(),i=t.find(".sapSuiteUiCommonsTimelineHorizontalLeftScroller .sapSuiteUiCommonsTimelineScrollerIconWrapper, .sapSuiteUiCommonsTimelineTopScroller .sapSuiteUiCommonsTimelineScrollerIconWrapper"),s=t.find(".sapSuiteUiCommonsTimelineHorizontalRightScroller .sapSuiteUiCommonsTimelineScrollerIconWrapper, .sapSuiteUiCommonsTimelineBottomScroller .sapSuiteUiCommonsTimelineScrollerIconWrapper"),r=t.find(".sapSuiteUiCommonsTimelineHorizontalLeftScroller, .sapSuiteUiCommonsTimelineTopScroller"),n=t.find(".sapSuiteUiCommonsTimelineHorizontalRightScroller, .sapSuiteUiCommonsTimelineBottomScroller"),o=this._$content,a=this;if(a._lazyLoading()||a._scrollingFadeout()){o.on("scroll",function(t){var o=e(t.currentTarget),l=o.get(0).scrollLeft,m=o.get(0).scrollTop,p=false,c=200,g=5,u=false,f,h,d,_,S;if(a._isVertical()){f=o.outerHeight();h=o.get(0).scrollHeight;u=m+f>h-c;p=m+f>=h-g}else{d=o.width();_=o.get(0).scrollWidth;u=l+d>_-c;p=l+d>=_-g-185}if(a._lazyLoading()&&a._scrollMoreEvent){if(u&&!a._isMaxed()){a._scrollMoreEvent=false;a._loadMore()}}if(a._scrollersSet){if(l>50||m>50){r.show()}else{r.hide();a._manualScrolling=false}if(p){n.hide()}else{n.show()}var T;if(a._isVertical()){T=o.get(0).scrollTop;S=T>a._lastScrollPosition.y?s:i;a._lastScrollPosition.y=T}else{T=o.get(0).scrollLeft;S=T>a._lastScrollPosition.x?s:i;a._lastScrollPosition.x=T}S.addClass("sapSuiteUiCommonsTimelineScrolling");clearTimeout(e.data(this,"scrollTimer"));e.data(this,"scrollTimer",setTimeout(function(){i.removeClass("sapSuiteUiCommonsTimelineScrolling");s.removeClass("sapSuiteUiCommonsTimelineScrolling")},350))}});this.$().find(".sapSuiteUiCommonsTimelineScrollerIconWrapper").on("mousedown",function(t){var i=90,s=e(this).hasClass("sapSuiteUiCommonsTimelineScrollerIconWrapperLeft")||e(this).hasClass("sapSuiteUiCommonsTimelineScrollerIconWrapperTop")?-i:i;a._manualScrolling=true;a._performScroll(s)});this.$().find(".sapSuiteUiCommonsTimelineScrollerIconWrapper").on("mouseup",function(){a._manualScrolling=false}).on("mouseout",function(){a._manualScrolling=false})}if(this.getEnableScroll()&&!a._isVertical()){this._$content.on("wheel",function(e){if(e.originalEvent.deltaX){return}var t=e.originalEvent.deltaY,i=30;if(t<i&&t>i*-1){t=t>0?i:i*-1}this.scrollLeft+=t*2});t.find(".sapSuiteUiCommonsTimelineHorizontalScroller, .sapSuiteUiCommonsTimelineVerticalScroller").on("wheel",function(e){var t=e.originalEvent.deltaY;if(a._isVertical()){a._$content.get(0).scrollTop+=t*2}else{a._$content.get(0).scrollLeft+=t*2}})}};t.prototype._setupMessageStrip=function(){var e=this;this._objects.register("messageStrip",function(){return new d(e.getId()+"-messageStrip",{close:function(){e.setCustomMessage("");e.fireCustomMessageClosed()},showCloseButton:true})});this._objects.register("filterMessageText",function(){return new i(e.getId()+"-filterMessageText",{})});this._objects.register("filterMessage",function(){var t=e._objects.getFilterMessageText(),i,r;r=new s(e.getId()+"filterMessageIcon",{src:"sap-icon://decline",press:[e._clearFilter,e]});r.setTooltip(E.getText("TIMELINE_CLEAR_ICN_TOOLTIP"));i=new m(e.getId()+"-filterMessage",{design:"Info",content:[t,new a,r]});i.addStyleClass("sapSuiteUiCommonsTimelineFilterInfoBar");i.setHeight("auto");return i})};t.prototype._setMessageBars=function(e){var t=this._getFilterMessage();if(t){e.addChild(this._objects.getFilterMessage());this._objects.getFilterMessageText().setText(t)}};t.prototype._setupRangeFilterPage=function(){var e=this;this._rangeFilterType=null;this._objects.register("timestampFilterPicker",function(){return new y(e.getId(),{dateChanged:function(t){var i=t.getSource(),s=i.getStartDate()||e._minDate,r=i.getEndDate()||e._maxDate;e._filterDialogRangePage.setFilterCount(+(s!==e._minDate||r!==e._maxDate))}},undefined,E,e._objects)});this._objects.register("timeFilterSelect",function(){var t=new p(e.getId()+"-timeFilterSelect",{ariaLabelledBy:e._objects.getRangeTypeLbl().getId(),change:function(t){e._rangeFilterType=t.getParameter("selectedItem").getProperty("key");e.toggleGroupTypeSelector(e._rangeFilterType);e._setRangeFilter();var i=e._objects.getFilterContent()._getDialog();var s=i.getBeginButton();s.setEnabled(true);if(e._objects.getTimeFilterSelect().getSelectedItem().getText()===E.getText("TIMELINE_CUSTOM_RANGE")){e._objects.getTimestampFilterPicker()._checkDatePickerStatus()}},items:[new o({text:E.getText("TIMELINE_YEAR"),key:w.Year}),new o({text:E.getText("TIMELINE_QUARTER"),key:w.Quarter}),new o({text:E.getText("TIMELINE_MONTH"),key:w.Month}),new o({text:E.getText("TIMELINE_DAY"),key:w.Day}),new o({text:E.getText("TIMELINE_CUSTOM_RANGE"),key:w.None})]});t.addStyleClass("sapSuiteUiCommonsTimelineRangeSelect");return t});this._objects.register("timeRangeSlider",function(){var t=function(t){if(typeof t==="string"){t=Number(t)}var i=e._fnAddDate(t);return e._formatGroupBy(i,e._rangeFilterType).title};var i=new D;i.getLabel=t;var s=new c(e.getId()+"-timeRangeSlider",{enableTickmarks:true,visible:false,showAdvancedTooltip:true,step:1,change:function(t){var i=s.getMin(),r=s.getMax(),n=s.getRange();e._filterDialogRangePage.setFilterCount(+(n[0]!==i||n[1]!==r))},customTooltips:[new U({mapFunction:t}),new U({mapFunction:t,fetchValue2:true})],scale:i});s.addStyleClass("sapSuiteUiCommonsTimelineRangeFilter");return s});this._objects.register("rangeTypeLbl",function(){return new g(e.getId()+"-rangeTypeLbl",{text:E.getText("TIMELINE_GROUP_BY_PERIOD")+":"})});this._objects.register("rangeTypePanel",function(){var t=new u(e.getId()+"-rangeTypePanel",{content:[e._objects.getRangeTypeLbl(),e._objects.getTimeFilterSelect()]});t.addStyleClass("sapSuiteUiCommonsTimelineRangeFilterPanel");t.addStyleClass("sapSuiteUiCommonsTimelineRangeFilterPanelShadowed");return t});this._objects.register("rangePanel",function(){return new f(e.getId()+"rangePanel",{direction:"Column",items:[e._objects.getRangeTypePanel(),e._objects.getTimeRangeSlider(),e._objects.getTimestampFilterPicker().getTimestampPanelRadio(),e._objects.getTimestampFilterPicker().getTimestampPanelPicker()]})})};t.prototype._setupFilterFirstPage=function(e){if(e){e.removeAllAggregation("filterItems");if(this.getShowItemFilter()){e.addAggregation("filterItems",new _({key:"items",text:this._getFilterTitle()}))}if(this.getShowTimeFilter()){this._filterDialogRangePage=new S({key:"range",text:E.getText("TIMELINE_RANGE_SELECTION"),customControl:[this._objects.getRangePanel()]});e.addAggregation("filterItems",this._filterDialogRangePage)}}};t.prototype._setupFilterDialog=function(){var t=this;this._setupRangeFilterPage();this._objects.register("filterContent",function(){var i,s,n=function(i){if(!t._filterState.data){t._setFilterList();i.removeAllItems();t._aFilterList.forEach(function(s){var r=e.grep(t._currentFilterKeys,function(e){return s.key===e.key}).length>0;i.addItem(new _({key:s.key,text:s.text,selected:r}))})}t._filterState.data=true},o=function(){b.show(E.getText("TIMELINE_NO_LIMIT_DATA"))},a=function(){if(!t._filterState.range){l.setBusy(true);t._getTimeFilterData().then(function(){l.setBusy(false);if(!t._minDate||!t._maxDate||(!(t._minDate instanceof Date)||!(t._maxDate instanceof Date))){o();return}if(!t._rangeFilterType){t._rangeFilterType=t._calculateRangeTypeFilter()}if(!t._startDate&&!t._endDate){t._setRangeFilter()}else{var e=t._objects.getTimeRangeSlider(),r=t._fnDateDiff(t._rangeFilterType),n=e.getMin(),a=e.getMax();if(a-n!==r){t._setRangeFilter()}i=t._fnDateDiff(t._rangeFilterType,t._minDate,t._startDate);s=t._fnDateDiff(t._rangeFilterType,t._minDate,t._endDate);e.setRange([i,s])}t.toggleGroupTypeSelector(t._rangeFilterType);t._objects.getTimeFilterSelect().setSelectedKey(t._rangeFilterType)}).catch(function(){l.setBusy(false);o()});t._filterState.range=true}},l=new r(t.getId()+"-filterContent",{confirm:function(e){var i=e.getParameter("filterItems"),s,r,n,o,a;t._currentFilterKeys=i.map(function(e){return{key:e.getProperty("key"),text:e.getProperty("text")}});t._startDate=null;t._endDate=null;if(t._objects.getTimestampFilterPicker().getVisible()){var l=t._objects.getTimestampFilterPicker().getStartDate()||t._minDate,m=t._objects.getTimestampFilterPicker().getEndDate()||t._maxDate;if(l!==t._minDate||m!==t._maxDate){t._startDate=l;t._endDate=m;a=true}}else{s=t._objects.getTimeRangeSlider();o=s.getRange();r=s.getMin();n=s.getMax();if(o[0]!==r||o[1]!==n){t._startDate=t._fnAddDate(Math.min.apply(null,o),P.DOWN);t._endDate=t._fnAddDate(Math.max.apply(null,o),P.UP);a=true}}t._filterData(a)},resetFilters:function(e){var i=t._objects.getTimeRangeSlider();i.setValue(i.getMin());i.setValue2(i.getMax());t._filterDialogRangePage.setFilterCount(0);t._objects.getTimestampFilterPicker().clearDates()},filterDetailPageOpened:function(e){var t=e.getParameter("parentFilterItem").getProperty("key");if(t==="items"){n(e.getParameter("parentFilterItem"))}if(t==="range"){a()}}});t._setupFilterFirstPage(l);return l})};t.prototype._setupHeaderToolbar=function(){var e=this,t=function(t){e._objects.register(t.name,function(){var i=new h(e.getId()+"-"+t.name,{type:L.Transparent,icon:t.icon,tooltip:t.tooltip,press:t.fnPress});i.setLayoutData(new T({priority:t.priority}));return i})};t({name:"filterIcon",icon:"sap-icon://add-filter",tooltip:E.getText("TIMELINE_FILTER_BY"),fnPress:[e._openFilterDialog,e],priority:R.NeverOverflow,visible:e.getShowItemFilter()||e.getShowTimeFilter()});t({name:"sortIcon",icon:"sap-icon://arrow-bottom",tooltip:E.getText("TIMELINE_SORT"),fnPress:[e._sortClick,e],priority:R.High,visible:e.getSort()&&e.getShowSort()});var i=new a;this._objects.register("searchFieldLabel",function(){return new I(e.getId()+"-searchFieldLabel",{text:E.getText("TIMELINE_ACCESSIBILITY_SEARCH")})});this._objects.register("searchField",function(){var t=new l(e.getId()+"-searchField",{width:"14rem",ariaLabelledBy:e._objects.getSearchFieldLabel().getId(),search:function(t){e._search(t.getSource().getValue())},visible:e.getShowSearch()});t.setLayoutData(new T({priority:R.Low}));return t});this._objects.register("headerBar",function(){var t=[i,e._objects.getSearchFieldLabel(),e._objects.getSearchField(),e._objects.getSortIcon(),e._objects.getFilterIcon()];var s=new m(e.getId()+"-headerBar",{content:t,visible:e.getShowHeaderBar()});s.addStyleClass("sapSuiteUiCommonsTimelineHeaderBar");s.setParent(e);return s})};t.prototype._setupAccessibilityItems=function(){var e=this;this._objects.register("accessibilityTitle",function(){return new I(e.getId()+"-accessibilityTitle",{text:E.getText("TIMELINE_ACCESSIBILITY_TITLE")})})};t.prototype.toggleGroupTypeSelector=function(e){var t=e!==w.None;this._objects.getTimestampFilterPicker().setVisible(!t);this._objects.getTimeRangeSlider().setVisible(t)}}};return V},true);