/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/m/library","sap/ui/core/Control","sap/suite/ui/commons/ProcessFlowConnection","sap/suite/ui/commons/ProcessFlowLaneHeader","sap/ui/Device","sap/ui/core/ResizeHandler","sap/base/Log","sap/ui/events/KeyCodes","./ProcessFlowRenderer"],function(e,t,i,o,s,a,n,r,l,c,h){"use strict";var u=o.extend("sap.suite.ui.commons.ProcessFlow",{metadata:{library:"sap.suite.ui.commons",properties:{foldedCorners:{type:"boolean",group:"Misc",defaultValue:false},scrollable:{type:"boolean",group:"Misc",defaultValue:true},wheelZoomable:{type:"boolean",group:"Behavior",defaultValue:true},showLabels:{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"lanes",aggregations:{_connections:{type:"sap.suite.ui.commons.ProcessFlowConnection",multiple:true,singularName:"_connection",visibility:"hidden"},nodes:{type:"sap.suite.ui.commons.ProcessFlowNode",multiple:true,singularName:"node"},lanes:{type:"sap.suite.ui.commons.ProcessFlowLaneHeader",multiple:true,singularName:"lane"},ariaProperties:{type:"sap.suite.ui.commons.AriaProperties",multiple:false,group:"Misc"}},events:{nodeTitlePress:{deprecated:true,parameters:{oEvent:{type:"object"}}},nodePress:{parameters:{oEvent:{type:"object"}}},labelPress:{parameters:{oEvent:{type:"object"}}},headerPress:{parameters:{oEvent:{type:"object"}}},onError:{parameters:{oEvent:{type:"object"}}}},dnd:{draggable:false,droppable:true}}});u.prototype._resBundle=null;u._cellEdgeConstants={LU:"tl",LD:"lb",DU:"tb",LR:"rl",DR:"rt",UR:"rb"};u._constants={scrollContainer:"scrollContainer",counterLeft:"counterLeft",counterRight:"counterRight",arrowScrollRight:"arrowScrollRight",arrowScrollRightMinus:"-arrowScrollRight",arrowScrollLeft:"arrowScrollLeft",arrowScrollLeftMinus:"-arrowScrollLeft",top:"top",px:"px",parents:"parents",left:"left",right:"right"};u._mouseEvents={mouseMove:"mousemove",mouseDown:"mousedown",mouseUp:"mouseup",mouseLeave:"mouseleave",mouseEnter:"mouseenter",touchStart:"touchstart",sapTouchStart:"saptouchstart",touchEnd:"touchend",sapTouchCancel:"saptouchcancel"};u._enumMoveDirection={LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down"};u.prototype._zoomLevel=t.ProcessFlowZoomLevel.Two;u.prototype._wheelTimeout=null;u.prototype._isFocusChanged=false;u.prototype._wheelTimestamp=null;u.prototype._wheelCalled=false;u.prototype._internalCalcMatrix=false;u.prototype._internalConnectionMap=null;u.prototype._internalLanes=false;u.prototype._jumpOverElements=5;u.prototype._lastNavigationFocusElement=null;u.prototype._bHighlightedMode=false;u.prototype._isLayoutOptimized=false;u.prototype._defaultCursorClass="sapSuiteUiDefaultCursorPF";if(n.browser.edge){u.prototype._grabCursorClass="sapSuiteUiGrabCursorIEPF";u.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorIEPF"}else{u.prototype._grabCursorClass="sapSuiteUiGrabCursorPF";u.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorPF"}u.prototype._mousePreventEvents="contextmenu dblclick";u.prototype._mouseEvents="contextmenu mousemove mouseleave mousedown mouseup mouseenter";u.prototype._mouseWheelEvent=n.browser.mozilla?"DOMMouseScroll MozMousePixelScroll":"mousewheel wheel";u.prototype._headerHasFocus=false;u.prototype._isInitialZoomLevelNeeded=true;u.prototype._bDoScroll=!n.system.desktop||n.os.windows&&n.os.version>=8;u.prototype._scrollStep=192;u.prototype._bPreviousScrollForward=false;u.prototype._bPreviousScrollBack=false;u.prototype._iInitialArrowTop=undefined;u.prototype._iInitialCounterTop=undefined;u.prototype._bRtl=false;u.prototype._arrowScrollable=null;u.prototype._iTouchStartScrollTop=undefined;u.prototype._iTouchStartScrollLeft=undefined;u.prototype._bSetFocusOnce=true;u.prototype.init=function(){this._bRtl=sap.ui.getCore().getConfiguration().getRTL();if(!this._resBundle){this._resBundle=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons")}this._internalLanes=[];if(this._getScrollContainer()){this._getScrollContainer().on("keydown",e.proxy(this.onkeydown,this))}};u.prototype.exit=function(){var t=this.getNodes(),i;if(t){for(i=0;i<t.length;i++){if(t[i]){t[i].destroy()}}t=null}if(this._internalLanes){for(i=0;i<this._internalLanes.length;i++){this._internalLanes[i].destroy()}this._internalLanes=null}var o=this.getAggregation("_connections");if(o){for(i=0;i<o.length;i++){o[i].destroy()}o=null}if(this._oArrowLeft){this._oArrowLeft.destroy()}if(this._oArrowRight){this._oArrowRight.destroy()}if(this._resizeRegId){r.deregister(this._resizeRegId)}if(this._internalCalcMatrix){delete this._internalCalcMatrix;this._internalCalcMatrix=null}if(this._getScrollContainer()){this._getScrollContainer().off(this._mousePreventEvents,this._handlePrevent);this._getScrollContainer().off(this._mouseEvents,e.proxy(this._registerMouseEvents,this));this._getScrollContainer().off(this._mouseWheelEvent,e.proxy(this._registerMouseWheel,this));this._getScrollContainer().off("keydown",e.proxy(this.onkeydown,this));this._getScrollContainer().off("scroll",e.proxy(this._onScroll,this))}};u.prototype.onBeforeRendering=function(){if(this._getScrollContainer()){this._getScrollContainer().off(this._mousePreventEvents,this._handlePrevent);this._getScrollContainer().off(this._mouseEvents,e.proxy(this._registerMouseEvents,this));this._getScrollContainer().off(this._mouseWheelEvent,e.proxy(this._registerMouseWheel,this));this._getScrollContainer().off("keydown",e.proxy(this.onkeydown,this));this._getScrollContainer().off("scroll",e.proxy(this._onScroll,this))}};u.prototype.onAfterRendering=function(){var t=false,i=this.$("scroll-content"),o,s,a,l;this._checkOverflow(this._getScrollContainer().get(0),this.$());this.iCursorPositionX=0;this.iCursorPositionY=0;if(i&&i.length){this._getScrollContainer().find(".sapSuiteUiCommonsProcessFlowNode .sapUiIcon").css("cursor","inherit");if(this.getScrollable()){o=parseInt(this._getScrollContainer().css("height").slice(0,-2),10);s=parseInt(this._getScrollContainer().css("width").slice(0,-2),10);l=i[0].scrollHeight;a=i[0].scrollWidth;if(l<=o&&a<=s){this._clearHandlers(this._getScrollContainer());this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass)}else{this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass);t=true}}else{this._clearHandlers(this._getScrollContainer());this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass);i.css("position","static")}if(t){if(!this._iInitialArrowTop||!this._iInitialCounterTop){this._iInitialArrowTop=parseInt(this.$(u._constants.arrowScrollRight).css(u._constants.top),10);this._iInitialCounterTop=parseInt(this.$(u._constants.counterRight).css(u._constants.top),10)}if(n.os.windows&&n.system.combi&&n.browser.chrome){this._getScrollContainer().bind(this._mouseEvents,e.proxy(this._registerMouseEvents,this));this._getScrollContainer().css("overflow","auto")}else if(n.os.windows&&n.browser.edge){this._getScrollContainer().bind(this._mouseEvents,e.proxy(this._registerMouseEvents,this));this._getScrollContainer().css("overflow","auto");this._getScrollContainer().css("-ms-overflow-style","none")}else if(!n.support.touch){this._getScrollContainer().bind(this._mouseEvents,e.proxy(this._registerMouseEvents,this))}else{this._clearHandlers(this._getScrollContainer());this._getScrollContainer().css("overflow","auto")}}else if(this._bDoScroll){this._getScrollContainer().css("overflow","auto")}else{this._getScrollContainer().css("overflow","hidden")}if(n.browser.mozilla){this._getScrollContainer().css("scrollbar-width","none")}if(this.getWheelZoomable()&&n.system.desktop&&!this._isHeaderMode()){this._getScrollContainer().bind(this._mouseWheelEvent,e.proxy(this._registerMouseWheel,this))}if(this._bDoScroll){this._getScrollContainer().on("scroll",e.proxy(this._onScroll,this))}this._resizeRegId=r.register(this,e.proxy(u.prototype._onResize,this));if(this._isInitialZoomLevelNeeded){this._initZoomLevel()}if(this._headerHasFocus){var c=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();if(c[0]){var h=sap.ui.getCore().byId(c[0].id);this._changeNavigationFocus(null,h);this._headerHasFocus=false}}}};u.prototype.ontouchend=function(e){if(e.target&&e.target.id.indexOf("arrowScroll")!==-1){this._onArrowClick(e)}else{if(!n.support.touch){this.onAfterRendering()}else{this._adjustAndShowArrow()}if(e===null||e.oSource===undefined){return}e.preventDefault();if(this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this)}}};u.prototype._handlePrevent=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault()}if(e&&!e.isPropagationStopped()){e.stopPropagation()}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation()}};u.prototype._onResize=function(){var e=(new Date).getTime();if(!this._iLastResizeEventTime||e-this._iLastResizeEventTime<50){if(!this._iLastResizeHandlingTime||e-this._iLastResizeHandlingTime>500){this.onAfterRendering();this._iLastResizeHandlingTime=(new Date).getTime()}}else{this._iLastResizeHandlingTime=null}this._iLastResizeEventTime=(new Date).getTime()};u.prototype._registerMouseEvents=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault()}switch(e.type){case u._mouseEvents.mouseMove:if(this._getScrollContainer().hasClass(this._grabbingCursorClass)){if(sap.ui.getCore().getConfiguration().getRTL()){this._getScrollContainer().scrollLeftRTL(this.iCursorPositionX-e.pageX)}else{this._getScrollContainer().scrollLeft(this.iCursorPositionX-e.pageX)}this._getScrollContainer().scrollTop(this.iCursorPositionY-e.pageY);this._adjustAndShowArrow()}break;case u._mouseEvents.mouseDown:this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabbingCursorClass);if(sap.ui.getCore().getConfiguration().getRTL()){this.iCursorPositionX=this._getScrollContainer().scrollLeftRTL()+e.pageX}else{this.iCursorPositionX=this._getScrollContainer().scrollLeft()+e.pageX}this.iCursorPositionY=this._getScrollContainer().scrollTop()+e.pageY;if(n.system.combi){this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this._getScrollContainer().scrollTop()}}break;case u._mouseEvents.mouseUp:this._switchCursors(this._getScrollContainer(),this._grabbingCursorClass,this._grabCursorClass);break;case u._mouseEvents.mouseLeave:this._getScrollContainer().removeClass(this._grabbingCursorClass);this._getScrollContainer().removeClass(this._grabCursorClass);this._getScrollContainer().addClass(this._defaultCursorClass);break;case u._mouseEvents.mouseEnter:this._getScrollContainer().removeClass(this._defaultCursorClass);if(e.buttons===null){if(e.which===1){this._getScrollContainer().addClass(this._grabbingCursorClass)}else{this._getScrollContainer().addClass(this._grabCursorClass)}}else if(e.buttons===0){this._getScrollContainer().addClass(this._grabCursorClass)}else if(e.buttons===1){this._getScrollContainer().addClass(this._grabbingCursorClass)}break;default:}if(e.target&&e.target.parentElement&&e.target.parentElement.parentElement&&e.target.parentElement.parentElement.getMetadata&&e.target.parentElement.parentElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){if(e&&!e.isPropagationStopped()){e.stopPropagation()}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation()}}};u.prototype.onfocusin=function(e){var t;if(e&&e.target&&e.target.id){t=sap.ui.getCore().byId(e.target.id)}if(this._isHeaderMode()||this._checkNodesVisibility()){this._setFocusOnHeader(true)}else if(this._bSetFocusOnce&&!(t&&e.target.id.indexOf("arrowScroll"))){this._bSetFocusOnce=false;if(t&&t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){this._changeNavigationFocus(null,t)}else if(!this._lastNavigationFocusElement){var i=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var o=sap.ui.getCore().byId(i[0].id);this._changeNavigationFocus(null,o)}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement)}}};u.prototype._checkNodesVisibility=function(){var e=true;this.getNodes().forEach(function(t){if(t.getVisible()){e=false}});return e};u.prototype.onfocusout=function(){this._bSetFocusOnce=true;if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement._getNavigationFocus()){this._lastNavigationFocusElement._setNavigationFocus(false);if(this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._lastNavigationFocusElement.rerender()}}};u.prototype.onsapplus=function(){this._isFocusChanged=true;this.zoomIn()};u.prototype.onsapminus=function(){this._isFocusChanged=true;this.zoomOut()};u.prototype.onsaptabnext=function(t){var i=true;var o=t.target;var s=sap.ui.getCore().byId(o.id);if(!s&&o&&o.childElementCount>0){o=o.childNodes[0];s=sap.ui.getCore().byId(o.id)}if(!s||s.getMetadata().getName()!=="sap.suite.ui.commons.ProcessFlowNode"&&s.getMetadata().getName()!=="sap.suite.ui.commons.ProcessFlowConnectionLabel"){if(!this._isHeaderMode()&&!this._lastNavigationFocusElement&&!this._checkNodesVisibility()){var a=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId(a[0].id);this._changeNavigationFocus(null,n);i=false}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement);i=false}}if((this._isHeaderMode()||this._checkNodesVisibility())&&i){if(!this._headerHasFocus){this._setFocusOnHeader(true)}else{this._setFocusOnHeader(false)}}else if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._lastNavigationFocusElement.rerender()}var r;if(i){r=this.$().nextAll(":focusable").first();if(r.length===0){r=this.$().nextAll().find(":focusable").first();if(r.length===0){c.apply(this)}}r.focus();l.debug("saptabnext: Keyboard focus has been changed to element:  id='"+r.id+"' outerHTML='"+r.outerHTML+"'");r=null}t.preventDefault();function c(){var t=this.$().parent();do{r=t.next(":focusable");if(r.length===0){r=t.nextAll().find(":focusable").first()}t=t.parent()}while(t.length!==0&&r.length===0);if(r.length===0){r=e(":focusable")[0]}}};u.prototype.onsaptabprevious=function(t){var i=null;var o=t.target;if((!this._lastNavigationFocusElement||!this._lastNavigationFocusElement._getNavigationFocus())&&t.target&&t.target.childElementCount>0){o=t.target.childNodes[0]}var s=sap.ui.getCore().byId(o.id);if(s&&(s.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"||s.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode")){if(!this._isHeaderMode()&&!this._lastNavigationFocusElement){var a=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId(a[0].id);this._changeNavigationFocus(null,n)}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement);t.preventDefault();return}}if(this._isHeaderMode()){if(!this._headerHasFocus){this._setFocusOnHeader(true)}else{this._setFocusOnHeader(false);i=this.$().prevAll().find(":focusable").last()}}else{i=this.$().prev(":focusable");if(i.length===0){i=this.$().prevAll().find(":focusable").last()}if(this._lastNavigationFocusElement){this._lastNavigationFocusElement._setNavigationFocus(false)}if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._lastNavigationFocusElement.rerender()}}if(i){if(i.length===0){r.apply(this)}else if(i.first().length!==0){i=e(i.first())}i.focus();l.debug("saptabnext: Keyboard focus has been set on element:  id='"+i.id+"' outerHTML='"+i.outerHTML+"'");i=null}t.preventDefault();function r(){var e=this.$();do{i=e.prev(":focusable");if(i.length===0){i=e.prevAll().find(":focusable").last()}e=e.parent()}while(e.length!==0&&i.length===0)}};u.prototype._handleKeySelect=function(e){if(this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this);var t=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var i=sap.ui.getCore().byId(t[0].id);this._changeNavigationFocus(null,i)}else if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._lastNavigationFocusElement._getNavigationFocus()){var o=this._lastNavigationFocusElement;o._handleEvents(e)}};u.prototype.onkeyup=function(e){var t=e.keyCode?e.keyCode:e.which;switch(t){case c.ENTER:case c.SPACE:var i=this._lastNavigationFocusElement;if(i){this.fireNodePress(this._lastNavigationFocusElement);i._handleEvents(e)}break;default:break}};u.prototype.onkeydown=function(e){var t=e.keyCode?e.keyCode:e.which;l.debug("ProcessFlow::keyboard input has been catched and action going to start: keycode="+t);var i=false;var o=e.ctrlKey;var s=e.altKey;var a=this._lastNavigationFocusElement;switch(t){case c.ARROW_RIGHT:i=this._moveToNextElement(u._enumMoveDirection.RIGHT);break;case c.ARROW_LEFT:i=this._moveToNextElement(u._enumMoveDirection.LEFT);break;case c.ARROW_DOWN:i=this._moveToNextElement(u._enumMoveDirection.DOWN);break;case c.ARROW_UP:i=this._moveToNextElement(u._enumMoveDirection.UP);break;case c.PAGE_UP:i=this._moveOnePage(u._enumMoveDirection.UP,s);break;case c.PAGE_DOWN:i=this._moveOnePage(u._enumMoveDirection.DOWN,s);break;case c.HOME:i=this._moveHomeEnd(u._enumMoveDirection.LEFT,o);break;case c.END:i=this._moveHomeEnd(u._enumMoveDirection.RIGHT,o);break;case c.NUMPAD_0:case c.DIGIT_0:this._initZoomLevel();break;case c.ENTER:case c.SPACE:this._handleKeySelect(e);e.preventDefault();return;default:return}e.preventDefault();if(i){this._changeNavigationFocus(a,this._lastNavigationFocusElement)}};u.prototype._onArrowClick=function(e){var t=e.target.id;if(t){var i=this.getId();e.preventDefault();if(t===i+u._constants.arrowScrollLeftMinus&&n.system.desktop){this._scroll(-this._scrollStep,500)}else if(t===i+u._constants.arrowScrollRightMinus&&n.system.desktop){this._scroll(this._scrollStep,500)}}};u.prototype._onScroll=function(){var e=this._getScrollContainer().scrollLeft();var t=Math.abs(e-this._iTouchStartScrollLeft);if(t>this._scrollStep/4&&!this._isFocusChanged){this._adjustAndShowArrow();this._iTouchStartScrollLeft=e}else if(this.getScrollable()){var i=this._getScrollContainer().scrollTop();var o=Math.abs(i-this._iTouchStartScrollTop);if(o>10){this._moveArrowAndCounterVertical();this._iTouchStartScrollTop=i}}};u.prototype.ontouchstart=function(){this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this._getScrollContainer().scrollTop()}};u.prototype.ontouchmove=function(e){e.setMarked()};u.prototype._handleLabelClick=function(e){if(e){var t=e.getSource();if(t&&t.getMetadata().getName()==="sap.ui.core.Icon"){t=t.getParent()}if(t&&t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){var i=this._getConnectionMapEntries(t);var o=this._createLabelPressEventArgs(t,i);this.fireLabelPress(o)}}};u.prototype._onFocusChanged=function(){var t=this._lastNavigationFocusElement,i=t?t.$():null,o,s,a,n,r,c,h,u,g,d,_,f,p,m,v,C,N=500;if(t&&this.getScrollable()){l.debug("The actually focused element is "+t.getId());if(t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){u=i.parent().parent().parent().outerWidth();g=i.parent().parent().parent().outerHeight();d=i.parent().parent().parent().position()}else{u=i.outerWidth();g=i.outerHeight();d=i.position()}l.debug("Element outer width x height ["+u+" x "+g+"]");l.debug("Position of element in the content is ["+d.left+", "+d.top+"]");r=this.$("scroll-content");o=this._getScrollContainer().innerWidth();s=this._getScrollContainer().innerHeight();l.debug("Scroll container inner width x height ["+o+" x "+s+"]");a=this._getScrollContainer().scrollLeft();n=this._getScrollContainer().scrollTop();l.debug("Current scroll offset is ["+a+", "+n+"]");c=r.innerWidth();h=r.innerHeight();l.debug("Scroll content inner width x height ["+c+" x "+h+"]");_=-a+d.left;p=_+u;f=-n+d.top;m=f+g;if(p>o||_<0||m>s||f<0){v=Math.round((o-u)/2);v=Math.max(o-c+d.left,v);v=Math.min(d.left,v);C=Math.round((s-g)/2);C=Math.max(s-h+d.top,C);C=Math.min(d.top,C);l.debug("Element lies outside the scroll container, scrolling from ["+_+","+f+"] to ["+v+","+C+"]");this._isFocusChanged=true;this._getScrollContainer().animate({scrollTop:d.top-C,scrollLeft:d.left-v},N,"swing",e.proxy(this._adjustAndShowArrow,this))}else{l.debug("Element lies inside the scroll container, no scrolling happens.");this._setFocusToNode(t)}}else{this._setFocusToNode(t);this._adjustAndShowArrow()}};u.prototype._setScrollWidth=function(){switch(this.getZoomLevel()){case t.ProcessFlowZoomLevel.One:this._scrollStep=240;break;case t.ProcessFlowZoomLevel.Two:this._scrollStep=192;break;case t.ProcessFlowZoomLevel.Three:this._scrollStep=168;break;case t.ProcessFlowZoomLevel.Four:this._scrollStep=128;break;default:this._scrollStep=192}};u.prototype._getLastNavigationFocusElement=function(){return this._lastNavigationFocusElement};u.prototype._getNode=function(e,t){for(var i=0;i<t.length;i++){if(t[i].getNodeId()===e.toString()){return t[i]}}};u.prototype._getLane=function(e){for(var t=0;t<this._internalLanes.length;t++){if(this._internalLanes[t].getLaneId()===e){return this._internalLanes[t]}}};u.prototype.destroyLanes=function(){this.removeAllAggregation("lanes");this._internalLanes=[];return this};u._getChildIdByElement=function(e){if(typeof e==="object"){return e.nodeId}else{return e}};u.prototype._isHeaderMode=function(){var e=this.getNodes();return!e||e.length===0};u.prototype._getScrollContainer=function(){return this.$(u._constants.scrollContainer)};u.prototype._handleException=function(e){var t=this._resBundle.getText("PF_ERROR_INPUT_DATA");this.fireOnError({text:t});l.error("Error loading data for the process flow with id : "+this.getId());if(e instanceof Array){for(var i=0;i<e.length;i++){l.error("Detailed description ("+i+") :"+e[i])}}else{l.error("Detailed description  :"+e)}};u.prototype._getAriaText=function(){return this._resBundle.getText("PF_ARIA_PROCESS_FLOW")};u.prototype._updateLanesFromNodes=function(){u.NodeElement._createNodeElementsFromProcessFlowNodes(this.getNodes(),this.getLanes());var e=this._arrangeNodesByParentChildRelation(this.getNodes());this._internalLanes=u.NodeElement._updateLanesFromNodes(this.getLanes(),e).lanes};u.prototype._getOrCreateLaneMap=function(){if(!this._internalLanes||this._internalLanes.length<=0){this._updateLanesFromNodes()}return u.NodeElement._createMapFromLanes(this._internalLanes,e.proxy(this.ontouchend,this),this._isHeaderMode()).positionMap};u.prototype._arrangeNodesByParentChildRelation=function(e){var t=e?e.length:0;var i=[];var o,s;if(t>0){this._setParentForNodes(e);for(o=0;o<t;o++){i=e[o].getChildren();if(i){var a=i.length;for(s=0;s<a;s++){i[s]=u._getChildIdByElement(i[s]).toString()}}for(s=0;s<o;s++){if(i&&Array.prototype.indexOf.call(i,e[s].getNodeId())>-1&&e[s].getLaneId()===e[o].getLaneId()){e.splice(s,0,e[o]);e.splice(o+1,1);e=this._arrangeNodesByParentChildRelation(e);break}}}}return e};u.prototype._getOrCreateProcessFlow=function(){if(!this._internalLanes||this._internalLanes.length<=0||this._isLanesUpdated()){this._resetLanesFromModel();this._updateLanesFromNodes()}this.applyNodeDisplayState();var e=this.getNodes();var t=u.NodeElement._createNodeElementsFromProcessFlowNodes(e,this._internalLanes);var i=t.elementById;var o=t.elementsByLane;var s=this._calculateMatrix(i);s=this._addFirstAndLastColumn(s);u.NodeElement._calculateLaneStatePieChart(o,this._internalLanes,e,this);for(var a=0;a<s.length;a++){for(var n=0;n<s[a].length;n++){if(s[a][n]instanceof u.NodeElement){s[a][n]=i[s[a][n].nodeId].oNode}}}this._internalCalcMatrix=s;return s};u.prototype._isLanesUpdated=function(){var e=this.getLanes();if(e.length!=this._internalLanes.length){return true}var t;for(var i=0;i<e.length;i++){var o=e[i];t=false;for(var s=0;s<this._internalLanes.length;s++){var a=this._internalLanes[s];if(a.getLaneId()===o.getLaneId()){t=true;break}}if(!t){return true}}return false};u.prototype._resetLanesFromModel=function(){var e=this.getNodes();e.forEach(function(e){e._mergedLaneId=false});var t=this.getLanes();t.forEach(function(e){e._mergedLanePosition=false});this._internalLanes=[];if(this._isHeaderMode()){var i=this.getBindingInfo("lanes");if(i&&i.model){this.getModel(i.model).refresh()}}else{var o=this.getBindingInfo("nodes");if(o&&o.model){this.getModel(o.model).refresh()}}};u.prototype._addFirstAndLastColumn=function(e){if(!e||e.length<=0){return[]}var t=e.length;for(var i=0;i<t;i++){e[i].unshift(null);e[i].push(null)}return e};u.prototype._calculateMatrix=function(e){var t,i,o,s,a;if(!e||e.length===0){return[]}t=new u.InternalMatrixCalculation(this);t.checkInputNodeConsistency(e);i=t._retrieveInfoFromInputArray(e);t._resetPositions();o=i.highestLanePosition+1;s=Math.max(Object.keys(e).length,2);a=t._createMatrix(s,o);for(var n=0;n<i.rootElements.length;n++){t.iPositionY=i.rootElements[n].lane;a=t.processCurrentElement(i.rootElements[n],e,a)}if(this._isLayoutOptimized){t._optimizeMatrix(a,e)}a=t._doubleColumnsInMatrix(a);a=t._calculatePathInMatrix(a);a=t._removeEmptyLines(a);return a};u.NodeElement=function(e,t,i,o){this.nodeId=e;this.lane=t;this.state=i.getState();this.displayState=i._getDisplayState();this.isProcessed=false;if(Array.isArray(o)){this.aParent=o}else{this.oParent=o}this.oNode=i};u.NodeElement._initNodeElement=function(e,t,i,o){return new u.NodeElement(e,t,i,o)};u.NodeElement.prototype={toString:function(){return this.nodeId},containsChildren:function(e){if(!e){return false}if(!(e instanceof u.NodeElement)){return false}if(this.oNode.getChildren()&&e.oNode.getChildren()&&this.oNode.getChildren().length&&e.oNode.getChildren().length){for(var t=0;t<this.oNode.getChildren().length;t++){if(e.oNode.getChildren().indexOf(this.oNode.getChildren()[t])>=0){return true}}}return false}};u.NodeElement._calculateLaneStatePieChart=function(e,i,o,s){if(!e||!i||!o){return}var a;for(a=0;a<o.length;a++){s._bHighlightedMode=o[a].getHighlighted();if(s._bHighlightedMode){break}}var n,r,l,c,h;for(a=0;a<i.length;a++){var u=i[a];var g=e[u.getLaneId()];if(!g){continue}n=0;r=0;l=0;c=0;h=0;for(var d=0;d<g.length;d++){if(!s._bHighlightedMode||(g[d].oNode._getDisplayState()===t.ProcessFlowDisplayState.Highlighted||g[d].oNode._getDisplayState()===t.ProcessFlowDisplayState.HighlightedFocused||g[d].oNode._getDisplayState()===t.ProcessFlowDisplayState.SelectedHighlighted||g[d].oNode._getDisplayState()===t.ProcessFlowDisplayState.SelectedHighlightedFocused)){switch(g[d].oNode.getState()){case t.ProcessFlowNodeState.Positive:n++;break;case t.ProcessFlowNodeState.Negative:case t.ProcessFlowNodeState.PlannedNegative:r++;break;case t.ProcessFlowNodeState.Planned:c++;break;case t.ProcessFlowNodeState.Critical:h++;break;case t.ProcessFlowNodeState.Neutral:default:l++}}}var _=[{state:t.ProcessFlowNodeState.Positive,value:n},{state:t.ProcessFlowNodeState.Negative,value:r},{state:t.ProcessFlowNodeState.Neutral,value:l},{state:t.ProcessFlowNodeState.Planned,value:c},{state:t.ProcessFlowNodeState.Critical,value:h}];u.setState(_)}};u.NodeElement._updateLanesFromNodes=function(e,t){var i=u.NodeElement._createMapFromLanes(e,null,false);var o=i.positionMap;var s=i.idMap;var a={};var n=e.slice();var r;var l={};var c=0;var h;for(h=0;h<t.length;h++){a[t[h].getNodeId()]=t[h]}for(h=0;h<t.length;h++){var g=t[h];var d=g.getChildren()||[];var _=1;var f=null;var p=null;for(var m=0;m<d.length;m++){var v=u._getChildIdByElement(d[m]);var C=a[v];if(C){if(g.getLaneId()===C.getLaneId()){f=C.getLaneId()+_;p=s[f];if(!p){var N=s[g.getLaneId()];p=u.NodeElement._createNewProcessFlowElement(N,f,N.getPosition()+_);s[p.getLaneId()]=p;n.splice(p.getPosition(),0,p)}C._setMergedLaneId(p.getLaneId())}u.NodeElement._changeLaneOfChildren(g.getLaneId(),C,a)}}if(p){l={};r=false;for(var M in o){if(p.getLaneId()===o[M].getLaneId()){r=true;break}if(parseInt(M,10)>=p.getPosition()){var F=o[M];l[F.getPosition()+_]=F}}if(!r){for(var b in l){c=parseInt(b,10);l[c]._setMergedPosition(c)}l[p.getPosition()]=p;for(var w=0;w<p.getPosition();w++){l[w]=o[w]}o=l}}}return{lanes:n,nodes:t}};u.NodeElement._changeLaneOfChildren=function(e,t,i){var o=t.getChildren();if(o){for(var s=0;s<o.length;s++){var a=u._getChildIdByElement(o[s]);var n=i[a];if(n&&n.getLaneId()===e){n._setMergedLaneId(t.getLaneId());u.NodeElement._changeLaneOfChildren(e,n,i)}}}};u.NodeElement._createNewProcessFlowElement=function(e,t,i){return new a({laneId:t,iconSrc:e.getIconSrc(),text:e.getText(),state:e.getState(),position:i,zoomLevel:e.getZoomLevel()})};u.NodeElement._createMapFromLanes=function(e,t,i){var o,s={},a={},n=e?e.length:0,r=0;if(!n){return{}}else{while(r<n){o=e[r];if(o&&o.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowLaneHeader"){s[o.getPosition()]=o;a[o.getLaneId()]=o;if(t){o.attachPress(t)}o._setHeaderMode(i)}r++}return{positionMap:s,idMap:a}}};u.NodeElement._createNodeElementsFromProcessFlowNodes=function(t,i){var o={},s={},a={},n,r=t?t.length:0,l,c,h=i?i.length:0,g,d=[],_,f,p,m,v,C,N={};if(r===0){return{elementById:{},elementsByLane:{}}}if(h===0){throw["No lane definition although there is a node definition."]}v=0;while(v<h){c=i[v];g=c.getLaneId();_=c.getPosition();if(o[g]){throw["The lane with id: "+g+" is defined at least twice. (Lane error)"]}o[g]=_;if(d&&Array.prototype.indexOf.call(d,_)>-1){throw["The position "+_+" is defined at least twice. (Lane error)."]}else{d.push(_)}s[g]=[];v++}v=0;while(v<r){n=t[v];if(n&&n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){l=n.getNodeId();g=n.getLaneId();f=n.getChildren()||[];m=f.length;C=0;while(C<m){p=u._getChildIdByElement(f[C]);a[p]=a[p]||[];a[p].push(l);C++}}v++}v=0;while(v<r){n=t[v];if(n&&n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){l=n.getNodeId();if(!l){throw["There is a node which has no node id defined. (Title="+n.getTitle()+") and array position: "+v]}g=n.getLaneId();_=o[g];if(e.type(_)!=="number"){throw["For the node "+l+" position (lane) is not defined."]}if(!N[l]){N[l]=u.NodeElement._initNodeElement(l,_,n,a[l]);s[g].push(N[l])}else{throw["The node id "+l+" is used second time."]}}v++}return{elementById:N,elementsByLane:s}};u.InternalMatrixCalculation=function(){this.iPositionX=0;this.iPositionY=0;this.nodePositions={};this.mapChildToNode={}};u.InternalMatrixCalculation.prototype._optimizeMatrix=function(e,t){var i;do{i=false;for(var o=0;o<e[0].length;o++){for(var s=0;s<e.length-1;s++){if(!e[s][o]){var a=false;for(var n=s+1;n<e.length;n++){if(e[n][o]){a=true;break}}if(!a){break}if(this._optimizeLane(e,s,o,t)){i=true}}}}}while(i)};u.InternalMatrixCalculation.prototype._optimizeLane=function(e,t,i,o){for(var s=t+1;s<e.length;s++){if(e[s][i]){var a=e[s][i];if(this._verifyOptimizeLane(e,t,s,i,o)){e[t][i]=a;this.nodePositions[a.nodeId].x=t;e[s][i]=null;return true}else{return false}}}return false};u.InternalMatrixCalculation.prototype._verifyOptimizeLane=function(e,t,i,o,s){var a=e[i][o].oNode;var n,r,l,c;if(a&&a.getChildren()){l=e[i][o].oNode.getChildren();for(n=0;n<l.length;n++){c=u._getChildIdByElement(l[n]);var h=s[c].lane;for(r=o+1;r<h;r++){if(e[t][r]){return false}}}}var g=e[i][o].nodeId;var d=this.nodePositions[g];var _=e[i][o].aParent;if(_){for(n=0;n<_.length;n++){c=u._getChildIdByElement(_[n]);if(o-1!==s[c].lane){return false}var f=this.nodePositions[c];if(f.x>=d.x){return false}}}for(n=0;n<o;n++){for(r=0;r<e.length;r++){if(e[r][n]&&e[r][n].oNode){c=e[r][n].nodeId;var p=this.nodePositions[c];l=e[r][n].oNode.getChildren();if(l){for(var m=0;m<l.length;m++){var v=u._getChildIdByElement(l[m]);var C=this.nodePositions[v];if(s[v].lane>o&&!(p.x<t&&C.x<t||p.x>t&&C.x>t)){return false}}}}}}if(a._hasChildren()){for(n=0;n<t;n++){if(e[n][o]){l=e[n][o].oNode.getChildren();if(l){for(r=0;r<l.length;r++){c=u._getChildIdByElement(l[r]);var N=s[c];var M=this.nodePositions[c];if(N.lane>o&&M.x>=t&&!a._hasChildrenWithNodeId(c)){return false}}}}}}return true};u.InternalMatrixCalculation.prototype._resetPositions=function(){this.iPositionX=0;this.iPositionY=0;delete this.nodePositions;delete this.mapChildToNode;this.nodePositions={};this.mapChildToNode={}};u.InternalMatrixCalculation.prototype._createMatrix=function(e){e=parseInt(e,10);var t=new Array(e||0);var i=e;if(arguments.length>1){var o=Array.prototype.slice.call(arguments,1);while(i--){t[e-1-i]=this._createMatrix.apply(this,o)}}return t};u.InternalMatrixCalculation.prototype._retrieveInfoFromInputArray=function(e){var t=0,i=[],o;Object.keys(e).forEach(function(s){o=e[s];if(!o.oParent&&!o.aParent){i.push(o)}if(t<o.lane){t=o.lane}});return{highestLanePosition:t,rootElements:i}};u.InternalMatrixCalculation.prototype._doubleColumnsInMatrix=function(e){var t=0,i;for(i=0;i<e.length;i++){t=t>e[i].length?t:e[i].length}var o=new Array(e.length||0);for(i=0;i<o.length;i++){o[i]=new Array(t*2-1);for(var s=0;s<t;s++){if(e[i][s]){o[i][2*s]=e[i][s]}}}return o};u.InternalMatrixCalculation.prototype._removeEmptyLines=function(e){var t=0,i,o;for(i=0;i<e.length;i++){for(o=0;o<e[i].length;o++){if(e[i][o]){t++;break}}}var s=this._createMatrix(t,e[0].length);for(i=0;i<t;i++){for(o=0;o<e[i].length;o++){s[i][o]=null;if(e[i][o]){s[i][o]=e[i][o]}}}return s};u.InternalMatrixCalculation.prototype._sortBasedOnChildren=function(e,t){var i={},o,s=null,a,n,r,l=[],c,h,g;if(e){e.forEach(function(e){var s=u._getChildIdByElement(e);o=i[t[s].lane];if(!o){i[t[s].lane]=o=[]}o.push(t[s])})}else{return[]}var d=function(e,t){n=(e.oNode.getChildren()||[]).length;r=(t.oNode.getChildren()||[]).length;return r-n};a=[];for(s in i){a.push(s);i[s].sort(d)}a=a.sort(function(e,t){return t-e});var _=function(e){if(g.containsChildren(e)){h.push(e)}};a.forEach(function(e){c=i[e];if(c.length>1){h=[];g=c.shift();while(g){if(h.indexOf(g)<0){h.push(g)}c.forEach(_);g=c.shift()}l=l.concat(h)}else{l=l.concat(c)}});return l};u.InternalMatrixCalculation.prototype._calculatePathInMatrix=function(e){var t=null;for(var i in this.nodePositions){if(this.nodePositions.hasOwnProperty(i)){t=this.nodePositions[i];var o=t.c.oNode.getChildren();for(var s=0;o&&s<o.length;s++){var a=u._getChildIdByElement(o[s]);var n=this.nodePositions[a];e=this._calculateSingleNodeConnection(t,n,t.x,t.y,n.x,n.y,e)}}}return e};u.InternalMatrixCalculation.prototype._calculateSingleNodeConnection=function(e,t,i,o,s,a,n){var r=a-o;var l=s-i;if(r<0){throw["Problem with negative horizontal movement","Parent node is "+e.c.toString(),"Children node is "+t.c.toString(),"Coordinates : '"+i+"','"+o+"','"+s+"','"+a+"'"]}else if(l<=-1){var c=this._checkIfHorizontalLinePossible(n,s,o+2,a);var h=a-1;if(c){h=o+1}var g=i;if(c){g=s}n[i][h]=this._createConnectionElement(n[i][h],u._cellEdgeConstants.LU,e,t,false);n=this._writeVerticalLine(n,i,s,h,e,t);n[s][h]=this._createConnectionElement(n[s][h],u._cellEdgeConstants.UR,e,t,h===a-1);var d=o+2;var _=a;if(!c){d=o+1;_=h+1}n=this._writeHorizontalLine(n,g,d,_,e,t)}else if(l===0){n=this._writeHorizontalLine(n,i,o+1,a,e,t)}else if(l===1){n[i][o+1]=this._createConnectionElement(n[i][o+1],u._cellEdgeConstants.LD,e,t,false);n[s][o+1]=this._createConnectionElement(n[s][o+1],u._cellEdgeConstants.DR,e,t,o+1===a-1);n=this._writeHorizontalLine(n,s,o+2,a,e,t)}else{n[i][o+1]=this._createConnectionElement(n[i][o+1],u._cellEdgeConstants.LD,e,t,false);n=this._writeVerticalLine(n,s,i,o+1,e,t);n[s][o+1]=this._createConnectionElement(n[s][o+1],u._cellEdgeConstants.DR,e,t,o+1===a-1);n=this._writeHorizontalLine(n,s,o+2,a,e,t)}return n};u.InternalMatrixCalculation.prototype._writeVerticalLine=function(e,t,i,o,s,a){for(var n=t-1;n>i;n--){e[n][o]=this._createConnectionElement(e[n][o],u._cellEdgeConstants.DU,s,a,false)}return e};u.InternalMatrixCalculation.prototype._checkIfHorizontalLinePossible=function(e,t,i,o){var s=true;for(var a=i;a<o;a++){if(e[t][a]instanceof u.NodeElement){s=false;break}}return s};u.InternalMatrixCalculation.prototype._writeHorizontalLine=function(e,t,i,o,s,a){var n=t===a.x;if(!n){o--}for(var r=i;r<o;r++){e[t][r]=this._createConnectionElement(e[t][r],u._cellEdgeConstants.LR,s,a,r===o-1&&n)}return e};u.InternalMatrixCalculation.prototype._createConnectionElement=function(e,t,i,o,a){var n=e;if(!n){n=new s}if(n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){var r=this._calculateConnectionDisplayStateBySourceAndTargetNode(i.c.oNode,o.c.oNode);var l={flowLine:t,targetNodeState:o.c.state,displayState:r,hasArrow:a};n.addConnectionData(l)}return n};u.InternalMatrixCalculation.prototype._calculateConnectionDisplayStateBySourceAndTargetNode=function(e,i){var o=e.getHighlighted();var s=e.getSelected();var a=e._getDimmed();var n=i.getHighlighted();var r=i.getSelected();var l=i._getDimmed();var c=t.ProcessFlowDisplayState.Regular;if(s&&r){c=t.ProcessFlowDisplayState.Selected}else if(o&&n){c=t.ProcessFlowDisplayState.Highlighted}else if(a||l||o&&r||s&&n){c=t.ProcessFlowDisplayState.Dimmed}return c};u.prototype.addNode=function(e){return this.addAggregation("nodes",e,false)};u.prototype._switchCursors=function(e,t,i){if(e.hasClass(t)){e.removeClass(t)}if(!e.hasClass(i)){e.addClass(i)}};u.prototype._clearHandlers=function(t){t.bind(this._mousePreventEvents,e.proxy(this._handlePrevent,this))};u.prototype._initZoomLevel=function(){if(this.$()){var e=this.$().width();if(e){if(e<i.ScreenSizes.tablet){this.setZoomLevel(t.ProcessFlowZoomLevel.Four)}else if(e<i.ScreenSizes.desktop){this.setZoomLevel(t.ProcessFlowZoomLevel.Three)}else{this.setZoomLevel(t.ProcessFlowZoomLevel.Two)}}}};u.prototype._registerMouseWheel=function(e){var t=e.originalEvent.wheelDelta||-e.originalEvent.detail;if(t===0){t=-e.originalEvent.deltaY}if(e&&!e.isDefaultPrevented()){e.preventDefault();e.originalEvent.returnValue=false}var i=300;var o=function(){var e=new Date-this._wheelTimestamp;if(e<i){this._wheelTimeout=setTimeout(function(){var e=o.bind(this);if(typeof e==="string"||e instanceof String){e=this[e]}e.apply(this,[])}.bind(this),i-e)}else{this._wheelTimeout=null;this._wheelCalled=false}};if(!this._wheelCalled){this._wheelCalled=true;if(t<0){this._isFocusChanged=true;this.zoomOut()}else{this._isFocusChanged=true;this.zoomIn()}}if(!this._wheelTimeout){this._wheelTimestamp=new Date;this._wheelTimeout=setTimeout(function(){var e=o.bind(this);if(typeof e==="string"||e instanceof String){e=this[e]}e.apply(this,[])}.bind(this),i)}if(e&&!e.isPropagationStopped()){e.stopPropagation()}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation()}};u.prototype._setFocusToNode=function(t){if(t){if(t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){e(document.getElementById(t.sId)).parent().focus();t._setNavigationFocus(true);t.rerender()}else if(t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){t.$().focus();t._setNavigationFocus(true)}}else if(this._lastNavigationFocusElement){if(this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){e(document.getElementById(this._lastNavigationFocusElement.sId)).parent().focus();this._lastNavigationFocusElement._setNavigationFocus(true);this._lastNavigationFocusElement.rerender()}else if(this._lastNavigationFocusElement.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnectionLabel"){this._lastNavigationFocusElement.$().focus();this._lastNavigationFocusElement._setNavigationFocus(true)}}};u.prototype._changeNavigationFocus=function(e,t){if(e&&t&&e.getId()!==t.getId()){l.debug("Rerendering PREVIOUS node with id '"+e.getId()+"' navigation focus : "+e._getNavigationFocus());e._setNavigationFocus(false);if(e.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){e.invalidate()}}if(t){l.debug("Rerendering CURRENT node with id '"+t.getId()+"' navigation focus : "+t._getNavigationFocus());t._setNavigationFocus(true);if(t.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){t.rerender()}this._lastNavigationFocusElement=t;this._onFocusChanged()}};u.prototype._moveOnePage=function(e,t){e=e||u._enumMoveDirection.UP;t=t||false;var i=0,o=0;var s=0,a=0;var n=0;var r=false,l,c,h;for(l=0;l<this._internalCalcMatrix.length;l++){for(c=0;c<this._internalCalcMatrix[l].length;c++){if(this._internalCalcMatrix[l][c]&&this._internalCalcMatrix[l][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._internalCalcMatrix[l][c]._getNavigationFocus()){i=l;o=c;break}else if(this._internalCalcMatrix[l][c]&&this._internalCalcMatrix[l][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[l][c]._getVisibleLabel();if(h&&h._getNavigationFocus()){i=l;o=c;break}}}}if(t){if(e===u._enumMoveDirection.UP){for(c=o-1;c>=0&&n<this._jumpOverElements;c--){if(this._internalCalcMatrix[i][c]&&this._internalCalcMatrix[i][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][c].getHighlighted())){n++;s=i;a=c;r=true}else if(this._internalCalcMatrix[i][c]&&this._internalCalcMatrix[i][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[i][c]._getVisibleLabel();if(this._labelCanGetFocus(h)){n++;s=i;a=c;r=true}}}}else if(e===u._enumMoveDirection.DOWN){for(c=o+1;c<this._internalCalcMatrix[i].length&&n<this._jumpOverElements;c++){if(this._internalCalcMatrix[i][c]&&this._internalCalcMatrix[i][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][c].getHighlighted())){n++;s=i;a=c;r=true}else if(this._internalCalcMatrix[i][c]&&this._internalCalcMatrix[i][c].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[i][c]._getVisibleLabel();if(this._labelCanGetFocus(h)){n++;s=i;a=c;r=true}}}}}else if(e===u._enumMoveDirection.UP){for(l=i-1;l>=0&&n<this._jumpOverElements;l--){if(this._internalCalcMatrix[l][o]&&this._internalCalcMatrix[l][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[l][o].getHighlighted())){n++;s=l;a=o;r=true}else if(this._internalCalcMatrix[l][o]&&this._internalCalcMatrix[l][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[l][o]._getVisibleLabel();if(this._labelCanGetFocus(h)){n++;s=l;a=o;r=true}}}}else if(e===u._enumMoveDirection.DOWN){for(l=i+1;l<this._internalCalcMatrix.length&&n<this._jumpOverElements;l++){if(this._internalCalcMatrix[l][o]&&this._internalCalcMatrix[l][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[l][o].getHighlighted())){n++;s=l;a=o;r=true}else if(this._internalCalcMatrix[l][o]&&this._internalCalcMatrix[l][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[l][o]._getVisibleLabel();if(this._labelCanGetFocus(h)){n++;s=l;a=o;r=true}}}}if(r){if(this._internalCalcMatrix[i][o]&&this._internalCalcMatrix[i][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){this._internalCalcMatrix[i][o]._getVisibleLabel()._setNavigationFocus(false)}else{this._internalCalcMatrix[i][o]._setNavigationFocus(false)}if(this._internalCalcMatrix[s][a]&&this._internalCalcMatrix[s][a].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){h=this._internalCalcMatrix[s][a]._getVisibleLabel();h._setNavigationFocus(true);this._lastNavigationFocusElement=h}else{this._internalCalcMatrix[s][a]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[s][a]}}return r};u.prototype._moveHomeEnd=function(e,t){e=e||u._enumMoveDirection.RIGHT;t=t||false;var i=0,o=0;var s=0,a=0;var n=false,r,l,c;for(r=0;r<this._internalCalcMatrix.length;r++){for(l=0;l<this._internalCalcMatrix[r].length;l++){if(this._internalCalcMatrix[r][l]&&this._internalCalcMatrix[r][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._internalCalcMatrix[r][l]._getNavigationFocus()){i=r;o=l;break}else if(this._internalCalcMatrix[r][l]&&this._internalCalcMatrix[r][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[r][l]._getVisibleLabel();if(c&&c._getNavigationFocus()){i=r;o=l;break}}}}if(t){if(e===u._enumMoveDirection.LEFT){for(r=0;r<i;r++){if(this._internalCalcMatrix[r][o]&&this._internalCalcMatrix[r][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[r][o].getHighlighted())){s=r;a=o;n=true;break}else if(this._internalCalcMatrix[r][o]&&this._internalCalcMatrix[r][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[r][o]._getVisibleLabel();if(this._labelCanGetFocus(c)){s=r;a=o;n=true;break}}}}else if(e===u._enumMoveDirection.RIGHT){for(r=this._internalCalcMatrix.length-1;r>i;r--){if(this._internalCalcMatrix[r][o]&&this._internalCalcMatrix[r][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[r][o].getHighlighted())){s=r;a=o;n=true;break}else if(this._internalCalcMatrix[r][o]&&this._internalCalcMatrix[r][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[r][o]._getVisibleLabel();if(this._labelCanGetFocus(c)){s=r;a=o;n=true;break}}}}}else if(e===u._enumMoveDirection.LEFT){for(l=0;l<o;l++){if(this._internalCalcMatrix[i][l]&&this._internalCalcMatrix[i][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][l].getHighlighted())){s=i;a=l;n=true;break}else if(this._internalCalcMatrix[i][l]&&this._internalCalcMatrix[i][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[i][l]._getVisibleLabel();if(this._labelCanGetFocus(c)){s=i;a=l;n=true;break}}}}else if(e===u._enumMoveDirection.RIGHT){for(l=this._internalCalcMatrix[i].length-1;l>o;l--){if(this._internalCalcMatrix[i][l]&&this._internalCalcMatrix[i][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&(!this._bHighlightedMode||this._internalCalcMatrix[i][l].getHighlighted())){s=i;a=l;n=true;break}else if(this._internalCalcMatrix[i][l]&&this._internalCalcMatrix[i][l].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[i][l]._getVisibleLabel();if(this._labelCanGetFocus(c)){s=i;a=l;n=true;break}}}}if(n){if(this._internalCalcMatrix[i][o]&&this._internalCalcMatrix[i][o].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){this._internalCalcMatrix[i][o]._getVisibleLabel()._setNavigationFocus(false)}else{this._internalCalcMatrix[i][o]._setNavigationFocus(false)}if(this._internalCalcMatrix[s][a]&&this._internalCalcMatrix[s][a].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){c=this._internalCalcMatrix[s][a]._getVisibleLabel();c._setNavigationFocus(true);this._lastNavigationFocusElement=c}else{this._internalCalcMatrix[s][a]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[s][a]}}return n};u.prototype._moveToNextElement=function(e,t){e=e||u._enumMoveDirection.RIGHT;if(sap.ui.getCore().getConfiguration().getRTL()){if(e===u._enumMoveDirection.RIGHT){e=u._enumMoveDirection.LEFT}else if(e===u._enumMoveDirection.LEFT){e=u._enumMoveDirection.RIGHT}}t=t||1;var i=false;var o=false;var s=0,a=1,n,r,l;if(!this._internalCalcMatrix){return false}var c=0,h=0;for(n=0;n<this._internalCalcMatrix.length;n++){for(r=0;r<this._internalCalcMatrix[n].length;r++){if(this._internalCalcMatrix[n][r]){if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&this._internalCalcMatrix[n][r]._getNavigationFocus()){s=c=n;a=h=r;i=true;break}else if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][r]._getVisibleLabel();if(l&&l._getNavigationFocus()&&l.getEnabled()){s=c=n;a=h=r;i=true;break}}}}if(i){break}}if(e===u._enumMoveDirection.RIGHT){for(n=c;n<this._internalCalcMatrix.length;n++){for(r=h+1;r<this._internalCalcMatrix[n].length;r++){if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][r].getHighlighted())){this._internalCalcMatrix[n][r]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][r];o=true;break}}else if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][r]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}}h=0;if(o){break}}}if(e===u._enumMoveDirection.LEFT){for(n=c;n>=0;n--){for(r=h-1;r>=0;r--){if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][r].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[n][r]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][r];o=true;break}}else if(this._internalCalcMatrix[n][r]&&this._internalCalcMatrix[n][r].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][r]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}}if(n>0){h=this._internalCalcMatrix[n-1].length}if(o){break}}}var g,d,_;if(e===u._enumMoveDirection.UP){for(n=c-1;n>=0;n--){g=0;while(!o){d=h-g;_=h+g;if(d>=0&&this._internalCalcMatrix[n][d]&&this._internalCalcMatrix[n][d].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][d].getHighlighted())){this._internalCalcMatrix[n][d]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][d];o=true;break}}else if(d>=0&&this._internalCalcMatrix[n][d]&&this._internalCalcMatrix[n][d].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][d]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}if(_<this._internalCalcMatrix[n].length&&this._internalCalcMatrix[n][_]&&this._internalCalcMatrix[n][_].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][_].getHighlighted())){this._internalCalcMatrix[n][_]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][_];o=true;break}}else if(_>=0&&this._internalCalcMatrix[n][_]&&this._internalCalcMatrix[n][_].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][_]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}if(d<0&&_>this._internalCalcMatrix[n].length){break}g++}}}if(e===u._enumMoveDirection.DOWN){for(n=c+1;n<this._internalCalcMatrix.length;n++){g=0;while(!o){d=h-g;_=h+g;if(d>=0&&this._internalCalcMatrix[n][d]&&this._internalCalcMatrix[n][d].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][d].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[n][d]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][d];o=true;break}}else if(d>=0&&this._internalCalcMatrix[n][d]&&this._internalCalcMatrix[n][d].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][d]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}if(_<this._internalCalcMatrix[n].length&&this._internalCalcMatrix[n][_]&&this._internalCalcMatrix[n][_].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){if(i&&(!this._bHighlightedMode||this._internalCalcMatrix[n][_].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[n][_]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[n][_];o=true;break}}else if(_>=0&&this._internalCalcMatrix[n][_]&&this._internalCalcMatrix[n][_].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowConnection"){l=this._internalCalcMatrix[n][_]._getVisibleLabel();if(i&&this._labelCanGetFocus(l)){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;o=true;break}}if(d<0&&_>this._internalCalcMatrix[n].length){break}g++}}}if(o){if(this._internalCalcMatrix[s][a]&&this._internalCalcMatrix[s][a].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){this._internalCalcMatrix[s][a]._setNavigationFocus(false)}else{this._internalCalcMatrix[s][a]._getVisibleLabel()._setNavigationFocus(false)}}return o};u.prototype._getScrollContainerOnZoomChanged=function(e,t){e.scrollLeft=Math.round(t.get()[0].scrollWidth/e.scrollWidth*e.scrollLeft);e.scrollTop=Math.round(t.get()[0].scrollHeight/e.scrollHeight*e.scrollTop);e.scrollWidth=t.get()[0].scrollWidth;e.scrollHeight=t.get()[0].scrollHeight;return e};u.prototype._mergeLaneIdNodeStates=function(e){var i=0;var o=0;var s=0;var a=0;var n=0;for(var r=0;r<5;r++){for(var l=0;l<e.length;l++){switch(e[l][r].state){case t.ProcessFlowNodeState.Positive:i=i+e[l][r].value;break;case t.ProcessFlowNodeState.Negative:o=o+e[l][r].value;break;case t.ProcessFlowNodeState.Neutral:s=s+e[l][r].value;break;case t.ProcessFlowNodeState.Planned:a=a+e[l][r].value;break;case t.ProcessFlowNodeState.PlannedNegative:o=o+e[l][r].value;break;case t.ProcessFlowNodeState.Critical:n=n+e[l][r].value;break;default:break}}}return[{state:t.ProcessFlowNodeState.Positive,value:i},{state:t.ProcessFlowNodeState.Negative,value:o},{state:t.ProcessFlowNodeState.Neutral,value:s},{state:t.ProcessFlowNodeState.Planned,value:a},{state:t.ProcessFlowNodeState.Critical,value:n}]};u.prototype._setFocusOnHeader=function(e){var t=this.$("thead");if(e){t.focus();t.addClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=true}else{t.removeClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=false}};u.prototype._scroll=function(t,i){var o=this._getScrollContainer().get(0);var s=o.scrollLeft;if(!n.browser.edge&&this._bRtl){t=-t}var a=s+t;e(o).stop(true,true).animate({scrollLeft:a},i,e.proxy(this._adjustAndShowArrow,this))};u.prototype._adjustAndShowArrow=function(){this._checkOverflow(this._getScrollContainer().get(0),this.$());if(this.getScrollable()){this._moveArrowAndCounterVertical()}if(this._isFocusChanged){this._setFocusToNode(this._lastNavigationFocusElement);this._isFocusChanged=false}};u.prototype._getScrollingArrow=function(e){var t;if(n.system.desktop){t="sap-icon://navigation-"+e+"-arrow"}else{t="sap-icon://slim-arrow-"+e}var o={src:t};var s="sapPFHArrowScrollLeft";var a="sapPFHArrowScrollRight";var r=["sapPFHArrowScroll",s];var l=["sapPFHArrowScroll",a];if(e===u._constants.left){if(!this._oArrowLeft){this._oArrowLeft=i.ImageHelper.getImageControl(this.getId()+u._constants.arrowScrollLeftMinus,null,this,o,r)}return this._oArrowLeft}if(e===u._constants.right){if(!this._oArrowRight){this._oArrowRight=i.ImageHelper.getImageControl(this.getId()+u._constants.arrowScrollRightMinus,null,this,o,l)}return this._oArrowRight}};u.prototype._checkScrolling=function(e,t){var i=false;if(e){if(e.scrollWidth>e.clientWidth){i=true}}if(this._arrowScrollable!==i){t.toggleClass("sapPFHScrollable",i);t.toggleClass("sapPFHNotScrollable",!i);this._arrowScrollable=i}return i};u.prototype._updateLeftCounter=function(){var e;if(!this._bRtl){e=this._getScrollContainer().scrollLeft()}else{e=this._getScrollContainer().scrollRightRTL()}var t=Math.round(e/this._scrollStep);this.$(u._constants.counterLeft).text(t.toString());return t};u.prototype._updateRightCounter=function(e,t){var i;var o;if(!this._bRtl){i=this._getScrollContainer().scrollLeft();o=Math.round((t-i-e)/this._scrollStep)}else{i=this._getScrollContainer().scrollLeftRTL();o=Math.round(i/this._scrollStep)}this.$(u._constants.counterRight).text(o.toString());return o};u.prototype._moveArrowAndCounterVertical=function(){var e=this._getScrollContainer().scrollTop();if(e>0){var t=this._iInitialArrowTop-e;var i=this._iInitialCounterTop-e;var o=this._iInitialCounterTop-this._iInitialArrowTop;if(t>0){this.$(u._constants.arrowScrollRight).css(u._constants.top,t+u._constants.px);this.$(u._constants.arrowScrollLeft).css(u._constants.top,t+u._constants.px)}else{this.$(u._constants.arrowScrollRight).css(u._constants.top,"0px");this.$(u._constants.arrowScrollLeft).css(u._constants.top,"0px")}if(i>o){this.$(u._constants.counterRight).css(u._constants.top,i+u._constants.px);this.$(u._constants.counterLeft).css(u._constants.top,i+u._constants.px)}else{this.$(u._constants.counterRight).css(u._constants.top,o+u._constants.px);this.$(u._constants.counterLeft).css(u._constants.top,o+u._constants.px)}}else{this.$(u._constants.arrowScrollRight).css(u._constants.top,this._iInitialArrowTop+u._constants.px);this.$(u._constants.arrowScrollLeft).css(u._constants.top,this._iInitialArrowTop+u._constants.px);this.$(u._constants.counterRight).css(u._constants.top,this._iInitialCounterTop+u._constants.px);this.$(u._constants.counterLeft).css(u._constants.top,this._iInitialCounterTop+u._constants.px)}};u.prototype._checkOverflow=function(t,i){if(this._checkScrolling(t,i)&&t){this._setScrollWidth();var o=false;var s=false;var a=20;var n=this._getScrollContainer().scrollLeft();var r=t.scrollWidth;var l=t.clientWidth;if(Math.abs(r-l)===1){r=l}if(!this._bRtl){if(n>a){o=true}if(r>l&&n+l+a<r){s=true}}else{var c=e(t);if(c.scrollLeftRTL()>a){s=true}if(c.scrollRightRTL()>a){o=true}}this._updateLeftCounter();this._updateRightCounter(l,r);if(s!==this._bPreviousScrollForward||o!==this._bPreviousScrollBack){this._bPreviousScrollForward=s;this._bPreviousScrollBack=o;i.toggleClass("sapPFHScrollBack",o);i.toggleClass("sapPFHNoScrollBack",!o);i.toggleClass("sapPFHScrollForward",s);i.toggleClass("sapPFHNoScrollForward",!s)}}else{this._bPreviousScrollForward=false;this._bPreviousScrollBack=false}};u.prototype._setParentForNodes=function(e){var t=e?e.length:0;var i;var o,s;for(var a in e){e[a].removeAllAssociation(u._constants.parents,true)}for(o=0;o<t;o++){i=e[o].getChildren();if(i){for(s=0;s<i.length;s++){var n=this._getNode(u._getChildIdByElement(i[s]),e);if(n){n.addAssociation(u._constants.parents,e[o],true)}}}}};u.prototype._getConnectionsMap=function(){var e=[];var t=this.getNodes();for(var i=0;i<t.length;i++){var o=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,t[i]);var s=t[i].getChildren();if(s){for(var a=0;a<s.length;a++){var n={};n.sourceNode=t[i];var r=u._getChildIdByElement(s[a]);var l=this._getNode(r,t);if(l){if(typeof s[a]==="object"){n.label=s[a].connectionLabel}n.targetNode=l;var c=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,n.targetNode);n.connectionParts=this._calculateConnectionParts(o,c);e.push(n)}}}}this._internalConnectionMap=e;return e};u.prototype._getPositionOfNodeInMatrix=function(e,t){var i={};for(var o=0;o<e.length;o++){var s=e[o];for(var a=0;a<s.length;a++){var n=s[a];if(n&&n.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&n.getNodeId()===t.getNodeId()){i.y=o;i.x=a;return i}}}return i};u.prototype._calculateConnectionParts=function(e,t){var i=[];var o=e.y;var s=e.x;s++;i.push({x:s,y:o});if(t.y>=e.y){while(o<t.y){o++;i.push({x:s,y:o})}}else{while(o>t.y){o--;i.push({x:s,y:o})}}while(s<t.x-1){s++;i.push({x:s,y:o})}return i};u.prototype._getConnectionMapEntries=function(e){var t=[];var i=null;var o=null;if(this._internalConnectionMap){for(var s=0;s<this._internalConnectionMap.length;s++){o=this._internalConnectionMap[s];if(o.label&&o.label.getId()===e.getId()){i=o;break}}o=null;for(var a=0;a<this._internalConnectionMap.length;a++){o=this._internalConnectionMap[a];if(o.targetNode&&o.targetNode.getNodeId()===i.targetNode.getNodeId()){t.push(o)}}}return t};u.prototype._createLabelPressEventArgs=function(e,t){var i={};var o=[];if(t){for(var s=0;s<t.length;s++){var a={sourceNode:t[s].sourceNode,targetNode:t[s].targetNode,label:t[s].label};o.push(a)}}i.selectedLabel=e;i.connections=o;return i};u.prototype.applyNodeDisplayState=function(){var e=this.getNodes(),t=e?e.length:0,i=0;if(t!==0){while(i<t){e[i]._setRegularState();i++}i=0;while(i<t&&!e[i].getHighlighted()&&!e[i].getSelected()){i++}if(i<t){i=0;while(i<t){if(!e[i].getHighlighted()&&!e[i].getSelected()){e[i]._setDimmedState()}i++}}}};u.InternalMatrixCalculation.prototype.checkInputNodeConsistency=function(e){var t=[],i,o,s,a,n,r=0;Object.keys(e).forEach(function(l){n=e[l];a=n.oNode.getChildren();s=a?a.length:0;if(n.oNode.getFocused()){r++}i=0;while(i<s){o=u._getChildIdByElement(a[i]);if(!e[o]){t.push("Node identificator "+o+" used in children definition is not presented as the node itself. Element : "+n.nodeId)}i++}});if(t.length>0){throw t}return r>1};u.InternalMatrixCalculation.prototype.processCurrentElement=function(e,t,i){var o,s,a=true,n=true;if(e.isProcessed){return i}this.nodePositions[e.nodeId]={c:e,x:this.iPositionX,y:this.iPositionY*2};i[this.iPositionX][this.iPositionY++]=e;o=e.oNode.getChildren();e.isProcessed=true;s=this._sortBasedOnChildren(o,t);if(s){s.forEach(function(e){if(!e.isProcessed){n=false;while(this.iPositionY<e.lane){i[this.iPositionX][this.iPositionY++]=null}i=this.processCurrentElement(e,t,i)}else if(a&&n){this.iPositionX++;a=false}}.bind(this))}if(!o||n){if(a){this.iPositionX++}this.iPositionY=0}return i};u.prototype.getZoomLevel=function(){return this._zoomLevel};u.prototype.setZoomLevel=function(e){if(!this._getScrollContainer()){return}var i=this._getScrollContainer();var o=null;var s;if(i.get().length){o={scrollWidth:i.get()[0].scrollWidth,scrollHeight:i.get()[0].scrollHeight,scrollLeft:i.get()[0].scrollLeft,scrollTop:i.get()[0].scrollTop};s=o;if(this._zoomLevel===e){this._isInitialZoomLevelNeeded=false;return}}if(!(e in t.ProcessFlowZoomLevel)){this._handleException('"'+e+'" is not a valid entry of the enumeration for property zoom level of ProcessFlow');return}this._zoomLevel=e;if(this._isInitialZoomLevelNeeded){this._isInitialZoomLevelNeeded=false;this.invalidate()}else{this.rerender()}if(o){if(n.support.touch){var a=parseInt(this._getScrollContainer().css("height").slice(0,-2),10);var r=parseInt(this._getScrollContainer().css("width").slice(0,-2),10);var l=this._getScrollContainer()[0].scrollHeight;var c=this._getScrollContainer()[0].scrollWidth;if(this.getScrollable()&&(l>a||c>r)){this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass);this._getScrollContainer().css("overflow","auto")}}i=this._getScrollContainer();s=this._getScrollContainerOnZoomChanged(o,i);i.scrollLeft(s.scrollLeft);i.scrollTop(s.scrollTop);this._adjustAndShowArrow();if(this._isFocusChanged){this._setFocusToNode();this._isFocusChanged=false}}};u.prototype.zoomOut=function(){var e=this.getZoomLevel();var i=e;switch(e){case t.ProcessFlowZoomLevel.One:i=t.ProcessFlowZoomLevel.Two;break;case t.ProcessFlowZoomLevel.Two:i=t.ProcessFlowZoomLevel.Three;break;case t.ProcessFlowZoomLevel.Three:i=t.ProcessFlowZoomLevel.Four;break;default:break}this.setZoomLevel(i);return this.getZoomLevel()};u.prototype.zoomIn=function(){var e=this.getZoomLevel();var i=e;switch(e){case t.ProcessFlowZoomLevel.Four:i=t.ProcessFlowZoomLevel.Three;break;case t.ProcessFlowZoomLevel.Three:i=t.ProcessFlowZoomLevel.Two;break;case t.ProcessFlowZoomLevel.Two:i=t.ProcessFlowZoomLevel.One;break;default:break}this.setZoomLevel(i);return this.getZoomLevel()};u.prototype.updateModel=function(){this._lastNavigationFocusElement=null;var e=this.getNodes();e.forEach(function(e){e._mergedLaneId=false});var t=this.getLanes();t.forEach(function(e){e._mergedLanePosition=false});this._internalLanes=[];if(this._isHeaderMode()){var i=this.getBindingInfo("lanes");this.getModel(i.model).refresh()}else{var o=this.getBindingInfo("nodes");this.getModel(o.model).refresh()}this.rerender()};u.prototype.optimizeLayout=function(e){if(e===undefined){e=true}if(this._isLayoutOptimized!==e){this._isLayoutOptimized=e;this.updateModel()}return this};u.prototype.getFocusedNode=function(){return this._lastNavigationFocusElement&&this._lastNavigationFocusElement.sId};u.prototype.updateNodesOnly=function(){var e=this.getBindingInfo("nodes");this.getModel(e.model).refresh();this.rerender()};u.prototype.setSelectedPath=function(e,t){var i=this.getNodes(),o;if(i){if(e&&t){var s=0;for(o=0;o<i.length;o++){if(i[o].getNodeId()===e||i[o].getNodeId()===t){i[o].setSelected(true);s++}else{i[o].setSelected(false)}}if(s===2){this.rerender()}}else if(!e&&!t){for(o=0;o<i.length;o++){i[o].setSelected(false)}this.rerender()}}};u.prototype.setShowLabels=function(e){var t=this.getShowLabels();if(t&&!e){this.setProperty("showLabels",e,true);if(!this.getShowLabels()){this.setSelectedPath(null,null)}}else{this.setProperty("showLabels",e)}return this};u.prototype.setFocusToLabel=function(e){this._changeNavigationFocus(this._lastNavigationFocusElement,e)};u.prototype._labelCanGetFocus=function(e){return e&&e.getEnabled()&&(!this._bHighlightedMode||e._bHighlighted)};u.prototype.getNode=function(e){var t=this.getNodes();for(var i=0;i<t.length;i++){if(t[i].getProperty("nodeId")===e){return t[i]}}};u.prototype.getFocusInfo=function(){var e=document.activeElement;if(e&&e.nodeName){return{sFocusId:e.id,oFocusedElement:e,oFocusInfo:{}}}else{return{}}};u.prototype.applyFocusInfo=function(e){if(e.sFocusId){var t=this._lastNavigationFocusElement;this._changeNavigationFocus(null,t)}};u.prototype.getLane=function(e){var t=this.getLanes();for(var i=0;i<t.length;i++){if(t[i].getProperty("laneId")===e){return t[i]}}};u.prototype.removeAllLanes=function(){this.removeAllAggregation("lanes");this._internalLanes=[]};return u});