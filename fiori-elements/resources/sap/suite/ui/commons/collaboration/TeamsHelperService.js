/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Core","sap/base/security/URLListValidator","./CollaborationHelper","sap/suite/ui/commons/collaboration/BaseHelperService","sap/ui/core/Element"],function(e,t,r,a,s,n){"use strict";var i=s.extend("sap.suite.ui.commons.collaboration.TeamsHelperService");var o="db5b69c6-0430-4ae1-8d6e-a65c2220b50c";var l=e.getLogger("sap.suite.ui.commons.collaboration.TeamsHelperService");var p=t.getLibraryResourceBundle("sap.suite.ui.commons");i.prototype.getOptions=function(e){var t={isShareAsLinkEnabled:true,isShareAsTabEnabled:true};var r=e||t;var a=[];var s=[];if(r.isShareAsLinkEnabled){if(this._providerConfig.isShareAsLinkEnabled){a.push({text:p.getText("COLLABORATION_MSTEAMS_CHAT"),key:"COLLABORATION_MSTEAMS_CHAT",icon:"sap-icon://post",fesrStepName:"MST:ShareAsLink"})}else{l.info("Share as Chat option is not enabled in the tenant")}}else{l.info("Consumer disable Share as Chat option")}if(r.isShareAsTabEnabled){if(this._isShareAsTabEnabled()){a.push({text:p.getText("COLLABORATION_MSTEAMS_TAB"),key:"COLLABORATION_MSTEAMS_TAB",icon:"sap-icon://image-viewer",fesrStepName:"MST:ShareAsTab"})}else{l.info("Share as Tab option is not enabled in the tenant")}}else{l.info("Consumer disable Share as Tab option")}if(a.length===1){s=a;if(s[0].key==="COLLABORATION_MSTEAMS_CHAT"){s[0].text=p.getText("COLLABORATION_MSTEAMS_CHAT_SINGLE")}else if(s[0].key==="COLLABORATION_MSTEAMS_TAB"){s[0].text=p.getText("COLLABORATION_MSTEAMS_TAB_SINGLE")}return s}if(a.length>1){s.push({type:"microsoft",text:p.getText("COLLABORATION_MSTEAMS_SHARE"),icon:"sap-icon://collaborate",subOptions:a})}return s};i.prototype.share=function(e,t){if(!t.url){l.error("url is not supplied in object so terminating Click");return}if(!r.validate(t.url)){l.error("Invalid URL supplied");return}if(e.key==="COLLABORATION_MSTEAMS_CHAT"){this._shareAsChat(t);return}if(e.key==="COLLABORATION_MSTEAMS_TAB"){this._shareAsTab(t);return}};i.prototype._shareAsChat=function(e){var t=window.open("","_blank","width=700,height=600");var r=e.appTitle;if(e.subTitle.length>0){r+=": "+e.subTitle}t.opener=null;if(e.minifyUrlForChat){a.compactHash(e.url,[]).then(function(e){t.location="https://teams.microsoft.com/share?msgText="+encodeURIComponent(r)+"&href="+encodeURIComponent(e.url)})}else{t.location="https://teams.microsoft.com/share?msgText="+encodeURIComponent(r)+"&href="+encodeURIComponent(e.url)}};i.prototype._shareAsTab=function(e){var t=sap.ushell&&sap.ushell.Container;var r=t&&t.getService("URLParsing");var a=e.url;var s=a.indexOf("#");if(s!==-1){var n=a.substring(0,s);var i=n.indexOf("?",0);var o="appState=lean&sap-collaboration-teams=true";if(i!==-1){n=n.substring(0,i+1)+o+"&"+n.substring(i+1)}else{n+="?"+o}a=n+a.substring(s);s=a.indexOf("#");var l=r.parseShellHash(a.substring(s));l.params["sap-ushell-navmode"]="explace";l.params["sap-ushell-next-navmode"]="explace";var p=r.constructShellHash(l);a=a.substring(0,s)+"#"+p}var u={subEntityId:{url:a,appTitle:e.appTitle,subTitle:e.subTitle,mode:"tab"}};this._getApplicationID().then(function(e){var t="https://teams.microsoft.com/l/entity/"+e+"/home?&context="+encodeURIComponent(JSON.stringify(u));sap.m.URLHelper.redirect(t,true)})};i.prototype._getApplicationID=function(){var e=sap.ushell&&sap.ushell.Container;var t=e&&e.getService("URLParsing");return a._getCurrentUrl().then(function(e){var r=e.split("#")[0];if(r.indexOf("?")!==-1){var a=t&&t.parseParameters(r.substring(r.indexOf("?")));if(a&&a["sap-collaboration-xx-TeamsAppId"]&&a["sap-collaboration-xx-TeamsAppId"][0]&&a["sap-collaboration-xx-TeamsAppId"][0].length>0){return Promise.resolve(a["sap-collaboration-xx-TeamsAppId"][0])}return Promise.resolve(o)}else{return Promise.resolve(o)}})};i.prototype._isShareAsTabEnabled=function(){if(window["sap-ushell-config"]&&window["sap-ushell-config"].renderers&&window["sap-ushell-config"].renderers.fiori2&&window["sap-ushell-config"].renderers.fiori2.componentData&&window["sap-ushell-config"].renderers.fiori2.componentData.config&&window["sap-ushell-config"].renderers.fiori2.componentData.config.sapHorizonEnabled){return true}return false};return i});