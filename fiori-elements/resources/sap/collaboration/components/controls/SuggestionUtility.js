/*
* ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
*/
sap.ui.define(["sap/ui/base/Object"],function(e){"use strict";var n=e.extend("sap.collaboration.components.controls.SuggestionUtility",{});n.maintainAtMentionIndices=function(e,n){e.startIndex=e.startIndex+n;e.endIndex=e.endIndex+n};n.getChangesInTextArea=function(e,n){if(n!==""){var t=e.length>n.length?e.length:n.length;var r=Math.abs(e.length-n.length);var a=function(n,t){return e.substring(t,t+n)};var i=function(e,t){return n.substring(t,t+e)};for(var s=0;s<t;s++){if(e[s]!==n[s]){return e.length>n.length?{operation:"addChar",charactersChanged:a(r,s),changeIndex:s,numberOfCharsChanged:r}:{operation:"deleteChar",charactersChanged:i(r,s),changeIndex:s,numberOfCharsChanged:r}}}}else{return{operation:"addChar",charactersChanged:e,changeIndex:0}}};n.convertTextWithFullNamesToEmailAliases=function(e,n){var t="";var r=n.length;var a=0;if(r!==0){for(var i=0;i<r;i++){if(n[i].atMentioned){var s="@"+n[i].email.split("@")[0];t=t+e.substring(a,n[i].startIndex)+s}else{t=t+e.substring(a,n[i].endIndex+1)}a=n[i].endIndex+1}t=t+e.substring(n[r-1].endIndex+1,e.length);return t}return e};n.getStringAfterAtMention=function(e,n,t){var r="";var a=e;function i(){while(n[a+1]!==" "&&n[a+1]!==undefined&&n[a+1]!=="\n"){r=r.concat(n[a+1]);a+=1}}i();if(t.atMentioned&&n[a+1]===" "&&n[a+1]<=t.endIndex){r=r.concat(n[a+1]);a+=1;i()}return r};n.getStringBeforeAtMention=function(e,n,t){var r=n.substring(e.startIndex+1,t);return r};n.addToAtMentionBuffer=function(e,n,t){var r=0;var a=e.length;if(a===0){e.push({startIndex:n,endIndex:n+t.length-1,atMentioned:false});r=0}else{for(var i=0;i<a;i++){if(n<=e[i].startIndex){this.maintainAtMentionIndices(e[i],t.length)}}for(var i=a-1;i>=0;i--){if(n>e[i].startIndex){e.splice(i+1,0,{startIndex:n,endIndex:n+t.length-1,atMentioned:false});r=i+1;break}else if(i===0){e.splice(0,0,{startIndex:n,endIndex:n+t.length-1,atMentioned:false});r=0}}}return r};n.isDeletedCharPartOfAtMentioned=function(e,n){var t=e.length;for(var r=0;r<t;r++){if(n>=e[r].startIndex&&n<=e[r].endIndex){return r}}};n.getTextAreaValueAfterSuggestionSelected=function(e,n,t,r,a,i){var s=t.startIndex;var d=t.endIndex;var o=a.length;var l;var u="@notify";if(i){l=a.substr(0,s+1)+u+" "+a.substr(d+1);t.endIndex=s+u.length;t.notifyAll=true}else{l=a.substr(0,s+1)+e+" "+a.substr(d+1);t.endIndex=s+e.length;t.atMentioned=true;t.email=n}var f=l.length;var g=f-o;var h=r.indexOf(t);for(var c=h+1;c<r.length;c++){this.maintainAtMentionIndices(r[c],g)}return l};n.atMentionsButtonPressed=function(e,n){var t;var r=e.slice(0,n);var a=e.slice(n,e.length);var i="";if(e[n-1]===" "||e[n-1]==="\n"||e[n-1]===undefined){i="@";t=n+1}else{i=" @";t=n+2}var s=r+i+a;return{newValue:s,cursorPosition:t}};return n});