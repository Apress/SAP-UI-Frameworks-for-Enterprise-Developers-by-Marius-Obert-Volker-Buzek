/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(["sap/collaboration/components/utils/CommonUtil","sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/SelectDialog","sap/m/StandardListItem","sap/m/library","sap/ui/model/json/JSONModel","sap/m/Bar","sap/m/Button","sap/m/Label","sap/m/Dialog","sap/ui/Device","sap/ui/core/mvc/View","sap/ui/core/library"],function(e,t,o,i,n,l,r,a,s,c,g,d,u,h,S){"use strict";var p=S.mvc.ViewType;var F=r.ButtonType;var m=r.ListType;var D=t.extend("sap.collaboration.components.fiori.sharing.helper.AttachmentsUtil",{constructor:function(t,o,i){this.oCommonUtil=new e;this.oLangBundle=t;this.oODataUtil=o;this.oJamODataModel=i},createFileSelectionDialog:function(e,t,r,a,s){var c=function(e){var t=e.getParameter("value");var n=new o("name",i.Contains,t);var l=e.getSource().getBinding("items");l.filter([n])};this.oFileSelectionDialog=new n(e+"_FileSelectionDialog",{multiSelect:true,rememberSelections:true,title:this.oLangBundle.getText("ATTACHMENTS_FIELD_TEXT",[""]),confirm:r,search:c,liveChange:c});if(a){this.oFileSelectionDialog.setContentWidth(a.toString()+"px")}if(s){this.oFileSelectionDialog.setContentHeight(s.toString()+"px")}var g=new l({title:"{name}",icon:"{icon}",iconDensityAware:false,iconInset:true,type:m.Active});this.oFileSelectionDialog.setModel(t);this.oFileSelectionDialog.bindAggregation("items","/attachments",g);return this.oFileSelectionDialog},createAttachmentsModel:function(e){var t=[];for(var o=0;o<e.length;o++){t.push({name:e[o].getName(),mimeType:e[o].getMimeType(),url:e[o].getUrl(),icon:this.oCommonUtil.getIconFromMimeType(e[o].getMimeType())})}var i=new a({attachments:t});return i},createFolderSelectionDialog:function(e,t,o,i,n,l){var r=this;var a=function(e){r.oFolderSelectionDialog.getContent()[0].getController().navigateBack()};var h=new s(e+"_FolderSelectionDialogHeaderBar",{contentLeft:[new c(e+"_FolderSelectionDialogHeaderBarBackButton",{type:F.Back,visible:false,press:a})],contentMiddle:[new g(e+"_FolderSelectionDialogHeaderBarTitle",{text:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT")})]});var S=new c(e+"_FolderSelectionDialogOKButton",{text:this.oLangBundle.getText("OK_BUTTON_TEXT"),press:function(e){o(e);r.oFolderSelectionDialog.close()}});var p=new c(e+"_FolderSelectionDialogCancelButton",{text:this.oLangBundle.getText("CANCEL_BUTTON_TEXT"),press:function(e){i(e);r.oFolderSelectionDialog.close()}});this.oFolderSelectionDialog=new d(e+"_FolderSelectionDialog",{beginButton:S,endButton:p,customHeader:h}).addStyleClass("sapUiPopupWithPadding");var m=this.createFolderSelectionView(e,t,n,l);this.oFolderSelectionDialog.addContent(m);if(u.system.phone){this.oFolderSelectionDialog.setStretch(true)}return this.oFolderSelectionDialog},createFolderSelectionView:function(e,t,o,i){var n=sap.ui.view({id:e+"_FolderSelectionView",viewData:{controlId:e,groupId:t,languageBundle:this.oLangBundle,oDataUtil:this.oODataUtil,oDataModel:this.oJamODataModel,folderSelectionDialog:this.oFolderSelectionDialog},type:p.JS,viewName:"sap.collaboration.components.fiori.sharing.FolderSelection"});if(o){n.setWidth(o.toString()+"px")}if(i){n.setHeight(i.toString()+"px")}return n},getCurrentFolder:function(){if(this.oFolderSelectionDialog){return this.oFolderSelectionDialog.getContent()[0].getController().getCurrentFolder()}return{name:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT"),id:""}},getCurrentGroupId:function(){return this.oFolderSelectionDialog.getContent()[0].getController().sGroupId},resetFolderSelection:function(e){if(this.oFolderSelectionDialog){this.oFolderSelectionDialog.getContent()[0].getController().sGroupId=e;this.oFolderSelectionDialog.getContent()[0].getController().sCurrentFolderId="";this.oFolderSelectionDialog.getContent()[0].getController().aFolderBuffer=[]}},setCurrentFolderId:function(e){this.oFolderSelectionDialog.getContent()[0].getController().sCurrentFolderId=e}});return D});