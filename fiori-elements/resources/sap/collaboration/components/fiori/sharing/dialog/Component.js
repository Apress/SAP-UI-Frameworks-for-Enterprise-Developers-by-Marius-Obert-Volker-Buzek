/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/collaboration/components/utils/CommonUtil","sap/ui/core/UIComponent","sap/ui/core/mvc/View","sap/ui/core/library","sap/m/Dialog","sap/m/Button","sap/ui/Device"],function(t,e,i,o,a,s,n,r){"use strict";var h=a.mvc.ViewType;var g=i.extend("sap.collaboration.components.fiori.sharing.dialog.Component",{metadata:{includes:["../../../resources/css/Sharing.css"],properties:{attachments:{type:"object"},object:{type:"object"},externalObject:{type:"object"}},aggregations:{},events:{}},systemSettings:{width:"400px",height:"",oDataServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV",collaborationHostODataServiceUrl:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData",collaborationHostRestService:{url:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1",urlParams:""}},init:function(){this.oCommonUtil=new e;this.oLangBundle=this.oCommonUtil.getLanguageBundle()},setSettings:function(t){this.setObject(t.object);this.setAttachments(t.attachments);if(JSON.stringify(t.externalObject)==="{}"){this.setExternalObject(undefined)}else{this.setExternalObject(t.externalObject)}},_createSharingView:function(){var t=this;var e;var i;var o;var a=this.getObject();if(a){o=t._handleObjectId(a.id);e=a.display;i=a.share}var s=function(){t.close();t.openoNoGroupsDialog(t.oSharingView.getController().sJamUrl)};if(!this.oSharingView){this.oSharingView=sap.ui.view({id:this.getId()+"_SharingView",viewData:{controlId:this.getId(),odataServiceUrl:this.systemSettings.oDataServiceUrl,collaborationHostODataServiceUrl:this.systemSettings.collaborationHostODataServiceUrl,collaborationHostRestService:this.systemSettings.collaborationHostRestService,langBundle:this.oLangBundle,jamGroups:this.aJamGroups,sharingDialog:this._oSharingDialog,noGroupsCallBack:s,objectDisplay:e,objectShare:i,objectId:o,attachments:this.getAttachments(),externalObject:this.getExternalObject()},type:h.JS,viewName:"sap.collaboration.components.fiori.sharing.Sharing"})}else{this.oSharingView.getViewData().objectId=o;this.oSharingView.getViewData().objectShare=i;this.oSharingView.getViewData().objectDisplay=e;this.oSharingView.getViewData().externalObject=this.getExternalObject();this.oSharingView.getViewData().attachments=this.getAttachments()}},_createSharingDialog:function(){var t=new s(this.getId()+"_SharingDialog",{title:this.oLangBundle.getText("SHARING_PAGE_TITLE"),contentWidth:this.systemSettings.width,stretch:false,afterClose:function(){}}).addStyleClass("sapUiPopupWithPadding");return t},createNoGroupsDialog:function(t){if(!this.oNoGroupsView){this.oNoGroupsView=sap.ui.view({id:this.getId()+"_NoGroupsView",viewData:{controlId:this.getId(),langBundle:this.oLangBundle,jamUrl:t},type:h.JS,viewName:"sap.collaboration.components.fiori.sharing.NoGroups"})}var e=new s(this.getId()+"_NoGroupsDialog",{title:this.oLangBundle.getText("SHARING_PAGE_TITLE"),stretch:false,content:this.oNoGroupsView,beginButton:new n(this.getId()+"_CloseButton",{text:this.oLangBundle.getText("CLOSE_BUTTON_TEXT"),press:function(){e.close()}})}).addStyleClass("sapUiPopupWithPadding");return e},open:function(){if(this.bStopRendering===undefined||this.bStopRendering===false){if(!this._oSharingDialog){this._logComponentProperties();this._oSharingDialog=this._createSharingDialog()}try{this._createSharingView();this._oSharingDialog.addAriaLabelledBy(this.getId()+"_SharingView");this._oSharingDialog.addContent(this.oSharingView);this._oSharingDialog.setInitialFocus(this.oSharingView);this._createDialogButtons();if(r.system.phone){this._oSharingDialog.setStretch(true)}this._oSharingDialog.open()}catch(e){t.error(e);this.oCommonUtil.displayError()}}},close:function(){if(this._oSharingDialog){this._oSharingDialog.close()}},openoNoGroupsDialog:function(t){this._oSharingDialog.removeAllContent();if(!this.oNoGroupsDialog){this.oNoGroupsDialog=this.createNoGroupsDialog(t)}this.oNoGroupsDialog.open()},_createDialogButtons:function(){if(!this.oMentionButton){this.oMentionButton=new n(this.getId()+"_mentionButton",{text:"@",enabled:false,press:[function(){this.oSharingView.getController().atMentionsButtonPressed()},this]});this._oSharingDialog.addButton(this.oMentionButton)}if(r.system.phone){this.oMentionButton.setVisible(false)}if(!this.oLeftButton){this.oLeftButton=new n(this.getId()+"_LeftButton",{text:this.oLangBundle.getText("OK_BUTTON_TEXT"),enabled:false,press:[function(){this.oSharingView.getController().shareToJam();this._oSharingDialog.close()},this]});this._oSharingDialog.addButton(this.oLeftButton)}if(!this.oRightButton){this.oRightButton=new n(this.getId()+"_RightButton",{text:this.oLangBundle.getText("CANCEL_BUTTON_TEXT"),press:[function(){this._oSharingDialog.close()},this]});this._oSharingDialog.addButton(this.oRightButton)}},setDialogButtons:function(){},setCloseButton:function(){this._oSharingDialog.destroyBeginButton();this._oSharingDialog.setEndButton(this.oCloseButton)},_handleObjectId:function(e){var i=typeof e;var o;switch(i){case"undefined":case"":case"string":o=e;break;case"function":o=e();if(typeof o=="string"){break}default:t.error("object->id is not a sting or callback function that returns a string");throw new Error}return o},_logComponentProperties:function(){t.debug("Share Component properties:","","sap.collaboration.components.fiori.sharing.Component._logComponentProperties()");t.debug("width: "+this.systemSettings.width);t.debug("height: "+this.systemSettings.height);t.debug("oDataServiceUrl: "+this.systemSettings.oDataServiceUrl);t.debug("collaborationHostODataServiceUrl: "+this.systemSettings.collaborationHostODataServiceUrl);t.debug("collaborationHostRestService: "+this.systemSettings.collaborationHostRestService.url+this.systemSettings.collaborationHostRestService.urlParams);if(this.getObject()){t.debug("object->id: "+this.getObject().id);t.debug("object->display: "+this.getObject().display);t.debug("object->share: "+this.getObject().share)}else{t.debug("object: undefined")}if(this.getAttachments()&&this.getAttachments().attachmentsArray){t.debug("Attachments:");var e=this.getAttachments().attachmentsArray;for(var i=0;i<e.length;i++){t.debug("Attachments"+(i+1)+":");t.debug(e[i].mimeType);t.debug(e[i].name);t.debug(e[i].url)}}else{t.debug("attachments: undefined")}if(this.getExternalObject()){t.debug("externalObject->appContext: "+this.getExternalObject().appContext);t.debug("externalObject->odataServicePath: "+this.getExternalObject().odataServicePath);t.debug("externalObject->collection: "+this.getExternalObject().collection);t.debug("externalObject->key: "+this.getExternalObject().key);t.debug("object->name: "+this.getExternalObject().name);t.debug("object->summary: "+this.getExternalObject().summary)}else{t.debug("externalObject: undefined")}}});return g});