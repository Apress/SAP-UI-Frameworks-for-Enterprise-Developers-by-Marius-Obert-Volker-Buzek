//Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ushell/library","sap/ushell/Config","sap/ushell/resources","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/utils/AppType"],function(e,t,i,s,n,c,o,r,l,a){"use strict";var u=n.AppType;var h={oModel:new s({recentActivities:[],frequentActivities:[]}),_createQuickAccessDialog:function(s){return t.load({name:"sap.ushell.ui.QuickAccess",type:"XML",controller:this}).then(function(t){this.oQuickAccessDialog=t;this.oQuickAccessDialog.setModel(this.oModel);this.oQuickAccessDialog.attachAfterClose(function(){this.oQuickAccessDialog.destroy();if(i.system.desktop){var t=e.byId(s);if(t){t.focus()}else{sap.ui.require(["sap/ushell/components/ComponentKeysHandler"],function(e){e.getInstance().then(function(e){e.goToLastVisitedTile()})})}}}.bind(this));e.byId("shell").addDependent(this.oQuickAccessDialog);return this.oQuickAccessDialog}.bind(this))},_updateQuickAccessDialog:function(e){var t=e.getContent()[0];t.setBusy(true);return sap.ushell.Container.getServiceAsync("UserRecents").then(function(e){return Promise.all([new Promise(function(t){e.getRecentActivity().then(function(e){t(e.map(function(e){e.timestamp=r.formatDate(e.timestamp);return e}))},function(){t([])})}),new Promise(function(t){e.getFrequentActivity().then(function(e){t(e)},function(){t([])})})])}).then(function(i){var s=i[0];var n=i[1];this.oModel.setData({recentActivities:s,frequentActivities:n});this._setDialogContentHeight(e,Math.max(s.length,n.length));t.setBusy(false)}.bind(this))},_setDialogContentHeight:function(e,t){var i=(t+.5)*4+2.75;if(i<18){i=18}else if(i>42){i=42}e.setContentHeight(i+"rem")},_closeDialog:function(){this.oQuickAccessDialog.close()},_titleFormatter:function(e,t){if(t===u.SEARCH){e='"'+e+'"'}return e},_descriptionFormatter:function(e){if(e===u.SEARCH){return o.i18n.getText("recentActivitiesSearchDescription")}return a.getDisplayName(e)},_itemPress:function(e){var t=e.getParameter("listItem").getBindingContextPath();var i=this.oModel.getProperty(t);if(i.url[0]==="#"){window.hasher.setHash(i.url);this._closeDialog()}else{var s=c.last("/core/shell/enableRecentActivity")&&c.last("/core/shell/enableRecentActivityLogging");if(s){var n={title:i.title,appType:u.URL,url:i.url,appId:i.url};sap.ushell.Container.getRenderer("fiori2").logRecentActivity(n)}l.openURL(i.url,"_blank")}}};return{openQuickAccessDialog:function(e,t){return h._createQuickAccessDialog(t).then(function(t){var i=t.getContent()[0];h._updateQuickAccessDialog(t);i.setSelectedKey(e);t.open()})},_getQuickAccess:function(){return h}}});