// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/integration/Extension","sap/ushell/utils/UrlParsing","sap/ushell/utils/AppType","sap/ushell/library","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/resources"],function(e,t,n,i,r,s,a){"use strict";var o=i.AppType;function c(e,t){if(t===o.SEARCH){return'"'+e+'"'}return e}function u(e){if(e===o.SEARCH){return a.i18n.getText("recentActivitiesSearchDescription")}return n.getDisplayName(e)}return e.extend("sap.ushell.ui.cards.RecentActivitiesExtension",{init:function(){e.prototype.init.apply(this,arguments);this.oUserRecentsPromise=sap.ushell.Container.getServiceAsync("UserRecents");this.oCrossAppNavPromise=sap.ushell.Container.getServiceAsync("CrossApplicationNavigation")},exit:function(){e.prototype.exit.apply(this,arguments);s.on("newUserRecentsItem").off();s.on("userRecentsCleared").off()},onCardReady:function(){s.on("newUserRecentsItem").do(function(){this.getCard().refreshData()}.bind(this));s.on("userRecentsCleared").do(function(){this.getCard().refreshData()}.bind(this))},getData:function(){if(!r.last("/core/shell/model/enableTrackingActivity")){return Promise.resolve([])}return this.oUserRecentsPromise.then(function(e){return new Promise(function(t,n){e.getRecentActivity().done(t).fail(n)})}).then(this._getActivitiesAsCardItems.bind(this)).then(this._checkEnabled.bind(this))},_getActivitiesAsCardItems:function(e){var n=[];for(var i=0;i<e.length;i++){if(e[i].url&&e[i].url!==""){var r=t.parseShellHash(e[i].url);var s={Name:c(e[i].title,e[i].appType),Description:u(e[i].appType),Icon:e[i].icon||"sap-icon://product",Url:e[i].url};if(r){s.Intent={SemanticObject:r.semanticObject,Action:r.action,Parameters:r.params,AppSpecificRoute:r.appSpecificRoute}}else{s.Url=e[i].url}n.push(s)}}return n},_checkEnabled:function(e){var t=e.map(function(e){return this._isActionEnabled(e).then(function(t){e.Enabled=t;return e})}.bind(this));return Promise.all(t)},_isActionEnabled:function(e){var n=t.parseShellHash(e.Url);if(!n){return Promise.resolve(true)}var i=n.params;var r={target:{semanticObject:n.semanticObject,action:n.action},params:i};return this.oCrossAppNavPromise.then(function(e){return new Promise(function(t){e.isNavigationSupported([r]).done(function(e){t(e[0].supported)}).fail(function(){t(false)})})})}})});