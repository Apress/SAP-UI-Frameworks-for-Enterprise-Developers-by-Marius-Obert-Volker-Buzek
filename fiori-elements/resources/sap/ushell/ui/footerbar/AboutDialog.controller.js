// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ushell/services/AppConfiguration","sap/ushell/Config","sap/ushell/resources","sap/base/Log","sap/base/util/isEmptyObject","sap/ui/Device"],function(e,t,n,o,i,r,a,s,l){"use strict";return e.extend("sap.ushell.ui.footerbar.AboutDialog.controller",{onBeforeOpen:function(){this._setupAboutDialogModel()},onClose:function(){this._getDialog().close()},onAfterClose:function(){this._getDialog().destroy()},_getDialog:function(){if(!this.oAboutDialog){this.oAboutDialog=t.byId("aboutDialogFragment","aboutDialog")}return this.oAboutDialog},_setupAboutDialogModel:function(){this._setupAppInfoModel().catch(function(e){a.error("Failed to setup application info model.",e)});var e=this._getDialog(),t=this._getSystemInformation(),o=this._getUserEnvironmentInformation(),i=new n(t),r=new n(o);e.setModel(i,"SysInfo");e.setModel(r,"UserEnvInfo")},_setupAppInfoModel:function(){var e=["appId","appVersion","appSupportInfo","technicalAppComponentId","appFrameworkId","appFrameworkVersion","appTitle"],t=this._getDialog();return new Promise(function(i,r){sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(t){var n=t.getCurrentApplication();return Promise.all([n.getInfo(e),this._getContentProviderLabel(n)])}.bind(this)).then(function(r){var a=o.getMetadata(),s=r[0]||{},l=r[1];e=e.concat(["contentProviderLabel"]);s.appTitle=s.appTitle&&typeof s.appTitle==="string"&&s.appTitle.length>0?s.appTitle:a.title;s.contentProviderLabel=l;var u=this._buildApplicationInformationObject(e,s);t.setModel(new n(u),"AppInfo");i()}.bind(this)).catch(function(e){r(e)})}.bind(this))},_buildApplicationInformationObject:function(e,t){var n={},o;for(var i=0;i<e.length;i++){o=e[i];if(t[o]){n[o]={label:r.i18n.getText(o),text:t[o]}}}return n},_getSystemInformation:function(){var e=sap.ushell.Container.getLogonSystem(),t=e.getProductName(),n=e.getProductVersion(),o=e.getSystemName(),i=e.getSystemRole(),a=e.getTenantRole(),s={};if(t){s.productName={label:r.i18n.getText("productName"),text:t}}if(n){s.productVersion={label:r.i18n.getText("productVersionFld"),text:n}}if(o){s.systemName={label:r.i18n.getText("systemName"),text:o}}if(i){s.systemRole={label:r.i18n.getText("systemRole"),text:i}}if(a){s.tenantRole={label:r.i18n.getText("tenantRole"),text:a}}return s},_getUserEnvironmentInformation:function(){var e={};e.userAgentFld={label:r.i18n.getText("userAgentFld"),text:navigator.userAgent};var t=this._getDeviceType(),n=this._isTouchSupported(),o=sap.ushell.Container.getUser(),i=o.getTheme(),a=o.getContentDensity()==="cozy";if(t){e.deviceType={label:r.i18n.getText("deviceType"),text:t}}e.touchSupported={label:r.i18n.getText("touchSupported"),text:n?r.i18n.getText("yes"):r.i18n.getText("no")};e.activeTheme={label:r.i18n.getText("activeTheme"),text:i};e.optimizedForTouch={label:r.i18n.getText("AppearanceContentDensityLabel"),text:a?r.i18n.getText("yes"):r.i18n.getText("no")};return e},_getContentProviderLabel:function(e){if(i.last("/core/contentProviders/providerInfo/enabled")){return e.getSystemContext().then(function(e){return e.label})}return Promise.resolve(undefined)},_getDeviceType:function(){var e;if(l.system.combi){e=r.i18n.getText("configuration.form_factor_combi")}else if(l.system.desktop){e=r.i18n.getText("configuration.form_factor_desktop")}else if(l.system.tablet){e=r.i18n.getText("configuration.form_factor_tablet")}else if(l.system.phone){e=r.i18n.getText("configuration.form_factor_phone")}return e},_isTouchSupported:function(){return l.support.touch&&(l.system.tablet||l.system.phone||l.system.combi)},calculateNumberOfColumns:function(e){if(!this.isFormVisible(e)){return 1}return Object.keys(e).length>1?2:1},isFormVisible:function(e){return!!e&&!s(e)}})});