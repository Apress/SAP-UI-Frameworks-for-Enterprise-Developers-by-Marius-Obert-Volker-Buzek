// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ushell/services/AppConfiguration","sap/base/util/restricted/_curry","sap/base/util/restricted/_zipObject","sap/ui/VersionInfo","sap/ushell/Config","sap/ushell/TechnicalParameters"],function(e,n,t,r,i,a,u){"use strict";var o="LAUNCHPAD";function p(e){var n=e.applicationType;if(n==="TR"){n="GUI"}return n}function f(){return n.getCurrentApplication()&&n.getCurrentApplication().appCapabilities||{}}function s(n){function t(e){return(e.version||"")+(" ("+(e.buildTimestamp||"")+")")||""}if(p(n)==="UI5"){return i.load().then(t).catch(function(){e.error("VersionInfo could not be loaded")})}return undefined}function c(e){return Promise.resolve().then(function(){var n=e.componentInstance;if(n){var t=n.getManifestEntry("/sap.app/applicationVersion/version");return t}return undefined})}function l(e){var n=e.getTechnicalParameter("sap-ach");return n.then(function(e){var n=e&&e[0];if(n){return n}return f().appSupportInfo})}function v(e){function t(){var e=n.getMetadata();return e.technicalName}var r={UI5:function(){var n=e.componentInstance;if(n){var r=n.getMetadata().getManifestEntry("/sap.ui5/componentName");if(!r){r=n.getMetadata().getComponentName()}return r}return t()},TR:function(){return(t()||"").replace(/\s[(]TCODE[)]$/,"")},WDA:t,NWBC:t,URL:function(){return Promise.resolve().then(function(){var e=n.getCurrentApplication();if(e.appCapabilities.technicalAppComponentId){return e.appCapabilities.technicalAppComponentId}return undefined})}};var i=e.applicationType;if(r.hasOwnProperty(i)){return r[i]()}return undefined}function d(e){var n="";return e.getTechnicalParameter("sap-fiori-id").then(function(t){if(e.homePage){if(t&&typeof t[0]==="string"){if(t[0]!==""){n=o+" ("+t[0]+")"}else{n=o}}else{n=o}}else if(t&&typeof t[0]==="string"){n=t[0]}else{n=f().appId||e.inboundPermanentKey}return n})}function m(e){return sap.ushell.Container.getServiceAsync("ReferenceResolver").then(function(n){return new Promise(function(t,r){n.resolveReferences([e]).then(function(n){t(n[e])}).catch(r)})})}function h(e){return Promise.resolve().then(function(){var t=n.getCurrentApplication();var r=p(e);if(r&&r!=="URL"){return r}return t.appCapabilities&&t.appCapabilities.appFrameworkId}).then(function(e){var n={NWBC:"WDA",TR:"GUI"};return n[e]||e})}function g(e,n){return n.getSystemContext().then(function(n){return n.getProperty(e)})}function P(){var e=window.hasher&&window.hasher.getHash();if(!e){return Promise.reject("Could not identify current application hash")}return Promise.resolve().then(function(){return e})}var C={theme:m.bind(null,"User.env.sap-theme-NWBC"),languageTag:m.bind(null,"User.env.sap-languagebcp47"),appIntent:P,appFrameworkId:h,appFrameworkVersion:s,appSupportInfo:l,technicalAppComponentId:v,appId:d,appVersion:c,productName:t(g)("productName")};function I(e){return!C[e]&&/[.]/.test(e)}function b(e,n,t,r,i){return new Promise(function(a){var o={};for(var p in w()){if(e){o[p]=w()[p].value}else{o[p]=w()[p]}}var f={},s=[];s.push(A(["appFrameworkId"],n).then(function(){return A(Object.keys(C),n)}));s.push(u.getTechnicalParametersAppInfo(t,r,i));Promise.allSettled(s).then(function(n){if(n[0].status==="fulfilled"){for(var t in n[0].value){if(n[0].value[t]!==undefined){if(e){f[t]=n[0].value[t]}else{f[t]={value:n[0].value[t]}}}}}if(n[1].status==="fulfilled"){for(var r in n[1].value){if(!o.hasOwnProperty(r)){if(n[1].value[r].value&&n[1].value[r].value[0]!==undefined){if(e){f[r]=n[1].value[r].value[0]}else{f[r]={value:n[1].value[r].value[0]}}}}}}o=Object.assign(f,o);a(o)})})}function A(n,i){var a=n.map(function(n){if(N(n)){return Promise.resolve(U(n))}if(I(n)){C[n]=t(g)(n)}if(!C[n]){e.error(n+" is not a valid app info parameter");return undefined}return C[n](i)});return Promise.all(a).then(function(e){return r(n,e)})}var y={};function w(){return y}function T(e){if(e===undefined||Object.keys(e).length===0){y={};return}for(var n in e.info){if(n!=="customProperties"){y[n]={value:e.info[n]}}}for(var t in e.info.customProperties){y[t]=e.info.customProperties[t]}}function N(e){return y.hasOwnProperty(e)}function U(e){if(N(e)){return y[e].value}return undefined}return{getInfo:function(e,n){if(!n){return Promise.reject("Parameter application missing")}return A(["appFrameworkId"],n).then(function(){return A(e,n)})},getCustomValue:U,isAttributeExist:N,setCustomAttributes:T,getAllAppInfo:b}},false);