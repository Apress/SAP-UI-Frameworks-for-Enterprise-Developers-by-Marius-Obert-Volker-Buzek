// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Core","sap/ui/core/support/Plugin","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/Label","sap/m/Text","sap/m/MessageStrip","sap/m/FlexBox","sap/ui/model/resource/ResourceModel","sap/m/SearchField","sap/m/MessageBox","sap/base/util/isEmptyObject"],function(e,t,n,r,i,a,o,s,u,p,l,f,c,g){"use strict";var d;var y=t.extend("sap.ushell.support.plugins.flpConfig.FlpConfigurationPlugin",{constructor:function(e){d=new l({bundleName:"sap/ushell/support/plugins/flpConfig/i18n/FlpConfigurationPlugin"});t.apply(this,["sapUiFlpConfigurationPlugin",d.getResourceBundle().getText("PLUGIN_NAME"),e]);this._oSupportStub=e;if(this.runsAsToolPlugin()){this._aEventIds=[this.getId()+"ReceiveData"]}else{this._aEventIds=[this.getId()+"RequestData"]}}});y.prototype.isToolPlugin=function(){return true};y.prototype.isAppPlugin=function(){return true};y.prototype.init=function(){t.prototype.init.apply(this,arguments);if(this.runsAsToolPlugin()){setTimeout(function(){this.requestData()}.bind(this),500);var n=e.createRenderManager();n.openStart("div",this.getId());n.openEnd();n.close("div");n.flush(this.dom());n.destroy()}else{}};y.prototype.exit=function(){t.prototype.exit.apply(this,arguments)};y.prototype.requestData=function(){this._oSupportStub.sendEvent(this.getId()+"RequestData",{eventData:{data:{}}})};y.prototype.onsapUiFlpConfigurationPluginRequestData=function(e){var t={};this.prepareForSending(window["sap-ushell-config"],t);this._oSupportStub.sendEvent(this.getId()+"ReceiveData",{eventData:{data:t}})};y.prototype.onsapUiFlpConfigurationPluginReceiveData=function(t){this.flpConfig=t.getParameter("eventData").data;e.loadLibrary("sap.ui.table",{async:true}).then(function(){sap.ui.require(["sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/table/library"],function(e,t,n){this.getFlpConfigurationPluginUI(null,e,t,n.SelectionMode)}.bind(this))}.bind(this))};function h(){var t=0;var n=e.byId("sap-ui-support-flpConfigurationPlugin-TabBar").getSelectedKey();var r=e.byId("sap-ui-support-flpConfigurationPlugin-TabBar").getModel().getData();if(Array.isArray(r[n])){r[n].forEach(function(e,i){var a=v(r[n][i],n);if(t<a){t=a}});if(t>0){e.byId("sap-ui-support-flpConfigurationPlugin-TreeTable"+n).expandToLevel(t-1)}else{c.error(new o({text:e.byId("sap-ui-support-flpConfigurationPlugin-TabBar").getModel("i18n").getResourceBundle().getText("MISSING_HIERARCHY_LEVEL")}))}}}function b(){var t=e.byId("sap-ui-support-flpConfigurationPlugin-TabBar").getSelectedKey();e.byId("sap-ui-support-flpConfigurationPlugin-TreeTable"+t).collapseAll()}y.prototype.onPressSearchNewModel=function(t){var r;var i;var a;var o;var s;var u;var p;var l;var f;var c=[];var g={};var d="";var y={};var h={};var b=e.byId("sap-ui-support-flpConfigurationPlugin-TabBar").getModel("Full");var E=t.getParameter("query");if(!b){b=e.byId("sap-ui-support-flpConfigurationPlugin-TabBar").getModel().getData()}else{b=b.getData()}Object.keys(b).forEach(function(e){g[e]=0});if(E){for(var S in b){d=S;r=[];w(b[S],S,d,r,E);h[S]=r}Object.keys(h).forEach(function(e){o=h[e];for(var t=0;t<o.length;t++){s=o[t].split(".");u=[];for(var n=0;n<s.length;n++){if(!isNaN(parseInt(s[n],10))){u.push(parseInt(s[n],10))}else{u.push(s[n])}}for(var r=0;r<u.length;r+=2){p={property:""};p[u[0]]=[];if(isNaN(parseInt(u[r],10))){i=u.slice(0,r+1);if(!I(y,i)&&typeof I(y,u.slice(0,u.length-2))!=="object"){P(y,i,[p],u[0],i.length)}f=I(b,u.slice(0,r+2));if(f&&I(y,u.slice(0,r+2))){T(y,f.property,u.slice(0,r+2).toString()+",property")}else if(r!==u.length-2){c.push(u.slice(0,r+2).toString())}}}a=u.slice(0);P(y,u,{property:"",value:""},u[0],i.length);f=I(b,a);if(f){T(y,f.value,a.toString()+",value");T(y,f.property,a.toString()+",property")}}c.forEach(function(e){f=I(b,e.split(","));if(f&&I(y,e.split(","))){T(y,f.property,e+",property")}});c=[];if(y[e]&&Array.isArray(y[e][0][e])&&y[e][0][e].length===0){y[e]=y[e].splice(1)}});e.byId("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new n(y));e.byId("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new n(b),"Full");var x=0;Object.keys(g).forEach(function(t){l=t;if(y[l]&&Array.isArray(y[l])){y[l].forEach(function(e,t){var n=v(y[l][t],l);if(x<n){x=n}})}e.byId("sap-ui-support-flpConfigurationPlugin-TreeTable"+t).expandToLevel(x-1);e.byId(t).setCount(C(y[t],t,0))})}else{Object.keys(g).forEach(function(t){e.byId(t).setCount(C(b[t],t,0))});e.byId("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new n(b))}};function v(e,t){var n=0;if(e[t]){e[t].forEach(function(e){var r=v(e,t);if(r>n){n=r}})}return n+1}function I(e,t){for(var n=0;n<t.length;n++){if(e){e=e[t[n]]}}return e}function C(e,t,n){if(Array.isArray(e)){e.forEach(function(e){if(e[t]){n=C(e[t],t,n)}else{n+=1}});return n}return undefined}function T(e,t,n){var r=n.split(",");for(var i=0;i<r.length-1;i++){e=e[r[i]]}e[r[r.length-1]]=t}function P(e,t,n,r,i){if(t.length===1){e[t[0]]=n}else{var a=t.shift();e[a]=P(typeof e[a]==="undefined"?{}:e[a],t,n,r,i)}if(e[r]&&e.property&&e.value){delete e.value;e.property=""}return e}function w(e,t,n,r,i){e.forEach(function(e,a){if(e[t]){n=n+"."+a+"."+t;n=w(e[t],t,n,r,i)}else if(e.property.indexOf(i)>-1){n=n+"."+a;r.push(n);n=n.substring(0,n.lastIndexOf("."))}});n=n.substring(0,n.lastIndexOf("."));if(isNaN(parseInt(n.substr(n.lastIndexOf(".")+1),10))){return n}return n.substring(0,n.lastIndexOf("."))}function E(e,t){if(typeof e!=="object"){return[{property:t,value:e}]}return Object.keys(e).map(function(n){var r={property:n};var i=e[n];if(typeof i==="object"&&i!==null&&!g(i)&&!Array.isArray(i)){r[t]=E(i,t);return r}else{try{r.value=JSON.stringify(i)}catch(e){r.value=i}}return r})}y.prototype.prepareForSending=function(e,t){Object.keys(e).forEach(function(n){var r=e[n];switch(typeof r){case"object":if(r===null){t[n]=r;return}else if(Array.isArray(r)){t[n]=[]}else{t[n]={}}this.prepareForSending(e[n],t[n]);break;case"undefined":t[n]="undefined";return;case"function":return;default:t[n]=e[n];return}}.bind(this))};y.prototype.getNewConfigJSON=function(e){var t={};Object.keys(e).forEach(function(n){t[n]=E(e[n],n)});return t};y.prototype.getFlpConfigurationPluginUI=function(t,l,c,y){var v,I,T,P={};T=this.getNewConfigJSON(this.flpConfig);v=new n(T);for(var w in T){P[w]=C(T[w],w,0)}if(!e.byId("sap-ui-support-flpConfigurationPlugin-TabBar")){if(!T||g(T)){new u({text:d.getResourceBundle().getText("ERROR_MESSAGE"),type:"Warning",showIcon:true,showCloseButton:false}).placeAt(this.getId())}else{I=new i("sap-ui-support-flpConfigurationPlugin-TabBar",{headerMode:"Inline"});Object.keys(this.flpConfig).forEach(function(e,t){I.insertItem(new a(e,{key:e,text:e,count:P[e],content:[new l("sap-ui-support-flpConfigurationPlugin-TreeTable"+e,{rows:"{/"+e+"/}",selectionMode:y.None,enableCellFilter:true,extension:[new p({items:[new r({icon:"sap-icon://expand",text:"{i18n>EXPAND_BUTTON}",press:h}),new r({icon:"sap-icon://collapse",text:"{i18n>COLLAPSE_BUTTON}",press:b})]})],columns:[new c({label:new o({text:"{i18n>COLUMN_PROPERTY}"}),template:new s({text:"{property}"})}),new c({label:new o({text:"{i18n>COLUMN_VALUE}"}),template:new s({text:"{value}"})})]})]}),t)});var E=new f({search:this.onPressSearchNewModel});E.placeAt(this.getId());I.setModel(v);I.setModel(d,"i18n");I.placeAt(this.getId())}}};return y});