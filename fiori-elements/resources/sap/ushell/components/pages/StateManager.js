// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/EventHub"],function(i,t){"use strict";var e={};e.init=function(i,e){this.aRefreshVisualizations=[];this.oPagesVisibility={};this.oPagesRuntimeNavContainer=i;this.oPagesNavContainer=e;this.oPagesRuntimeNavContainer.attachNavigate(this._onErrorPageNavigated,this);this.oPagesNavContainer.attachNavigate(this._onPageNavigated,this);this._onTabNavigatedBind=this._onTabNavigated.bind(this);document.addEventListener("visibilitychange",this._onTabNavigatedBind);this.oEventBus=sap.ui.getCore().getEventBus();this.oEventBus.subscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);this.oEventBus.subscribe("sap.ushell","navigated",this._onShellNavigated,this);this.oEventHubListener=t.once("PagesRuntimeRendered").do(function(){this._setCurrentPageVisibility(true,false)}.bind(this))};e._onEnableRequests=function(i,t,e){if(!e||e.active===undefined){return}this._setCurrentPageVisibility(e.active,false)};e._setCurrentPageVisibility=function(i,t,e){if(this.oPagesRuntimeNavContainer.getCurrentPage().isA("sap.m.MessagePage")&&!e){return}var s=this.oPagesNavContainer.getCurrentPage();if(s){this._setPageVisibility(s,i,t)}};e._setPageVisibility=function(i,t,e){if(!i){return}if(i.getContent()[0].isA("sap.ushell.ui.launchpad.Page")){var s=i.getBindingContext().getPath();this.oPagesVisibility[s]=t;this._visitVisualizations(i,function(i){i.setActive(t,e)})}};e._visitVisualizations=function(i,t){if(!t){return}i.getContent()[0].getSections().forEach(function(i){i.getVisualizations().forEach(t)})};e._onShellNavigated=function(){var t=window.hasher.getHash();if(i.isFlpHomeIntent(t)){this._setCurrentPageVisibility(true,false);this._refreshVisualizations()}else{this._setCurrentPageVisibility(false,false)}return Promise.resolve()};e.addVisualizationForRefresh=function(i){this.aRefreshVisualizations.push(i)};e._refreshVisualizations=function(){this.aRefreshVisualizations.forEach(function(i){i.setActive(i.getActive(),true)});this.aRefreshVisualizations=[]};e._onTabNavigated=function(){var t=window.hasher.getHash();if(i.isFlpHomeIntent(t)){this._setCurrentPageVisibility(!document.hidden,false)}return Promise.resolve()};e._onPageNavigated=function(i){var t=i.getParameters();this._setPageVisibility(t.from,false,false);this._setPageVisibility(t.to,true,false)};e._onErrorPageNavigated=function(i){var t=i.getParameter("to");this._setCurrentPageVisibility(t.isA("sap.m.NavContainer"),false,true)};e.getPageVisibility=function(i){return this.oPagesVisibility[i]};e.exit=function(){this.oEventBus.unsubscribe("sap.ushell","navigated",this._onPageNavigated,this);document.removeEventListener("visibilitychange",this._onTabNavigatedBind);this.oPagesNavContainer.detachNavigate(this._onPageNavigated,this);this.oPagesRuntimeNavContainer.detachNavigate(this._onErrorPageNavigated,this);this.oEventBus.unsubscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);this.oEventHubListener.off()};return e});