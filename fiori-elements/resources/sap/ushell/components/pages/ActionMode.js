//Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/library","sap/ui/Device","sap/m/MessageBox","sap/m/MessageToast","sap/ushell/resources","sap/ushell/EventHub","sap/base/Log"],function(e,t,n,i,o,r,a){"use strict";var s={};s.start=function(e,n){this.oController=e;var i=e.getView().getModel("viewSettings");var a=i.getProperty("/addToMyHomeOnly");if(!a){e.getView().getModel("viewSettings").setProperty("/actionModeEditActive",true)}e.getView().getModel("viewSettings").setProperty("/actionModeActive",true);e.handleMyHomeActionMode(true).catch(e._onError.bind(e));r.emit("enableMenuBarNavigation",false);var s=sap.ui.getCore().byId("ActionModeBtn");this.sActionButtonActivateText=s.getText();n=n||o.i18n.getText("PageRuntime.EditMode.Exit");s.setTooltip(n);s.setText(n);if(t.system.desktop){sap.ui.require(["sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e){e.attachEvent("editModeDone",this.save,this)}.bind(this))}};s.cancel=function(){this._cleanup()};s.save=function(){a.info("store actions in pages service");this._cleanup()};s._cleanup=function(){this.oController.getView().getModel("viewSettings").setProperty("/actionModeActive",false);this.oController.getView().getModel("viewSettings").setProperty("/actionModeEditActive",false);this.oController.handleMyHomeActionMode(false).catch(this.oController._onError.bind(this.oController));r.emit("enableMenuBarNavigation",true);var e=sap.ui.getCore().byId("ActionModeBtn");e.setTooltip(this.sActionButtonActivateText);e.setText(this.sActionButtonActivateText);if(t.system.desktop){sap.ui.require(["sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e){e.detachEvent("editModeDone",this.save,this)}.bind(this))}};s.addVisualization=function(e,t){var n=t.getBindingContext().getModel();var i=t.getBindingContext().getPath();var o=i.split("/");var r=parseInt(o[2],10);var a=n.getProperty("/pages/"+r+"/id");var s=n.getProperty(i+"/id");sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){var t="Shell-appfinder?&/catalog/"+JSON.stringify({pageID:encodeURIComponent(a),sectionID:encodeURIComponent(s)});e.toExternal({target:{shellHash:t}})})};s.addSection=function(e,t,n){var i=n.index;var o=t.getBindingContext().getPath();var r=o.split("/");var a=parseInt(r[2],10);return this.oController.getOwnerComponent().getPagesService().then(function(e){e.addSection(a,i);var n={onAfterRendering:function(){setTimeout(function(){t.getSections()[i].byId("title-edit").focus()},0);t.removeEventDelegate(n)}};t.addEventDelegate(n)})};s.deleteSection=function(e,t){return sap.ushell.Container.getServiceAsync("Message").then(function(e){var r=t.getTitle();var a=r?o.i18n.getText("PageRuntime.Message.Section.Delete",r):o.i18n.getText("PageRuntime.Message.Section.DeleteNoTitle");var s=o.i18n.getText("PageRuntime.Dialog.Title.Delete");function g(e){if(e===n.Action.DELETE){this.oController.getOwnerComponent().getPagesService().then(function(e){var n=t.getBindingContext().getPath(),r=t.getParent(),a=n.split("/"),s=parseInt(a[2],10),g=parseInt(a[4],10);e.deleteSection(s,g);i.show(o.i18n.getText("PageRuntime.Message.SectionDeleted"));var c=r.getSections();if(c.length){var l=c[g!==0?g-1:g];l.focus();var v={onAfterRendering:function(){l.focus();l.removeEventDelegate(v)}};l.addEventDelegate(v)}else{var d={onAfterRendering:function(){r.focus();r.removeEventDelegate(d)}};r.addEventDelegate(d)}})}}e.confirm(a,g.bind(this),s,[n.Action.DELETE,n.Action.CANCEL])}.bind(this))};s.resetSection=function(e,t){var n=t.getBindingContext().getPath();var r=n.split("/");var a=parseInt(r[2],10);var s=parseInt(r[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(e){e.resetSection(a,s);i.show(o.i18n.getText("PageRuntime.Message.SectionReset"))})};s.changeSectionTitle=function(e,t,n){var i=t.getBindingContext().getPath();var o=t.getProperty("title");var r=i.split("/");var a=parseInt(r[2],10);var s=parseInt(r[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(e){e.renameSection(a,s,o)})};s.moveSection=function(e,t,n){var i=n.draggedControl.getBindingContext().getPath();var o=n.droppedControl.getBindingContext().getPath();var r=n.dropPosition;var a=o.split("/");var s=i.split("/");var g=parseInt(s[2],10);var c=parseInt(s[4],10);var l=parseInt(a[4],10);if(c===l-1&&r==="Before"||c===l+1&&r==="After"){return Promise.resolve()}if(r==="After"){l=l+1}var v=this.oController.getOwnerComponent();return v.getPagesService().then(function(e){return e.moveSection(g,c,l)}).then(function(){t.announceMove()})};s.changeSectionVisibility=function(e,t,n){if(this.oController===undefined||n.visible===undefined){return Promise.resolve()}var i=t.getBindingContext().getPath();var o=n.visible;var r=i.split("/");var a=parseInt(r[2],10);var s=parseInt(r[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(e){e.setSectionVisibility(a,s,o)})};return s});