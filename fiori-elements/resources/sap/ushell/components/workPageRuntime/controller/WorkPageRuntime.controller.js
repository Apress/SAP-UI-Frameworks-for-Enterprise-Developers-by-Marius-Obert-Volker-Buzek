//Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/mvc/Controller","sap/ushell/components/workPageRuntime/services/WorkPage","sap/base/util/deepExtend","sap/ushell/EventHub","sap/ushell/components/pages/controller/PagesAndSpaceId","sap/ushell/Config"],function(e,t,o,n,i,a,r){"use strict";return t.extend("sap.ushell.components.workPageRuntime.controller.WorkPageRuntime",{onInit:function(){var e=sap.ushell.Container.getRenderer();var t=new URLSearchParams(window.location.search);this.oWorkPageService=new o;this.oWorkPageNavContainer=this.byId("workpageNavContainer");this.oEmptyPage=this.byId("emptyPage");this._oWorkPageBuilderComponentCreatedPromise=new Promise(function(e,t){this._oWorkPageBuilderComponentResolve=e;this._oWorkPageBuilderComponentReject=t}.bind(this));return this._getPageId().then(function(o){this._sPageId=o;this._sSiteId=t.get("siteId")||r.last("/core/site/siteId");return this._onWorkPageLoad().finally(function(){i.emit("CenterViewPointContentRendered");if(!this.getOwnerComponent().getNavigationDisabled()){this.oContainerRouter=e.getRouter();this.oContainerRouter.getRoute("home").attachMatched(this.onRouteMatched.bind(this,false));this.oContainerRouter.getRoute("openFLPPage").attachMatched(this.onRouteMatched.bind(this,false))}}.bind(this))}.bind(this)).catch(this._handleErrors.bind(this))},_navigate:function(){this.oWorkPageNavContainer.to(this.byId("workPage"))},onWorkPageBuilderCreated:function(e){this._oWorkPageBuilderComponent=e.getParameter("component");this._oWorkPageBuilderComponentResolve(this._oWorkPageBuilderComponent)},_handleErrors:function(t){e.error("An error occurred while loading the page",t);e.debug("cep/editMode: on Route matched: Handle errors","Work Page runtime");this.oWorkPageNavContainer.to(this.byId("errorPage"))},onRouteMatched:function(){e.debug("cep/editMode: on Route matched","Work Page runtime");return this._getPageId().then(function(e){this._sPageId=e;return this._onWorkPageLoad()}.bind(this)).catch(this._handleErrors.bind(this))},_onWorkPageLoad:function(){this._oLoadWorkPageAndVisualizationsPromise=this.oWorkPageService.loadWorkPageAndVisualizations(this._sSiteId,this._sPageId);return Promise.all([this._oWorkPageBuilderComponentCreatedPromise,this._oLoadWorkPageAndVisualizationsPromise]).then(function(e){var t=e[0];var o=e[1];this._oOriginalData=n({},o);t.setPageData(o);this._navigate()}.bind(this))},_getPageId:function(){if(r.last("/core/workPages/myHome/pageId")){return Promise.resolve(r.last("/core/workPages/myHome/pageId"))}return a._getPageAndSpaceId().then(function(e){return e.pageId})},hideRuntime:function(){e.debug("cep/editMode: navigate to empty page","Page runtime");this.oWorkPageNavContainer.to(this.oEmptyPage)}})});