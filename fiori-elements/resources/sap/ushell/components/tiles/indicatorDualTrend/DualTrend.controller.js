// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/model/json/JSONModel","sap/suite/ui/microchart/AreaMicroChartPoint","sap/suite/ui/microchart/AreaMicroChartItem","sap/m/library","sap/ui/thirdparty/jquery"],function(e,i,t,l,a){"use strict";var r=l.Size;var s=l.ValueColor;var o=l.DeviationIndicator;var n=l.LoadState;sap.ui.controller("tiles.indicatorDualTrend.DualTrend",{logError:function(e){this.oDualTrendView.oGenericTile.setState(n.Failed);this.oDualTrendView.oGenericTile.setState(n.Failed);sap.ushell.components.tiles.indicatorTileUtils.util.logError(e)},formSelectStatement:function(e){var i=Object.keys(e);var t="";for(var l=0;l<i.length;l++){if(e[i[l]]!==undefined&&e.fullyFormedMeasure){t+=","+e[i[l]]}}return t},setThresholdValues:function(){var e=this;try{var i={};i.fullyFormedMeasure=this.DEFINITION_DATA.EVALUATION.COLUMN_NAME;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){switch(this.DEFINITION_DATA.EVALUATION.GOAL_TYPE){case"MI":i.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","MEASURE");i.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","MEASURE");i.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");i.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");i.fullyFormedMeasure+=e.formSelectStatement(i);break;case"MA":i.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","MEASURE");i.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","MEASURE");i.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");i.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");i.fullyFormedMeasure+=e.formSelectStatement(i);break;case"RA":i.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","MEASURE");i.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","MEASURE");i.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");i.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");i.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","MEASURE");i.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","MEASURE");i.fullyFormedMeasure+=e.formSelectStatement(i);break}}else{i.criticalHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","FIXED");i.criticalLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","FIXED");i.warningHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","FIXED");i.warningLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","FIXED");i.targetValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","FIXED");i.trendValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","FIXED")}return i}catch(i){e.logError(i)}},getTrendIndicator:function(e,i){var t=this;e=Number(e);try{var l=o.None;if(e>i){l=o.Down}else if(e<i){l=o.Up}return l}catch(e){t.logError(e)}},getTile:function(){return this.oDualTrendView.oGenericTile},getTrendColor:function(e){var i=this;try{var t=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE;var l=s.Neutral;if(t==="MI"){if(e.criticalHighValue&&e.warningHighValue){e.criticalHighValue=Number(e.criticalHighValue);e.warningHighValue=Number(e.warningHighValue);if(this.CALCULATED_KPI_VALUE<e.warningHighValue){l=s.Good}else if(this.CALCULATED_KPI_VALUE<=e.criticalHighValue){l=s.Critical}else{l=s.Error}}}else if(t==="MA"){if(e.criticalLowValue&&e.warningLowValue){e.criticalLowValue=Number(e.criticalLowValue);e.warningLowValue=Number(e.warningLowValue);if(this.CALCULATED_KPI_VALUE<e.criticalLowValue){l=s.Error}else if(this.CALCULATED_KPI_VALUE<=e.warningLowValue){l=s.Critical}else{l=s.Good}}}else if(e.warningLowValue&&e.warningHighValue&&e.criticalLowValue&&e.criticalHighValue){e.criticalHighValue=Number(e.criticalHighValue);e.warningHighValue=Number(e.warningHighValue);e.warningLowValue=Number(e.warningLowValue);e.criticalLowValue=Number(e.criticalLowValue);if(this.CALCULATED_KPI_VALUE<e.criticalLowValue||this.CALCULATED_KPI_VALUE>e.criticalHighValue){l=s.Error}else if(this.CALCULATED_KPI_VALUE>=e.criticalLowValue&&this.CALCULATED_KPI_VALUE<=e.warningLowValue||this.CALCULATED_KPI_VALUE>=e.warningHighValue&&this.CALCULATED_KPI_VALUE<=e.criticalHighValue){l=s.Critical}else{l=s.Good}}return l}catch(e){i.logError(e)}},_updateTileModel:function(e){var i=this.getTile().getModel().getData();a.extend(i,e);this.getTile().getModel().setData(i)},onAfterFinalEvaluation:function(){var e=this;var l=this.DEFINITION_DATA.EVALUATION.ODATA_URL;var a=this.DEFINITION_DATA.EVALUATION.ODATA_ENTITYSET;var r=this.DEFINITION_DATA.EVALUATION.COLUMN_NAME;var s=sap.ushell.components.tiles.indicatorTileUtils.util.prepareFilterStructure(this.DEFINITION_DATA.EVALUATION_FILTERS,this.DEFINITION_DATA.ADDITIONAL_FILTERS);var o=this.DEFINITION_DATA.TILE_PROPERTIES.dimension;if(o==undefined){this.logError();return}var u=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE,c=this.DEFINITION_DATA.EVALUATION_VALUES,T;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){var h=r;switch(u){case"MI":e.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","MEASURE");e.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","MEASURE");e.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");e.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");if(e.sWarningHigh&&e.sCriticalHigh&&e.sTarget){h+=","+e.sWarningHigh+","+e.sCriticalHigh+","+e.sTarget}break;case"MA":e.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","MEASURE");e.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","MEASURE");e.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");e.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");if(e.sWarningLow&&e.sCriticalLow&&e.sTarget){h+=","+e.sWarningLow+","+e.sCriticalLow+","+e.sTarget}break;case"RA":e.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","MEASURE");e.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","MEASURE");e.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");e.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");e.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","MEASURE");e.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","MEASURE");if(e.sWarningLow&&e.sCriticalLow&&e.sTarget&&e.sWarningHigh&&e.sCriticalHigh){h+=","+e.sWarningLow+","+e.sCriticalLow+","+e.sTarget+","+e.sWarningHigh+","+e.sCriticalHigh}break}T=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(e.oTileApi.url.addSystemToServiceUrl(l),a,h,o,s)}else{T=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(e.oTileApi.url.addSystemToServiceUrl(l),a,r,o,s)}var E=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(e.oConfig.TILE_PROPERTIES.id);if(!E){if(T){this.queryUriForTrendChart=T.uri;e.writeData={};try{this.trendChartODataReadRef=T.model.read(T.uri,null,null,true,function(i){if(i&&i.results&&i.results.length){if(T.unit[0]){e.unit=i.results[0][T.unit[0].name];e.writeData.unit=T.unit[0];e.writeData.unit.name=T.unit[0].name}e.queryUriResponseForTrendChart=i;o=sap.ushell.components.tiles.indicatorTileUtils.util.findTextPropertyForDimension(e.oTileApi.url.addSystemToServiceUrl(l),a,o);i.firstXlabel=i.results[0][o];i.lastXlabel=i.results[i.results.length-1][o];e.writeData.data=i;e.writeData.dimensionName=o;sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(e.oConfig.TILE_PROPERTIES.id,e.writeData);var t=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(e.oConfig,e.system);e.oDualTrendView.oGenericTile.$().wrap("<a href ='"+t+"'></a>");e.oDualTrendView.oGenericTile.setState(n.Loaded);f(i,e.DEFINITION_DATA.EVALUATION.VALUES_SOURCE)}else{e.logError("no Response from QueryServiceUri")}},function(i){if(i&&i.response){e.logError("Data call failed")}})}catch(i){e.logError(i)}}else{e.logError()}s=sap.ushell.components.tiles.indicatorTileUtils.util.prepareFilterStructure(e.DEFINITION_DATA.EVALUATION_FILTERS,e.DEFINITION_DATA.ADDITIONAL_FILTERS);T=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(e.oTileApi.url.addSystemToServiceUrl(l),a,r,null,s);if(T){e.QUERY_SERVICE_MODEL=T.model;e.queryUriForKpiValue=T.uri;e.numericODataReadRef=e.QUERY_SERVICE_MODEL.read(T.uri,null,null,true,function(i){if(i&&i.results&&i.results.length){var t="";var l=i.results[0][e.DEFINITION_DATA.EVALUATION.COLUMN_NAME];e.writeData.numericData=i;if(e.oConfig.EVALUATION.SCALING==-2){l*=100}t=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(Number(l),e.oConfig.EVALUATION.SCALING,e.oConfig.EVALUATION.DECIMAL_PRECISION);if(e.oConfig.EVALUATION.SCALING==-2){e._updateTileModel({scale:"%"})}var a=e.getTrendIndicator(e.setThresholdValues().trendValue,l);e._updateTileModel({value:t.toString(),valueColor:e.getTrendColor(e.setThresholdValues()),indicator:a})}else{fnError.call(e,"no Response from QueryServiceUri")}})}}else{try{if(E.unit!==undefined){e.unit=E.data.results[0][E.unit.name]}e.queryUriResponseForTrendChart=E.data;o=E.dimensionName;var g=E.numericData.results[0][e.DEFINITION_DATA.EVALUATION.COLUMN_NAME];var d=e.getTrendIndicator(e.setThresholdValues().trendValue,E.data.results[0][e.DEFINITION_DATA.EVALUATION.COLUMN_NAME]);var A=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(Number(g),e.oConfig.EVALUATION.SCALING,e.oConfig.EVALUATION.DECIMAL_PRECISION);e.oDualTrendView.oGenericTile.setState(n.Loaded);f(E.data,e.DEFINITION_DATA.EVALUATION.VALUES_SOURCE);e._updateTileModel({value:A.toString(),valueColor:e.getTrendColor(e.setThresholdValues()),indicator:d})}catch(i){e.logError(i)}}function f(l,a){var s=[];var n=[];var T=[];var h=[];var E=[];var g=[];var d=l.firstXlabel;var A,f,m,L,C;var N=l.lastXlabel;var p=Number(l.results[0][r]);var I=Number(l.results[l.results.length-1][r]);var U;for(U in l.results){l.results[U][o]=Number(U);l.results[U][r]=Number(l.results[U][r]);if(e.sWarningHigh){l.results[U][e.sWarningHigh]=Number(l.results[U][e.sWarningHigh])}if(e.sCriticalHigh){l.results[U][e.sCriticalHigh]=Number(l.results[U][e.sCriticalHigh])}if(e.sCriticalLow){l.results[U][e.sCriticalLow]=Number(l.results[U][e.sCriticalLow])}if(e.sWarningLow){l.results[U][e.sWarningLow]=Number(l.results[U][e.sWarningLow])}if(e.sTarget){l.results[U][e.sTarget]=Number(l.results[U][e.sTarget])}if(e.sWarningHigh){T.push(l.results[U][e.sWarningHigh])}if(e.sCriticalHigh){h.push(l.results[U][e.sCriticalHigh])}if(e.sCriticalLow){E.push(l.results[U][e.sCriticalLow])}if(e.sWarningLow){g.push(l.results[U][e.sWarningLow])}s.push(l.results[U][o]);n.push(l.results[U][r])}try{d=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(d);N=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(N)}catch(i){e.logError(i)}var V=Number(p);if(e.oConfig.EVALUATION.SCALING==-2){V*=100}var w=Math.min.apply(Math,n);var M=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(V,e.oConfig.EVALUATION.SCALING,e.oConfig.EVALUATION.DECIMAL_PRECISION);if(e.oConfig.EVALUATION.SCALING==-2){M+=" %"}var S=M.toString();var D=Number(I);if(e.oConfig.EVALUATION.SCALING==-2){D*=100}var b=Math.max.apply(Math,n);var v=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(D,e.oConfig.EVALUATION.SCALING,e.oConfig.EVALUATION.DECIMAL_PRECISION);if(e.oConfig.EVALUATION.SCALING==-2){v+=" %"}var R=v.toString();try{var O=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.min.apply(Math,s));var H=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.max.apply(Math,s))}catch(i){e.logError(i)}if(a=="MEASURE"){if(T.length!=0){e.firstwH=T[O];e.lastwH=T[H]}if(h.length!=0){e.firstcH=h[O];e.lastcH=h[H]}if(E.length!=0){e.firstcL=E[O];e.lastcL=E[H]}if(g.length!=0){e.firstwL=g[O];e.lastwL=g[H]}}var _={width:"100%",height:"100%",unit:e.unit||"",chart:{color:"Neutral",data:l.results},size:"Auto",minXValue:O,maxXValue:H,minYValue:w,maxYValue:b,firstXLabel:{label:d+"",color:"Neutral"},lastXLabel:{label:N+"",color:"Neutral"},firstYLabel:{label:S+"",color:"Neutral"},lastYLabel:{label:R+"",color:"Neutral"},minLabel:{},maxLabel:{}},F;switch(u){case"MA":for(U in c){if(c[U].TYPE=="CL"){_.minThreshold={color:"Error"};F={};F[o]="";F[r]=Number(c[U].FIXED);e.cl=Number(c[U].FIXED);_.minThreshold.data=a=="MEASURE"?l.results:[F];A=a=="MEASURE"?e.sCriticalLow:r}else if(c[U].TYPE=="WL"){_.maxThreshold={color:"Good"};F={};F[o]="";F[r]=Number(c[U].FIXED);_.maxThreshold.data=a=="MEASURE"?l.results:[F];f=a=="MEASURE"?e.sWarningLow:r;e.wl=Number(c[U].FIXED)}else if(c[U].TYPE=="TA"){F={};F[o]="";F[r]=Number(c[U].FIXED);_.target={color:"Neutral"};_.target.data=a=="MEASURE"?l.results:[F];C=a=="MEASURE"?e.sTarget:r}}_.innerMinThreshold={data:[]};_.innerMaxThreshold={data:[]};if(a=="FIXED"){_.firstYLabel.color=p<e.cl?"Error":e.cl<=p&&p<=e.wl?"Critical":p>e.wl?"Good":"Neutral";_.lastYLabel.color=I<e.cl?"Error":e.cl<=I&&I<=e.wl?"Critical":I>e.wl?"Good":"Neutral"}else if(a=="MEASURE"&&e.firstwL&&e.lastwL&&e.firstcL&&e.lastcL){_.firstYLabel.color=p<e.firstcL?"Error":e.firstcL<=p&&p<=e.firstwL?"Critical":p>e.firstwL?"Good":"Neutral";_.lastYLabel.color=I<e.lastcL?"Error":e.lastcL<=I&&I<=e.lastwL?"Critical":I>e.lastwL?"Good":"Neutral"}break;case"MI":for(U in c){if(c[U].TYPE=="CH"){F={};F[o]="";F[r]=Number(c[U].FIXED);e.ch=Number(c[U].FIXED);_.maxThreshold={color:"Error"};_.maxThreshold.data=a=="MEASURE"?l.results:[F];f=a=="MEASURE"?e.sCriticalHigh:r}else if(c[U].TYPE=="WH"){F={};F[o]="";F[r]=Number(c[U].FIXED);e.wh=Number(c[U].FIXED);_.minThreshold={color:"Good"};_.minThreshold.data=a=="MEASURE"?l.results:[F];A=a=="MEASURE"?e.sWarningHigh:r}else if(c[U].TYPE=="TA"){F={};F[o]="";F[r]=Number(c[U].FIXED);_.target={color:"Neutral"};_.target.data=a=="MEASURE"?l.results:[F];C=a=="MEASURE"?e.sTarget:r}}if(a=="FIXED"){_.firstYLabel.color=p>e.ch?"Error":e.wh<=p&&p<=e.ch?"Critical":p<e.wh?"Good":"Neutral";_.lastYLabel.color=I>e.ch?"Error":e.wh<=I&&I<=e.ch?"Critical":I<e.wh?"Good":"Neutral"}else if(a=="MEASURE"&&e.firstwH&&e.lastwH&&e.firstcH&&e.lastcH){_.firstYLabel.color=p>e.firstcH?"Error":e.firstwH<=p&&p<=e.firstcH?"Critical":p<e.firstwH?"Good":"Neutral";_.lastYLabel.color=I>e.lastcH?"Error":e.lastwH<=I&&I<=e.lastcH?"Critical":I<e.lastwH?"Good":"Neutral"}_.innerMaxThreshold={data:[]};_.innerMinThreshold={data:[]};break;case"RA":for(U in c){if(c[U].TYPE=="CH"){F={};F[o]="";F[r]=Number(c[U].FIXED);e.ch=Number(c[U].FIXED);_.maxThreshold={color:"Error"};_.maxThreshold.data=a=="MEASURE"?l.results:[F];f=a=="MEASURE"?e.sCriticalHigh:r}else if(c[U].TYPE=="WH"){F={};F[o]="";F[r]=Number(c[U].FIXED);e.wh=Number(c[U].FIXED);_.innerMaxThreshold={color:"Good"};_.innerMaxThreshold.data=a=="MEASURE"?l.results:[F];L=a=="MEASURE"?e.sWarningHigh:r}else if(c[U].TYPE=="WL"){F={};F[o]="";F[r]=Number(c[U].FIXED);e.wl=Number(c[U].FIXED);_.innerMinThreshold={color:"Good"};_.innerMinThreshold.data=a=="MEASURE"?l.results:[F];m=a=="MEASURE"?e.sWarningLow:r}else if(c[U].TYPE=="CL"){F={};F[o]="";F[r]=Number(c[U].FIXED);e.cl=Number(c[U].FIXED);_.minThreshold={color:"Error"};_.minThreshold.data=a=="MEASURE"?l.results:[F];A=a=="MEASURE"?e.sCriticalLow:r}else if(c[U].TYPE=="TA"){F={};F[o]="";F[r]=Number(c[U].FIXED);_.target={color:"Neutral"};_.target.data=a=="MEASURE"?l.results:[F];C=a=="MEASURE"?e.sTarget:r}}if(a=="FIXED"){_.firstYLabel.color=p>e.ch||p<e.cl?"Error":e.wh<=p&&p<=e.ch||e.cl<=p&&p<=e.wl?"Critical":p>=e.wl&&p<=e.wh?"Good":"Neutral";_.lastYLabel.color=I>e.ch||I<e.cl?"Error":e.wh<=I&&I<=e.ch||e.cl<=I&&I<=e.wl?"Critical":I>=e.wl&&I<=e.wh?"Good":"Neutral"}else if(a=="MEASURE"&&e.firstwL&&e.lastwL&&e.firstcL&&e.lastcL&&e.firstwH&&e.lastwH&&e.firstcH&&e.lastcH){_.firstYLabel.color=p>e.firstcH||p<e.firstcL?"Error":e.firstwH<=p&&p<=e.firstcH||e.firstcL<=p&&p<=e.firstwL?"Critical":p>=e.firstwL&&p<=e.firstwH?"Good":"Neutral";_.lastYLabel.color=I>e.lastcH||I<e.lastcL?"Error":e.lastwH<=I&&I<=e.lastcH||e.lastcL<=I&&I<=e.lastwL?"Critical":I>=e.lastwL&&I<=e.lastwH?"Good":"Neutral"}break}var y=function(e,l,a){return new t({color:"{/"+e+"/color}",points:{path:"/"+e+"/data",template:new i({x:"{"+l+"}",y:"{"+a+"}"})}})};e.getTile().getTileContent()[1].getContent().setTarget(y("target",o,C));e.getTile().getTileContent()[1].getContent().setInnerMinThreshold(y("innerMinThreshold",o,m));e.getTile().getTileContent()[1].getContent().setInnerMaxThreshold(y("innerMaxThreshold",o,L));e.getTile().getTileContent()[1].getContent().setMinThreshold(y("minThreshold",o,A));e.getTile().getTileContent()[1].getContent().setMaxThreshold(y("maxThreshold",o,f));e.getTile().getTileContent()[1].getContent().setChart(y("chart",o,r));e._updateTileModel(_)}},flowWithoutDesignTimeCall:function(){this.DEFINITION_DATA=this.oConfig;this._updateTileModel(this.DEFINITION_DATA);if(this.oTileApi.visible.isVisible()&&!this.firstTimeVisible){this.firstTimeVisible=true}this.onAfterFinalEvaluation()},flowWithDesignTimeCall:function(){var e=this;try{var i=sap.ushell.components.tiles.indicatorTileUtils.cache.getEvaluationById(this.oConfig.EVALUATION.ID);if(i){e.oConfig.EVALUATION_FILTERS=i.EVALUATION_FILTERS;e.flowWithoutDesignTimeCall()}else{sap.ushell.components.tiles.indicatorTileUtils.util.getFilterFromRunTimeService(this.oConfig,function(i){e.oConfig.EVALUATION_FILTERS=i;sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(e.oConfig.TILE_PROPERTIES.id,e.oConfig);e.flowWithoutDesignTimeCall()})}}catch(e){this.logError(e)}},refreshHandler:function(e){if(!e.firstTimeVisible){if(Number(this.oTileApi.configuration.getParameterValueAsString("isSufficient"))){e.flowWithoutDesignTimeCall()}else{e.flowWithDesignTimeCall()}}},visibleHandler:function(e){if(!e){this.firstTimeVisible=false;sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef)}if(e){this.refreshHandler(this)}},setTextInTile:function(){var e=this;this._updateTileModel({header:e.oTileApi.preview.getTitle()||sap.ushell.components.tiles.indicatorTileUtils.util.getChipTitle(e.oConfig),subheader:e.oTileApi.preview.getDescription()||sap.ushell.components.tiles.indicatorTileUtils.util.getChipSubTitle(e.oConfig)})},onInit:function(){var e=this;this.firstTimeVisible=false;this.oDualTrendView=this.getView();this.oViewData=this.oDualTrendView.getViewData();this.oTileApi=this.oViewData.chip;if(this.oTileApi.visible){this.oTileApi.visible.attachVisible(this.visibleHandler.bind(this))}this.system=this.oTileApi.url.getApplicationSystem();this.oDualTrendView.oGenericTile.setState(n.Loading);if(this.oTileApi.preview.isEnabled()){this.setTextInTile();this._updateTileModel({value:8888,size:r.Auto,frameType:"TwoByOne",state:n.Loading,valueColor:s.Error,indicator:o.None,title:"Liquidity Structure",footer:"Current Quarter",description:"Apr 1st 2013 (B$)",width:"100%",height:"100%",chart:{color:"Good",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:20},{day:100,balance:80}]},target:{color:"Error",data:[{day:0,balance:0},{day:30,balance:30},{day:60,balance:40},{day:100,balance:90}]},maxThreshold:{color:"Good",data:[{day:0,balance:0},{day:30,balance:40},{day:60,balance:50},{day:100,balance:100}]},innerMaxThreshold:{color:"Error",data:[]},innerMinThreshold:{color:"Neutral",data:[]},minThreshold:{color:"Error",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:30},{day:100,balance:70}]},minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:{label:"June 123",color:"Error"},lastXLabel:{label:"June 30",color:"Error"},firstYLabel:{label:"0M",color:"Good"},lastYLabel:{label:"80M",color:"Critical"},minLabel:{},maxLabel:{}});this.oDualTrendView.oGenericTile.setState(n.Loaded)}else{try{sap.ushell.components.tiles.indicatorTileUtils.util.getParsedChip(this.oTileApi.configuration.getParameterValueAsString("tileConfiguration"),function(i){e.oConfig=i;e.setTextInTile();e.oDualTrendView.oGenericTile.attachPress(function(){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(e.trendChartODataReadRef);sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(e.oConfig.TILE_PROPERTIES.id,null);window.location.hash=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(e.oConfig,e.system)});if(Number(e.oTileApi.configuration.getParameterValueAsString("isSufficient"))){sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(e.oConfig.TILE_PROPERTIES.id,e.oConfig);e.flowWithoutDesignTimeCall()}else{e.flowWithDesignTimeCall()}})}catch(e){this.logError(e)}}},_setLocalModelToTile:function(){if(!this.getTile().getModel()){this.getTile().setModel(new e({}))}},onExit:function(){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef)}})},true);