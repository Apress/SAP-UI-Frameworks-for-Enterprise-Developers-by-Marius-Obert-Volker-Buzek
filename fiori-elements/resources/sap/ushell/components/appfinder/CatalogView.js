// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/BusyIndicator","sap/m/library","sap/m/List","sap/m/MessagePage","sap/m/Page","sap/m/PageAccessibleLandmarkInfo","sap/m/SplitApp","sap/m/StandardListItem","sap/ui/core/Core","sap/ui/core/mvc/View","sap/ui/core/library","sap/ui/Device","sap/ui/performance/Measurement","sap/ui/thirdparty/jquery","sap/ushell/components/appfinder/VisualizationOrganizerHelper","sap/ushell/ui/appfinder/AppBox","sap/ushell/ui/appfinder/PinButton","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/ui/launchpad/CatalogEntryContainer","sap/ushell/ui/launchpad/CatalogsContainer","sap/ushell/ui/launchpad/Tile","sap/ushell/resources"],function(e,t,a,o,i,s,n,l,r,p,u,g,c,d,h,f,m,C,v,b,P,y){"use strict";var T=t.ListSeparators;var S=t.ListMode;var B=u.AccessibleLandmarkRole;return p.extend("sap.ushell.components.appfinder.CatalogView",{oController:null,oVisualizationOrganizerHelper:h.getInstance(),formatPinButtonTooltip:function(e,t){var a;if(t.path){var o=e?Array.prototype.indexOf.call(e,t.id):-1;a=o!==-1?"removeAssociatedTileFromContextGroup":"addAssociatedTileToContextGroup";return y.i18n.getText(a,t.title)}a=e&&e.length?"EasyAccessMenu_PinButton_Toggled_Tooltip":"EasyAccessMenu_PinButton_UnToggled_Tooltip";return y.i18n.getText(a)},formatPinButtonSelectState:function(e,t,a,o){if(a){var i=e?Array.prototype.indexOf.call(e,o):-1;return i!==-1}return!!t},createContent:function(t){var p=this;this.oViewData=this.getViewData();this.parentComponent=this.oViewData.parentComponent;var u=this.parentComponent.getModel();this.setModel(u);this.setModel(this.oViewData.subHeaderModel,"subHeaderModel");this.oVisualizationOrganizerHelper.setModel(u);this.oController=t;function h(e){return e!==null&&(e==="1x2"||e==="2x2")||false}var M=new m({icon:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonIcon},type:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonType},selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonSelectState.bind(this)},tooltip:{parts:["associatedGroups","/groupContext","id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonTooltip.bind(this)},press:[this.oVisualizationOrganizerHelper.onTilePinButtonClick,this],visible:false});var w=new m({icon:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonIcon},type:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonType},selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonSelectState.bind(this)},tooltip:{parts:["associatedGroups","/groupContext","id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonTooltip.bind(this)},press:[this.oVisualizationOrganizerHelper.onTilePinButtonClick,this],visible:false});this.oAppBoxesTemplate=new f({title:"{title}",icon:"{icon}",subtitle:"{subtitle}",url:"{url}",navigationMode:"{navigationMode}",pinButton:w,press:[t.onAppBoxPressed,t]});this.oVisualizationOrganizerHelper.shouldPinButtonBeVisible().then(function(e){w.setVisible(e);M.setVisible(e)});w.addCustomData(new C({key:"tabindex",value:"-1",writeToDom:true}));w.addStyleClass("sapUshellPinButton");M.addCustomData(new C({key:"tabindex",value:"-1",writeToDom:true}));M.addStyleClass("sapUshellPinButton");this.oTileTemplate=new P({tileViews:{path:"content",factory:function(e,t){return t.getObject()}},long:{path:"size",formatter:h},tileCatalogId:"{id}",tileCatalogIdStable:"{tileCatalogIdStable}",pinButton:M,press:[t.catalogTilePress,t],afterRendering:t.onTileAfterRendering});this.oCatalogSelect=new a("catalogSelect",{visible:"{/enableCatalogSelection}",rememberSelections:true,showSeparators:T.None,mode:S.SingleSelectMaster,items:{path:"/masterCatalogs",template:new l({type:"Active",title:"{title}"})},showNoData:false,itemPress:[t._handleCatalogListItemPress,t],selectionChange:[t._handleCatalogListItemPress,t]});this.getCatalogSelect=function(){return this.oCatalogSelect};var A=this.oCatalogSelect.onAfterRendering;if(g.system.desktop){sap.ui.require(["sap/ushell/components/ComponentKeysHandler","sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e,t){e.getInstance().then(function(e){this.oCatalogSelect.addEventDelegate({onsaptabnext:function(a){try{a.preventDefault();t.setIsFocusHandledByAnotherHandler(true);e.setFocusOnCatalogTile()}catch(e){}},onsapskipforward:function(a){try{a.preventDefault();t.setIsFocusHandledByAnotherHandler(true);e.setFocusOnCatalogTile()}catch(e){}},onsapskipback:function(a){try{a.preventDefault();t.setIsFocusHandledByAnotherHandler(true);var o=r.byId("openCloseButtonAppFinderSubheader");if(o.getVisible()){o.focus()}else{e.appFinderFocusMenuButtons(a)}}catch(e){}}})}.bind(this))}.bind(this))}if(u.getProperty("/enableHelp")){this.oCatalogSelect.addStyleClass("help-id-catalogCategorySelect")}this.setCategoryFilterSelection=function(e,t){var a=p.getCatalogSelect();var o=a.getItems();var i=e;var s=0;if(!i||i===""){i=y.i18n.getText("all")}o.forEach(function(e,t){if(e.getTitle()===i){s=t;a.setSelectedItem(e)}});if(o.length!==0&&t){o[s].focus()}};this.oCatalogSelect.onAfterRendering=function(){var e=p.oController.categoryFilter||y.i18n.getText("all");p.setCategoryFilterSelection(e);if(A){A.apply(this,arguments)}if(!this.getSelectedItem()){this.setSelectedItem(this.getItems()[0])}setTimeout(function(){var e=d("#catalog-button, #userMenu-button, #sapMenu-button").filter("[tabindex=0]");if(e.length){e.eq(0).focus()}else{d("#catalog-button").focus()}},0)};var x=this.oCatalogSelect._onAfterRenderingPopover;this.oCatalogSelect._onAfterRenderingPopover=function(){if(this._oPopover){this._oPopover.setFollowOf(false)}if(x){x.apply(this,arguments)}};var I=r.getEventBus();var D;var H=function(){this.splitApp.toMaster("catalogSelect","show");if(!g.system.phone){D=this._calculateDetailPageId();if(D!==this.splitApp.getCurrentDetailPage().getId()){this.splitApp.toDetail(D)}}}.bind(this);I.subscribe("launchpad","catalogContentLoaded",function(){setTimeout(H,500)},this);I.subscribe("launchpad","afterCatalogSegment",H,this);var z=new v({header:"{title}",customTilesContainer:{path:"customTiles",template:this.oTileTemplate,templateShareable:true},appBoxesContainer:{path:"appBoxes",template:this.oAppBoxesTemplate,templateShareable:true}});this.oMessagePage=new o({visible:true,showHeader:false,text:y.i18n.getText("EasyAccessMenu_NoAppsToDisplayMessagePage_Text"),description:""}).addEventDelegate({onAfterRendering:function(){var e=this.oMessagePage.getDomRef();if(e){var t=e.getElementsByClassName("sapMMessagePageMainText");if(t.length){t[0].setAttribute("tabindex","0")}}}.bind(this),onBeforeRendering:function(){var e=this.oMessagePage.getDomRef();if(e){var t=e.getElementsByClassName("sapMMessagePageMainText");if(t.length){t[0].removeAttribute()}}}.bind(this)});this.oCatalogsContainer=new b("catalogTiles",{categoryFilter:"{/categoryFilter}",catalogs:{path:"/catalogs",templateShareable:true,template:z},busy:true}).addStyleClass("sapUiTinyMarginTop");this.oCatalogsContainer.addStyleClass("sapUshellCatalogTileContainer");this.oCatalogsContainer.addEventDelegate({onsaptabprevious:function(e){var t=r.byId("openCloseButtonAppFinderSubheader");var a=d(e.srcControl.getDomRef());if(t.getVisible()&&!t.getPressed()&&!a.hasClass("sapUshellPinButton")){e.preventDefault();var o=r.byId("appFinderSearch");o.focus()}},onsapskipback:function(e){var t=r.byId("openCloseButtonAppFinderSubheader");if(t.getVisible()&&!t.getPressed()){e.preventDefault();t.focus()}}});this.oCatalogsContainer.onAfterRendering=function(){var e=r.byId("catalogTilesDetailedPage");if(!this.getBusy()){e.setBusy(false);c.end("FLP:AppFinderLoadingStartToEnd")}else{e.setBusy(true)}d("#catalogTilesDetailedPage-cont").scroll(function(){var e=r.byId("catalogTilesDetailedPage");var t=e.getScrollDelegate();var a=t.getScrollTop();var o=t.getMaxScrollTop();if(o-a<=30+3*p.oController.PagingManager.getTileHeight()&&p.oController.bIsInProcess===false){p.oController.bIsInProcess=true;p.oController.allocateNextPage();setTimeout(function(){p.oController.bIsInProcess=false},0)}})};var V=new i("catalogTilesDetailedPage",{showHeader:false,showFooter:false,showNavButton:false,content:[this.oCatalogsContainer.addStyleClass("sapUshellCatalogPage")],landmarkInfo:new s({contentLabel:y.i18n.getText("appFinderCatalogTitle"),contentRole:B.None,rootRole:B.None})});var F=new i("catalogMessagePage",{showHeader:false,showFooter:false,showNavButton:false,content:[this.oMessagePage]});var O=new e("catalogSelectBusyIndicator",{size:"1rem"});this.splitApp=new n("catalogViewMasterDetail",{masterPages:[O,this.oCatalogSelect],detailPages:[V,F],mode:"{= ${/isPhoneWidth} ? 'HideMode' : 'ShowHideMode'}"});return this.splitApp},_calculateDetailPageId:function(){var e=this.getModel("subHeaderModel");var t=e.getProperty("/search/searchMode");var a=e.getProperty("/tag/tagMode");var o=!!this.getModel().getProperty("/catalogsNoDataText");var i;if(t||a){i=this.getController().bSearchResults?"catalogTilesDetailedPage":"catalogMessagePage"}else if(o){i="catalogMessagePage"}else{i="catalogTilesDetailedPage"}return i},getControllerName:function(){return"sap.ushell.components.appfinder.Catalog"}})});