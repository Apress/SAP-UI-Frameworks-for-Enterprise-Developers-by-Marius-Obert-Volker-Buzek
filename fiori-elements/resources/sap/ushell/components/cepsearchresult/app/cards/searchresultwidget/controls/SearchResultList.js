/*!
 * Copyright (c) 2009-2023 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/base/Log","sap/m/List","sap/m/ListRenderer","sap/m/CustomListItem","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Button","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Title","sap/ui/core/ResizeHandler","sap/ui/Device","sap/ui/dom/includeStylesheet","sap/ushell/components/cepsearchresult/app/util/appendStyleVars","sap/ui/core/Fragment","./Paginator","sap/m/Text","./Highlighter"],function(e,t,i,s,a,o,n,r,l,h,p,g,c,u,d,f,m,y){"use strict";u(["sapUiShadowLevel0","sapUiShadowLevel1","sapUiBaseText","sapUiContentLabelColor","sapUiElementBorderCornerRadius","sapMFontMediumSize","sapUiListBorderColor","sapMFontHeader4Size","sapMFontMediumSize","sapBackgroundColor","sapUiTileBackground","sapUiMarginSmall","sapUiMarginTiny","sapUiContentLabelColor","sapUiAccent1","sapUiAccentBackgroundColor1","sapUiAccent2","sapUiAccentBackgroundColor2","sapUiAccent3","sapUiAccentBackgroundColor3","sapUiAccent4","sapUiAccentBackgroundColor4","sapUiAccent5","sapUiAccentBackgroundColor5","sapUiAccent6","sapUiAccentBackgroundColor6","sapUiAccent7","sapUiAccentBackgroundColor7","sapUiAccent8","sapUiAccentBackgroundColor8","sapUiAccent9","sapUiAccentBackgroundColor8","sapUiAccent10","sapUiAccentBackgroundColor10","sapMFontSmallSize","sapUiButtonNegativeActiveBackground","sapUiButtonSuccessActiveBackground","sapUiButtonInformationActiveBackground","sapUiButtonCriticalBackground","sapUiIndication8HoverBackground"]);c(sap.ui.require.toUrl("sap/ushell/components/cepsearchresult/app/cards/searchresultwidget/controls/SearchResultList.css"));var C=document.createElement("span");C.classList.add("sapMGT","OneByOne");C.style.position="absolute";C.style.top="-1000";document.body.appendChild(C);var v=C.offsetWidth+5;C.remove();var w=new a({content:[new o({width:"0.5rem"}),new h({text:"{category>title} ({= ${count>}})",level:"H1"}),new o,new r({selectedKey:"{category>list/_currentView}",visible:"{= ${category>list/views}.length > 1}",items:[new l({icon:"sap-icon://text-align-justified",key:"List",visible:"{= ${category>list/views}.indexOf('List') > -1}"}),new l({icon:"sap-icon://grid",key:"Tile",visible:"{= ${category>list/views}.indexOf('Tile') > -1}"}),new l({icon:"sap-icon://business-card",key:"Card",visible:"{= ${category>list/views}.indexOf('Card') > -1}"})]}),new o({width:"1rem"})]});function _(e){var t=new a({style:"Clear",content:[new o({width:"1rem"}),new m({visible:false,text:"Found {= ${count>}} items"}),new o,e,new o({width:"1rem"})]});t.addStyleClass("sapUiCEPCatFooterBar");t.addStyleClass("sapUiTinyMarginBottom");t.addStyleClass("sapUiTinyMarginTop");return t}function T(e){var t=new f({visible:"{= ${count>} > ${category>list/paginator/pageSize}}",count:"{= ${count>} || 0}",pageSize:"{category>list/paginator/pageSize}",currentPage:"{category>list/paginator/currentPage}",selectPage:e});return _(t)}function S(e){var t=new n({text:"{i18n>CARD.List.Button.ViewAll}",press:e});return _(t)}var U=t.extend("sap.ushell.components.cepsearchresult.app.cards.searchresultwidget.controls.SearchResultList",{metadata:{properties:{category:{type:"object"},paging:{type:"boolean",defaultValue:true},viewAll:{type:"boolean",defaultValue:false},view:{type:"string",defaultValue:""},template:{type:"object"},highlightTerm:{type:"string",defaultValue:""}},aggregations:{_footer:{type:"sap.m.OverflowToolbar",multiple:false,hidden:true}},events:{selectPage:{},fetchData:{},showAll:{}}},renderer:function(e,t){i.render(e,t);if(t.getPaging()||t.getViewAll()){e.renderControl(t.getAggregation("_footer"))}}});U.prototype.init=function(){this.addStyleClass("sapUiCEPCatList");this._initToolbar();this._sViewHeight="unset"};U.prototype._initToolbar=function(){this.setHeaderToolbar(w.clone())};U.prototype._initFooterBar=function(){var e;if(this.getViewAll()){e=S(this.handleViewAll.bind(this))}else{e=T(this.handleSelectPage.bind(this))}this.setAggregation("_footer",e)};U.prototype._initTemplate=function(){if(!this.oTemplatePromise){var e=this.getTemplate();var t="default";var i=this.getView();if(e&&e[i]){t=e[i]}this.oTemplatePromise=d.load({type:"XML",name:"sap.ushell.components.cepsearchresult.app.cards.searchresultwidget.templates."+t,controller:this}).then(function(e){this.oTemplate=e;this.oTemplatePromise=null;this.updateItems()}.bind(this))}return this.oTemplatePromise};U.prototype.bindAggregation=function(e,i){if(e==="items"){i.factory=function(e,t){if(this.oTemplate){return this.oTemplate.clone(e)}return new s}.bind(this)}return t.prototype.bindAggregation.apply(this,[e,i])};U.prototype._getCurrentColCount=function(){if(this.getDomRef()){var e=this.getDomRef().querySelectorAll(".sapMListItems > LI");var t=1;var i=e[0].offsetTop;for(var s=1;s<e.length;s++){if(e[s].offsetTop<=i){t=t+1}else{break}}return t}};U.prototype._startItemNavigation=function(){t.prototype._startItemNavigation.apply(this,[false]);if(this._oItemNavigation){if(this.getView()==="Tile"){this._oItemNavigation.setItemDomRefs(Array.from(this.getDomRef().querySelectorAll(".sapMGT")))}this._oItemNavigation.setTableMode(false,true).setColumns(this._getCurrentColCount())}};U.prototype.setView=function(e){var t=this.getProperty("view");this.setProperty("view",e);this.removeStyleClass("sapUiCEPCatListCard");this.removeStyleClass("sapUiCEPCatListTile");switch(e){case"Card":this.addStyleClass("sapUiCEPCatListCard");break;case"Tile":this.addStyleClass("sapUiCEPCatListTile");break;default:}if(this._iGivenPageSize&&this.getDomRef()&&this.getDomRef().offsetWidth){this.loadForVisibleItemCount(this._iGivenPageSize,this.getDomRef())}if(e&&t!==e){this._sViewHeight="unset"}if(this.getTemplate()!==null){this._changeTemplate()}this.updateItems();return this};U.prototype.setViewAll=function(e){this.setProperty("viewAll",e);this._initFooterBar()};U.prototype.setTemplate=function(e){if(e!==this.getTemplate()||!this.oTemplate){this._changeTemplate();this.setProperty("template",e);this.updateItems()}};U.prototype._changeTemplate=function(){if(this.oTemplatePromise){this.oTemplatePromise.then(this._changeTemplate.bind(this),this._changeTemplate.bind(this));return}this.oTemplatePromise=null;this.oTemplate=null;this._initTemplate()};U.prototype.loadForVisibleItemCount=function(e,t){this._iGivenPageSize=e;this._iCurrentPageSize=e;var i,s;if(this.getView()==="Tile"&&t){i=Math.floor((t.offsetWidth-30)/(v+5));s=Math.ceil(e/i);this._iCurrentPageSize=s*i}if(this.getView()==="Card"&&t){i=Math.min(Math.floor((t.offsetWidth-20)/300),3);s=Math.ceil(e/i);this._iCurrentPageSize=s*i}this.fireFetchData({page:1,pageSize:this._iCurrentPageSize})};U.prototype.handleSelectPage=function(e){this._sViewHeight=this.getDomRef().offsetHeight+"px";this.fireFetchData({page:e.getParameter("page"),pageSize:this._iCurrentPageSize})};U.prototype.handleViewAll=function(e){this.fireShowAll({category:this.getModel("category").getProperty("/name")})};U.prototype._onResize=function(e){if(this._oItemNavigation){this._oItemNavigation.setColumns(this._getCurrentColCount())}var t=this.getView();if(t==="Tile"&&e.size&&Math.abs(this.getDomRef().offsetWidth-this.iCurrentWidth)>v){this.loadForVisibleItemCount(this._iGivenPageSize,this.getDomRef());this._sViewHeight="unset";this.getDomRef().style.height=this._sViewHeight}if(this.getDomRef()){this.iCurrentWidth=this.getDomRef().offsetWidth}};U.prototype.applyModelContexts=function(e,t){for(var i in t){this.setModel(e,i);this.setElementBindingContext(e.createBindingContext(t[i]),i)}};U.prototype.itemNavigate=function(e){var t=e.getSource();while(t.getParent()){if(t.getParent()===this){this.fireItemPress({listItem:t,srcControl:e.getSource()});break}t=t.getParent()}};U.prototype.onBeforeRendering=function(){if(this._iResizeListenerId){g.resize.detachHandler(this._fnResizeListener);p.deregister(this._iResizeListenerId);this._iResizeListenerId=null}if(this.getDomRef()){this.getDomRef().nextElementSibling.remove()}if(this.getItems().length>0){this.removeStyleClass("sapUiCEPCatListNoData")}else{this.addStyleClass("sapUiCEPCatListNoData")}if(this._oHighlighter){this._oHighlighter.destroy();this._oHighlighter=null}t.prototype.onBeforeRendering.apply(this,arguments)};U.prototype.onAfterRendering=function(){if(!this._iResizeListenerId){this._fnResizeListener=this._onResize.bind(this);g.resize.attachHandler(this._fnResizeListener);this._iResizeListenerId=p.register(this,this._fnResizeListener)}t.prototype.onAfterRendering.apply(this,arguments);this.getDomRef().style.height=this._sViewHeight;if(this.getHighlightTerm()&&this.getItems().length>0){this._oHighlighter=new y(this.getDomRef().querySelector(".sapMListItems"),{isCaseSensitive:false,shouldBeObserved:true});this._oHighlighter.highlight(this.getHighlightTerm())}};return U});