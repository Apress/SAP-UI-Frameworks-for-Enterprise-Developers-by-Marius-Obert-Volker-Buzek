// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/assert","sap/ui/model/json/JSONModel","sap/ui/base/ManagedObject","sap/ui/core/Core","sap/ui/integration/util/DataProviderFactory","sap/ui/integration/util/BindingResolver","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/Destinations"],function(t,a,e,s,i,r,o,n,l){"use strict";var d=new s;var u=e.extend("sap.ushell.components.cepsearchresult.app.util.SearchResultModel",{constructor:function(){e.apply(this,arguments);i.attachThemeChanged(function(){this.checkUpdate(true)}.bind(this))}});u.prototype.setDestinations=function(t){this._destinations=t};u.prototype.setExtension=function(t){this._extension=t};u.prototype.addFormatters=function(t,a){if(!this._oFormatters){this._oFormatters={}}this._oFormatters[t]=a};u.prototype.removeFormatters=function(t){if(this._oFormatters&&this._oFormatters[t]){delete this._oFormatters[t]}};u.prototype.setHost=function(t){this._host=t};u.prototype.setCard=function(t){this._card=t};u.prototype.fetchCategoryData=function(t){var a=this.getData();a._status=a._status||{};a.list=a.list||{data:{}};a.list.data=a.list.data||{};a.list.data._result=[];a.list.data._count=0;a.list._currentView=a.list._currentView||a.list.defaultView;a._status.dataStatusText=a.list.loadingDataText;a.list.paginator.currentPage=t;a.list.paginator.skip=(a.list.paginator.currentPage-1)*a.list.paginator.pageSize;a.list.paginator.top=a.list.paginator.pageSize;var s=new e(a.list.paginator);var u=i.byId(this._host);this.oDataProviderFactory=new r({destinations:new l({host:u,manifestConfig:this._destinations,data:a.list.data}),card:this._card,extension:this._extension,host:u});d.setModel(s,"paginator");d.setModel(this._card.getModel("parameters"),"parameters");var p=a.list.data.request;var c=a.list.data.extension;var h;if(p&&p.url&&a.list.data.destinations){var g=/\{\{destinations.([^}]+)/;var _=p.url.match(g);if(_&&_[1]){var f="{{destinations."+_[1]+"}}";p.url=p.url.replace(f,"{destinations>/placeholder}");d.setModel(new e({placeholder:f}),"destinations")}}if(p){p=o.resolveValue(p,d);h=this.oDataProviderFactory.create({request:p})}if(c){c=o.resolveValue(c,d);h=this.oDataProviderFactory.create({extension:c})}d.setModel(null,"paginator");d.setModel(null,"parameters");d.setModel(null,"destinations");return h.getData().then(function(t){var s=new e(t);a.list.data._result=s.getProperty(a.list.data.path);a.list.data._count=s.getProperty(a.list.data.count);if(!a.list.data._result||!Array.isArray(a.list.data._result)||a.list.data._result.length===0){a._status.dataStatusText=a.list.noDataText}if(a.list.data.clientSplice){a.list.data._result.splice(0,a.list.paginator.skip);a.list.data._result.splice(a.list.paginator.top)}for(var i=0;i<a.list.data._result.length;i++){var r=o.resolveValue(n.createBindingInfos(a.list.data.mapping,this._oFormatters),s,a.list.data.path+"/"+i);a.list.data._result[i]=r}this.checkUpdate()}.bind(this)).catch(function(){a.list.data._result=[];a.list.data._count=0;a._status.dataStatusText=a.list.noDataText;this.checkUpdate()}.bind(this))};return u});