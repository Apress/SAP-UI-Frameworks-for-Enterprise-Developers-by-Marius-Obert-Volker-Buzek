/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/PropertyFormatters","sap/fe/macros/field/FieldHelper","sap/fe/macros/internal/valuehelp/ValueHelpTemplating"],function(e,t,n,o,r,a){"use strict";var s=a.generateID;var i=o.getRelativePropertyPath;var l=n.generate;const c="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1";function u(){this.control.detachModelContextChange(u,this);const e=this.modelName,t=this.control.getModel(e);if(t){this.resolve(t)}else{this.control.attachModelContextChange(u,this)}}async function d(e,t,n){const o=[];const r=await Promise.resolve().then(n.getAggregation.bind(n,e,"customData"));const a=r.reduce((e,r)=>e.then(n.getProperty.bind(n,r,"key")).then(function(e){if(e===t){o.push(r)}}),Promise.resolve());await a;if(o.length===1){return n.getProperty(o[0],"value")}else{return undefined}}const f="sap_fe_ControlDelegate_propertyInfoMap";const g={setCachedProperties(e,t){if(e instanceof window.Element){return}const n=f;g.setCustomData(e,n,t)},getCachedProperties(e){if(e instanceof window.Element){return null}const t=f;return g.getCustomData(e,t)},getCustomData(e,t,n){if(n){return d(e,t,n)}else{if(e&&t){if(e instanceof window.Element){return e.getAttributeNS(c,t)}if(e.data instanceof Function){return e.data(t)}}return undefined}},setCustomData(e,t,n){if(e&&t){if(e instanceof window.Element){return e.setAttributeNS(c,`customData:${t}`,n)}if(e.data instanceof Function){return e.data(t,n)}}},fetchPropertiesForEntity(e,t){return t.requestObject(`${e}/`)},fetchAnnotationsForEntity(e,t){return t.requestObject(`${e}@`)},fetchModel(e){return new Promise(t=>{const n=e.getDelegate().payload&&e.getDelegate().payload.modelName,o={modelName:n,control:e,resolve:t};u.call(o)})},templateControlFragment(e,n,o,r){return t.templateControlFragment(e,n,o,r)},doesValueHelpExist(e){const t=e.sPropertyName||"";const n=e.sValueHelpType||"";const o=e.oMetaModel;const a=e.oModifier;const c=`${e.sBindingPath}/${t}`;const u=o.createBindingContext(c);let d=r.valueHelpProperty(u);const f=e.sBindingPath&&e.sBindingPath.indexOf("/")===0;if(d.indexOf("$Path")>-1){d=o.getObject(d)}if(f&&d.indexOf("/")!==0){d=`${e.sBindingPath}/${d}`}const g=s(e.flexId,l([a?a.getId(e.oControl):e.oControl.getId(),n]),i(u.getProperty(c),{context:{getModel:()=>e.oMetaModel,getPath:()=>c}}),i(u.getProperty(d),{context:{getModel:()=>e.oMetaModel,getPath:()=>d}}));return Promise.resolve().then(function(){if(a){return a.getAggregation(e.oControl,"dependents")}return e.oControl.getAggregation("dependents")}).then(function(e){return Promise.resolve(e&&e.some(function(e){return a?a.getId(e)===g:e.getId()===g}))})},isValueHelpRequired(t,n){const o=t.sPropertyName||"",a=t.oMetaModel,s=`${t.sBindingPath}/${o}`,i=a.createBindingContext(s),l=r.valueHelpProperty(i,n);return this.getCustomData(t.oControl,"displayModePropertyBinding",t.oModifier).then(function(e){e=typeof e==="boolean"?e:e==="true";if(e){return false}return Promise.all([a.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueListWithFixedValues`),a.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueListReferences`),a.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueListMapping`),a.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueList`)])}).then(function(e){return!!e[0]||!!e[1]||!!e[2]||!!e[3]}).catch(function(t){e.warning("Error while retrieving custom data / value list annotation values",t)})},isMultiValue(e){let t=true;switch(e.filterExpression){case"SearchExpression":case"SingleRange":case"SingleValue":t=false;break;default:break}if(e.type&&e.type.indexOf("Boolean")>0){t=false}return t}};return g},false);