/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/base/util/deepEqual","sap/base/util/deepExtend","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/ExcelFormatHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/SizeHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/type/EDM","sap/fe/core/type/TypeUtil","sap/fe/macros/CommonHelper","sap/fe/macros/DelegateUtil","sap/fe/macros/filterBar/FilterBarDelegate","sap/fe/macros/table/TableSizeHelper","sap/fe/macros/table/Utils","sap/ui/core/Fragment","sap/ui/mdc/odata/v4/TableDelegate","sap/ui/model/Filter","sap/ui/model/json/JSONModel","../TableHelper"],function(e,t,n,a,i,o,r,s,l,c,d,u,p,g,f,m,h,y,v,b,P,C,D,F,T,_){"use strict";var x=f.isTypeFilterable;var I=g.isMultipleNavigationProperty;var S=u.getResourceModel;var A=u.getLocalizedText;var M=r.getInvolvedDataModelObjects;const w="/semanticKeyHasDraftIndicator";return Object.assign({},D,{_computeVisualSettingsForFieldGroup:function(e,t,n){if(t.name.indexOf("DataFieldForAnnotation::FieldGroup::")===0){const i=e.getColumns().find(function(e){return e.getDataProperty()===t.name});const o=i?i.data("showDataFieldsLabel")==="true":false;const r=e.getModel().getMetaModel();const s=M(r.getContext(t.metadataPath));const l=s.convertedTypes;const c=s.targetObject;const d=c.Target.$target;const u=[];d.Data.forEach(function(e){let t;switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":t=b.getWidthForDataFieldForAnnotation(e,n,l,o);break;case"com.sap.vocabularies.UI.v1.DataField":t=b.getWidthForDataField(e,o,n,l);break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":t={labelWidth:0,propertyWidth:p.getButtonWidth(e.Label)};break;default:}if(t){u.push(t.labelWidth+t.propertyWidth)}});const g=u.reduce(function(e,t){return Math.max(e,t)},0);t.visualSettings=a(t.visualSettings,{widthCalculation:{verticalArrangement:true,minWidth:Math.ceil(g)}})}},_computeVisualSettingsForPropertyWithValueHelp:function(e,t){const n=e.getParent();if(!t.propertyInfos){const i=e.getModel().getMetaModel();if(t.metadataPath&&i){const e=i.getObject(`${t.metadataPath}@`);if(e&&e["@com.sap.vocabularies.Common.v1.ValueList"]){t.visualSettings=a(t.visualSettings||{},{widthCalculation:{gap:n.getProperty("readOnly")?0:4}})}}}},_computeVisualSettingsForPropertyWithUnit:function(e,t,n,i,o){const r=e?e.getParent():null;const s=i||o;if(s){t.visualSettings=a(t.visualSettings,{widthCalculation:{gap:Math.ceil(p.getButtonWidth(s))}})}if(n){t.visualSettings=a(t.visualSettings,{widthCalculation:{gap:r&&r.getReadOnly()?0:6}})}},_computeLabel:function(e,t){if(e.label){var n;const a=t[e.label];if((a===null||a===void 0?void 0:a.length)>1&&(n=e.path)!==null&&n!==void 0&&n.includes("/")&&e.additionalLabels){e.label=e.label+" ("+e.additionalLabels.join(" / ")+")"}delete e.additionalLabels}},_updatePropertyInfo:function(e,t){const n={};const i=e.getP13nMode();t.forEach(e=>{if(!e.propertyInfos&&e.label){if((i===null||i===void 0?void 0:i.indexOf("Sort"))>-1&&e.sortable||(i===null||i===void 0?void 0:i.indexOf("Filter"))>-1&&e.filterable||(i===null||i===void 0?void 0:i.indexOf("Group"))>-1&&e.groupable){n[e.label]=n[e.label]!==undefined?n[e.label].concat([e]):[e]}}});t.forEach(i=>{this._computeVisualSettingsForFieldGroup(e,i,t);this._computeVisualSettingsForPropertyWithValueHelp(e,i);i.typeConfig=a(i.typeConfig,{});this._computeLabel(i,n)});return t},getColumnsFor:function(e){return e.getParent().getTableDefinition().columns},_getAggregatedPropertyMap:function(e){return e.getParent().getTableDefinition().aggregates},fetchExportCapabilities:function(t){const n={XLSX:{}};let a;return y.fetchModel(t).then(function(e){a=e;return a.getMetaModel().getObject("/$EntityContainer@Org.OData.Capabilities.V1.SupportedFormats")}).then(function(e){const t=(e||[]).map(e=>e.toLowerCase());if(t.indexOf("application/pdf")>-1){return a.getMetaModel().getObject("/$EntityContainer@com.sap.vocabularies.PDF.v1.Features")}return undefined}).then(function(e){if(e){n["PDF"]=Object.assign({},e)}}).catch(function(t){e.error(`An error occurs while computing export capabilities: ${t}`)}).then(function(){return n})},_isFilterableNavigationProperty:function(e,t,n){const a=M(t.getContext(y.getCustomData(n,"metaPath"))),i=M(t.getContext(e.annotationPath)).navigationProperties,o=i.findIndex(e=>{var t;return((t=e.targetType)===null||t===void 0?void 0:t.name)===a.targetEntityType.name}),r=i.slice(o>0?o:0);return!e.relativePath.includes("/")||e.isPartOfLineItem===true&&!r.some(I)},_fetchPropertyInfo:function(e,t,n,a){var i,o,r;const s=t.annotationPath,l=e.getObject(s),c=e.createBindingContext(s),d=(i=t.typeConfig)!==null&&i!==void 0&&i.className&&x(t.typeConfig.className)?m.getTypeConfig(t.typeConfig.className,t.typeConfig.formatOptions,t.typeConfig.constraints):{},u=h.isPropertyFilterable(c,l),p=t.typeConfig&&t.typeConfig.className&&((o=t.typeConfig.className)===null||o===void 0?void 0:o.indexOf("Edm."))!==0,g=y.getCustomData(n,"enableAnalytics")==="true",f=g?this._getAggregatedPropertyMap(n):{},v=A(t.label??"",a??n);const b={name:t.name,metadataPath:s,groupLabel:t.groupLabel,group:t.group,label:v,tooltip:t.tooltip,typeConfig:d,visible:t.availability!=="Hidden"&&!p,exportSettings:this._setPropertyInfoExportSettings(t.exportSettings,t),unit:t.unit};if(t.visualSettings&&Object.keys(t.visualSettings).length>0){b.visualSettings=t.visualSettings}if(t.exportDataPointTargetValue){b.exportDataPointTargetValue=t.exportDataPointTargetValue}if((r=t.propertyInfos)!==null&&r!==void 0&&r.length){b.propertyInfos=t.propertyInfos;if(b.exportSettings){var P;b.exportSettings.wrap=(P=t.exportSettings)===null||P===void 0?void 0:P.wrap}}else{var C;b.path=t.relativePath;b.sortable=t.sortable;if(g){this._updateAnalyticalPropertyInfoAttributes(b,t)}b.filterable=!!u&&this._isFilterableNavigationProperty(t,e,n)&&(!g||!f[b.name]&&!((C=t.extension)!==null&&C!==void 0&&C.technicallyGroupable));b.key=t.isKey;b.groupable=t.isGroupable;if(t.textArrangement){const e=this.getColumnsFor(n).find(function(e){var n;return e.name===((n=t.textArrangement)===null||n===void 0?void 0:n.textProperty)});if(e){b.mode=t.textArrangement.mode;b.valueProperty=t.relativePath;b.descriptionProperty=e.relativePath}}b.text=t.textArrangement&&t.textArrangement.textProperty;b.caseSensitive=t.caseSensitive;if(t.additionalLabels){b.additionalLabels=t.additionalLabels.map(e=>A(e,a||n))}}this._computeVisualSettingsForPropertyWithUnit(n,b,t.unit,t.unitText,t.timezoneText);return b},_setPropertyInfoExportSettings:function(e,t){var n;const a=this._getExportFormat((n=t.typeConfig)===null||n===void 0?void 0:n.className);if(e){if(a&&!e.timezoneProperty){e.format=a}if(e.template){var i;e.template=(i=t.exportSettings)===null||i===void 0?void 0:i.template}}return e},_updateAnalyticalPropertyInfoAttributes(e,t){if(t.aggregatable){e.aggregatable=t.aggregatable}if(t.extension){e.extension=t.extension}},_fetchCustomPropertyInfo:function(e,t,n){const a=A(e.header,n||t);const i={name:e.name,groupLabel:undefined,group:undefined,label:a,type:"Edm.String",visible:e.availability!=="Hidden",exportSettings:e.exportSettings,visualSettings:e.visualSettings};if(e.propertyInfos&&e.propertyInfos.length){i.propertyInfos=e.propertyInfos;i.exportSettings={wrap:e.exportSettings.wrap,template:e.exportSettings.template}}else{i.path=e.name;i.sortable=false;i.filterable=false}return i},_bColumnHasPropertyWithDraftIndicator:function(e){return!!(e.formatOptions&&e.formatOptions.hasDraftIndicator||e.formatOptions&&e.formatOptions.fieldGroupDraftIndicatorPropertyPath)},_updateDraftIndicatorModel:function(e,t){const n=e.getColumns();const a=e.getBindingContext("internal");const i=a&&a.getPath();if(n&&a){for(const e in n){if(this._bColumnHasPropertyWithDraftIndicator(t)&&t.name===n[e].getDataProperty()){if(a.getProperty(i+w)===undefined){a.setProperty(i+w,t.name);break}}}}},_fetchPropertiesForEntity:function(t,n,a,i){const r=d.getEntitySetPath(n);let s=[];const l=o.getFilterRestrictionsByPath(r,a);const c=l.NonFilterableProperties;return Promise.resolve(this.getColumnsFor(t)).then(e=>{if(e){let n;e.forEach(e=>{this._updateDraftIndicatorModel(t,e);switch(e.type){case"Annotation":n=this._fetchPropertyInfo(a,e,t,i);if(n&&c.indexOf(n.name)===-1){n.maxConditions=y.isMultiValue(n)?-1:1}break;case"Slot":case"Default":n=this._fetchCustomPropertyInfo(e,t,i);break;default:throw new Error(`unhandled switch case ${e.type}`)}s.push(n)})}}).then(()=>{s=this._updatePropertyInfo(t,s)}).catch(function(t){e.error(`An error occurs while updating fetched properties: ${t}`)}).then(function(){return s})},_getCachedOrFetchPropertiesForEntity:function(e,t,n,a){const i=y.getCachedProperties(e);if(i){return Promise.resolve(i)}return this._fetchPropertiesForEntity(e,t,n,a).then(function(t){y.setCachedProperties(e,t);return t})},_setTableNoDataText:function(e,t){let n="";const a=P.getAllFilterInfo(e),i=t.path.startsWith("/")?t.path.substr(1):t.path;const o=function(){if(e.data("hiddenFilters")||e.data("quickFilterKey")){return"M_TABLE_AND_CHART_NO_DATA_TEXT_MULTI_VIEW"}else{return"T_TABLE_AND_CHART_NO_DATA_TEXT_WITH_FILTER"}};const r=e.getFilter();if(r&&!/BasicSearch$/.test(r)){if(a.search||a.filters&&a.filters.length){n=o()}else{n="T_TABLE_AND_CHART_NO_DATA_TEXT"}}else if(a.search||a.filters&&a.filters.length){n=o()}else{n="M_TABLE_AND_CHART_NO_FILTERS_NO_DATA_TEXT"}e.setNoData(S(e).getText(n,undefined,i))},handleTableDataReceived:function(e,t){const n=e&&e.getRowBinding(),a=t&&t.getProperty("dataReceivedAttached");if(t&&!a){n.attachDataReceived(function(){t.setProperty("selectedContexts",[]);const n=e.getSelectedContexts();t.setProperty("selectedContexts",n);t.setProperty("numberOfSelectedContexts",n.length);const a=JSON.parse(h.parseCustomData(y.getCustomData(e,"operationAvailableMap")));i.setActionEnablement(t,a,n,"table");l.updateDeleteInfoForSelectedContexts(t,n);const o=e?e.getParent():null;if(o){o.setUpEmptyRows(e)}});t.setProperty("dataReceivedAttached",true)}},rebind:function(t,n){const a=t.getParent();const i=a===null||a===void 0?void 0:a.getProperty("bindingSuspended");a===null||a===void 0?void 0:a.setProperty("outDatedBinding",i);if(!i){P.clearSelection(t);D.rebind.apply(this,[t,n]);P.onTableBound(t);this._setTableNoDataText(t,n);return P.whenBound(t).then(this.handleTableDataReceived(t,t.getBindingContext("internal"))).catch(function(t){e.error("Error while waiting for the table to be bound",t)})}return Promise.resolve()},fetchProperties:function(e){return y.fetchModel(e).then(t=>this._getCachedOrFetchPropertiesForEntity(e,y.getCustomData(e,"entityType"),t.getMetaModel())).then(t=>{e.getBindingContext("internal").setProperty("tablePropertiesAvailable",true);return t})},preInit:function(e){return D.preInit.apply(this,[e]).then(function(){const t=e.getCreationRow();if(t){t.setBindingContext(null)}})},updateBindingInfo:function(e,t){D.updateBindingInfo.apply(this,[e,t]);this._internalUpdateBindingInfo(e,t);t.events.dataReceived=e.getParent().onInternalDataReceived.bind(e.getParent());t.events.dataRequested=e.getParent().onInternalDataRequested.bind(e.getParent());this._setTableNoDataText(e,t);_.enableFastCreationRow(e.getCreationRow(),t.path,e.getBindingContext(),e.getModel(),e.getModel("ui").getProperty("/isEditable"))},_manageSemanticTargets:function(e){const t=e.getRowBinding();if(t){t.attachEventOnce("dataRequested",function(){setTimeout(function(){const t=o.getTargetView(e);if(t){P.getSemanticTargetsFromTable(t.getController(),e)}},0)})}},updateBinding:function(t,a,i){const r=t.getParent();const s=r===null||r===void 0?void 0:r.getProperty("bindingSuspended");if(!s){let r=false;const s=o.getTargetView(t);const l=t.getBindingContext("internal");const c="pendingManualBindingUpdate";const d=l.getProperty(c);const u=t.getRowBinding();if(u){const e=u.getFilters("Application");r=n(a.filters,e[0])&&u.getQueryOptionsFromParameters().$search===a.parameters.$search&&!d&&s&&s.getViewData().converterType==="ListReport"}D.updateBinding.apply(this,[t,a,i]);t.fireEvent("bindingUpdated");if(r&&t.getFilter()&&i){u.requestRefresh(u.getGroupId()).finally(function(){l.setProperty(c,false)}).catch(function(t){e.error("Error while refreshing the table",t)});l.setProperty(c,true)}this._manageSemanticTargets(t)}r===null||r===void 0?void 0:r.setProperty("outDatedBinding",s)},_computeRowBindingInfoFromTemplate:function(e){const n=t(y.getCustomData(e,"rowsBindingInfo"));if(n.parameters.$$getKeepAliveContext){const t=y.getCustomData(e,"targetCollectionPath");const a=e.getModel("internal");const i=a.getObject("/keptAliveLists")||{};if(!i[t]){i[t]=e.getId();a.setProperty("/keptAliveLists",i)}else if(i[t]!==e.getId()){delete n.parameters.$$getKeepAliveContext}}return n},_internalUpdateBindingInfo:function(e,t){const n=e.getBindingContext("internal");Object.assign(t,this._computeRowBindingInfoFromTemplate(e));if(e.getRowBinding()){t.suspended=false}if(n){n.setProperty("dataReceivedAttached",false)}let a;const i=P.getAllFilterInfo(e);if(i.filters.length>0){a=new F({filters:i.filters,and:true})}if(i.bindingPath){t.path=i.bindingPath}const o=e.getDataStateIndicator();if(o&&o.isFiltering()){if(t.filters.length>0){a=new F({filters:t.filters.concat(i.filters),and:true});this.updateBindingInfoWithSearchQuery(t,i,a)}}else{this.updateBindingInfoWithSearchQuery(t,i,a)}},updateBindingInfoWithSearchQuery:function(e,t,n){e.filters=n;if(t.search){e.parameters.$search=o.normalizeSearchTerm(t.search)}else{e.parameters.$search=undefined}},_templateCustomColumnFragment:function(e,t,n,a){const i=new T(e),o=new T({id:a}),r={bindingContexts:{this:o.createBindingContext("/"),column:i.createBindingContext("/")},models:{this:o,column:i}};return y.templateControlFragment("sap.fe.macros.table.CustomColumn",r,{view:t},n).then(function(e){i.destroy();return e})},_templateSlotColumnFragment:async function(t,n,a,i){const o=new T(t),r=new T({id:i}),s={bindingContexts:{this:r.createBindingContext("/"),column:o.createBindingContext("/")},models:{this:r,column:o}};const l=await y.templateControlFragment("sap.fe.macros.table.SlotColumn",s,{isXML:true});if(!l){return Promise.resolve(null)}const c=l.getElementsByTagName("slot")[0],d=l.getElementsByTagName("mdcTable:template")[0];d.removeChild(c);if(t.template){const e=(new DOMParser).parseFromString(t.template,"text/xml");d.appendChild(e.firstElementChild)}else{e.error(`Please provide content inside this Building Block Column: ${t.header}`);return Promise.resolve(null)}if(a.targets!=="jsControlTree"){return l}return C.load({type:"XML",definition:l})},_getExportFormat:function(e){switch(e){case"Edm.Date":return c.getExcelDatefromJSDate();case"Edm.DateTimeOffset":return c.getExcelDateTimefromJSDateTime();case"Edm.TimeOfDay":return c.getExcelTimefromJSTime();default:return undefined}},_getVHRelevantFields:function(e,t,n){let a=[],i=e.getObject(t);if(i.$kind&&i.$kind==="Property"){i=e.getObject(`${t}@com.sap.vocabularies.UI.v1.DataFieldDefault`);t=`${t}@com.sap.vocabularies.UI.v1.DataFieldDefault`}switch(i.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.getObject(`${t}/Target/$AnnotationPath`).includes("com.sap.vocabularies.UI.v1.FieldGroup")){e.getObject(`${t}/Target/$AnnotationPath/Data`).forEach((n,i)=>{a=a.concat(this._getVHRelevantFields(e,`${t}/Target/$AnnotationPath/Data/${i}`))})}break;case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":a.push(e.getObject(`${t}/Value/$Path`));break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":break;default:if(t.indexOf(n)===0){a.push(t.substring(n.length+1));break}a.push(h.getNavigationPath(t,true));break}return a},_setDraftIndicatorOnVisibleColumn:function(e,t,n){const a=e.getBindingContext("internal");if(!a){return}const i=a.getPath();const o=t.filter(e=>this._bColumnHasPropertyWithDraftIndicator(e));const r=e.getColumns();let s,l,c,d;for(const e in r){l=r[e].getDataProperty();for(const e in o){d=o[e].name;if(l===d){c=true;break}if(n&&n.name===d){s=n.name}}if(c){a.setProperty(i+w,l);break}}if(!c&&s){a.setProperty(i+w,s)}},removeItem:function(e,t,n){let a=true;if(!e){return Promise.resolve(a)}const i=n.modifier;const o=i.getProperty(e,"dataProperty");if(o&&o.indexOf&&o.indexOf("InlineXML")!==-1){i.insertAggregation(t,"dependents",e);a=false}if(t.isA&&i.targets==="jsControlTree"){this._setDraftIndicatorStatus(i,t,this.getColumnsFor(t))}return Promise.resolve(a)},_getMetaModel:function(e){return e.appComponent&&e.appComponent.getModel().getMetaModel()},_setDraftIndicatorStatus:function(e,t,n,a){if(e.targets==="jsControlTree"){this._setDraftIndicatorOnVisibleColumn(t,n,a)}},_getGroupId:function(e){return e||undefined},_getDependent:function(e,t,n){if(t===n){return e}return undefined},_fnTemplateValueHelp:function(e,t,n){if(t&&!n){return e("sap.fe.macros.table.ValueHelp")}return Promise.resolve()},_getDisplayMode:function(e){let t;if(e!==undefined){e=typeof e==="boolean"?e:e==="true";t=e?"Display":"Editable";return{displaymode:e,columnEditMode:t}}return{displaymode:undefined,columnEditMode:undefined}},_insertAggregation:function(e,t,n){if(e){return t.insertAggregation(n,"dependents",e,0)}return undefined},addItem:async function(t,n,a){const i=this._getMetaModel(a),r=a.modifier,s=r.getId(n),l=n.isA?this.getColumnsFor(n):null;if(!l){return Promise.resolve(null)}const c=l.find(function(e){return e.name===t});if(!c){e.error(`${t} not found while adding column`);return Promise.resolve(null)}this._setDraftIndicatorStatus(r,n,l,c);if(c.type==="Default"){return this._templateCustomColumnFragment(c,a.view,r,s)}if(c.type==="Slot"){return this._templateSlotColumnFragment(c,a.view,r,s)}if(!i){return Promise.resolve(null)}const d=await y.getCustomData(n,"metaPath",r);const u=await y.getCustomData(n,"entityType",r);const p=await y.getCustomData(n,"requestGroupId",r);const g=this._getGroupId(p);const f=i.createBindingContext(d);const m=await this._getCachedOrFetchPropertiesForEntity(n,u,i,a.appComponent);const h=m.find(function(e){return e.name===t});const v=i.createBindingContext(h.metadataPath);const b=this._getVHRelevantFields(i,h.metadataPath,d);const P={sBindingPath:d,sValueHelpType:"TableValueHelp",oControl:n,oMetaModel:i,oModifier:r,oPropertyInfo:h};const C=async t=>{const a=new T({id:s,requestGroupId:g}),o={bindingContexts:{this:a.createBindingContext("/"),dataField:v,contextPath:f},models:{this:a,dataField:i,metaModel:i,contextPath:i}};try{const e=await y.templateControlFragment(t,o,{},r);return await this._insertAggregation(e,r,n)}catch(t){e.error(`ValueHelp not loaded : ${t.message}`);return null}finally{a.destroy()}};const D=(e,o)=>{const l="sap.fe.macros.table.Column";let u;let p;let g;let m;return Promise.all([y.getCustomData(n,"displayModePropertyBinding",r),y.getCustomData(n,"tableType",r),y.getCustomData(n,"onChange",r),y.getCustomData(n,"creationMode",r)]).then(e=>{u=e[0];p=e[1];g=e[2];m=e[3];const h=this._getDisplayMode(u);u=h.displaymode;const b=h.columnEditMode;const P=new T({enableAutoColumnWidth:n.getParent().enableAutoColumnWidth,isOptimizedForSmallDevice:n.getParent().isOptimizedForSmallDevice,readOnly:u,columnEditMode:b,tableType:p,onChange:g,id:s,navigationPropertyPath:t,columnInfo:c,collection:{sPath:d,oModel:i},creationMode:m}),C={bindingContexts:{entitySet:f,collection:f,dataField:v,this:P.createBindingContext("/"),column:P.createBindingContext("/columnInfo")},models:{this:P,entitySet:i,collection:i,dataField:i,metaModel:i,column:P},appComponent:a.appComponent};return y.templateControlFragment(l,C,{view:o},r).finally(function(){P.destroy()})})};await Promise.all(b.map(async e=>{const t=Object.assign({},P,{sPropertyName:e});const n=await Promise.all([y.isValueHelpRequired(t),y.doesValueHelpExist(t)]);const a=n[0],i=n[1];return this._fnTemplateValueHelp(C,a,i)}));const F=a.view||o.getTargetView(n)||(a.appComponent?o.getCurrentPageView(a.appComponent):undefined);return D(h,F)},getFilterDelegate:function(){return Object.assign({},v,{addItem:function(e,t){if(e.indexOf("Property::")===0){e=e.replace("Property::","")}return v.addItem(e,t)}})},getTypeUtil:function(){return m},formatGroupHeader(e,t,n){var a,i;const o=y.getCachedProperties(e),r=o&&o.filter(e=>e.name===n)[0],l=(r===null||r===void 0?void 0:(a=r.typeConfig)===null||a===void 0?void 0:a.baseType)==="DateTime"||(r===null||r===void 0?void 0:(i=r.typeConfig)===null||i===void 0?void 0:i.baseType)==="Date";let c;if(r&&r.mode){switch(r.mode){case"Description":c=t.getProperty(r.descriptionProperty,l);break;case"DescriptionValue":c=s.formatWithBrackets(t.getProperty(r.descriptionProperty,l),t.getProperty(r.valueProperty,l));break;case"ValueDescription":c=s.formatWithBrackets(t.getProperty(r.valueProperty,l),t.getProperty(r.descriptionProperty,l));break;default:break}}else{c=t.getProperty(r===null||r===void 0?void 0:r.path,l)}return S(e).getText("M_TABLE_GROUP_HEADER_TITLE",[r===null||r===void 0?void 0:r.label,c])}})},false);