/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyFormatters","sap/fe/core/type/FiscalDate","sap/fe/macros/CommonHelper","sap/ui/model/odata/v4/AnnotationHelper"],function(e,t,n,o,i,r,a){"use strict";var l={};var s=o.getProperty;var c=n.getContextRelativeTargetObjectPath;var u=t.pathInModel;var f=t.getFiscalType;var p=t.EDM_TYPE_MAPPING;var d=t.compileExpression;function g(t,n){const o=n.context.getModel();const i=n.context.getPath();const a=r.getLocationForPropertyPath(o,i);let l;let s=o.getObject(`${a}/@com.sap.vocabularies.Common.v1.ResultContext`);if(!s){var c;if(typeof t==="string"){l=t}else{l=o.getObject(`${i}@sapui.name`)}const n=e.getFilterRestrictionsByPath(a,o);s=n===null||n===void 0?void 0:(c=n.RequiredProperties)===null||c===void 0?void 0:c.includes(l)}return s}l.isRequiredInFilter=g;function m(t,n){var o;const i=n.context.getModel();const a=n.context.getPath();const l=r.getLocationForPropertyPath(i,a);let s;let c=-1;if(i.getObject(`${l}/@com.sap.vocabularies.Common.v1.ResultContext`)===true){return 1}if(typeof t==="string"){s=t}else{s=i.getObject(`${a}@sapui.name`)}const u=e.getFilterRestrictionsByPath(l,i);let f=i.getObject(`${l}/${s}`);if(!f){f=i.getObject(a)}if(f.$Type==="Edm.Boolean"){c=1}else if(u!==null&&u!==void 0&&(o=u.FilterAllowedExpressions)!==null&&o!==void 0&&o[s]){const t=e.getSpecificAllowedExpression(u.FilterAllowedExpressions[s]);if(t==="SingleValue"||t==="SingleRange"){c=1}}return c}l.maxConditions=m;function v(e){const t=c(e,false,true);return d(u(`/conditions/${t}`,"$filters"))}l.getConditionsBinding=v;function y(e,t){const n=a.format(e,t)||"";const o=n.match(/constraints:.*?({.*?})/);let i=(o===null||o===void 0?void 0:o[1])||"";if(n.includes("sap.ui.model.odata.type.DateTimeOffset")){if(i){i=`${i.substring(0,o===null||o===void 0?void 0:o[1].indexOf("}"))}, V4: true}`}else{i="{V4: true}"}}if(i.includes("'nullable':false")){i=i.replace(/,[ ]*'nullable':false/,"").replace(/'nullable':false[, ]*/,"");if(i==="{}"){i=""}}return i||undefined}l.constraints=y;function P(e,t){var n;if(e.$Type==="Edm.String"){if(!e.hasOwnProperty("$Nullable")||e.$Nullable===true){t.arguments=[null,{parseKeepsEmptyString:false}]}const n=f(s(e,t));if(n){if(!t.arguments){t.arguments=[null,{}]}t.arguments[1].fiscalType=n}}const o=a.format(e,t)||"";return((n=o.match(/formatOptions:.*?({.*?})/))===null||n===void 0?void 0:n[1])||undefined}l.formatOptions=P;function b(e){if(e.type==="Edm.String"){const t=f(e);if(t){return"sap.fe.core.type.FiscalDate"}}const t=p[e.type];return t?t.type:e.type}l.getDataType=b;function h(e){if(e.type==="Edm.String"){const t=f(e);if(t){return new i({fiscalType:t},{}).getPattern()}}return undefined}l.getPlaceholder=h;return l},false);