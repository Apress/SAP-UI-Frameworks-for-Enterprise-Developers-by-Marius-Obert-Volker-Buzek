/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/ui/model/odata/v4/AnnotationHelper"],function(t,e,n,o,i,r,a){"use strict";var s={};var l=r.getDisplayMode;var u=r.getBindingWithUnitOrCurrency;var d=r.getBindingWithTimezone;var c=i.hasStaticPercentUnit;var v=o.getRelativePaths;var g=o.enhanceDataModelPath;var p=n.isProperty;var f=e.unresolvableExpression;var m=e.isPathInModelExpression;var O=e.getExpressionFromAnnotation;var T=e.formatWithTypeInformation;var I=e.formatResult;var b=e.EDM_TYPE_MAPPING;var _=e.compileExpression;const E=t=>t!==null&&t!==void 0&&t.TargetValue?O(t.TargetValue):f;const P=sap.ui.getCore().getLibraryResourceBundle("sap.fe.macros");const h=e=>{var n;const o=(e===null||e===void 0?void 0:(n=e.targetObject)===null||n===void 0?void 0:n.Value)||"";const i=v(e);let r=O(o,i);const a=E(e.targetObject);if(r&&a){var s,l,u,d;let n=e.targetObject.Value;if(!p(n)){n=e.targetObject.Value.$target}const v=((s=n.annotations)===null||s===void 0?void 0:(l=s.Measures)===null||l===void 0?void 0:l.Unit)||((u=n.annotations)===null||u===void 0?void 0:(d=u.Measures)===null||d===void 0?void 0:d.ISOCurrency);if(!v){return P.getText("T_COMMON_PROGRESS_INDICATOR_DISPLAY_VALUE_NO_UOM",[_(r),_(a)])}if(c(o===null||o===void 0?void 0:o.$target)){return`${_(r)} %`}r=T(n,r);const g=v.$target?T(v.$target,O(v,i)):O(v,i);return _(I([r,a,g],t.formatProgressIndicatorText))}return undefined};s.buildExpressionForProgressIndicatorDisplayValue=h;const A=t=>{var e,n,o,i,r,a;const s=v(t);const l=t===null||t===void 0?void 0:(e=t.targetObject)===null||e===void 0?void 0:(n=e.Value)===null||n===void 0?void 0:n.$target;if(!p(l)){return""}const u=((o=l.annotations)===null||o===void 0?void 0:(i=o.Measures)===null||i===void 0?void 0:i.Unit)||((r=l.annotations)===null||r===void 0?void 0:(a=r.Measures)===null||a===void 0?void 0:a.ISOCurrency);return u?_(O(u,s)):""};s.buildUnitBindingExpression=A;const D=(t,e)=>{if(e){return N(a.value(e,{context:t}))}};const N=t=>{if(t){const e=t>1?P.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL_PLURAL"):P.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL");return P.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE",[String(t),e])}};const x=(t,e)=>{let n;if(e&&e.SampleSize){n=D(t,e.SampleSize)}else if(e&&e.Description){const o=a.value(e.Description,{context:t});n="${path:"+o+"}"}return n};x.requiresIContext=true;s.getHeaderRatingIndicatorText=x;const M=t=>{var e,n,o;const i=v(t);if(t!==null&&t!==void 0&&(e=t.targetObject)!==null&&e!==void 0&&(n=e.annotations)!==null&&n!==void 0&&(o=n.Common)!==null&&o!==void 0&&o.Text){var r,a;const e=O(t===null||t===void 0?void 0:(r=t.targetObject.annotations)===null||r===void 0?void 0:(a=r.Common)===null||a===void 0?void 0:a.Text,i);if(m(e)){e.parameters={$$noPatch:true}}return e}return undefined};const V=(t,e,n)=>{if(!t.constraints){t.constraints={}}t.constraints=Object.assign(t.constraints,{precision:e.$target.precision,scale:n?n:e.$target.scale});if(n){if(!t.formatOptions){t.formatOptions={}}t.formatOptions=Object.assign(t.formatOptions,{preserveDecimals:false})}return t};const y=(t,e,n,o)=>{var i;let r;const a=(e===null||e===void 0?void 0:(i=e.path)===null||i===void 0?void 0:i.indexOf("/"))===-1?v(t):[];r=O(e,a);const s=t.targetObject;if(n&&m(r)){var l;T(s,r);r.type=(l=b[n])===null||l===void 0?void 0:l.type;switch(n){case"Edm.Decimal":r=V(r,e,o);break;default:}}return r};s.getValueFormatted=y;const j=(e,n,o)=>{var i,r,a,s;const u=e.targetObject;const c=(u===null||u===void 0?void 0:u.Value)||"";const v=c===null||c===void 0?void 0:(i=c.$target)===null||i===void 0?void 0:i.type;let p;if(v==="Edm.Decimal"&&u.ValueFormat){if(u.ValueFormat.NumberOfFractionalDigits){p=u.ValueFormat.NumberOfFractionalDigits}}const f=g(e,c.path);const m=f?M(f):undefined;const O=y(f,c,v,p);const T=m?n.displayMode||l(f):"Value";let b;switch(T){case"Description":b=m;break;case"ValueDescription":b=I([O,m],t.formatWithBrackets);break;case"DescriptionValue":b=I([m,O],t.formatWithBrackets);break;default:if((r=f.targetObject)!==null&&r!==void 0&&(a=r.annotations)!==null&&a!==void 0&&(s=a.Common)!==null&&s!==void 0&&s.Timezone){b=d(f,O)}else{b=R(f,O,o||(n===null||n===void 0?void 0:n.measureDisplayMode)==="Hidden")}}return _(b)};s.buildFieldBindingExpression=j;const R=(t,e,n)=>{var o,i,r,a,s,l;if((o=t.targetObject)!==null&&o!==void 0&&(i=o.annotations)!==null&&i!==void 0&&(r=i.Measures)!==null&&r!==void 0&&r.Unit||(a=t.targetObject)!==null&&a!==void 0&&(s=a.annotations)!==null&&s!==void 0&&(l=s.Measures)!==null&&l!==void 0&&l.ISOCurrency){if(n&&c(t.targetObject)){return e}return u(t,e,undefined,n?{showMeasure:false}:undefined)}return e};s._computeBindingWithUnitOrCurrency=R;const C=e=>{var n,o,i,r,a;const s=(e===null||e===void 0?void 0:(n=e.targetObject)===null||n===void 0?void 0:n.Value)||"";const l=v(e);const u=O(s,l);const d=E(e.targetObject);const c=s.$target;const g=((o=c.annotations)===null||o===void 0?void 0:(i=o.Measures)===null||i===void 0?void 0:i.Unit)||((r=c.annotations)===null||r===void 0?void 0:(a=r.Measures)===null||a===void 0?void 0:a.ISOCurrency);if(g){const e=g.$target?T(g.$target,O(g,l)):O(g,l);return _(I([u,d,e],t.computePercentage))}return _(I([u,d,""],t.computePercentage))};s.buildExpressionForProgressIndicatorPercentValue=C;return s},false);