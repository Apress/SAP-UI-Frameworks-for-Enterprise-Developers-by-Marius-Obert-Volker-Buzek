/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/KeepAliveRefreshTypes","./ModelHelper"],function(t,e,n){"use strict";var o=e.RefreshStrategyType;var r=e.PATH_TO_STORE;const s=function(t,e){const o=n.getEntitySetPath(e);const r=o.indexOf("$NavigationPropertyBinding")>-1&&t.getObject(o);return r?`/${r}`:e};const i=function(t,e,n){return t===e||n===o.IncludingDependents&&t.startsWith(e)};const c=function(t,e,n,o){let r=e.startsWith("/")?e:`/${e}`,c=n.startsWith("/")?n:`/${n}`;if(!i(r,c,o)){r=s(t,r);if(!i(r,c,o)){c=s(t,c)}else{return true}}return i(r,c,o)};const a=function(t,e){const n=[];const o=t.getModel().getMetaModel();const s=t.getModel("internal");const i=s.getProperty(r)||{};if(e){e.forEach(function(t){const e=t.data("targetCollectionPath");for(const r in i){const s=i[r];if(n.indexOf(t)===-1&&c(o,e,r,s)){n.push(t)}}})}return n};const l=function(t,e){const n=t.getModel().getMetaModel();const o=t.getModel("internal");const s=o.getProperty(r)||{};let i;if(e){for(const t in s){const o=s[t];if(c(n,e,t,o)){i=o;if(i==="includingDependents"){break}}}}return i};const f=function(t){const e=t.getViewData(),n=e&&((e===null||e===void 0?void 0:e.contextPath)||`/${e===null||e===void 0?void 0:e.entitySet}`);return h.getControlRefreshStrategyForContextPath(t,n)};const u=function(t,e,n){const o=e&&n&&`${e}-${n}`;const r=t.intents;const s=r&&o&&r[o];const i=!s&&r&&e&&r[e];return s||i||(t===null||t===void 0?void 0:t.defaultBehavior)||(t===null||t===void 0?void 0:t._feDefault)};const g=function(t,e){if(t&&t.getModel("viewData")&&t.getModel("internal")){const n=t.getModel("viewData");const o=n.getProperty(r);if(o){const n=t.getModel("internal");const s=h.getRefreshStrategyForIntent(o,e===null||e===void 0?void 0:e.semanticObject,e===null||e===void 0?void 0:e.action);n.setProperty(r,s)}}};const d=function(e){const n=e.getBindingContext("internal");const o=e.getController();const r=o===null||o===void 0?void 0:o.viewState;let s=Promise.resolve();if(n&&n.getProperty("restoreStatus")==="pending"){if(r.refreshViewBindings){s=r.refreshViewBindings();s.then(function(){t.info(`FE V4: Refresh was triggered successfull: ${e.getId()}`)}).catch(function(n){t.warning(`FE V4: Refresh was unsuccessfull: ${e.getId()}`,n)})}s=s.then(function(){r.onRestore();n.setProperty("restoreStatus","done")}).catch(function(n){t.warning(`FE V4: Restore was unsuccessfull: ${e.getId()}`,n)})}return s};const h={getControlsForRefresh:a,getControlRefreshStrategyForContextPath:l,getViewRefreshInfo:f,getRefreshStrategyForIntent:u,storeControlRefreshStrategyForHash:g,restoreView:d};return h},false);