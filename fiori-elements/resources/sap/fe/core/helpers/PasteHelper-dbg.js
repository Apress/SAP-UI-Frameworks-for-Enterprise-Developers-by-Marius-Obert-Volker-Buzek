/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/m/MessageBox","sap/ui/core/Core","sap/ui/core/util/PasteHelper"],function(e,t,r,n){"use strict";const o=function(e,t,r,n){const o=r.getProperty(e),s={parseKeepsEmptyString:true},i=n.getUI5Type(`${t}/${e}`,s),a=!o||r.getProperty(`${e}@Org.OData.Core.V1.Computed`);return{property:e,ignore:a,type:i}};const s=function(e){const n=[...e];const o=r.getLibraryResourceBundle("sap.fe.core"),s=o.getText("C_PASTE_HELPER_SAPFE_PASTE_ERROR_CORRECTION_MESSAGE"),i=o.getText("C_PASTE_HELPER_SAPFE_PASTE_ERROR_CORRECTION_NOTE");let a;if(n.length>1){a=o.getText("C_PASTE_HELPER_SAPFE_PASTE_ERROR_MESSAGE_PLURAL",[n.length])}else{a=o.getText("C_PASTE_HELPER_SAPFE_PASTE_ERROR_MESSAGE_SINGULAR")}n.unshift("");n.unshift(i);n.unshift(s);t.error(a,{title:o.getText("C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_TITLE_ERROR"),details:n.join("<br>")})};const i={displayErrorMessages:s,formatCustomMessage:function(e,t){let n="";const o=e.length;const s=r.getLibraryResourceBundle("sap.fe.core"),i=s.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW");if(o>0){n+=`${i} ${t}: `;e.forEach((e,t)=>{if(e.messageText){n+=e.messageText+(t+1!==o?" ":"")}})}return n},getColumnInfo:function(e){const t=e.getRowBinding().getModel(),r=t.getMetaModel(),n=t.resolve(e.getRowBinding().getPath(),e.getRowBinding().getContext()),o=r.getMetaContext(n);return e.getControlDelegate().fetchProperties(e).then(t=>{const s=Object.assign({},...t.map(e=>({[e.name]:e})));const i=[];e.getColumns().forEach(e=>{const t=s[e.getDataProperty()];if(t.propertyInfos){t.propertyInfos.forEach(e=>{const t=s[e];if(t.exportSettings!==null){if(e.indexOf("/")>-1){i.push({property:t.path,ignore:true})}else{i.push(this.getInfoForEntityProperty(t.path,n,o,r))}}});if(t.exportDataPointTargetValue){i.push({property:"targetValueFromDataPoint",ignore:true})}}else if(t.exportSettings!==null){if(t.path){i.push(this.getInfoForEntityProperty(t.path,n,o,r))}else{i.push({property:"unused",type:null,ignore:true})}}});return i})},getInfoForEntityProperty:o,parsePastedData:function(e,t){return this.getColumnInfo(t).then(function(t){const r=e.length?e[0].length:0;let o=-1;for(let e=0;e<t.length&&o<0;e++){if(!t[e].ignore){o=e}}return o<0||o>r-1?Promise.resolve({}):n.parse(e,t)}).then(e=>{if(e.errors){const t=e.errors.map(function(e){return e.message});this.displayErrorMessages(t);return[]}else{return e.parsedData?e.parsedData:[]}})},pasteData:function(t,r,n){const o=n.editFlow;const s=r.getParent().getTableDefinition();let i=[];return this.parsePastedData(t,r).then(e=>{i=e||[];return Promise.all(i.map(e=>{var t;return o.validateDocument(r.getBindingContext(),{data:e,customValidationFunction:s===null||s===void 0?void 0:(t=s.control)===null||t===void 0?void 0:t.customValidationFunction})}))}).then(e=>{const t=e.reduce(function(e,t,r){if(t.length>0){e.push({messages:t,row:r+1})}return e},[]);if(t.length>0){const e=t.map(e=>this.formatCustomMessage(e.messages,e.row));this.displayErrorMessages(e);return[]}return i}).then(e=>{var t;return e.length>0?o.createMultipleDocuments(r.getRowBinding(),e,s===null||s===void 0?void 0:(t=s.control)===null||t===void 0?void 0:t.createAtEnd,true,n.editFlow.onBeforeCreate):undefined}).catch(t=>{e.error("Error while pasting data",t)})}};return i},false);