/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/model/Filter","sap/ui/model/FilterOperator","./ModelHelper"],function(e,t,n){"use strict";const r={_getKeysFromStartupParams:function(e,t){let n=true;const r=e.map(e=>{if(t[e]&&t[e].length===1){return{name:e,value:t[e][0]}}else{n=false;return{name:e,value:""}}});return n?r:undefined},_createFilterFromKeys:function(r,a,s){const i=n.isFilteringCaseSensitive(s);let o=false;const c=r.map(n=>{if(n.name==="IsActiveEntity"){o=true}return new e({path:n.name,operator:t.EQ,value1:n.value,caseSensitive:i})});if(a&&!o){const t=new e({filters:[new e("IsActiveEntity","EQ",false),new e("SiblingEntity/IsActiveEntity","EQ",null)],and:false});c.push(t)}return new e(c,true)},_requestObjectsFromParameters:function(e,t){const n=e.map(e=>{const n=e.semanticKeys||e.technicalKeys||[];const r=this._createFilterFromKeys(n,e.draftMode,t.getMetaModel());const a=t.bindList(e.contextPath,undefined,undefined,r,{$select:n.map(e=>e.name).join(",")});return a.requestContexts(0,2)});return Promise.all(n)},_getReachablePageInfoFromRoute:function(e,t,n,r){var a,s;let i=e.pattern.replace(":?query:","");i=i.replace(/\/$/,"");if(!i||!i.endsWith(")")){return undefined}i=i.replace(/\(\{[^}]*\}\)/g,"(#)");const o=Array.isArray(e.target)?e.target[e.target.length-1]:e.target;const c=t.targets[o];const u=i.split("/");const l=u.length-1;if(l!==0&&(c===null||c===void 0?void 0:(a=c.options)===null||a===void 0?void 0:(s=a.settings)===null||s===void 0?void 0:s.allowDeepLinking)!==true){return undefined}const f=c.options.settings.contextPath||c.options.settings.entitySet&&`/${c.options.settings.entitySet}`;const p=f&&r.getObject(`/$EntityContainer${f}/`);if(!p){return undefined}const g=r.getObject(`/$EntityContainer${f}/@com.sap.vocabularies.Common.v1.SemanticKey`);const h=g?this._getKeysFromStartupParams(g.map(e=>e.$PropertyPath),n):undefined;const d=!h&&l===0?this._getKeysFromStartupParams(p["$Key"],n):undefined;if(h===undefined&&d===undefined){return undefined}const m=r.getObject(`/$EntityContainer${f}@com.sap.vocabularies.Common.v1.DraftRoot`)||r.getObject(`/$EntityContainer${f}@com.sap.vocabularies.Common.v1.DraftNode`)?true:false;return{pattern:i,contextPath:f,draftMode:m,technicalKeys:d,semanticKeys:h,target:o,pageLevel:l}},_getReachablePages:function(e,t,n){const r=e.routes;const a={};r.forEach(r=>{const s=this._getReachablePageInfoFromRoute(r,e,t,n);if(s){if(!a[s.pageLevel]){a[s.pageLevel]=[]}a[s.pageLevel].push(s)}});const s=[];let i=0;while(a[i]){s.push(a[i]);i++}return s},_getStartupPagesFromStartupParams:function(e,t,n){const r=this._getReachablePages(e,t,n);if(r.length===0){return[]}let a=[];const s=[];function i(e){const t=r[e];const n=s.length?s[s.length-1]:undefined;if(t){t.forEach(function(t){if(!n||t.pattern.indexOf(n.pattern)===0){s.push(t);i(e+1);s.pop()}})}if(s.length>a.length){a=s.slice()}}i(0);return a},_getDeepLinkObject:function(e,t){if(t.length===1){return{context:t[0]}}else if(t.length>1){let n=e[e.length-1].pattern;t.forEach(function(e){n=n.replace("(#)",`(${e.getPath().split("(")[1]}`)});return{hash:n}}else{return{}}},getDeepLinkStartupHash:function(e,t,n){let r;return n.getMetaModel().requestObject("/$EntityContainer/").then(()=>{r=this._getStartupPagesFromStartupParams(e,t,n.getMetaModel());return this._requestObjectsFromParameters(r,n)}).then(e=>{if(e.length){const t=[];e.forEach(function(e){if(e.length===1){t.push(e[0])}});return t.length===e.length?this._getDeepLinkObject(r,t):{}}else{return{}}})},getCreateStartupHash:function(e,t,n,r){return r.requestObject(`${t}@`).then(a=>{let s="";let i=true;if(a["@com.sap.vocabularies.Common.v1.DraftRoot"]&&a["@com.sap.vocabularies.Common.v1.DraftRoot"]["NewAction"]){s=`${t}@com.sap.vocabularies.Common.v1.DraftRoot/NewAction@Org.OData.Core.V1.OperationAvailable`}else if(a["@com.sap.vocabularies.Session.v1.StickySessionSupported"]&&a["@com.sap.vocabularies.Session.v1.StickySessionSupported"]["NewAction"]){s=`${t}@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction@Org.OData.Core.V1.OperationAvailable`}if(s){const e=r.getObject(s);if(e===false){i=false}}else{const e=a["@Org.OData.Capabilities.V1.InsertRestrictions"];if(e&&e.Insertable===false){i=false}}if(i){return this.getDefaultCreateHash(e,t,n)}else{return""}})},getDefaultCreateHash:function(e,t,n){let r=e&&e.preferredMode?e.preferredMode[0]:"create";let a="";r=r.indexOf(":")!==-1&&r.length>r.indexOf(":")+1?r.substr(0,r.indexOf(":")):"create";a=`${t.substring(1)}(...)?i-action=${r}`;if(n.getRouteInfoByHash(a)){return a}else{throw new Error(`No route match for creating a new ${t.substring(1)}`)}}};return r},false);