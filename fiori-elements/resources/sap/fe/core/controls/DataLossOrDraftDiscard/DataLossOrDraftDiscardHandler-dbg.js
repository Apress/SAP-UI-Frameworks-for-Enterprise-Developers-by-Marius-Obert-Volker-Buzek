/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Fragment","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/ui/model/json/JSONModel"],function(e,t,n,o,s){"use strict";var a={};var i;(function(e){e["Save"]="draftDataLossOptionSave";e["Keep"]="draftDataLossOptionKeep";e["Discard"]="draftDataLossOptionDiscard"})(i||(i={}));let r;let c;function d(a,i,d,f){let u;r=a;c=i;const l="sap.fe.core.controls.DataLossOrDraftDiscard.DataLossDraft";const p=d.getView();const m={onDataLossOk:function(){g(u,d,r,f)},onDataLossCancel:function(){c();u.close()},setDataLossPopup:function(e){d.dataLossPopup=e}};const L=new s({}),v={bindingContexts:{this:L.createBindingContext("/")},models:{this:L}};if(d.dataLossPopup){u=d.dataLossPopup;u.open();D(u)}else{const s=o.loadTemplate(l,"fragment");Promise.resolve(n.process(s,{name:l},v)).then(e=>t.load({definition:e,controller:m})).then(e=>{u=e;D(u);const t=u.getContent().find(e=>e.data("listIdentifier")==="draftDataLossOptionsList");t.addEventDelegate({onsapenter:function(){g(u,d,r,f)}});p.addDependent(u);u.open();m.setDataLossPopup(u)}).catch(function(t){e.error("Error while opening the Discard Dialog fragment",t)})}}function f(e,t,n,o){return new Promise(function(s,a){const i=function(t){const n=e(t);s(n)};const r=function(){t();a()};d(i,r,n,o)})}a.performAfterDiscardorKeepDraft=f;function u(e,t){const n=e.getView().getBindingContext();const o={skipBackNavigation:true,skipDiscardPopover:true,skipBindingToView:t!==undefined?t:true};return e.editFlow.cancelDocument(n,o)}a.discardDraft=u;function l(e){const t=e.getView().getBindingContext();if(e.isA("sap.fe.templates.ObjectPage.ObjectPageController")){return e._saveDocument(t)}else{return e.editFlow.saveDocument(t)}}a.saveDocument=l;function p(e){const t=e.getContent().find(e=>e.data("listIdentifier")==="draftDataLossOptionsList");return t.getSelectedItem().data("itemKey")}a.getSelectedKey=p;function D(e){const t=e.getContent().find(e=>e.data("listIdentifier")==="draftDataLossOptionsList");const n=t.getItems()[0];t.setSelectedItem(n);n===null||n===void 0?void 0:n.focus()}a.selectAndFocusFirstEntry=D;function g(t,n,o,s){const a=p(t);if(a===i.Save){l(n).then(o).catch(function(t){e.error("Error while saving document",t)});t.close()}else if(a===i.Keep){o();t.close()}else if(a===i.Discard){u(n,s).then(o).catch(function(t){e.error("Error while discarding draft",t)});t.close()}}a.handleDataLossOk=g;return{performAfterDiscardorKeepDraft:f,discardDraft:u,saveDocument:l,getSelectedKey:p,selectAndFocusFirstEntry:D}},false);