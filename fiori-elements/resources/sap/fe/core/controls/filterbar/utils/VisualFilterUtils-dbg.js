/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/templating/FilterHelper","sap/ui/core/format/NumberFormat","sap/ui/mdc/condition/Condition","sap/ui/model/odata/type/DateTimeOffset"],function(e,t,r,n,a){"use strict";var o=t.getTypeCompliantValue;var s=t.getRangeProperty;const i={applyMedianScaleToChartData:function(e,t,r,n){const a=[];const o=e.data("measure");const s=t.getBindingContext("internal");const i=e.getPoints&&e.getPoints()||e.getBars&&e.getBars()||e.getSegments&&e.getSegments();for(let e=0;e<i.length;e++){a.push(i[e].getBindingContext().getObject())}const l=this._getMedianScaleFactor(a,o);if(l&&l.iShortRefNumber&&l.scale){s.setProperty(`scalefactor/${n}`,l.scale);s.setProperty(`scalefactorNumber/${n}`,l.iShortRefNumber)}else{s.setProperty(`scalefactor/${n}`,"");s.setProperty(`scalefactorNumber/${n}`,"");const e=t.byId(`${r}::ScaleUoMTitle`);const a=t.byId(`${r}::MeasureDimensionTitle`);const o=e.getText();if(o===" | "){e.setText("");a.setTooltip(a.getText())}}},_getMedianScaleFactor:function(e,t){let n;let a;e.sort(function(e,r){if(Number(e[t])<Number(r[t])){return-1}if(Number(e[t])>Number(r[t])){return 1}return 0});if(e.length>0){const r=e.length/2,o=r%1===0?(parseFloat(e[r-1][t])+parseFloat(e[r][t]))/2:parseFloat(e[Math.floor(r)][t]),s=o;for(n=0;n<14;n++){a=Math.pow(10,n);if(Math.round(Math.abs(s)/a)<10){break}}}const o=r.getIntegerInstance({style:"short",showScale:false,shortRefNumber:a});for(n=0;n<e.length;n++){const r=e[n],s=o.format(r[t]),i=s.split(".");if(!i[1]&&parseInt(i[0],10)===0||i[1]&&parseInt(i[0],10)===0&&i[1].indexOf("0")===0||s/1e3>=1e3){a=undefined;break}}return{iShortRefNumber:a,scale:a?o.getScale():""}},getFormattedNumber:function(e,t,n,a){let o;e=typeof e==="string"?Number(e.replace(/,/g,"")):e;if(a){const t=r.getCurrencyInstance({showMeasure:false});return t.format(parseFloat(e),a)}else if(t){o=r.getFloatInstance({style:"short",showScale:false,shortRefNumber:t,shortDecimals:n});return o.format(parseFloat(e))}else{o=r.getFloatInstance({decimals:n});return o.format(parseFloat(e))}},applyUOMToTitle:function(e,t,r,n){const a=e.data("uom");let o;let s;if(a&&a["ISOCurrency"]){o=a["ISOCurrency"];s=o.$Path?t[o.$Path]:o}else if(a&&a["Unit"]){o=a["Unit"]}if(o){const e=o.$Path?t[o.$Path]:o;const a=r.getBindingContext("internal");a.setProperty(`uom/${n}`,e);if(s){a.setProperty(`currency/${n}`,e)}}},updateChartScaleFactorTitle:function(e,t,n,a){if(!e.data("scalefactor")){this.applyMedianScaleToChartData(e,t,n,a)}else{const n=r.getIntegerInstance({style:"short",showScale:false,shortRefNumber:e.data("scalefactor")});const o=t.getBindingContext("internal");const s=n.getScale()?n.getScale():"";o.setProperty(`scalefactor/${a}`,s)}},applyErrorMessageAndTitle:function(e,t,r,n){const a=n.getBindingContext("internal");a.setProperty(r,{});a.setProperty(r,{errorMessageTitle:e,errorMessage:t,showError:true})},checkMulitUnit:function(e,t){const r=[];if(e&&t){for(let n=0;n<e.length;n++){const a=e[n]&&e[n].getObject();r.push(a[t])}}return!!r.reduce(function(e,t){return e===t?e:NaN})},setMultiUOMMessage:function(t,r,n,a,o){const s=r.data("uom");const i=s&&s["ISOCurrency"]&&s["ISOCurrency"].$Path;const l=s&&s["Unit"]&&s["Unit"].$Path;const c=i||l;let u,f;if(c){if(!this.checkMulitUnit(t,c)){if(i){u=a.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");f=a.getText("M_VISUAL_FILTERS_MULTIPLE_CURRENCY",c);this.applyErrorMessageAndTitle(u,f,n,o);e.warning(`Filter is set for multiple Currency for${c}`)}else if(l){u=a.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");f=a.getText("M_VISUAL_FILTERS_MULTIPLE_UNIT",c);this.applyErrorMessageAndTitle(u,f,n,o);e.warning(`Filter is set for multiple UOMs for${c}`)}}}},setNoDataMessage:function(e,t,r){const n=t.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");const a=t.getText("M_VISUAL_FILTER_NO_DATA_TEXT");this.applyErrorMessageAndTitle(n,a,e,r)},convertFilterCondions:function(e){const t={};Object.keys(e).forEach(function(r){const a=[];const o=e[r];for(let e=0;e<o.length;e++){const t=o[e].value2?[o[e].value1,o[e].value2]:[o[e].value1];a.push(n.createCondition(o[e].operator,t,null,null,"Validated"))}if(a.length){t[r]=a}});return t},getCustomConditions:function(e,t,r){let n,a;if(t.$Type==="Edm.DateTimeOffset"){n=this._parseDateTime(o(this._formatDateTime(e.Low),t.$Type));a=e.High?this._parseDateTime(o(this._formatDateTime(e.High),t.$Type)):null}else{n=e.Low;a=e.High?e.High:null}return{operator:e.Option?s(e.Option.$EnumMember||e.Option):null,value1:n,value2:a,path:r}},_parseDateTime:function(e){return this._getDateTimeTypeInstance().parseValue(e,"string")},_formatDateTime:function(e){return this._getDateTimeTypeInstance().formatValue(e,"string")},_getDateTimeTypeInstance:function(){return new a({pattern:"yyyy-MM-ddTHH:mm:ssZ",calendarType:"Gregorian"},{V4:true})}};return i},false);