/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/ID","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","../../../helpers/StableIdHelper","../../helpers/DataFieldHelper","../Common/Form"],function(e,t,a,i,o,n,l,r){"use strict";var d={};var v=r.getFormElementsFromManifest;var s=r.FormElementType;var c=l.isReferencePropertyStaticallyHidden;var u=l.isAnnotationFieldStaticallyHidden;var f=n.createIdForAnnotation;var p=o.not;var m=o.getExpressionFromAnnotation;var g=o.equal;var b=o.compileExpression;var y=i.KeyHelper;var F=a.getHeaderFacetID;var I=a.getHeaderFacetFormID;var h=a.getHeaderFacetContainerID;var T=a.getCustomHeaderFacetID;var $=t.Placement;var U=t.insertCustomElements;var D=e.getSemanticObjectPath;let C;(function(e){e["Annotation"]="Annotation";e["XMLFragment"]="XMLFragment"})(C||(C={}));d.HeaderFacetType=C;let A;(function(e){e["Reference"]="Reference";e["Collection"]="Collection"})(A||(A={}));d.FacetType=A;let P;(function(e){e["Default"]="Default";e["NotAdaptable"]="not-adaptable";e["NotAdaptableTree"]="not-adaptable-tree";e["NotAdaptableVisibility"]="not-adaptable-visibility"})(P||(P={}));d.FlexDesignTimeType=P;var S;(function(e){e["ProgressIndicator"]="ProgressIndicator";e["RatingIndicator"]="RatingIndicator";e["Content"]="Content"})(S||(S={}));var H;(function(e){e["None"]="None";e["DataPoint"]="DataPoint";e["Chart"]="Chart";e["Identification"]="Identification";e["Contact"]="Contact";e["Address"]="Address";e["FieldGroup"]="FieldGroup"})(H||(H={}));function E(e){var t,a,i;const o=[];(t=e.getEntityType().annotations)===null||t===void 0?void 0:(a=t.UI)===null||a===void 0?void 0:(i=a.HeaderFacets)===null||i===void 0?void 0:i.forEach(t=>{const a=B(t,e);if(a){o.push(a)}});return o}d.getHeaderFacetsFromAnnotations=E;function N(e){const t={};Object.keys(e).forEach(a=>{const i=e[a];t[a]=W(i,a)});return t}d.getHeaderFacetsFromManifest=N;function R(e,t,a){var i;if(e.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"&&t.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"){return false}const o=f(e)??"";const n=a.getManifestWrapper().getHeaderFacets();const l=(i=n[o])===null||i===void 0?void 0:i.stashed;return l===true}d.getStashedSettingsForHeaderFacet=R;function k(e,t,a){let i=P.Default;const o=f(e);if(e.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"&&t.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"){i=P.NotAdaptableTree}else{const e=a.getManifestWrapper().getHeaderFacets();if(o){var n,l;const t=(n=e[o])===null||n===void 0?void 0:(l=n.flexSettings)===null||l===void 0?void 0:l.designtime;switch(t){case P.NotAdaptable:case P.NotAdaptableTree:case P.NotAdaptableVisibility:i=t;break;default:break}}}return i}d.getDesignTimeMetadataSettingsForHeaderFacet=k;function O(e,t,a){var i,o,n;if(e.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"&&!(((i=e.annotations)===null||i===void 0?void 0:(o=i.UI)===null||o===void 0?void 0:(n=o.Hidden)===null||n===void 0?void 0:n.valueOf())===true)){var l,r;const i=F(e),o=(e,t)=>{var a,i;return((a=e.ID)===null||a===void 0?void 0:a.toString())||((i=e.Label)===null||i===void 0?void 0:i.toString())||t},n=e.Target.value,s=L(e);let c;let f;switch(s){case H.FieldGroup:c=V(e,a);break;case H.DataPoint:f=j(e,a);break;default:break}const{annotations:y}=e;if(((l=e.Target)===null||l===void 0?void 0:(r=l.$target)===null||r===void 0?void 0:r.term)==="com.sap.vocabularies.UI.v1.Chart"&&u(e)){return undefined}else{var d,v;return{type:C.Annotation,facetType:A.Reference,id:i,containerId:h(e),key:o(e,i),flexSettings:{designtime:k(e,t,a)},stashed:R(e,t,a),visible:b(p(g(m(y===null||y===void 0?void 0:(d=y.UI)===null||d===void 0?void 0:(v=d.Hidden)===null||v===void 0?void 0:v.valueOf()),true))),annotationPath:`${a.getEntitySetBasedAnnotationPath(e.fullyQualifiedName)}/`,targetAnnotationValue:n,targetAnnotationType:s,headerFormData:c,headerDataPointData:f}}}return undefined}function x(e,t){if(e.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"){var a,i,o;const n=[],l=F(e),r=(e,t)=>{var a,i;return((a=e.ID)===null||a===void 0?void 0:a.toString())||((i=e.Label)===null||i===void 0?void 0:i.toString())||t};e.Facets.forEach(a=>{const i=O(a,e,t);if(i){n.push(i)}});return{type:C.Annotation,facetType:A.Collection,id:l,containerId:h(e),key:r(e,l),flexSettings:{designtime:k(e,e,t)},stashed:R(e,e,t),visible:b(p(g(m((a=e.annotations)===null||a===void 0?void 0:(i=a.UI)===null||i===void 0?void 0:(o=i.Hidden)===null||o===void 0?void 0:o.valueOf()),true))),annotationPath:`${t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName)}/`,facets:n}}return undefined}function L(e){let t=H.None;const a={"com.sap.vocabularies.UI.v1.DataPoint":H.DataPoint,"com.sap.vocabularies.UI.v1.Chart":H.Chart,"com.sap.vocabularies.UI.v1.Identification":H.Identification,"com.sap.vocabularies.Communication.v1.Contact":H.Contact,"com.sap.vocabularies.Communication.v1.Address":H.Address,"com.sap.vocabularies.UI.v1.FieldGroup":H.FieldGroup};if(e.$Type!=="com.sap.vocabularies.UI.v1.ReferenceURLFacet"&&e.$Type!=="com.sap.vocabularies.UI.v1.CollectionFacet"){var i,o;t=a[(i=e.Target)===null||i===void 0?void 0:(o=i.$target)===null||o===void 0?void 0:o.term]||H.None}return t}function V(e,t){var a;if(!e){throw new Error("Cannot get FieldGroup form data without facet definition")}const i=U(M(e,t),v(e,t));return{id:I(e),label:(a=e.Label)===null||a===void 0?void 0:a.toString(),formElements:i}}function M(e,t){const a=[];if(e.$Type!=="com.sap.vocabularies.UI.v1.ReferenceURLFacet"&&e.$Type!=="com.sap.vocabularies.UI.v1.CollectionFacet"){var i,o;(i=e.Target)===null||i===void 0?void 0:(o=i.$target)===null||o===void 0?void 0:o.Data.forEach(i=>{var o,n,l;if(!(((o=i.annotations)===null||o===void 0?void 0:(n=o.UI)===null||n===void 0?void 0:(l=n.Hidden)===null||l===void 0?void 0:l.valueOf())===true)){const o=D(t,i);if((i.$Type==="com.sap.vocabularies.UI.v1.DataField"||i.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||i.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath"||i.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation"||i.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithAction")&&!c(i)){var r,d,v,u,f,F,h,T,$,U,C;const{annotations:n}=i;a.push({isValueMultilineText:((r=i.Value)===null||r===void 0?void 0:(d=r.$target)===null||d===void 0?void 0:(v=d.annotations)===null||v===void 0?void 0:(u=v.UI)===null||u===void 0?void 0:(f=u.MultiLineText)===null||f===void 0?void 0:f.valueOf())===true,type:s.Annotation,key:y.generateKeyFromDataField(i),visible:b(p(g(m(n===null||n===void 0?void 0:(F=n.UI)===null||F===void 0?void 0:(h=F.Hidden)===null||h===void 0?void 0:h.valueOf()),true))),label:((T=i.Value)===null||T===void 0?void 0:($=T.$target)===null||$===void 0?void 0:(U=$.annotations)===null||U===void 0?void 0:(C=U.Common)===null||C===void 0?void 0:C.Label)||i.Label,idPrefix:I(e,i),annotationPath:`${t.getEntitySetBasedAnnotationPath(i.fullyQualifiedName)}/`,semanticObjectPath:o})}else if(i.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&!c(i)){var A,P,S,H,E,N,R,k;const{annotations:n}=i;a.push({isValueMultilineText:false,type:s.Annotation,key:y.generateKeyFromDataField(i),visible:b(p(g(m(n===null||n===void 0?void 0:(A=n.UI)===null||A===void 0?void 0:(P=A.Hidden)===null||P===void 0?void 0:P.valueOf()),true))),label:((S=i.Target)===null||S===void 0?void 0:(H=S.$target)===null||H===void 0?void 0:(E=H.annotations)===null||E===void 0?void 0:(N=E.Common)===null||N===void 0?void 0:(R=N.Label)===null||R===void 0?void 0:R.toString())||((k=i.Label)===null||k===void 0?void 0:k.toString()),idPrefix:I(e,i),annotationPath:`${t.getEntitySetBasedAnnotationPath(i.fullyQualifiedName)}/`,semanticObjectPath:o})}}})}return a}function j(e,t){let a=S.Content;let i;if(e.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"&&!u(e)){var o,n,l,r,d;if(((o=e.Target)===null||o===void 0?void 0:(n=o.$target)===null||n===void 0?void 0:n.Visualization)==="UI.VisualizationType/Progress"){a=S.ProgressIndicator}else if(((l=e.Target)===null||l===void 0?void 0:(r=l.$target)===null||r===void 0?void 0:r.Visualization)==="UI.VisualizationType/Rating"){a=S.RatingIndicator}const u=(d=e.Target)===null||d===void 0?void 0:d.$target;if(typeof u==="object"){var v;if(u!==null&&u!==void 0&&(v=u.Value)!==null&&v!==void 0&&v.$target){var s,c;const e=u.Value.$target;if((e===null||e===void 0?void 0:(s=e.annotations)===null||s===void 0?void 0:(c=s.Common)===null||c===void 0?void 0:c.SemanticObject)!==undefined){i=t.getEntitySetBasedAnnotationPath(e===null||e===void 0?void 0:e.fullyQualifiedName)}}}}return{type:a,semanticObjectPath:i}}function B(e,t){let a;switch(e.$Type){case"com.sap.vocabularies.UI.v1.ReferenceFacet":a=O(e,e,t);break;case"com.sap.vocabularies.UI.v1.CollectionFacet":a=x(e,t);break;default:break}return a}function G(e){if(!e){return undefined}const t=["Heroes","Decoration","Workers","LongRunners"].indexOf(e)!==-1?`$auto.${e}`:e;return`{ path : '', parameters : { $$groupId : '${t}' } }`}function W(e,t){const a=T(t);let i=e.position;if(!i){i={placement:$.After}}return{facetType:A.Reference,facets:{},type:e.type,id:a,containerId:a,key:t,position:i,visible:e.visible,fragmentName:e.template||e.name,title:e.title,subTitle:e.subTitle,stashed:e.stashed||false,flexSettings:{...{designtime:P.Default},...e.flexSettings},binding:G(e.requestGroupId),templateEdit:e.templateEdit}}return d},false);