/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/ManifestWrapper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper"],function(t,e,n,i){"use strict";var a=i.getTargetObjectPath;var r=i.getContextRelativeTargetObjectPath;var o=i.enhanceDataModelPath;var s=n.isServiceObject;var u=e.getInvolvedDataModelObjectFromPath;var h=e.convertTypes;const l=function(t){return typeof t==="object"};const c=function(t,e){let n;let i;let a;let r;let o=[];const u=[];t.objectPath.forEach(t=>{var e;if(s(t)){switch(t._type){case"NavigationProperty":o.push(t.name);u.push(t);r=t.targetType;if(a&&a.navigationPropertyBinding.hasOwnProperty(o.join("/"))){i=a.navigationPropertyBinding[o.join("/")];a=i;o=[]}else{i=undefined}break;case"EntitySet":if(n===undefined){n=t}i=t;a=i;r=(e=i)===null||e===void 0?void 0:e.entityType;break;default:break}}});const h={startingEntitySet:n,targetEntityType:r,targetEntitySet:i,navigationProperties:u,contextLocation:undefined,targetObject:t.target,convertedTypes:e};h.contextLocation=h;return h};let f=function(){function e(e,n,i,r,o){this.convertedTypes=e;this.manifestSettings=n;this.diagnostics=i;this.mergeFn=r;this.targetDataModelPath=o;this.manifestWrapper=new t(this.manifestSettings,r);this.baseContextPath=a(this.targetDataModelPath)}var n=e.prototype;n._getEntityTypeFromFullyQualifiedName=function t(e){return this.convertedTypes.entityTypes.find(t=>{if(e.startsWith(t.fullyQualifiedName)){const n=e.replace(t.fullyQualifiedName,"");return n.startsWith("/")||n.startsWith("@")}return false})};n.getAnnotationEntityType=function t(e){if(e){const t=e.fullyQualifiedName;const n=this._getEntityTypeFromFullyQualifiedName(t);if(!n){throw new Error(`Cannot find Entity Type for ${e.fullyQualifiedName}`)}return n}else{return this.targetDataModelPath.targetEntityType}};n.getManifestControlConfiguration=function t(e){if(l(e)){return this.manifestWrapper.getControlConfiguration(e.fullyQualifiedName.replace(this.targetDataModelPath.targetEntityType.fullyQualifiedName,""))}const n=this.manifestWrapper.hasMultipleEntitySets()&&this.baseContextPath!==`/${this.manifestWrapper.getEntitySet()}`?`${this.baseContextPath}/${e}`:e;return this.manifestWrapper.getControlConfiguration(n)};n.getAbsoluteAnnotationPath=function t(e){if(!e){return e}if(e[0]==="/"){return e}return`${this.baseContextPath}/${e}`};n.getEntitySet=function t(){return this.targetDataModelPath.targetEntitySet};n.getContextPath=function t(){return this.baseContextPath};n.getDataModelObjectPath=function t(){return this.targetDataModelPath};n.getEntityContainer=function t(){return this.convertedTypes.entityContainer};n.getEntityType=function t(){return this.targetDataModelPath.targetEntityType};n.getParameterEntityType=function t(){var e,n;const i=this.targetDataModelPath.startingEntitySet.entityType;const a=!!((e=i.annotations)!==null&&e!==void 0&&(n=e.Common)!==null&&n!==void 0&&n.ResultContext);return a&&i};n.getEntityTypeAnnotation=function t(n){if(!n.includes("@")){throw new Error(`Not an annotation path: '${n}'`)}const i=n.startsWith("/");let a;if(i){a=n}else{const t=this.getContextPath().split("@",1)[0];a=t.endsWith("/")?t+n:`${t}/${n}`}const r=this.resolveAbsolutePath(a);const o=u({target:r.target,visitedObjects:r.objectPath},this.convertedTypes,i?undefined:this.targetDataModelPath.contextLocation,true);return{annotation:r.target,converterContext:new e(this.convertedTypes,this.manifestSettings,this.diagnostics,this.mergeFn,o)}};n.getTemplateType=function t(){return this.manifestWrapper.getTemplateType()};n.getConvertedTypes=function t(){return this.convertedTypes};n.getRelativeAnnotationPath=function t(e,n){return e.replace(n.fullyQualifiedName,"")};n.getEntitySetBasedAnnotationPath=function t(e){if(!e){return e}const n=this.targetDataModelPath.targetEntityType.fullyQualifiedName;if(this.targetDataModelPath.targetEntitySet||(this.baseContextPath.startsWith("/")&&this.baseContextPath.match(/\//g)||[]).length>1){let t=e.replace(n,"/");if(t.length>2&&t[0]==="/"&&t[1]==="/"){t=t.substr(1)}return this.baseContextPath+(t.startsWith("/")?t:`/${t}`)}else{return`/${e}`}};n.getManifestWrapper=function t(){return this.manifestWrapper};n.getDiagnostics=function t(){return this.diagnostics};n.resolveAbsolutePath=function t(e){return this.convertedTypes.resolvePath(e)};n.getConverterContextFor=function t(n){const i=this.convertedTypes.resolvePath(n);const a=c(i,this.convertedTypes);return new e(this.convertedTypes,this.manifestSettings,this.diagnostics,this.mergeFn,a)};n.getAnnotationsByTerm=function t(e,n){let i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[this.getEntityType()];let a=[];i.forEach(t=>{if(t){const i=(t===null||t===void 0?void 0:t.annotations[e])||{};if(i){a=Object.keys(i).filter(t=>i[t].term===n).reduce((t,e)=>{t.push(i[e]);return t},a)}}});return a};n.getRelativeModelPathFunction=function t(){const e=this.targetDataModelPath;return function(t){const n=o(e,t);return r(n,true)}};e.createConverterContextForMacro=function t(n,i,a,r,o){let s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};const u=i.isA("sap.ui.model.odata.v4.ODataMetaModel")?i:i.getModel();const l=h(u);let c=l.entitySets.find(t=>t.name===n);if(!c){c=l.singletons.find(t=>t.name===n)}if(!o||c!==o.startingEntitySet){o={startingEntitySet:c,navigationProperties:[],targetEntitySet:c,targetEntityType:c.entityType,targetObject:c,convertedTypes:l}}return new e(l,s,a,r,o)};return e}();return f},false);