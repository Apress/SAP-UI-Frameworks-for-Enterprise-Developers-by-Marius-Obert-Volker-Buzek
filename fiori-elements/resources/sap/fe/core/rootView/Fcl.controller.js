/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library","sap/fe/core/controllerextensions/ViewState","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/KeepAliveHelper","sap/m/Link","sap/m/MessageBox","sap/m/MessagePage","./RootViewBaseController"],function(e,t,n,o,i,r,l,s,a,u){"use strict";var g,c,C,h,d;var f=s.Icon;var m=s.Action;var p=i.usingExtension;var F=i.defineUI5Class;function w(e,t,n,o){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(o):void 0})}function E(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function P(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;b(e,t)}function b(e,t){b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return b(e,t)}function M(e,t,n,o,i){var r={};Object.keys(o).forEach(function(e){r[e]=o[e]});r.enumerable=!!r.enumerable;r.configurable=!!r.configurable;if("value"in r||r.initializer){r.writable=true}r=n.slice().reverse().reduce(function(n,o){return o(e,t,n)||n},r);if(i&&r.initializer!==void 0){r.value=r.initializer?r.initializer.call(i):void 0;r.initializer=undefined}if(r.initializer===void 0){Object.defineProperty(e,t,r);r=null}return r}function v(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}const y=n.LayoutType;const x={page:{names:["BeginColumn","MidColumn","EndColumn"],currentGetter:{prefix:"getCurrent",suffix:"Page"},getter:{prefix:"get",suffix:"Pages"}}};const T=function(e){if(e.isA("sap.ui.core.ComponentContainer")){return e.getComponentInstance().getRootControl()}else{return e}};let R=(g=F("sap.fe.core.rootView.Fcl"),c=p(o.override({applyInitialStateOnly:function(){return false},adaptBindingRefreshControls:function(e){this.getView().getController()._getAllVisibleViews().forEach(function(t){const n=Promise.resolve(t);e.push(n)})},adaptStateControls:function(e){this.getView().getController()._getAllVisibleViews().forEach(function(t){const n=Promise.resolve(t);e.push(n)})},onRestore:function(){const e=this.getView().getController();const t=e.getAppContentContainer();const n=t.getModel("internal");const o=n.getProperty("/pages");for(const e in o){n.setProperty(`/pages/${e}/restoreStatus`,"pending")}e.onContainerReady()},onSuspend:function(){const e=this.getView().getController();const t=e.getFclControl();const n=t.getBeginColumnPages()||[];const o=t.getMidColumnPages()||[];const i=t.getEndColumnPages()||[];const r=[].concat(n,o,i);r.forEach(function(e){const t=T(e);const n=t&&t.getController();if(n&&n.viewState&&n.viewState.onSuspend){n.viewState.onSuspend()}})}})),g(C=(h=function(n){P(o,n);function o(){var e;for(var t=arguments.length,o=new Array(t),i=0;i<t;i++){o[i]=arguments[i]}e=n.call(this,...o)||this;w(e,"viewState",d,E(e));return e}var i=o.prototype;i.onInit=function e(){n.prototype.onInit.call(this);this._internalInit()};i.manageDataReceived=function e(t){if(t.getParameter("error")){var n;const e=t.getParameter("path"),o=this._getAllVisibleViews().find(t=>{var n;return((n=t.getBindingContext())===null||n===void 0?void 0:n.getPath())===e});if(e&&o!==null&&o!==void 0&&(n=o.getBindingContext())!==null&&n!==void 0&&n.isKeepAlive()){o.getController()._routing.onDataReceived(t)}}};i.attachRouteMatchers=function e(){this.getRouter().attachBeforeRouteMatched(this._getViewForNavigatedRowsComputation,this);n.prototype.attachRouteMatchers.call(this);this._internalInit();this.getRouter().attachBeforeRouteMatched(this.onBeforeRouteMatched,this);this.getRouter().attachRouteMatched(this.onRouteMatched,this);this.getFclControl().attachStateChange(this._saveLayout,this)};i._internalInit=function e(){var t,n;if(this._oRouterProxy){return}this.sCurrentRouteName="";this.sCurrentArguments={};this.SQUERYKEYNAME="?query";const o=this.getAppComponent();const i=this.getAppComponent().getModel();i===null||i===void 0?void 0:i.attachEvent("dataReceived",this.manageDataReceived.bind(this));this._oRouterProxy=o.getRouterProxy();this._oFCLConfig={maxColumnsCount:3};const r=o.getManifest()["sap.ui5"].routing;if(r!==null&&r!==void 0&&(t=r.config)!==null&&t!==void 0&&t.flexibleColumnLayout){const e=r.config.flexibleColumnLayout;if(e.defaultTwoColumnLayoutType){this._oFCLConfig.defaultTwoColumnLayoutType=e.defaultTwoColumnLayoutType}if(e.defaultThreeColumnLayoutType){this._oFCLConfig.defaultThreeColumnLayoutType=e.defaultThreeColumnLayoutType}if(e.limitFCLToTwoColumns===true){this._oFCLConfig.maxColumnsCount=2}}if(r!==null&&r!==void 0&&(n=r.config)!==null&&n!==void 0&&n.controlAggregation){this._oFCLConfig.defaultControlAggregation=r.config.controlAggregation}this._initializeTargetAggregation(o);this._initializeRoutesInformation(o);this.getFclControl().attachStateChange(this.onStateChanged,this);this.getFclControl().attachAfterEndColumnNavigate(this.onStateChanged,this)};i.getFclControl=function e(){return this.getAppContentContainer()};i._saveLayout=function e(t){this.sPreviousLayout=t.getParameters().layout};i._getViewForNavigatedRowsComputation=function e(){const t=this._getAllVisibleViews(this.sPreviousLayout);const n=t[t.length-1];let o;this.getRouter().attachEventOnce("routeMatched",e=>{o=T(e.getParameter("views")[e.getParameter("views").length-1]);if(n){if(o.getViewData()&&o.getViewData().viewLevel===this._oFCLConfig.maxColumnsCount){this.oAdditionalViewForNavRowsComputation=o}if(o.getViewData()&&n.getViewData()&&n.getViewData().viewLevel<this._oFCLConfig.maxColumnsCount&&n.getViewData()&&n.getViewData().viewLevel>o.getViewData().viewLevel&&o!==n){this.oAdditionalViewForNavRowsComputation=n}}})};i.getViewForNavigatedRowsComputation=function e(){return this.oAdditionalViewForNavRowsComputation};i.onExit=function e(){this.getRouter().detachRouteMatched(this.onRouteMatched,this);this.getRouter().detachBeforeRouteMatched(this.onBeforeRouteMatched,this);this.getFclControl().detachStateChange(this.onStateChanged,this);this.getFclControl().detachAfterEndColumnNavigate(this.onStateChanged,this);this._oTargetsAggregation=null;this._oTargetsFromRoutePattern=null;u.prototype.onExit.bind(this)()};i.isFclEnabled=function e(){return true};i.displayErrorPage=function e(t,n){const o=this.getFclControl();if(this._oFCLConfig&&n.FCLLevel>=this._oFCLConfig.maxColumnsCount){n.FCLLevel=this._oFCLConfig.maxColumnsCount-1}if(!this.aMessagePages){this.aMessagePages=[null,null,null]}let i=this.aMessagePages[n.FCLLevel];if(!i){i=new a({showHeader:false,icon:"sap-icon://message-error"});this.aMessagePages[n.FCLLevel]=i;switch(n.FCLLevel){case 0:o.addBeginColumnPage(i);break;case 1:o.addMidColumnPage(i);break;default:o.addEndColumnPage(i)}}i.setText(t);if(n.technicalMessage){i.setCustomDescription(new l({text:n.description||n.technicalMessage,press:function(){s.show(n.technicalMessage,{icon:f.ERROR,title:n.title,actions:[m.OK],defaultAction:m.OK,details:n.technicalDetails||"",contentWidth:"60%"})}}))}else{i.setDescription(n.description||"")}o.to(i.getId());return Promise.resolve(true)};i._initializeTargetAggregation=function e(t){const n=t.getManifest(),o=n["sap.ui5"].routing?n["sap.ui5"].routing.targets:null;this._oTargetsAggregation={};if(o){Object.keys(o).forEach(e=>{const t=o[e];if(t.controlAggregation){this._oTargetsAggregation[e]={aggregation:t.controlAggregation,pattern:t.contextPattern}}else{this._oTargetsAggregation[e]={aggregation:"page",pattern:null}}})}};i._initializeRoutesInformation=function e(t){const n=t.getManifest(),o=n["sap.ui5"].routing?n["sap.ui5"].routing.routes:null;this._oTargetsFromRoutePattern={};if(o){o.forEach(e=>{this._oTargetsFromRoutePattern[e.pattern]=e.target})}};i.getCurrentArgument=function e(){return this.sCurrentArguments};i.getCurrentRouteName=function e(){return this.sCurrentRouteName};i.getConstants=function e(){return x};i.getTargetAggregation=function e(){return this._oTargetsAggregation};i.onRouteMatched=function e(t){const n=t.getParameter("name");this.sCurrentRouteName=n;this.sCurrentArguments=t.getParameter("arguments")};i._scrollTablesToLastNavigatedItems=function e(){const t=this._getAllVisibleViews();if(t.length>1||t[0].getViewData().viewLevel<this._oFCLConfig.maxColumnsCount){let e;const n=this.getViewForNavigatedRowsComputation();if(n&&t.indexOf(n)===-1){t.push(n)}for(let n=t.length-1;n>0;n--){const o=t[n],i=t[n-1];if(o.getBindingContext()){e=o.getBindingContext().getPath();i.getController()._scrollTablesToRow(e)}}}};i.onStateChanged=function e(t){const n=t.getParameter("isNavigationArrow");if(this.sCurrentArguments!==undefined){if(!this.sCurrentArguments[this.SQUERYKEYNAME]){this.sCurrentArguments[this.SQUERYKEYNAME]={}}this.sCurrentArguments[this.SQUERYKEYNAME].layout=t.getParameter("layout")}this._forceModelContextChangeOnBreadCrumbs(t);if(n){this._oRouterProxy.navTo(this.sCurrentRouteName,this.sCurrentArguments)}const o=this.getRightmostView();if(o){this._computeTitleHierarchy(o)}};i._forceModelContextChangeOnBreadCrumbs=function e(t){const n=t.getSource();let o=[];o=o.concat(n.getBeginColumnPages()).concat(n.getMidColumnPages()).concat(n.getEndColumnPages());o.forEach(function(e){const t=T(e);const n=t.byId&&t.byId("breadcrumbs");if(n){n.fireModelContextChange()}})};i._updateShareButtonVisibility=function e(t,n){let o;switch(n){case"OneColumn":o=t==="beginColumn";break;case"MidColumnFullScreen":case"ThreeColumnsBeginExpandedEndHidden":case"ThreeColumnsMidExpandedEndHidden":case"TwoColumnsBeginExpanded":case"TwoColumnsMidExpanded":o=t==="midColumn";break;case"EndColumnFullScreen":case"ThreeColumnsEndExpanded":case"ThreeColumnsMidExpanded":o=t==="endColumn";break;default:o=false}return o};i._updateEditButtonVisiblity=function e(t,n){let o=true;switch(t){case"midColumn":switch(n){case"TwoColumnsMidExpanded":case"ThreeColumnsMidExpanded":case"ThreeColumnsEndExpanded":o=false;break}break;case"endColumn":switch(n){case"ThreeColumnsMidExpanded":case"ThreeColumnsEndExpanded":o=false}break}return o};i.updateUIStateForView=function e(t,n){const o=this.getHelper().getCurrentUIState(),i=["beginColumn","midColumn","endColumn"],r=this.getFclControl().getLayout();let l;if(!t.getModel("fclhelper")){t.setModel(this._createHelperModel(),"fclhelper")}if(n>=this._oFCLConfig.maxColumnsCount){l=i[this._oFCLConfig.maxColumnsCount-1];o.actionButtonsInfo.midColumn.fullScreen=null;o.actionButtonsInfo.midColumn.exitFullScreen=null;o.actionButtonsInfo.midColumn.closeColumn=null;o.actionButtonsInfo.endColumn.exitFullScreen=null;o.actionButtonsInfo.endColumn.fullScreen=null;o.actionButtonsInfo.endColumn.closeColumn=null}else{l=i[n]}if(n>=this._oFCLConfig.maxColumnsCount||r==="EndColumnFullScreen"||r==="MidColumnFullScreen"||r==="OneColumn"){t.getModel("fclhelper").setProperty("/breadCrumbIsVisible",true)}else{t.getModel("fclhelper").setProperty("/breadCrumbIsVisible",false)}o.actionButtonsInfo.beginColumn={fullScreen:null,exitFullScreen:null,closeColumn:null};const s=Object.assign({},o.actionButtonsInfo[l]);s.switchVisible=s.fullScreen!==null||s.exitFullScreen!==null;s.switchIcon=s.fullScreen!==null?"sap-icon://full-screen":"sap-icon://exit-full-screen";s.isFullScreen=s.fullScreen===null;s.closeVisible=s.closeColumn!==null;t.getModel("fclhelper").setProperty("/actionButtonsInfo",s);t.getModel("fclhelper").setProperty("/showEditButton",this._updateEditButtonVisiblity(l,r));t.getModel("fclhelper").setProperty("/showShareIcon",this._updateShareButtonVisibility(l,r))};i.onBeforeRouteMatched=function e(t){if(t){const e=t.getParameters().arguments[this.SQUERYKEYNAME];let n=e?e.layout:null;if(!n){const e=this.getHelper().getNextUIState(0);n=e.layout}const o=t.getParameter("config").target;n=this._correctLayoutForTargets(n,o);if(n){this.getFclControl().setLayout(n)}}};i.getHelper=function e(){return t.getInstanceFor(this.getFclControl(),this._oFCLConfig)};i.calculateLayout=function e(t,n,o){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!o){o=i?this.getFclControl().getLayout():this.getHelper().getNextUIState(t).layout}const r=this.getRouter().getRouteByHash(`${n}?layout=${o}`);const l=this._oTargetsFromRoutePattern[r.getPattern()];return this._correctLayoutForTargets(o,l)};i._correctLayoutForTargets=function e(t,n){const o={2:["TwoColumnsMidExpanded","TwoColumnsBeginExpanded","MidColumnFullScreen"],3:["ThreeColumnsMidExpanded","ThreeColumnsEndExpanded","ThreeColumnsMidExpandedEndHidden","ThreeColumnsBeginExpandedEndHidden","MidColumnFullScreen","EndColumnFullScreen"]};if(n&&!Array.isArray(n)){n=[n]}if(!n){return t}else if(n.length>1){const e=o[n.length];if(e.indexOf(t)<0){t=e[0]}}else{const e=this.getTargetAggregation()[n[0]].aggregation||this._oFCLConfig.defaultControlAggregation;switch(e){case"beginColumnPages":t="OneColumn";break;case"midColumnPages":t="MidColumnFullScreen";break;case"endColumnPages":t="EndColumnFullScreen";break}}return t};i.getInstancedViews=function e(){const t=this.getFclControl();const n=[...t.getBeginColumnPages(),...t.getMidColumnPages(),...t.getEndColumnPages()];return n.map(e=>e.getComponentInstance().getRootControl())};i._getAllVisibleViews=function t(n){const o=[];n=n?n:this.getFclControl().getLayout();switch(n){case y.EndColumnFullScreen:if(this.getFclControl().getCurrentEndColumnPage()){o.push(T(this.getFclControl().getCurrentEndColumnPage()))}break;case y.MidColumnFullScreen:if(this.getFclControl().getCurrentMidColumnPage()){o.push(T(this.getFclControl().getCurrentMidColumnPage()))}break;case y.OneColumn:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(T(this.getFclControl().getCurrentBeginColumnPage()))}break;case y.ThreeColumnsEndExpanded:case y.ThreeColumnsMidExpanded:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(T(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(T(this.getFclControl().getCurrentMidColumnPage()))}if(this.getFclControl().getCurrentEndColumnPage()){o.push(T(this.getFclControl().getCurrentEndColumnPage()))}break;case y.TwoColumnsBeginExpanded:case y.TwoColumnsMidExpanded:case y.ThreeColumnsMidExpandedEndHidden:case y.ThreeColumnsBeginExpandedEndHidden:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(T(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(T(this.getFclControl().getCurrentMidColumnPage()))}break;default:e.error(`Unhandled switch case for ${this.getFclControl().getLayout()}`)}return o};i._getAllViews=function t(n){const o=[];n=n?n:this.getFclControl().getLayout();switch(n){case y.OneColumn:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(T(this.getFclControl().getCurrentBeginColumnPage()))}break;case y.ThreeColumnsEndExpanded:case y.ThreeColumnsMidExpanded:case y.ThreeColumnsMidExpandedEndHidden:case y.ThreeColumnsBeginExpandedEndHidden:case y.EndColumnFullScreen:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(T(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(T(this.getFclControl().getCurrentMidColumnPage()))}if(this.getFclControl().getCurrentEndColumnPage()){o.push(T(this.getFclControl().getCurrentEndColumnPage()))}break;case y.TwoColumnsBeginExpanded:case y.TwoColumnsMidExpanded:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(T(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(T(this.getFclControl().getCurrentMidColumnPage()))}break;case y.MidColumnFullScreen:const t=this.getHelper().getCurrentUIState().actionButtonsInfo.midColumn.exitFullScreen;if(this.getFclControl().getCurrentBeginColumnPage()){o.push(T(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(T(this.getFclControl().getCurrentMidColumnPage()))}if(t.indexOf("ThreeColumn")>=0){if(this.getFclControl().getCurrentEndColumnPage()){o.push(T(this.getFclControl().getCurrentEndColumnPage()))}}break;default:e.error(`Unhandled switch case for ${this.getFclControl().getLayout()}`)}return o};i.onContainerReady=function e(){const t=this._getAllVisibleViews();const n=t.reduce(function(e,t){e.push(r.restoreView(t));return e},[]);return Promise.all(n)};i.getRightmostContext=function e(){const t=this.getRightmostView();return t&&t.getBindingContext()};i.getRightmostView=function e(){return this._getAllViews().pop()};i.isContextUsedInPages=function e(t){if(!this.getFclControl()){return false}const n=this._getAllViews();for(const e of n){if(e){if(e.getBindingContext()===t){return true}}else{return false}}return false};i._setShellMenuTitle=function e(t,n,o){if(this.getHelper().getCurrentUIState().isFullScreen!==true){t.getShellServices().setTitle(o)}else{t.getShellServices().setTitle(n)}};return o}(u),d=M(h.prototype,"viewState",[c],{configurable:true,enumerable:true,writable:true,initializer:null}),h))||C);return R},false);