/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/MassEditHelper","sap/fe/core/helpers/ModelHelper","sap/m/MessageBox","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","../CommonUtils"],function(e,t,o,n,i,r,s,a){"use strict";var l,c,p,u,g,E,d,_,f;var M=t.publicExtension;var C=t.privateExtension;var T=t.finalExtension;var S=t.extensible;var A=t.defineUI5Class;function D(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;h(e,t)}function h(e,t){h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,o){t.__proto__=o;return t};return h(e,t)}function x(e,t,o,n,i){var r={};Object.keys(n).forEach(function(e){r[e]=n[e]});r.enumerable=!!r.enumerable;r.configurable=!!r.configurable;if("value"in r||r.initializer){r.writable=true}r=o.slice().reverse().reduce(function(o,n){return n(e,t,o)||o},r);if(i&&r.initializer!==void 0){r.value=r.initializer?r.initializer.call(i):void 0;r.initializer=undefined}if(r.initializer===void 0){Object.defineProperty(e,t,r);r=null}return r}let O=(l=A("sap.fe.core.controllerextensions.MassEdit"),c=M(),p=T(),u=M(),g=T(),E=C(),d=S(s.After),l(_=(f=function(t){D(r,t);function r(){return t.apply(this,arguments)||this}var s=r.prototype;s.getMessageDetailForNonEditable=function e(t,o,n){const i=t.getText("C_MASS_EDIT_CONFIRM_MESSAGE_DETAIL_HEADER"),r=t.getText("C_MASS_EDIT_CONFIRM_MESSAGE_DETAIL_REASON",[n]),s=t.getText("C_MASS_EDIT_CONFIRM_MESSAGE_DETAIL_REASON_DRAFT",[o]),a=t.getText("C_MASS_EDIT_CONFIRM_MESSAGE_DETAIL_REASON_NON_EDITABLE",[o]);return`<p><strong>${i}</strong></p>\n`+(!!r&&`<p>${r}</p>\n`+`<ul>`+(!!s&&`<li>${s}</li>`)+(!!a&&`<li>${a}</li>`)+`</ul>`)};s.getResourceText=function e(t,o){const n=t&&a.getTranslatedTextFromExpBindingString(t,o);return n&&n.toLocaleLowerCase()};s._openConfirmDialog=function t(o,r,s){const a=(r||[]).length;const l=this.getView();return new Promise(t=>{l.getModel("sap.fe.i18n").getResourceBundle().then(c=>{const p=c.getText("C_MASS_EDIT_CONFIRM_BUTTON_TEXT"),u=c.getText("C_COMMON_OBJECT_PAGE_CANCEL"),g=s-a,E=o.data("entityType"),d=o.getModel().getMetaModel(),_=d.getObject(`${E}@com.sap.vocabularies.UI.v1.HeaderInfo`),f=_&&this.getResourceText(_.TypeName,l)||c.getText("C_MASS_EDIT_DIALOG_DEFAULT_TYPENAME"),M=_&&this.getResourceText(_.TypeNamePlural,l)||c.getText("C_MASS_EDIT_DIALOG_DEFAULT_TYPENAME_PLURAL"),C=c.getText("C_MASS_EDIT_CONFIRM_MESSAGE",[g,s,a,M]),T=o.data("targetCollectionPath"),S=o.getModel().getMetaModel(),A=n.isDraftSupported(S,T),D=o.data("displayModePropertyBinding")==="true",h=A&&D&&this.getMessageDetailForNonEditable(c,f,M);i.warning(C,{details:h,actions:[p,u],emphasizedAction:p,contentWidth:"100px",onClose:function(o){let n=[];if(o===p){e.info("Mass Edit: Confirmed to edit ",a.toString()," selections.");n=r}else if(o===u){e.info("Mass Edit: Cancelled.")}t(n)}})}).catch(function(t){e.error(t)})})};s._confirmContexts=function e(t,o){const n=t.getBindingContext("internal"),i=+n.getProperty("numberOfSelectedContexts")||0;o=o||[];if(o.length&&o.length!==i){return this._openConfirmDialog(t,o,i)}return Promise.resolve(o)};s.openMassEditDialog=function t(n){const i=this.getView().getController(),r=this.fetchContextsForEdit(n);return r.then(this._confirmContexts.bind(this,n)).then(function(e){return e&&e.length>0?o.createDialog(n,e,i):Promise.resolve()}).then(function(e){if(e){n.addDependent(e);e.open()}}).catch(function(t){e.error("Mass Edit: Something went wrong in mass edit dialog creation.",t)})};s.fetchContextsForEdit=function e(t){const o=t.getBindingContext("internal"),n=o.getProperty("updatableContexts")||[];return Promise.resolve(n)};return r}(r),x(f.prototype,"getMessageDetailForNonEditable",[c,p],Object.getOwnPropertyDescriptor(f.prototype,"getMessageDetailForNonEditable"),f.prototype),x(f.prototype,"openMassEditDialog",[u,g],Object.getOwnPropertyDescriptor(f.prototype,"openMassEditDialog"),f.prototype),x(f.prototype,"fetchContextsForEdit",[E,d],Object.getOwnPropertyDescriptor(f.prototype,"fetchContextsForEdit"),f.prototype),f))||_);return O},false);