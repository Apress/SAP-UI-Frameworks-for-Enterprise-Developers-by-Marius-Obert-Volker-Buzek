/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../utils/TableUtils","sap/ui/base/Object","sap/ui/base/EventProvider","sap/ui/base/ManagedObjectObserver"],function(e,t,n,r){"use strict";var o=new window.Map;var i={"sap.m.table.columnmenu.Menu":"MobileColumnHeaderMenuAdapter","sap.m.table.columnmenu.test.TestMenu":"test/TestAdapter"};var u=t.extend("sap.ui.table.menus.ColumnHeaderMenuAdapter",{constructor:function(){t.apply(this,arguments);this._mInjectionTarget=null;this._oColumnHeaderMenuObserver=new r(function(e){this.onAfterMenuDestroyed(e.object)}.bind(this))}});u.activateFor=function(e){var t=e.getHeaderMenuInstance();var n=a(t);var r;if(!n||!e._getTable()){return Promise.resolve()}o.forEach(function(t,r){if(r!==n){c(e,r)}});if(!o.has(n)){r={adapter:s(n).then(function(e){r=o.get(n);r.adapter=new e;r.adapter._injectMenuItems(r.activeFor.getHeaderMenuInstance(),r.activeFor)}),columns:[e],activeFor:e};o.set(n,r)}else{r=o.get(n);r.activeFor=e;if(!r.columns.includes(e)){r.columns.push(e)}}if(r.adapter instanceof Promise){return r.adapter}r.adapter._injectMenuItems(t,e);return Promise.resolve()};u.unlink=function(e){c(e)};u.prototype._injectMenuItems=function(e,t){this._removeMenuItems();this._oColumnHeaderMenuObserver.observe(e,{destroy:true});this.injectMenuItems(e,t);this._mInjectionTarget={column:t,menu:e}};u.prototype._removeMenuItems=function(){if(!this._mInjectionTarget){return}this.removeMenuItems(this._mInjectionTarget.menu);this._mInjectionTarget=null};u.prototype.injectMenuItems=function(e,t){};u.prototype.removeMenuItems=function(e){};u.prototype.onAfterMenuDestroyed=function(e){};u.prototype.destroy=function(){t.prototype.destroy.apply(this,arguments);this._removeMenuItems();this._oColumnHeaderMenuObserver.disconnect();delete this._oColumnHeaderMenuObserver};function s(e){return new Promise(function(t,n){sap.ui.require(["sap/ui/table/menus/"+e],function(e){t(e)},function(e){n(e)})})}function a(t){for(var n in i){if(e.isA(t,n)){return i[n]}}return""}function c(e,t){var n;if(t){n=o.get(t)}else{o.forEach(function(r,o){if(r.columns.includes(e)){n=r;t=o}})}if(!n){return}if(n.adapter instanceof Promise){n.adapter.then(function(){c(e,t)})}else{if(n.columns.includes(e)){n.columns.splice(n.columns.indexOf(e),1)}if(n.columns.length===0){n.adapter.destroy();o.delete(t)}}}return u});