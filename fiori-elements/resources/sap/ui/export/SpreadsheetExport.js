/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/Log","sap/ui/export/ExportUtils"],function(e,r){"use strict";var t="sap/ui/export/provider/DataProviderBase",n="sap/ui/export/js/XLSXBuilder",o="sap/ui/export/js/libs/JSZip3";var i={execute:function(i,a){function s(e){if(e instanceof MessageEvent&&e.data){e=e.data}if(typeof a==="function"){a(e)}}function u(e,r){s({progress:true,fetched:e||0,total:r||0})}function c(e){s({error:e.message||e})}function f(e){s({finished:true,spreadsheet:e})}function l(){var e;var r;function a(t,n){r=t.getDataConverter(i);e=new n(i.workbook.columns,i.workbook.context,i.workbook.hierarchyLevel,i.customizing);var o=i.dataSource.data||[];var a=o.length;var s=r(o.slice());e.append(s);u(a,a);e.build().then(f)}sap.ui.require([t,n,o],a);return{cancel:f}}function p(){var e,r;function a(t,n){var o=new t(i);e=new n(i.workbook.columns,i.workbook.context,i.workbook.hierarchyLevel,i.customizing);r=o.requestData(s)}function s(r){if(r.error||typeof r.error==="string"){c(r.error);return}e.append(r.rows);u(r.fetched,r.total);if(r.finished){e.build().then(f)}}function l(){r.cancel();f()}sap.ui.require([t,n,o],a);return{cancel:l}}function d(){var t;var n={};var o=function(){t.postMessage({cancel:true});f()};function a(e){var r=new Worker(e);r.onmessage=s;if(navigator.userAgent.indexOf("Firefox")===-1||u(e)){r.onerror=c}r.postMessage(i);return r}function u(e){return e.indexOf(window.location.host)>0||/^[^/]+\/[^/].*$|^\/[^/].*$/i.test(e)}function l(){var r,t;e.warning("Direct worker is not allowed. Load the worker via blob.");r='self.origin = "'+n.base+'"; '+'importScripts("'+n.src+'")';t=window.URL.createObjectURL(new Blob([r]));return a(t)}function d(){e.warning("Blob worker is not allowed. Use in-process export.");o=p(i).cancel}function v(){try{t=a(n.src);t.addEventListener("error",function(e){t=l();t.addEventListener("error",function(e){d();e.preventDefault()});e.preventDefault()})}catch(e){try{t=l()}catch(e){d()}}}n.base=r.normalizeUrl(sap.ui.require.toUrl("sap/ui/export/js/"));n.src=n.base+"SpreadsheetWorker.js";v();return{cancel:function(){o()}}}if(i.dataSource.type==="array"){return l()}else if(i.worker===false){return p()}else{return d()}}};return i},true);