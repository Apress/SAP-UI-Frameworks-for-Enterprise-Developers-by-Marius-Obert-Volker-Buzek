/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["./sapvbi"],function(){"use strict";VBI.Automations=function(){var e={};e.m_automations=[];e.clear=function(){for(var n=0;n<e.m_automations.length;++n){e.m_automations[n].clear()}e.m_automations=[]};e.load=function(n,t){if(n.Call){var a={};if(jQuery.type(n.Call)=="object"){a=new VBI.Automations.Automation;a.load(n.Call,t);e.m_automations.push(a)}else if(jQuery.type(n.Call)=="array"){for(var r=0;r<n.Call.length;++r){a=new VBI.Automations.Automation;a.load(n.Call[r],t);e.m_automations.push(a)}}}};VBI.Automations.Automation=function(){var e={};e.m_additionalProperties=[];e.clear=function(){e.m_addProperties=null};e.createHandler=function(e,n){switch(n){case"CONTEXTMENUHANDLER":return new VBI.ContextMenuHandler(e);case"FLYTOHANDLER":return new VBI.FlyToHandler(e);case"OBJECTCREATIONHANDLER":return new VBI.ObjectCreationHandler(e);case"LOOPBACKHANDLER":return new VBI.LoopBackHandler(e);default:return undefined}};e.getMainScene=function(e){if(e.m_SceneManager.m_SceneArray.length==1){return e.m_SceneManager.m_SceneArray[0].m_ID}return undefined};e.load=function(n,t){e.m_handlerName=n.handler;e.m_handler=e.createHandler(n.Param,n.handler);if(!e.m_handler){return}e.m_handler.m_Ctx=t;e.m_name=n.name;if(e.m_handler.m_scene==undefined){e.m_handler.m_scene=n.scene==undefined?e.getMainScene(t):n.scene}e.m_delay=n.delay==undefined?1:n.delay;e.m_earliest=n.earliest==undefined?1:n.earliest;e.m_retryAfterMS=n.retryAfterMS==undefined?0:n.retryAfterMS;e.m_reattempts=n.reattempts==undefined?-1:n.reattempts;e.m_handler.m_refID=n.refID==undefined?"":n.refID;e.m_handler.m_refObj=n.object==undefined?"":n.object;e.m_handler.m_refInstance=n.object==undefined?"":n.instance;e.m_handler.m_Name=n.name;e.m_nAttempts=0;var a=new Date;var r=a.getTime()-t.m_StartupTime;var m=e.m_delay;if(r<e.m_earliest){m=Math.max(m,e.m_earliest-r)}e.m_AnimZoomTimer=window.setInterval(e.startAutomation,m)};e.startAutomation=function(){window.clearInterval(e.m_AnimZoomTimer);if(!e.m_handler.start()&&e.m_retryAfterMS){e.m_nAttempts++;if(e.m_reattempts==-1||e.m_nAttempts<e.m_reattempts){e.m_AnimZoomTimer=window.setInterval(e.startAutomation,e.m_retryAfterMS)}}};return e};return e};VBI.FlyToHandler=function(e){var n={};n.cnt=0;for(var t=0;t<e.length;++t){if(e[t].name==="x"){n.m_x=e[t]["#"]}if(e[t].name==="y"){n.m_y=e[t]["#"]}if(e[t].name==="lod"){n.m_lod=e[t]["#"]}if(e[t].name==="mode"){n.m_mode=e[t]["#"]}if(e[t].name==="velocity"){n.m_velocity=e[t]["#"]}if(e[t].name==="basetime"){n.m_basetime=e[t]["#"]}if(e[t].name==="scene"){n.m_scene=e[t]["#"]}if(e[t].name==="zoomToAll"){n.m_zoomToAll=e[t]["#"]}}n.start=function(){if(VBI.m_bTrace){VBI.m_bTrace&&VBI.Trace("FlyTo triggered to "+n.m_x+","+n.m_y+","+n.m_lod+" on scene "+n.m_scene)}if(n.m_scene==undefined||n.m_x==undefined||n.m_y==undefined||n.m_lod==undefined){return true}var e=n.m_Ctx.m_SceneManager.GetSceneByName(n.m_scene);if(e){if(n.m_zoomToAll){e.ZoomToAll()}else{var t=n.m_lod;var a=VBI.MathLib.DegToRad([parseFloat(n.m_x),parseFloat(n.m_y)]);e.ZoomToGeoPosition(a,t)}}return true};return n};VBI.ContextMenuHandler=function(e){var n={};n.cnt=0;for(var t=0;t<e.length;++t){if(e[t].name==="x"){n.m_x=parseInt(e[t]["#"],10)}if(e[t].name==="y"){n.m_y=parseInt(e[t]["#"],10)}if(e[t].name==="scene"){n.m_scene=e[t]["#"]}}n.start=function(){var e=n.m_Ctx.m_SceneManager.GetSceneByName(n.m_scene);var t=n.m_Ctx;var a=t.m_Menus.findMenuByID(n.m_refID);if(!e){return true}a.vbi_data.scene=n.m_scene;a.vbi_data.object=n.m_refObj;a.vbi_data.instance=n.m_refInstance;if(t.m_strOpenMenu){t.m_Menus.findMenuByID(t.m_strOpenMenu).close()}if(t.m_HitMenu){t.m_HitMenu.close();t.m_HitMenu.destroy()}t.m_strOpenMenu=n.m_refID;a.open(true,0,"begin top","begin top",e.m_Div,""+n.m_x+" "+n.m_y+"","fit")};return n};VBI.ObjectCreationHandler=function(e){var n={};n.cnt=0;n.m_Ctx=null;n.m_Name=null;if(jQuery.type(e)=="object"){if(e.name==="data"){n.m_data=e["#"]}}else if(jQuery.type(e)=="array"){for(var t=0,a=e.length;t<a;++t){if(e[t].name==="data"){n.m_data=e[t]["#"]}}}n.start=function(){var e=null;if(e=n.m_Ctx.m_SceneManager.GetSceneByName(n.m_scene)){if(n.m_Name=="CreateObject"){var t=null,a=e.m_Ctx.m_Actions;if(a){t=e.m_Ctx.m_Actions.findAction("CreateComplete",e,"General")}var r=null;if(t){r=function(n){var a={data:n};e.m_Ctx.FireAction(t,e,"General",null,a)}}else{r=e.m_Ctx.m_Control.load.bind(e.m_Ctx.m_Control)}e.DesignCreateObject(n.m_data,null,r)}}};return n};VBI.LoopBackHandler=function(e){var n={};n.cnt=0;n.m_Ctx=null;n.m_Name=null;if(jQuery.type(e)=="object"){if(e.name==="ActionID"){n.m_ActionID=e["#"]}}else if(jQuery.type(e)=="array"){for(var t=0,a=e.length;t<a;++t){if(e[t].name==="ActionID"){n.m_ActionID=e[t]["#"]}}}n.start=function(){if(n.m_Name=="TriggerAction"){var e;if(e=n.m_Ctx.m_Actions){var t;if(t=e.findAction(null,null,null,n.m_ActionID)){var a;if(a=n.m_Ctx.m_SceneManager.GetSceneByName(t.m_refScene)){var r=a.BaseGetVO(t.m_refVO);n.m_Ctx.FireAction(t,a,r?r:t.m_refVO,null,null)}}}}};return n}});