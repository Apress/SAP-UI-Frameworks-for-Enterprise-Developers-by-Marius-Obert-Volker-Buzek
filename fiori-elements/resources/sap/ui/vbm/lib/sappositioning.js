/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["./sapvbi"],function(){"use strict";VBI.addScenePositioningFunctions=function(a){a.GetNearestPosArray=function(a){var t=a.slice();var e=Math.floor(t.length/3)*3;var r=t[0];var n=t[1];var i=r,v=r;var o=n,m=n;for(var s=3;s<e;s+=3){while(t[s]-r>180){t[s]-=360}while(r-t[s]>180){t[s]+=360}r=t[s];n=t[s+1];if(i>r){i=r}if(v<r){v=r}if(o>n){o=n}if(m<n){m=n}}t.m_MinX=i;t.m_MaxX=v;t.m_MinY=o;t.m_MaxY=m;return t};a.GetNearestPos=function(a,t){var e=a.slice();var r=t[0];while(e[0]-r>180){e[0]-=360}while(r-e[0]>180){e[0]+=360}return e};a.BuildCacheDataObj=function(){var t={};t.mul=Math.PI/180;var e=a.m_Canvas[0];var r=a.m_Canvas[a.m_nOverlayIndex];var n=e.m_nCurrentLOD;t.minLOD=a.GetMinLOD();t.lod=n;t.nMaxLODTiles=1<<n;t.tilePixelWidth=a.m_nWidthCanvas/a.m_nTilesX;t.tilePixelHeight=a.m_nHeightCanvas/a.m_nTilesY;t.completeX=t.nMaxLODTiles*t.tilePixelWidth;t.completeY=t.nMaxLODTiles*t.tilePixelHeight;t.fx=r.getPixelWidth()/a.m_nWidthCanvas;t.fy=r.getPixelHeight()/a.m_nHeightCanvas;var i=a.m_Proj;t.ucs_min=i.m_nUCSMin*t.completeX;t.ucs_max=i.m_nUCSMax*t.completeX;t.ucs_compl=i.m_nXYRatio*t.completeX;t.ox=e.m_nCurrentX*t.tilePixelWidth+t.ucs_min;t.oy=e.m_nCurrentY*t.tilePixelHeight;t.factX=t.completeX*t.fx;t.factY=t.completeY*t.fy;t.addX=-t.ox*t.fx;t.addY=-t.oy*t.fy;a.m_CacheVars=t};a.DestroyCacheDataObj=function(){a.m_CacheVars=undefined};a.FillPositionCache=function(t,e){var r=a.m_CacheVars;var n=[1,1],i=[];var v=e?0:t[0];var o,m;var s=t[0],h=t[0];var l=t[1],_=t[1];var c=a.m_Proj.LonLatToUCS;var f=r.mul;for(var C=0,u=t.length;C<u;C+=3){o=t[C];m=t[C+1];while(o-v>180){o-=360}while(v-o>180){o+=360}if(o<s){s=o}if(o>h){h=o}if(m<l){l=m}if(m>_){_=m}n=c([f*o,f*m],[1,1]);i.push(n[0],n[1],0);if(!e){v=o}}t.cache={data:i,ref:a.m_CacheVars,lt:c([f*s,f*_],[1,1]),rb:c([f*h,f*l],[1,1]),minLod:-Math.log(Math.max(h-s,_-l))/Math.log(2)}};a.GetVOExtension=function(t){if(t.cache==undefined){a.FillPositionCache(t)}return t.cache.BB};a.GetPointArrayFromPosArrayWCache=function(t){if(t.cache==undefined){a.FillPositionCache(t)}return t.cache.data};a.GetPointFromUCSPoint=function(t){var e=a.m_CacheVars;return[t[0]*e.factX+e.addX,t[1]*e.factY+e.addY]};a.GetPointArrayFromUCSArray=function(t){var e=a.m_CacheVars;var r=e.factX,n=e.factY;var i=e.addX,v=e.addY;var o=[];for(var m=0;m<=t.length-3;m+=3){o.push(t[m]*r+i,t[m+1]*n+v,0)}return o};a.GetShortPointArrayFromUCSArray=function(t){var e=a.m_CacheVars;var r=e.factX,n=e.factY;var i=e.addX,v=e.addY;var o=[];for(var m=0;m<=t.length-3;m+=3){o.push(t[m]*r+i,t[m+1]*n+v)}return o};a.GetPointArrayFromPosArray=function(t,e,r){var n=[0,0],i=[];var v=a.m_Canvas[0];var o=1<<v.m_nCurrentLOD;var m=a.m_nWidthCanvas/a.m_nTilesX;var s=a.m_nHeightCanvas/a.m_nTilesY;var h=o*m;var l=o*s;var _=a.m_Canvas[a.m_nOverlayIndex];var c=r?1:_.getPixelWidth()/a.m_nWidthCanvas;var f=r?1:_.getPixelHeight()/a.m_nHeightCanvas;var C=a.m_Proj.LonLatToUCS;var u=[0,0],d=Math.PI/180;var P=a.m_Proj;var g=P.m_nUCSMin*h;var x=P.m_nUCSMax*h;var X=P.m_nXYRatio*h;var G=v.m_nCurrentX*m+g;var O=v.m_nCurrentY*s;var Y,L;for(Y=0,L=t.length;Y<L;Y+=3){n[0]=d*t[Y];n[1]=d*t[Y+1];u[0]=h;u[1]=l;u=C(n,u);u[0]=u[0]-G;u[1]=u[1]-O;if(e){while(u[0]<g){u[0]+=X}while(u[0]>x){u[0]-=X}}i.push(u[0]*c,u[1]*f,0)}if(L==1&&u){var M,y;i.m_bVisible=(M=u[0])>0&&(y=u[1])>0&&M<a.m_nWidthCanvas&&y<a.m_nHeightCanvas}return i};a.GetPointFromGeo=function(t,e){return a.GetPointArrayFromPosArray(VBI.MathLib.RadToDeg(t),e)};a.GetInstanceOffsets=function(t){var e=t.slice();var r=a.m_Canvas[0];var n=a.m_nWidthCanvas/a.m_nTilesX;var i=(1<<r.m_nCurrentLOD)*n*a.m_Proj.m_nXYRatio;var v=[0,0,a.m_nWidthCanvas,a.m_nHeightCanvas];var o=0;while(e[2]>0){--o;VBI.Utilities.RectOffset(e,-i,0)}var m=[];while(e[0]<a.m_nWidthCanvas){o++;VBI.Utilities.RectOffset(e,i,0);if(VBI.Utilities.RectIntersect(e,v)){m.push(o*i)}}return m};a.GetCorrectedInstanceOffsets=function(t,e){var r=t.slice();var n=a.m_Canvas[0];var i=a.m_nWidthCanvas/a.m_nTilesX;var v=e[0]*(1<<n.m_nCurrentLOD)*i*a.m_Proj.m_nXYRatio;var o=[0,0,e[0]*a.m_nWidthCanvas,e[1]*a.m_nHeightCanvas];var m=0;while(r[2]>0){--m;VBI.Utilities.RectOffset(r,-v,0)}var s=[];while(r[0]<a.m_nWidthCanvas){m++;VBI.Utilities.RectOffset(r,v,0);if(VBI.Utilities.RectIntersect(r,o)){s.push(m*v)}}return s};a.GetPosFromVPPoint=function(t){var e=a.m_Canvas[a.m_nOverlayIndex];var r=[t[0]-e.getPixelLeft(),t[1]-e.getPixelTop(),0];var n=this.GetGeoFromPoint(r);return VBI.MathLib.RadToDeg(n)};a.GetPosFromPoint=function(a){var t=this.GetGeoFromPoint(a);return VBI.MathLib.RadToDeg(t)};a.GetGeoFromPoint=function(t){var e=a.m_Canvas[0];var r=e.m_nCurrentLOD;var n=1<<r;var i=t[0]*a.m_nWidthCanvas/e.getPixelWidth();var v=t[1]*a.m_nHeightCanvas/e.getPixelHeight();var o=a.m_nWidthCanvas/a.m_nTilesX;var m=a.m_nHeightCanvas/a.m_nTilesY;var s=e.m_nCurrentX*o;var h=e.m_nCurrentY*m;var l=s+i;var _=h+v;var c=n*o;var f=n*m;var C=[0,0];var u=[l/c*2-1,_/f*2-1];return a.m_Proj.UCSToLonLat(u,C)}}});