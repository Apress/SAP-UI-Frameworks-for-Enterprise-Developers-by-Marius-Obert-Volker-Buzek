/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["./sapvbi"],function(){"use strict";VBI.addSceneRectangularTrackingFunctions=function(t){t.RectangularTracking=function(){this.m_PosStart=null;this.m_PosMove=null;this.m_bTrack=false;this.m_keycode=0};t.RectangularTracking.prototype.onsapkeydown=function(t){if(t.keyCode==this.m_keycode){this.ExitMode();t.preventDefault();return true}};t.RectangularTracking.prototype.onsapdown=function(e){var o=t.m_Canvas[t.m_nOverlayIndex].getBoundingClientRect();this.m_PosStart=t.GetPosFromPoint([e.clientX-o.left,e.clientY-o.top,0]);this.m_bTrack=true;if(e.type=="mousedown"){document.addEventListener("mouseup",this,true)}else if(e.type=="touchstart"){document.addEventListener("touchend",this,true)}else if(e.type=="pointerdown"){document.addEventListener("pointerup",this,true)}e.preventDefault();t.m_Canvas[t.m_nLabelIndex].focus({preventScroll:true});return true};t.RectangularTracking.prototype.handleEvent=function(e){if(e.type=="mouseup"){document.removeEventListener("mouseup",this,true)}else if(e.type=="touchend"){document.removeEventListener("touchend",this,true)}else if(e.type=="pointerup"){document.removeEventListener("pointerup",this,true);if(t.m_Gesture){t.m_Gesture.pointerCount--;if(!t.m_Gesture.pointerCount){t.m_Gesture.target=null;t.m_Gesture=null}}}this.TrackEnd(e)};t.RectangularTracking.prototype.TrackEnd=function(e){if(!this.m_bTrack){return false}if(this.m_PosStart&&this.m_PosMove){this.execute(e)}this.m_PosStart=null;this.m_PosMove=null;this.m_bTrack=false;t.RenderAsync(true);e.preventDefault();e.stopPropagation();return true};t.RectangularTracking.prototype.onsapmove=function(e){if(this.m_bTrack){var o=t.m_Canvas[t.m_nOverlayIndex].getBoundingClientRect();this.m_PosMove=t.GetPosFromPoint([e.clientX-o.left,e.clientY-o.top,0])}t.SetCursor("crosshair");t.RenderAsync(true);e.preventDefault();return true};t.RectangularTracking.prototype.onsapout=function(t){};t.RectangularTracking.prototype.execute=function(t){};t.RectangularTracking.prototype.Hook=function(e){t.SetInputMode(e);if(e==VBI.InputModeRectSelect){t.m_Ctx.m_Control.setProperty("rectangularSelection",true,true)}else{t.m_Ctx.m_Control.setProperty("rectZoom",true,true)}t.m_DesignVO=this;t.SetCursor("crosshair");t.RenderAsync(true)};t.RectangularTracking.prototype.UnHook=function(){if(t.m_nInputMode==VBI.InputModeRectSelect||t.m_nInputMode==VBI.InputModeRectZoom){t.m_Ctx.onChangeTrackingMode(t.m_nInputMode,false);if(t.m_nInputMode==VBI.InputModeRectSelect){t.m_Ctx.m_Control.setProperty("rectangularSelection",false,true)}else{t.m_Ctx.m_Control.setProperty("rectZoom",false,true)}t.SetInputMode(VBI.InputModeDefault)}else{jQuery.sap.log.error("Wrong InputMode in UnHook: "+t.m_nInputMode)}this.m_PosStart=null;this.m_PosMove=null;this.m_bTrack=false;t.m_DesignVO=null;t.RenderAsync(true)};t.RectangularTracking.prototype.ExitMode=function(){this.UnHook();t.SetCursor("default");t.RenderAsync(true)};t.RectangularZoom=function(){t.RectangularTracking.call(this);this.m_keycode=90;this.Hook(VBI.InputModeRectZoom)};t.RectangularZoom.prototype=Object.create(t.RectangularTracking.prototype);t.RectangularZoom.prototype.constructor=t.RectangularZoom;t.RectangularZoom.prototype.execute=function(e){var o=[];var r=[];o[0]=this.m_PosStart[0];o[1]=this.m_PosMove[0];r[0]=this.m_PosStart[1];r[1]=this.m_PosMove[1];t.ZoomToMultiplePositions(o,r,1)};t.RectangularZoom.prototype.Render=function(e,o){if(!this.m_bTrack){return false}if(this.m_PosMove&&this.m_PosStart){var r=t.GetPointFromPos(this.m_PosStart,false);var n=t.GetPointFromPos(this.m_PosMove,false);var i=n.slice(0);var a=n[0]-r[0];var s=n[1]-r[1];var c=t.GetInternalDivClientRect();var u=Math.abs(c.width/c.height);var l=Math.abs(a/s);var m=0;var p=0;if(l<u){p=n[0]-r[0];m=p/u;if(n[0]<r[0]&&n[1]>r[1]||n[0]>r[0]&&n[1]<r[1]){i[1]=r[1]-m}else{i[1]=r[1]+m}}else{m=n[1]-r[1];p=u*m;if(n[0]<r[0]&&n[1]>r[1]||n[0]>r[0]&&n[1]<r[1]){i[0]=r[0]-p}else{i[0]=r[0]+p}}VBI.Utilities.DrawTrackingRect(o,r[0],r[1],i[0],i[1]);var h=t.GetStretchFactor4Mode();i[0]*=h[0];i[1]*=h[1];this.m_PosMove=t.GetPosFromPoint([i[0],i[1]])}};t.RectSelection=function(){t.RectangularTracking.call(this);this.m_keycode=82;this.Hook(VBI.InputModeRectSelect)};t.RectSelection.prototype=Object.create(t.RectangularTracking.prototype);t.RectSelection.prototype.constructor=t.RectSelection;t.RectSelection.prototype.execute=function(e){var o=t.GetPointFromPos(this.m_PosStart,false);var r=t.GetPointFromPos(this.m_PosMove,false);var n=[];var i=[];var a;for(a=0;a<=1;a++){if(o[a]<r[a]){n[a]=o[a];i[a]=r[a]}else{n[a]=r[a];i[a]=o[a]}}var s=t.GetStretchFactor4Mode();n[0]/=s[0];i[0]/=s[0];n[1]/=s[1];i[1]/=s[1];this.selectionRect=[n[0],n[1],i[0],i[1]];t.PerFormMultiSelect(e,this)};t.RectSelection.prototype.Render=function(e,o){if(!this.m_bTrack){return false}if(this.m_PosMove&&this.m_PosStart){var r=t.GetPointFromPos(this.m_PosStart,false);var n=t.GetPointFromPos(this.m_PosMove,false);VBI.Utilities.DrawTrackingRect(o,r[0],r[1],n[0],n[1])}}}});