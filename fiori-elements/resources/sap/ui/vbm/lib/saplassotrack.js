/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["./sapvbi"],function(){"use strict";VBI.addSceneLassoTrackingFunctions=function(e){e.LassoTracking=function(){this.m_PosMoves=[];this.m_bTrack=false;this.m_keycode=0};e.LassoTracking.prototype.onsapkeydown=function(e){if(e.keyCode==this.m_keycode){this.ExitMode();e.preventDefault();return true}};e.LassoTracking.prototype.onsapdown=function(t){var o=e.m_Canvas[e.m_nOverlayIndex].getBoundingClientRect();var n=e.GetStretchFactor4Mode();this.m_PosMoves.push([(t.clientX-o.left)/n[0],(t.clientY-o.top)/n[1]]);this.m_bTrack=true;if(t.type=="mousedown"){document.addEventListener("mouseup",this,true)}else if(t.type=="touchstart"){document.addEventListener("touchend",this,true)}else if(t.type=="pointerdown"){document.addEventListener("pointerup",this,true)}t.preventDefault();e.m_Canvas[e.m_nLabelIndex].focus({preventScroll:true});return true};e.LassoTracking.prototype.handleEvent=function(t){if(t.type=="mouseup"){document.removeEventListener("mouseup",this,true)}else if(t.type=="touchend"){document.removeEventListener("touchend",this,true)}else if(t.type=="pointerup"){document.removeEventListener("pointerup",this,true);if(e.m_Gesture){e.m_Gesture.pointerCount--;if(!e.m_Gesture.pointerCount){e.m_Gesture.target=null;e.m_Gesture=null}}}this.TrackEnd(t)};e.LassoTracking.prototype.TrackEnd=function(t){if(!this.m_bTrack){return false}if(this.m_PosMoves.length>2){this.execute(t)}this.m_PosMoves=[];this.m_bTrack=false;e.RenderAsync(true);t.preventDefault();t.stopPropagation();return true};e.LassoTracking.prototype.onsapmove=function(t){if(this.m_bTrack){var o=e.GetStretchFactor4Mode();var n=e.m_Canvas[e.m_nOverlayIndex].getBoundingClientRect();this.m_PosMoves.push([(t.clientX-n.left)/o[0],(t.clientY-n.top)/o[1]])}e.SetCursor("crosshair");e.RenderAsync(true);t.preventDefault();return true};e.LassoTracking.prototype.onsapout=function(e){};e.LassoTracking.prototype.execute=function(e){};e.LassoTracking.prototype.Hook=function(){e.SetInputMode(VBI.InputModeLassoSelect);e.m_Ctx.m_Control.setLassoSelection(true);e.m_DesignVO=this;e.SetCursor("crosshair");e.RenderAsync(true)};e.LassoTracking.prototype.UnHook=function(){if(e.m_nInputMode==VBI.InputModeLassoSelect){e.m_Ctx.onChangeTrackingMode(e.m_nInputMode,false);e.SetInputMode(VBI.InputModeDefault);e.m_Ctx.m_Control.setLassoSelection(false)}else{jQuery.sap.log.error("Wrong InputMode in UnHook: "+e.m_nInputMode)}this.m_PosMoves=[];this.m_bTrack=false;e.m_DesignVO=null;e.RenderAsync(true)};e.LassoTracking.prototype.ExitMode=function(){this.UnHook();e.SetCursor("default");e.RenderAsync(true)};e.LassoSelection=function(){e.LassoTracking.call(this);this.m_keycode=65;this.Hook()};e.LassoSelection.prototype=Object.create(e.LassoTracking.prototype);e.LassoSelection.prototype.constructor=e.LassoSelection;e.LassoSelection.prototype.execute=function(t){e.PerFormMultiSelect(t,this)};e.LassoSelection.prototype.Render=function(e,t){if(!this.m_bTrack){return false}if(this.m_PosMoves.length){VBI.Utilities.DrawTrackingLasso(t,this.m_PosMoves)}}}});