/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/valuehelp/base/Content","sap/ui/mdc/util/loadModules","sap/ui/mdc/enum/SelectType","sap/ui/mdc/enum/ConditionValidated","sap/ui/mdc/util/Common"],function(e,t,i,n,o){"use strict";var r=e.extend("sap.ui.mdc.valuehelp.content.Conditions",{metadata:{library:"sap.ui.mdc",interfaces:["sap.ui.mdc.valuehelp.ITypeaheadContent","sap.ui.mdc.valuehelp.IDialogContent"],properties:{label:{type:"string"}},aggregations:{},associations:{fieldHelp:{type:"sap.ui.mdc.ValueHelp",multiple:false}},events:{}}});r.prototype.init=function(){e.prototype.init.apply(this,arguments);this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc")};r.prototype.exit=function(){o.cleanup(this,["_oScrollContainer","_oDefineConditionPanel"]);e.prototype.exit.apply(this,arguments)};r.prototype.getContent=function(){return this._retrievePromise("content",function(){var e=["sap/ui/mdc/field/DefineConditionPanel","sap/ui/model/base/ManagedObjectModel"];if(this.provideScrolling()){e.push("sap/m/ScrollContainer")}return t(e).then(function(e){var t=e[0];var i=e[1];var n=e.length>2&&e[2];this._oManagedObjectModel=new i(this);this._oDefineConditionPanel=new t(this.getId()+"-DCP",{label:"{$help>/label}",conditions:"{$help>/conditions}",inputOK:"{$valueHelp>/_valid}",formatOptions:{path:"$help>/config",formatter:s},conditionProcessed:l.bind(this),fieldHelp:this.getFieldHelp()}).setModel(this._oManagedObjectModel,"$help");if(n){this._oScrollContainer=new n(this.getId()+"-SC",{height:"100%",width:"100%",vertical:true,content:[this._oDefineConditionPanel]});this.setAggregation("displayContent",this._oScrollContainer);return this._oScrollContainer}else{this.setAggregation("displayContent",this._oDefineConditionPanel);return this._oDefineConditionPanel}}.bind(this))}.bind(this))};r.prototype.getCount=function(e){var t=0;for(var i=0;i<e.length;i++){var o=e[i];if(o.isEmpty!==true&&o.validated===n.NotValidated){t++}}return t};r.prototype.getUseAsValueHelp=function(){return false};r.prototype.getValueHelpIcon=function(){return"sap-icon://value-help"};r.prototype.isFocusInHelp=function(){return true};r.prototype.getInitialFocusedControl=function(){return this._oDefineConditionPanel.getInitialFocusedControl()};r.prototype.getRequiresTokenizer=function(){return true};r.prototype.getFormattedTitle=function(t){var i=e.prototype.getFormattedTitle.apply(this,arguments);if(!i){i=this._oResourceBundle.getText(t?"valuehelp.DEFINECONDITIONS":"valuehelp.DEFINECONDITIONSNONUMBER",t)}return i};r.prototype.getFormattedShortTitle=function(){var e=this.getShortTitle();if(!e){e=this._oResourceBundle.getText("valuehelp.DEFINECONDITIONS.Shorttitle")}return e};r.prototype.getFormattedTokenizerTitle=function(e){var t=this.getTokenizerTitle();if(!t){t=this._oResourceBundle.getText("valuehelp.DEFINECONDITIONS.TokenizerTitle"+(e===0?"NoCount":""),e)}return t};r.prototype.getAriaAttributes=function(e){return{contentId:this.getId()+"-DCP",ariaHasPopup:"dialog",roleDescription:null}};r.prototype.getContainerConfig=function(){return{"sap.ui.mdc.valuehelp.Popover":{showArrow:true,showHeader:true,getContentWidth:function(){return"500px"},getFooter:function(){return this._retrievePromise("footer",function(){return t(["sap/m/library","sap/m/Button"]).then(function(e){var t=e[0];var i=t.ButtonType;var n=e[1];var o=new n(this.getId()+"-ok",{text:this._oResourceBundle.getText("valuehelp.OK"),enabled:"{$valueHelp>/_valid}",type:i.Emphasized,press:a.bind(this)});var r=new n(this.getId()+"-cancel",{text:this._oResourceBundle.getText("valuehelp.CANCEL"),press:this.fireCancel.bind(this)});return[o,r]}.bind(this))}.bind(this))}.bind(this)}}};r.prototype.onContainerClose=function(){if(this._oDefineConditionPanel){this._oDefineConditionPanel.cleanUp()}};function a(e){this.fireConfirm({close:true})}function l(e){var t=this.getConditions();if(this._getMaxConditions()===1){t=t.filter(function(e){return e.validated==="NotValidated"})}this.fireSelect({type:i.Set,conditions:t})}function s(e){var t={};if(e){t.valueType=e.dataType;t.maxConditions=e.maxConditions;t.delegate=e.delegate;t.delegateName=e.delegateName;t.payload=e.payload;t.operators=e.operators;t.display=e.display;t.defaultOperatorName=e.defaultOperatorName}return t}return r});