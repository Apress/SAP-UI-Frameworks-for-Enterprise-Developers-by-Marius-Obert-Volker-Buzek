/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/p13n/subcontroller/FilterController","sap/ui/mdc/p13n/subcontroller/AdaptFiltersController","sap/ui/mdc/filterbar/aligned/FilterContainer","sap/ui/mdc/filterbar/aligned/FilterItemLayout","sap/ui/mdc/filterbar/FilterBarBase","sap/ui/mdc/filterbar/FilterBarBaseRenderer","sap/m/library","sap/m/Button","sap/base/util/merge","sap/base/Log","sap/ui/core/library"],function(t,e,i,r,o,n,s,a,l,u,d){"use strict";var p=d.aria.HasPopup;var h=o.extend("sap.ui.mdc.FilterBar",{metadata:{designtime:"sap/ui/mdc/designtime/filterbar/FilterBar.designtime",properties:{showAdaptFiltersButton:{type:"boolean",defaultValue:true},showClearButton:{type:"boolean",defaultValue:false},p13nMode:{type:"sap.ui.mdc.FilterBarP13nMode[]"},_p13nModeItem:{type:"boolean",visibility:"hidden",defaultValue:false},_p13nModeValue:{type:"boolean",visibility:"hidden",defaultValue:false}}},renderer:n});var _=s.ButtonType;h.prototype._createInnerLayout=function(){this._cLayoutItem=r;this._oFilterBarLayout=new i;this._oFilterBarLayout.getInner().setParent(this);this._oFilterBarLayout.getInner().addStyleClass("sapUiMdcFilterBarBaseAFLayout");this.setAggregation("layout",this._oFilterBarLayout,true);this._addButtons()};h.prototype.setP13nMode=function(i){var r=this.getP13nMode();this.setProperty("p13nMode",i||[],false);var o={helper:this.getPropertyHelper(),controller:{}};i&&i.forEach(function(i){if(!r||r.indexOf(i)<0){this._setP13nMode(i,true)}if(i=="Item"){o.controller["Item"]=new e({control:this})}if(i=="Value"){o.controller["Filter"]=new t({control:this})}}.bind(this));r&&r.forEach(function(t){if(!i||i.indexOf(t)<0){this._setP13nMode(t,false)}}.bind(this));this.getEngine().register(this,o);return this};h.prototype._setP13nMode=function(t,e){switch(t){case"Item":this._setP13nModeItem(e);break;case"Value":this._setP13nModeValue(e);break}};h.prototype.setFilterConditions=function(e,i){t.checkConditionOperatorSanity(e);if(this._oP13nFB){this._oP13nFB.setFilterConditions(l({},e))}this.setProperty("filterConditions",e,i);return this};h.prototype._getP13nModeItem=function(){return this._oModel.getProperty("/_p13nModeItem")};h.prototype._setP13nModeItem=function(t){this._oModel.setProperty("/_p13nModeItem",t,true)};h.prototype._getP13nModeValue=function(){return this._oModel.getProperty("/_p13nModeValue")};h.prototype._setP13nModeValue=function(t){this._oModel.setProperty("/_p13nModeValue",t,false);this._bPersistValues=t};h.prototype._addButtons=function(){if(this._oFilterBarLayout){this.setProperty("_filterCount",this._oRb.getText("filterbar.ADAPT"),false);this._btnAdapt=new a(this.getId()+"-btnAdapt",{type:_.Transparent,text:"{"+o.INNER_MODEL_NAME+">/_filterCount}",press:this.onAdaptFilters.bind(this)});this._btnAdapt.setAriaHasPopup(p.ListBox);this._btnAdapt.setModel(this._oModel,o.INNER_MODEL_NAME);this._btnAdapt.bindProperty("visible",{parts:[{path:"/showAdaptFiltersButton",model:o.INNER_MODEL_NAME},{path:"/_p13nModeItem",model:o.INNER_MODEL_NAME}],formatter:function(t,e){return t&&e}});this._btnSearch=this._getSearchButton();this._btnSearch.setModel(this._oModel,o.INNER_MODEL_NAME);this._btnSearch.bindProperty("visible",{parts:[{path:"/showGoButton",model:o.INNER_MODEL_NAME},{path:"/liveMode",model:o.INNER_MODEL_NAME}],formatter:function(t,e){return t&&(this._isPhone()?true:!e)}.bind(this)});this._btnSearch.addStyleClass("sapUiMdcFilterBarBaseButtonPaddingRight");this._btnClear=new a(this.getId()+"-btnClear",{type:_.Transparent,visible:"{"+o.INNER_MODEL_NAME+">/showClearButton}",text:this._oRb.getText("filterbar.CLEAR"),press:function(t){this.onClear()}.bind(this)});this._btnClear.setModel(this._oModel,o.INNER_MODEL_NAME);this._oFilterBarLayout.addButton(this._btnSearch);this._oFilterBarLayout.addButton(this._btnClear);this._oFilterBarLayout.addButton(this._btnAdapt)}};h.prototype.onClear=function(){this._btnClear.setEnabled(false);this.awaitControlDelegate().then(function(t){t.clearFilters(this).catch(function(t){u.error(t)}).finally(function(){this._btnClear.setEnabled(true)}.bind(this))}.bind(this))};h.prototype.retrieveInbuiltFilter=function(){var t=o.prototype.retrieveInbuiltFilter.apply(this,arguments);return t.then(function(t){t._bPersistValues=this._bPersistValues;return t}.bind(this))};h.prototype.onAdaptFilters=function(t){return this._retrieveMetadata().then(function(){return this.getEngine().uimanager.show(this,"Item",this._btnAdapt).then(function(t){t.setVerticalScrolling(false);return t})}.bind(this))};h.prototype.getCurrentState=function(){var t=o.prototype.getCurrentState.apply(this,arguments);if(!this.getProperty("_p13nModeItem")){delete t.items}return t};h.prototype.setFocusOnFirstErroneousField=function(){return this._setFocusOnFirstErroneousField()};h.prototype.exit=function(){o.prototype.exit.apply(this,arguments);this._btnClear=undefined};return h});