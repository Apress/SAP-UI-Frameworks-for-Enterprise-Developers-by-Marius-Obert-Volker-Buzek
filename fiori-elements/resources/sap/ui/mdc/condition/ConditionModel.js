/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/condition/ConditionModelPropertyBinding","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/ChangeReason","sap/ui/mdc/condition/FilterOperatorUtil","sap/base/util/merge","sap/base/util/deepEqual","sap/base/Log","sap/ui/mdc/condition/Condition","sap/ui/mdc/condition/FilterConverter","sap/ui/core/date/UI5Date"],function(t,i,e,n,o,r,s,a,d,p,h){"use strict";var l=i.extend("sap.ui.mdc.condition.ConditionModel",{constructor:function(){i.apply(this,arguments);this.setSizeLimit(1e3);if(!this.getProperty("/conditions")){this.setProperty("/conditions",{})}if(!this.getProperty("/fieldPath")){this.setProperty("/fieldPath",{})}}});l.prototype.bindProperty=function(i,e,n){var o=i;if(i.startsWith("/conditions/")){var r=i.slice(12);this._getFieldPathProperty(r);r=c.call(this,r);o="/conditions/"+r}var s=new t(this,o,e,n);s._sOriginapPath=i;return s};l.prototype.getContext=function(t){if(t.startsWith("/conditions/")){var e=t.slice(12);e=c.call(this,e);t="/conditions/"+e}return i.prototype.getContext.apply(this,[t])};l.prototype.bindList=function(t,e,n,o,r){var s=i.prototype.bindList.apply(this,arguments);s.enableExtendedChangeDetection(true);return s};l.prototype.destroy=function(){i.prototype.destroy.apply(this,arguments)};l.prototype.clone=function(t){var i=new l;i._sName=this._sName+"_clone";var e={};if(typeof t==="string"){var n=this.getConditions(t);for(var o=0;o<n.length;o++){var s=n[o];var a=c.call(this,t);if(!e[a]){e[a]=[]}e[a].push(r({},s))}}else{e=r({},this.getAllConditions())}i.setConditions(e);return i};l.prototype.merge=function(t,i,e){this.removeAllConditions(t);var n=r({},i.getAllConditions());for(var o in n){if(!(typeof e==="string")||o===e){var s=d._removeEmptyConditions(n[o]);for(var a=0;a<s.length;a++){var p=s[a];this.addCondition(o,p)}}}this.checkUpdate(true,true)};l.prototype.getConditions=function(t){return f.call(this,t)};function f(t,i){var e=this.getProperty("/conditions");var n;if(typeof t=="string"){t=c.call(this,t);if(!e[t]&&i){e[t]=[]}n=e[t]||[]}else{throw new Error("ConditionModel","getConditions without FieldPath is not supported!")}return n}l.prototype.getAllConditions=function(t){var i=this.getProperty("/conditions");var e={};for(var n in i){var o=this.getProperty("/fieldPath");var s=o[n];var a=s?s.fieldPath:n;if(t&&[].concat(t).indexOf(a)===-1){continue}e[a]=r([],i[n])}return e};l.prototype.indexOf=function(t,i,e){if(typeof t!=="string"){throw new Error("sFieldPath must be a string "+this)}var n=this.getConditions(t);var r=e?[e(i),n.map(e)]:[i,n];var s=o.indexOfCondition.apply(o,r);return s};l.prototype.exist=function(t,i){if(typeof i==="string"){return this.indexOf(i,t)>=0}else{throw new Error("sFieldPath must be provided "+this)}};l.prototype.setConditions=function(t){var i=0;var e;if(Array.isArray(t)){throw new Error("setConditions with an Array of condition is not supported! "+this)}else{this._bNoSingleEvent=true;var s=false;var a;var d;var p=r({},this.getProperty("/conditions"));for(a in t){this._getFieldPathProperty(a);d=c.call(this,a);var h=p[d]||[];var l=t[a]||[];if(!o.compareConditionsArray(h,l)){s=true;this.removeAllConditions(a);for(i=0;i<t[a].length;i++){e=t[a][i];this.insertCondition(a,-1,e,true)}this.firePropertyChange({reason:n.Binding,path:"/conditions/"+a,context:undefined,value:t[a]})}delete p[d]}var f=this.getProperty("/fieldPath");for(d in p){if(p[d].length>0){s=true;a=f[d].fieldPath;this.removeAllConditions(a);this.firePropertyChange({reason:n.Binding,path:"/conditions/"+a,context:undefined,value:[]})}}if(s){this.checkUpdate(false,true)}this._bNoSingleEvent=false}return this};l.prototype.addCondition=function(t,i,e){if(typeof t!=="string"){throw new Error("sFieldPath must be a string "+this)}return this.insertCondition(t,-1,i,e)};l.prototype.insertCondition=function(t,i,e,r){if(typeof t!=="string"){throw new Error("sFieldPath must be a string "+this)}if(!e){return this}var s;o.checkConditionsEmpty(e);o.updateConditionsValues(e);this._getFieldPathProperty(t);if(!r){var a=this.indexOf(t,e);if(a>=0){return this}}s=f.call(this,t,true);if(i==-1){s.push(e)}else{s.splice(i,0,e)}if(!this._bNoSingleEvent){this.checkUpdate(false,true);this.firePropertyChange({reason:n.Binding,path:"/conditions/"+t,context:undefined,value:s})}return this};l.prototype.createItemCondition=function(t,i,e){a.error("ConditionModel","createItemCondition is deprecated");return d.createItemCondition(i,e)};l.prototype.createCondition=function(t,i,e){a.error("ConditionModel","createCondition is deprecated");return d.createCondition(i,e)};l.prototype.removeCondition=function(t,i){if(typeof t!=="string"){throw new Error("sFieldPath must be a string "+this)}var e=-1;if(typeof i==="object"){e=this.indexOf(t,i)}else if(typeof i==="number"){e=i}if(e>=0){var o=this.getConditions(t);if(o.length>e){o.splice(e,1);this.checkUpdate(false,true);this.firePropertyChange({reason:n.Binding,path:"/conditions/"+t,context:undefined,value:o});return true}}return false};l.prototype.removeAllConditions=function(t){var i=this.getProperty("/conditions");if(typeof t==="string"){var e=c.call(this,t);if(i[e]&&i[e].length>0){i[e]=[];if(!this._bNoSingleEvent){this.firePropertyChange({reason:n.Binding,path:"/conditions/"+t,context:undefined,value:i[e]})}}}else{for(var o in i){if(i[o]&&i[o].length>0){i[o]=[];if(!this._bNoSingleEvent){var r=this.getProperty("/fieldPath");var s=r[o].fieldPath;this.firePropertyChange({reason:n.Binding,path:"/conditions/"+s,context:undefined,value:i[o]})}}}}if(!this._bNoSingleEvent){this.checkUpdate(false,true)}return this};l.prototype._getFieldPathProperty=function(t){var i=c.call(this,t);var e=this.getProperty("/fieldPath");if(!e[i]){e[i]={fieldPath:t}}var n=this.getProperty("/conditions");if(!n[i]){n[i]=[]}return e[i]};l.prototype.getFilters=function(t){a.error("ConditionModel","usage or deprecated getFilters() function! Please use the FilterConverter.createFilters() function instead.");return p.createFilters(this.getAllConditions(),{})};l.prototype.serialize=function(){var t=r({},this.getAllConditions());for(var i in t){var e=t[i];e.forEach(function(t){delete t.isEmpty},this);if(e.length===0){delete t[i]}}return'{"conditions":'+JSON.stringify(t)+"}"};l.prototype.parse=function(t){var i=function(t,i){var e;if(!isNaN(parseInt(t))&&typeof i==="string"){e=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}).(\d{3})Z$/.exec(i);if(e){return h.getInstance(i)}}return i};this.setConditions(JSON.parse(t,i).conditions)};function c(t){if(t){var i=t.split("/");if(i.length>1){t="";for(var e=0;e<i.length;e++){var n=i[e];if(e>0){if(!isNaN(n)||!isNaN(i[e-1])){t=t+"/"}else{t=t+"\\"}}t=t+n}}}return t}return l});