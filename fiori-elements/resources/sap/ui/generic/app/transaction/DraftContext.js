/*
 * SAPUI5

(c) Copyright 2009-2020 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/generic/app/util/ModelUtil"],function(t,e){"use strict";var r=t.extend("sap.ui.generic.app.transaction.DraftContext",{metadata:{publicMethods:["isDraftEnabled","isDraftRoot","hasDraft","hasDraftRoot","hasDraftValidationFunction","hasDraftPreparationAction","isTechnicalKey","isSemanticKey","getSemanticKey","checkUpdateOnChange","getODataDraftFunctionImportName","hasDraftAdministrativeData","hasSiblingEntity","destroy","hasPreserveChanges"]},constructor:function(t){if(!t){throw new Error("No model")}this._oModel=t;this._oMeta=t.getMetaModel();this._oModelUtil=new e(t);return this.getInterface()}});r.prototype.isDraftEnabled=function(t){var e=this._getODataDraftEntitySet(t);return!!(e&&e.isDraft)};r.prototype.isDraftRoot=function(t){var e=this._getODataDraftEntitySet(t);return!!(e&&e.isRoot)};r.prototype.hasDraft=function(t){var r=e.getEntitySetFromContext(t);if(r==null){return false}return this.isDraftEnabled(r)};r.prototype.hasDraftRoot=function(t){var r=e.getEntitySetFromContext(t);return this.isDraftRoot(r)};r.prototype.hasDraftValidationFunction=function(t){return!!this.getODataDraftFunctionImportName(t,"ValidationFunction")};r.prototype.hasDraftPreparationAction=function(t){return!!this.getODataDraftFunctionImportName(t,"PreparationAction")};r.prototype.isTechnicalKey=function(t,e){var r,a,o,i,n;if(!t){throw new Error("No entity set")}r=this._oMeta.getODataEntitySet(t);a=this._oMeta.getODataEntityType(r.entityType);o=a.key.propertyRef.length;if(Object.keys(e).length!==o){return false}for(i=0;i<o;i++){n=a.key.propertyRef[i].name;if(!e[n]){return false}}return true};r.prototype.isSemanticKey=function(t,e){var r,a,o;if(this.isDraftEnabled(t)){r=this.getSemanticKey(t);o=r.length;for(a=0;a<o;a++){if(!e[r[a].name]){return false}}return true}return false};r.prototype.getSemanticKey=function(t){var e,r,a,o=[],i,n;if(!t){throw new Error("No entity set")}e=this._oMeta.getODataEntitySet(t);r=this._oMeta.getODataEntityType(e.entityType);a=r["com.sap.vocabularies.Common.v1.SemanticKey"];if(a){n=a.length;for(i=0;i<n;i++){o.push({name:a[i].PropertyPath})}}return o};r.prototype.getODataDraftFunctionImportName=function(t,r){var a,o;a=e.getEntitySetFromContext(t);o=this._getODataDraftEntitySet(a);if(o.oDraft[r]&&o.oDraft[r].String){return o.oDraft[r].String}return null};r.prototype._getODataDraftEntitySet=function(t){var e={},r;if(!t){throw new Error("No entity set")}r=this._oMeta.getODataEntitySet(t);e.ODataEntitySet=r;if(r["com.sap.vocabularies.Common.v1.DraftRoot"]){e.isDraft=true;e.isRoot=true;e.oDraft=r["com.sap.vocabularies.Common.v1.DraftRoot"]}else if(r["com.sap.vocabularies.Common.v1.DraftNode"]){e.isDraft=true;e.isRoot=false;e.oDraft=r["com.sap.vocabularies.Common.v1.DraftNode"]}return e};r.prototype.hasDraftAdministrativeData=function(t){return this._hasNavigationProperty(t,"DraftAdministrativeData")};r.prototype.hasSiblingEntity=function(t){return this._hasNavigationProperty(t,"SiblingEntity")};r.prototype._hasNavigationProperty=function(t,e){var r,a,o,i;r=this._oMeta.getODataEntitySet(t);a=this._oMeta.getODataEntityType(r.entityType);if(a.navigationProperty){i=a.navigationProperty.length;for(o=0;o<i;o++){if(a.navigationProperty[o].name===e){return true}}}return false};r.prototype.checkUpdateOnChange=function(t,e){var r,a,o;if(!t){throw new Error("No entity set")}a=this._oMeta.getODataEntitySet(t);for(r in a){if(r.indexOf&&r.indexOf("com.sap.vocabularies.Common.v1.SideEffects")===0){o=a[r];if(o.SourceProperties&&o.SourceProperties.length){if(o.SourceProperties.length===1&&o.SourceProperties[0].PropertyPath){if(o.SourceProperties[0].PropertyPath===e){return true}}}}}return false};r.prototype.hasPreserveChanges=function(t){var e=this._oMeta.getODataFunctionImport(this.getODataDraftFunctionImportName(t,"EditAction"));if(e&&e.parameter){for(var r=0;r<e.parameter.length;r++){var a=e.parameter[r];if(a.mode==="In"&&a.name==="PreserveChanges"){return true}}}return false};r.prototype.destroy=function(){if(this._oModelUtil){this._oModelUtil.destroy()}this._oModelUtil=null;this._oModel=null;this._oMeta=null};return r},true);