/* Tiny Comments plugin
*
* Copyright 2010-2020 Tiny Technologies Inc. All rights reserved.
*
* Version: 2.1.3-99
*/
!function(b){"use strict";var _=function(){},d=function(t,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(r.apply(null,n))}},J=function(n){return function(){return n}},g=function(n){return n};function p(r){for(var o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=o.concat(n);return r.apply(null,t)}}var n,e,t,r,u=function(n){return function(){throw new Error(n)}},i=J(!1),a=J(!0),y=J("dismiss.popups"),m=J("reposition.popups"),o=function(){return c},c=(n=function(n){return n.isNone()},r={fold:function(n,e){return n()},is:i,isSome:i,isNone:a,getOr:t=function(n){return n},getOrThunk:e=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:J(null),getOrUndefined:J(void 0),or:t,orThunk:e,map:o,each:_,bind:o,exists:i,forall:a,filter:o,equals:n,equals_:n,toArray:function(){return[]},toString:J("none()")},Object.freeze&&Object.freeze(r),r),s=function(t){var n=J(t),e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:a,isNone:i,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return s(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?o:c},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(i,function(n){return e(t,n)})}};return o},A={some:s,none:o,from:function(n){return null==n?c:s(n)}},f=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:J(n)}},w={fromHtml:function(n,e){var t=(e||b.document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw b.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return f(t.childNodes[0])},fromTag:function(n,e){var t=(e||b.document).createElement(n);return f(t)},fromText:function(n,e){var t=(e||b.document).createTextNode(n);return f(t)},fromDom:f,fromPoint:function(n,e,t){var r=n.dom();return A.from(r.elementFromPoint(e,t)).map(f)}},l=function(n){var e,t,r,o,i,u,a,c=w.fromDom(n.target),s=function(){n.stopPropagation()},f=function(){n.preventDefault()},l=d(f,s);return e=c,t=n.clientX,r=n.clientY,o=s,i=f,u=l,a=n,{target:J(e),x:J(t),y:J(r),stop:o,prevent:i,kill:u,raw:J(a)}},v=function(n,e,t,r,o){var i,u,a=(i=t,u=r,function(n){i(n)&&u(l(n))});return n.dom().addEventListener(e,a,o),{unbind:p(h,n,e,a,o)}},h=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},x=J(!0),O=function(n,e,t){return v(n,e,x,t,!1)},S=function(n,e,t){return v(n,e,x,t,!0)},E=function(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":e}(n)===e}},C=E("string"),k=E("object"),T=E("array"),D=E("boolean"),M=E("function"),N=E("number"),F=Array.prototype.slice,R=Array.prototype.indexOf,B=Array.prototype.push,I=function(n,e){return t=n,r=e,-1<R.call(t,r);var t,r},H=function(n,e){for(var t=0,r=n.length;t<r;t++){if(e(n[t],t))return!0}return!1},P=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o)}return r},j=function(n,e){for(var t=0,r=n.length;t<r;t++){e(n[t],t)}},V=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r)&&t.push(i)}return t},L=function(n,e,t){return function(n,e){for(var t=n.length-1;0<=t;t--)e(n[t],t)}(n,function(n){t=e(t,n)}),t},W=function(n,e,t){return j(n,function(n){t=e(t,n)}),t},U=function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t))return A.some(o)}return A.none()},z=function(n,e){for(var t=0,r=n.length;t<r;t++){if(e(n[t],t))return A.some(t)}return A.none()},G=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!T(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);B.apply(e,n[t])}return e},q=function(n,e){var t=P(n,e);return G(t)},Y=function(n,e){for(var t=0,r=n.length;t<r;++t){if(!0!==e(n[t],t))return!1}return!0},K=function(n){var e=F.call(n,0);return e.reverse(),e},X=function(n,e){return V(n,function(n){return!I(e,n)})},Q=function(n){return[n]},$=function(n){return 0===n.length?A.none():A.some(n[0])},Z=(M(Array.from)&&Array.from,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(e.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+e.length+']", got '+t.length+" arguments");var r={};return j(e,function(n,e){r[n]=J(t[e])}),r}}),nn=Object.keys,en=Object.hasOwnProperty,tn=function(n,e){for(var t=nn(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i)}},rn=function(n,t){return on(n,function(n,e){return{k:e,v:t(n,e)}})},on=function(n,r){var o={};return tn(n,function(n,e){var t=r(n,e);o[t.k]=t.v}),o},un=function(n,t){var r=[];return tn(n,function(n,e){r.push(t(n,e))}),r},an=function(n,e){return en.call(n,e)},cn=function(n){return n.slice(0).sort()},sn=function(e,n){if(!T(n))throw new Error("The "+e+" fields must be an array. Was: "+n+".");j(n,function(n){if(!C(n))throw new Error("The value "+n+" in the "+e+" fields was not a string.")})},fn=function(o,i){var t,u=o.concat(i);if(0===u.length)throw new Error("You must specify at least one required or optional field.");return sn("required",o),sn("optional",i),t=cn(u),U(t,function(n,e){return e<t.length-1&&n===t[e+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")}),function(e){var t=nn(e);Y(o,function(n){return I(t,n)})||function(n,e){throw new Error("All required keys ("+cn(n).join(", ")+") were not specified. Specified keys were: "+cn(e).join(", ")+".")}(o,t);var n=V(t,function(n){return!I(u,n)});0<n.length&&function(n){throw new Error("Unsupported keys for object: "+cn(n).join(", "))}(n);var r={};return j(o,function(n){r[n]=J(e[n])}),j(i,function(n){r[n]=J(Object.prototype.hasOwnProperty.call(e,n)?A.some(e[n]):A.none())}),r}},ln=function(n,e,t){return 0!=(n.compareDocumentPosition(e)&t)},dn=function(n,e){return ln(n,e,b.Node.DOCUMENT_POSITION_CONTAINED_BY)},mn=function(){return(mn=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}).apply(this,arguments)};function gn(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]])}return t}function pn(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;var r=Array(n),o=0;for(e=0;e<t;e++)for(var i=arguments[e],u=0,a=i.length;u<a;u++,o++)r[o]=i[u];return r}var vn,hn,bn,yn=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return yn(t())}}},_n=function(){return wn(0,0)},wn=function(n,e){return{major:n,minor:e}},xn={nu:wn,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?_n():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return wn(r(1),r(2))}(n,t)},unknown:_n},On="Firefox",Sn=function(n,e){return function(){return e===n}},En=function(n){var e=n.current;return{current:e,version:n.version,isEdge:Sn("Edge",e),isChrome:Sn("Chrome",e),isIE:Sn("IE",e),isOpera:Sn("Opera",e),isFirefox:Sn(On,e),isSafari:Sn("Safari",e)}},Cn={unknown:function(){return En({current:void 0,version:xn.unknown()})},nu:En,edge:J("Edge"),chrome:J("Chrome"),ie:J("IE"),opera:J("Opera"),firefox:J(On),safari:J("Safari")},kn="Windows",Tn="Android",Dn="Solaris",Mn="FreeBSD",Nn=function(n,e){return function(){return e===n}},An=function(n){var e=n.current;return{current:e,version:n.version,isWindows:Nn(kn,e),isiOS:Nn("iOS",e),isAndroid:Nn(Tn,e),isOSX:Nn("OSX",e),isLinux:Nn("Linux",e),isSolaris:Nn(Dn,e),isFreeBSD:Nn(Mn,e)}},Fn={unknown:function(){return An({current:void 0,version:xn.unknown()})},nu:An,windows:J(kn),ios:J("iOS"),android:J(Tn),linux:J("Linux"),osx:J("OSX"),solaris:J(Dn),freebsd:J(Mn)},Rn=function(n,e){var t=String(e).toLowerCase();return U(n,function(n){return n.search(t)})},Bn=function(n,t){return Rn(n,t).map(function(n){var e=xn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},In=function(n,t){return Rn(n,t).map(function(n){var e=xn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Hn=function(n,e){return-1!==n.indexOf(e)},Pn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,jn=function(e){return function(n){return Hn(n,e)}},Vn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return Hn(n,"edge/")&&Hn(n,"chrome")&&Hn(n,"safari")&&Hn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Pn],search:function(n){return Hn(n,"chrome")&&!Hn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return Hn(n,"msie")||Hn(n,"trident")}},{name:"Opera",versionRegexes:[Pn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:jn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:jn("firefox")},{name:"Safari",versionRegexes:[Pn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(Hn(n,"safari")||Hn(n,"mobile/"))&&Hn(n,"applewebkit")}}],Ln=[{name:"Windows",search:jn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return Hn(n,"iphone")||Hn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:jn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:jn("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:jn("linux"),versionRegexes:[]},{name:"Solaris",search:jn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:jn("freebsd"),versionRegexes:[]}],Wn={browsers:J(Vn),oses:J(Ln)},Un=yn(function(n,e){var t,r,o,i,u,a,c,s,f,l,d,m,g=Wn.browsers(),p=Wn.oses(),v=Bn(g,n).fold(Cn.unknown,Cn.nu),h=In(p,n).fold(Fn.unknown,Fn.nu);return{browser:v,os:h,deviceType:(r=v,o=n,i=e,u=(t=h).isiOS()&&!0===/ipad/i.test(o),a=t.isiOS()&&!u,c=t.isiOS()||t.isAndroid(),s=c||i("(pointer:coarse)"),f=u||!a&&c&&i("(min-device-width:768px)"),l=a||c&&!f,d=r.isSafari()&&t.isiOS()&&!1===/safari/i.test(o),m=!l&&!f&&!d,{isiPad:J(u),isiPhone:J(a),isTablet:J(f),isPhone:J(l),isTouch:J(s),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:J(d),isDesktop:J(m)})}}(b.navigator.userAgent,function(n){return b.window.matchMedia(n).matches})),zn=function(){return Un.get()},Gn=(b.Node.ATTRIBUTE_NODE,b.Node.CDATA_SECTION_NODE,b.Node.COMMENT_NODE,b.Node.DOCUMENT_NODE),qn=(b.Node.DOCUMENT_TYPE_NODE,b.Node.DOCUMENT_FRAGMENT_NODE,b.Node.ELEMENT_NODE),Yn=b.Node.TEXT_NODE,Kn=(b.Node.PROCESSING_INSTRUCTION_NODE,b.Node.ENTITY_REFERENCE_NODE,b.Node.ENTITY_NODE,b.Node.NOTATION_NODE,qn),Xn=Gn,Jn=function(n,e){var t=n.dom();if(t.nodeType!==Kn)return!1;var r=t;if(void 0!==r.matches)return r.matches(e);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(e);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(e);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},Qn=function(n){return n.nodeType!==Kn&&n.nodeType!==Xn||0===n.childElementCount},$n=function(n,e){return n.dom()===e.dom()},Zn=(zn().browser.isIE(),function(n){return w.fromDom(n.dom().ownerDocument)}),ne=function(n){return w.fromDom(n.dom().ownerDocument.defaultView)},ee=function(n){return A.from(n.dom().parentNode).map(w.fromDom)},te=function(n){return P(n.dom().childNodes,w.fromDom)},re=function(n,e){var t=n.dom().childNodes;return A.from(t[e]).map(w.fromDom)},oe=function(n){return re(n,0)},ie=(Z("element","offset"),function(e,t){ee(e).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})}),ue=function(e,t){oe(e).fold(function(){ae(e,t)},function(n){e.dom().insertBefore(t.dom(),n.dom())})},ae=function(n,e){n.dom().appendChild(e.dom())},ce={},se={exports:ce};hn=ce,bn=se,vn=void 0,function(n){"object"==typeof hn&&void 0!==bn?bn.exports=n():"function"==typeof vn&&vn.amd?vn([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=n()}(function(){return function i(u,a,c){function s(e,n){if(!a[e]){if(!u[e]){var t=!1;if(!n&&t)return t(e,!0);if(f)return f(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=a[e]={exports:{}};u[e][0].call(o.exports,function(n){return s(u[e][1][n]||n)},o,o.exports,i,u,a,c)}return a[e].exports}for(var f=!1,n=0;n<c.length;n++)s(c[n]);return s}({1:[function(n,e,t){var r,o,i=e.exports={};function u(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===u||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(n){try{return r.call(null,e,0)}catch(n){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:u}catch(n){r=u}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(n){o=a}}();var s,f=[],l=!1,d=-1;function m(){l&&s&&(l=!1,s.length?f=s.concat(f):d=-1,f.length&&g())}function g(){if(!l){var n=c(m);l=!0;for(var e=f.length;e;){for(s=f,f=[];++d<e;)s&&s[d].run();d=-1,e=f.length}s=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(n){try{return o.call(null,e)}catch(n){return o.call(this,e)}}}(n)}}function p(n,e){this.fun=n,this.array=e}function v(){}i.nextTick=function(n){var e=new Array(arguments.length-1);if(1<arguments.length)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];f.push(new p(n,e)),1!==f.length||l||c(g)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(n){return[]},i.binding=function(n){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(n){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(n,l,e){(function(t){!function(n){var e=setTimeout;function r(){}function i(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(n,this)}function o(t,r){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,i._immediateFn(function(){var n=1===t._state?r.onFulfilled:r.onRejected;if(null!==n){var e;try{e=n(t._value)}catch(n){return void a(r.promise,n)}u(r.promise,e)}else(1===t._state?u:a)(r.promise,t._value)})):t._deferreds.push(r)}function u(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof i)return e._state=3,e._value=n,void c(e);if("function"==typeof t)return void f((r=t,o=n,function(){r.apply(o,arguments)}),e)}e._state=1,e._value=n,c(e)}catch(n){a(e,n)}var r,o}function a(n,e){n._state=2,n._value=e,c(n)}function c(n){2===n._state&&0===n._deferreds.length&&i._immediateFn(function(){n._handled||i._unhandledRejectionFn(n._value)});for(var e=0,t=n._deferreds.length;e<t;e++)o(n,n._deferreds[e]);n._deferreds=null}function s(n,e,t){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.promise=t}function f(n,e){var t=!1;try{n(function(n){t||(t=!0,u(e,n))},function(n){t||(t=!0,a(e,n))})}catch(n){if(t)return;t=!0,a(e,n)}}i.prototype.catch=function(n){return this.then(null,n)},i.prototype.then=function(n,e){var t=new this.constructor(r);return o(this,new s(n,e,t)),t},i.all=function(n){var a=Array.prototype.slice.call(n);return new i(function(r,o){if(0===a.length)return r([]);var i=a.length;function u(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void t.call(n,function(n){u(e,n)},o)}a[e]=n,0==--i&&r(a)}catch(n){o(n)}}for(var n=0;n<a.length;n++)u(n,a[n])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(n){n(e)})},i.reject=function(t){return new i(function(n,e){e(t)})},i.race=function(o){return new i(function(n,e){for(var t=0,r=o.length;t<r;t++)o[t].then(n,e)})},i._immediateFn="function"==typeof t?function(n){t(n)}:function(n){e(n,0)},i._unhandledRejectionFn=function(n){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",n)},i._setImmediateFn=function(n){i._immediateFn=n},i._setUnhandledRejectionFn=function(n){i._unhandledRejectionFn=n},void 0!==l&&l.exports?l.exports=i:n.Promise||(n.Promise=i)}(this)}).call(this,n("timers").setImmediate)},{timers:3}],3:[function(c,n,s){(function(n,e){var r=c("process/browser.js").nextTick,t=Function.prototype.apply,o=Array.prototype.slice,i={},u=0;function a(n,e){this._id=n,this._clearFn=e}s.setTimeout=function(){return new a(t.call(setTimeout,window,arguments),clearTimeout)},s.setInterval=function(){return new a(t.call(setInterval,window,arguments),clearInterval)},s.clearTimeout=s.clearInterval=function(n){n.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},s.enroll=function(n,e){clearTimeout(n._idleTimeoutId),n._idleTimeout=e},s.unenroll=function(n){clearTimeout(n._idleTimeoutId),n._idleTimeout=-1},s._unrefActive=s.active=function(n){clearTimeout(n._idleTimeoutId);var e=n._idleTimeout;0<=e&&(n._idleTimeoutId=setTimeout(function(){n._onTimeout&&n._onTimeout()},e))},s.setImmediate="function"==typeof n?n:function(n){var e=u++,t=!(arguments.length<2)&&o.call(arguments,1);return i[e]=!0,r(function(){i[e]&&(t?n.apply(null,t):n.call(null),s.clearImmediate(e))}),e},s.clearImmediate="function"==typeof e?e:function(n){delete i[n]}}).call(this,c("timers").setImmediate,c("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(n,e,t){var r=n("promise-polyfill"),o="undefined"!=typeof window?window:Function("return this;")();e.exports={boltExport:o.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)});var fe,le,de=se.exports.boltExport,me=function(n){var t=A.none(),e=[],r=function(n){o()?u(n):e.push(n)},o=function(){return t.isSome()},i=function(n){j(n,u)},u=function(e){t.each(function(n){b.setTimeout(function(){e(n)},0)})};return n(function(n){t=A.some(n),i(e),e=[]}),{get:r,map:function(t){return me(function(e){r(function(n){e(t(n))})})},isReady:o}},ge={nu:me,pure:function(e){return me(function(n){n(e)})}},pe=function(n){b.setTimeout(function(){throw n},0)},ve=function(t){var n=function(n){t().then(n,pe)};return{map:function(n){return ve(function(){return t().then(n)})},bind:function(e){return ve(function(){return t().then(function(n){return e(n).toPromise()})})},anonBind:function(n){return ve(function(){return t().then(function(){return n.toPromise()})})},toLazy:function(){return ge.nu(n)},toCached:function(){var n=null;return ve(function(){return null===n&&(n=t()),n})},toPromise:t,get:n}},he=function(n){return ve(function(){return new de(n)})},be=function(n){return ve(function(){return de.resolve(n)})},ye=(void 0!==b.window?b.window:Function("return this;")(),function(n){return n.dom().nodeName.toLowerCase()}),_e=function(e){return function(n){return n.dom().nodeType===e}},we=_e(qn),xe=_e(Yn),Oe=function(n,e,t){if(!(C(t)||D(t)||N(t)))throw b.console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")},Se=function(n,e,t){Oe(n.dom(),e,t)},Ee=function(n,e){var t=n.dom();tn(e,function(n,e){Oe(t,e,n)})},Ce=function(n,e){var t=n.dom().getAttribute(e);return null===t?void 0:t},ke=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},Te=function(n,e){n.dom().removeAttribute(e)},De=function(t){var r,o=!1;return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return o||(o=!0,r=t.apply(null,n)),r}},Me=function(n){var e=xe(n)?n.dom().parentNode:n.dom();return null!=e&&e.ownerDocument.body.contains(e)},Ne=(De(function(){return Ne(w.fromDom(b.document))}),function(n){var e=n.dom().body;if(null==e)throw new Error("Body is not available yet");return w.fromDom(e)}),Ae=(yn(A.none()),"_tinycomments_sidebar"),Fe=function(n){(0,tinymce[Ae])(n)};(le=fe||(fe={}))[le.Modern=0]="Modern",le[le.Silver=1]="Silver";var Re,Be,Ie=function(t){return{is:function(n){return t===n},isValue:a,isError:i,getOr:J(t),getOrThunk:J(t),getOrDie:J(t),or:function(n){return Ie(t)},orThunk:function(n){return Ie(t)},fold:function(n,e){return e(t)},map:function(n){return Ie(n(t))},mapError:function(n){return Ie(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return A.some(t)}}},He=function(t){return{is:i,isValue:i,isError:a,getOr:g,getOrThunk:function(n){return n()},getOrDie:function(){return u(String(t))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,e){return n(t)},map:function(n){return He(t)},mapError:function(n){return He(n(t))},each:_,bind:function(n){return He(t)},exists:i,forall:a,toOption:A.none}},Pe={value:Ie,error:He,fromOption:function(n,e){return n.fold(function(){return He(e)},Ie)}},je=function(i){return mn(mn({},i),{toCached:function(){return je(i.toCached())},bindFuture:function(e){return je(i.bind(function(n){return n.fold(function(n){return be(Pe.error(n))},function(n){return e(n)})}))},bindResult:function(e){return je(i.map(function(n){return n.bind(e)}))},mapResult:function(e){return je(i.map(function(n){return n.map(e)}))},mapError:function(e){return je(i.map(function(n){return n.mapError(e)}))},foldResult:function(e,t){return i.map(function(n){return n.fold(e,t)})},withTimeout:function(n,o){return je(he(function(e){var t=!1,r=b.setTimeout(function(){t=!0,e(Pe.error(o()))},n);i.get(function(n){t||(b.clearTimeout(r),e(n))})}))}})},Ve=function(n){return je(he(n))},Le=function(n){return je(be(Pe.value(n)))},We={nu:Ve,wrap:je,pure:Le,value:Le,error:function(n){return je(be(Pe.error(n)))},fromResult:function(n){return je(be(n))},fromFuture:function(n){return je(n.map(Pe.value))},fromPromise:function(n){return Ve(function(e){n.then(function(n){e(Pe.value(n))},function(n){e(Pe.error(n))})})}},Ue=function(n,e){var t=Ce(n,e);return void 0===t||""===t?[]:t.split(" ")},ze=function(n){return void 0!==n.dom().classList},Ge=function(n,e){return o=e,i=Ue(t=n,r="class").concat([o]),Se(t,r,i.join(" ")),!0;var t,r,o,i},qe=function(n,e){return o=e,0<(i=V(Ue(t=n,r="class"),function(n){return n!==o})).length?Se(t,r,i.join(" ")):Te(t,r),!1;var t,r,o,i},Ye=function(n,e){ze(n)?n.dom().classList.add(e):Ge(n,e)},Ke=function(n){0===(ze(n)?n.dom().classList:Ue(n,"class")).length&&Te(n,"class")},Xe=function(n,e){ze(n)?n.dom().classList.remove(e):qe(n,e);Ke(n)},Je=function(n,e){return ze(n)&&n.dom().classList.contains(e)},Qe=function(n,e){return t=e,o=void 0===(r=n)?b.document:r.dom(),Qn(o)?[]:P(o.querySelectorAll(t),w.fromDom);var t,r,o},$e=J("tox-comment--active"),Ze=(J("data-mce-annotation-uid"),J("data-mce-annotation"),J("tinycomments"));function nt(e,u,o,a){var t=function(n,e){o.notificationManager.open({text:n,type:"error"}),e&&console.error(n,e)},r=function(n,e){return{view:{type:"splash"},grabFocus:function(){return 1===n||e}}},i=function(n,i){u.set(n),u.get().fold(function(){return We.pure({response:Re.Change,update:r(i,a.hasFocus())})},function(n){return e.lookup({conversationUid:n}).foldResult(function(n){return Pe.value({response:Re.Change,update:r(i,a.hasFocus())})},function(e){var n,t,r,o=u.get().forall(function(n){return n!==e.conversation.uid});return Pe.value(o?{response:Re.NoChange}:{response:Re.Change,update:(n=i,t=a.hasFocus(),r=e.conversation,{view:{type:"comments",conversation:r},grabFocus:function(){return t||I([1,3,4],n)}})})})}).get(function(n){return n.fold(function(n){t("An error occurred reading the conversation. See the Console for details.",n)},function(n){n.response===Re.Change&&a.update(n.update)})})},c=function(n){var e="."+$e(),t=w.fromDom(n.getBody()),r=Qe(t,e);j(r,function(n){Xe(n,$e())})};return{refreshSidebar:i,refreshView:function(n){n.fold(function(){c(o),i(A.none(),0)},function(n){var e,t=n.uid,r=n.nodes;e=r,c(o),j(e,function(n){Ye(n,$e())}),i(A.some(t),0)})},setReadonly:function(n){a.setReadonly(n)},showError:t}}(Be=Re||(Re={}))[Be.Change=0]="Change",Be[Be.NoChange=1]="NoChange";var et,tt,rt=function(u){if(!T(u))throw new Error("cases must be an array");if(0===u.length)throw new Error("there must be at least one case");var a=[],t={};return j(u,function(n,r){var e=nn(n);if(1!==e.length)throw new Error("one and only one name per case");var o=e[0],i=n[o];if(void 0!==t[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!T(i))throw new Error("case arguments must be an array");a.push(o),t[o]=function(){var n=arguments.length;if(n!==i.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+i.length+" ("+i+"), got "+n);for(var t=new Array(n),e=0;e<t.length;e++)t[e]=arguments[e];return{fold:function(){if(arguments.length!==u.length)throw new Error("Wrong number of arguments to fold. Expected "+u.length+", got "+arguments.length);return arguments[r].apply(null,t)},match:function(n){var e=nn(n);if(a.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+a.join(",")+"\nActual: "+e.join(","));if(!Y(a,function(n){return I(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+a.join(", "));return n[o].apply(null,t)},log:function(n){b.console.log(n,{constructors:a,constructor:o,params:t})}}}}),t},ot=Object.prototype.hasOwnProperty,it=function(u){return function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},r=0;r<n.length;r++){var o=n[r];for(var i in o)ot.call(o,i)&&(t[i]=u(t[i],o[i]))}return t}},ut=it(function(n,e){return k(n)&&k(e)?ut(n,e):e}),at=it(function(n,e){return e}),ct=rt([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),st=function(n){return ct.defaultedThunk(J(n))},ft=ct.strict,lt=ct.asOption,dt=ct.defaultedThunk,mt=(ct.asDefaultedOptionThunk,ct.mergeWithThunk),gt=function(e){return function(n){return an(n,e)?A.from(n[e]):A.none()}},pt=function(n,e){return gt(e)(n)},vt=function(n,e){var t={};return t[n]=e,t},ht=(rt([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){return gt(n)}),bt=function(n,e){return t=n,r=e,function(n){return an(n,t)?n[t]:r};var t,r},yt=function(n,e){return pt(n,e)},_t=function(n,e){return vt(n,e)},wt=function(n){return e={},j(n,function(n){e[n.key]=n.value}),e;var e},xt=function(n,e){var t,r,o,i,u,a=(t=[],r=[],j(n,function(n){n.fold(function(n){t.push(n)},function(n){r.push(n)})}),{errors:t,values:r});return 0<a.errors.length?(u=a.errors,Pe.error(G(u))):(i=e,0===(o=a.values).length?Pe.value(i):Pe.value(ut(i,at.apply(void 0,o))))},Ot=function(n,e){return an(t=n,r=e)&&void 0!==t[r]&&null!==t[r];var t,r};(tt=et||(et={}))[tt.Error=0]="Error",tt[tt.Value=1]="Value";var St=function(n,e,t){return n.stype===et.Error?e(n.serror):t(n.svalue)},Et=function(n){return{stype:et.Value,svalue:n}},Ct=function(n){return{stype:et.Error,serror:n}},kt=function(n){return n.fold(Ct,Et)},Tt=function(n){return St(n,Pe.error,Pe.value)},Dt=Et,Mt=function(n){var e=[],t=[];return j(n,function(n){St(n,function(n){return t.push(n)},function(n){return e.push(n)})}),{values:e,errors:t}},Nt=Ct,At=function(n,e){return n.stype===et.Value?e(n.svalue):n},Ft=function(n,e){return n.stype===et.Error?e(n.serror):n},Rt=function(n,e){return n.stype===et.Value?{stype:et.Value,svalue:e(n.svalue)}:n},Bt=function(n,e){return n.stype===et.Error?{stype:et.Error,serror:e(n.serror)}:n},It=function(n){return d(Nt,G)(n)},Ht=function(n,e){var t,r,o=Mt(n);return 0<o.errors.length?It(o.errors):(t=o.values,r=e,0<t.length?Dt(ut(r,at.apply(void 0,t))):Dt(r))},Pt=function(n){var e=Mt(n);return 0<e.errors.length?It(e.errors):Dt(e.values)},jt=rt([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),Vt=rt([{field:["name","presence","type"]},{state:["name"]}]),Lt=function(n){return k(n)&&100<nn(n).length?" removed due to size":JSON.stringify(n,null,2)},Wt=function(n,e){return Nt([{path:n,getErrorInfo:e}])},Ut=rt([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),zt=function(t,r,o){return pt(r,o).fold(function(){return n=o,e=r,Wt(t,function(){return'Could not find valid *strict* value for "'+n+'" in '+Lt(e)});var n,e},Dt)},Gt=function(n,e,t){var r=pt(n,e).fold(function(){return t(n)},g);return Dt(r)},qt=function(a,c,n,s){return n.fold(function(o,t,n,r){var i=function(n){var e=r.extract(a.concat([o]),s,n);return Rt(e,function(n){return vt(t,s(n))})},u=function(n){return n.fold(function(){var n=vt(t,s(A.none()));return Dt(n)},function(n){var e=r.extract(a.concat([o]),s,n);return Rt(e,function(n){return vt(t,s(A.some(n)))})})};return n.fold(function(){return At(zt(a,c,o),i)},function(n){return At(Gt(c,o,n),i)},function(){return At(Dt(pt(c,o)),u)},function(n){return At((t=n,r=pt(e=c,o).map(function(n){return!0===n?t(e):n}),Dt(r)),u);var e,t,r},function(n){var e=n(c),t=Rt(Gt(c,o,J({})),function(n){return ut(e,n)});return At(t,i)})},function(n,e){var t=e(c);return Dt(vt(n,s(t)))})},Yt=function(r){return{extract:function(t,n,e){return Ft(r(e,n),function(n){return e=n,Wt(t,function(){return e});var e})},toString:function(){return"val"},toDsl:function(){return jt.itemOf(r)}}},Kt=function(n){var c=Xt(n),s=L(n,function(e,n){return n.fold(function(n){return ut(e,_t(n,!0))},J(e))},{});return{extract:function(n,e,t){var r,o,i,u=D(t)?[]:(o=nn(r=t),V(o,function(n){return Ot(r,n)})),a=V(u,function(n){return!Ot(s,n)});return 0===a.length?c.extract(n,e,t):(i=a,Wt(n,function(){return"There are unsupported fields: ["+i.join(", ")+"] specified"}))},toString:c.toString,toDsl:c.toDsl}},Xt=function(a){return{extract:function(n,e,t){return r=n,o=t,i=e,u=P(a,function(n){return qt(r,o,n,i)}),Ht(u,{});var r,o,i,u},toString:function(){return"obj{\n"+P(a,function(n){return n.fold(function(n,e,t,r){return n+" -> "+r.toString()},function(n,e){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return jt.objOf(P(a,function(n){return n.fold(function(n,e,t,r){return Vt.field(n,t,r)},function(n,e){return Vt.state(n)})}))}}},Jt=function(t,i){var u=function(n,e){return(o=Yt(t),{extract:function(t,r,n){var e=P(n,function(n,e){return o.extract(t.concat(["["+e+"]"]),r,n)});return Pt(e)},toString:function(){return"array("+o.toString()+")"},toDsl:function(){return jt.arrOf(o)}}).extract(n,g,e);var o};return{extract:function(t,r,o){var n=nn(o),e=u(t,n);return At(e,function(n){var e=P(n,function(n){return Ut.field(n,n,ft(),i)});return Xt(e).extract(t,r,o)})},toString:function(){return"setOf("+i.toString()+")"},toDsl:function(){return jt.setOf(t,i)}}},Qt=J(Yt(Dt)),$t=Ut.state,Zt=Ut.field,nr=function(t,e,r,o,i){return yt(o,i).fold(function(){return n=o,e=i,Wt(t,function(){return'The chosen schema: "'+e+'" did not exist in branches: '+Lt(n)});var n,e},function(n){return n.extract(t.concat(["branch: "+i]),e,r)})},er=function(o,i){return{extract:function(e,t,r){return yt(r,o).fold(function(){return n=o,Wt(e,function(){return'Choice schema did not contain choice key: "'+n+'"'});var n},function(n){return nr(e,t,r,i,n)})},toString:function(){return"chooseOn("+o+"). Possible values: "+nn(i)},toDsl:function(){return jt.choiceOf(o,i)}}},tr=Yt(Dt),rr=function(e){return Yt(function(n){return e(n).fold(Nt,Dt)})},or=function(e,n){return Jt(function(n){return kt(e(n))},n)},ir=function(n,e,t){return Tt((r=n,o=g,i=t,u=e.extract([r],o,i),Bt(u,function(n){return{input:i,errors:n}})));var r,o,i,u},ur=function(n){return n.fold(function(n){throw new Error(cr(n))},g)},ar=function(n,e,t){return ur(ir(n,e,t))},cr=function(n){return"Errors: \n"+(e=n.errors,t=10<e.length?e.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):e,P(t,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: "+Lt(n.input);var e,t},sr=function(n,e){return er(n,rn(e,Xt))},fr=J(tr),lr=function(t,r){return Yt(function(n){var e=typeof n;return t(n)?Dt(n):Nt("Expected type: "+r+" but got: "+e)})},dr=lr(D,"boolean"),mr=lr(M,"function"),gr=function(n){return Zt(n,n,ft(),Qt())},pr=function(n,e){return Zt(n,n,ft(),e)},vr=function(n){return pr(n,mr)},hr=function(n,e){return Zt(n,n,ft(),Xt(e))},br=function(n){return Zt(n,n,lt(),Qt())},yr=function(n,e){return Zt(n,n,lt(),e)},_r=function(n,e){return yr(n,Xt(e))},wr=function(n,e){return yr(n,Kt(e))},xr=function(n,e){return Zt(n,n,st(e),Qt())},Or=function(n,e,t){return Zt(n,n,st(e),t)},Sr=function(n,e){return $t(n,e)},Er={init:function(){return Cr({readState:function(){return"No State required"}})}},Cr=function(n){return n},kr=function(n,e){return $n(n.element(),e.event().target())};function Tr(n,e,t,r,o){return n(t,r)?A.some(t):M(o)&&o(t)?A.none():e(t,r,o)}var Dr,Mr,Nr,Ar=function(n,e,t){for(var r=n.dom(),o=M(t)?t:J(!1);r.parentNode;){r=r.parentNode;var i=w.fromDom(r);if(e(i))return A.some(i);if(o(i))break}return A.none()},Fr=function(n,e,t){return Tr(function(n,e){return e(n)},Ar,n,e,t)},Rr=function(n,e,t){return Fr(n,function(n){return e(n).isSome()},t).bind(e)},Br=function(n){if(!Ot(n,"can")&&!Ot(n,"abort")&&!Ot(n,"run"))throw new Error("EventHandler defined by: "+JSON.stringify(n,null,2)+" does not have can, abort, or run!");return ar("Extracting event.handler",Kt([xr("can",J(!0)),xr("abort",J(!1)),xr("run",_)]),n)},Ir=function(t){var e,r,o,i,n=(e=t,r=function(n){return n.can},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return W(e,function(n,e){return n&&r(e).apply(void 0,t)},!0)}),u=(o=t,i=function(n){return n.abort},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return W(o,function(n,e){return n||i(e).apply(void 0,t)},!1)});return Br({can:n,abort:u,run:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];j(t,function(n){n.run.apply(void 0,e)})}})},Hr=J("touchstart"),Pr=J("touchmove"),jr=J("touchend"),Vr=J("mousedown"),Lr=J("mouseover"),Wr=J("keydown"),Ur=J("keyup"),zr=J("input"),Gr=J("click"),qr=J("transitionend"),Yr={tap:J("alloy.tap")},Kr=J("alloy.focus"),Xr=J("alloy.blur.post"),Jr=J("alloy.paste.post"),Qr=J("alloy.receive"),$r=J("alloy.execute"),Zr=J("alloy.focus.item"),no=Yr.tap,eo=J("alloy.longpress"),to=J("alloy.sandbox.close"),ro=J("alloy.system.init"),oo=J("alloy.system.attached"),io=J("alloy.system.detached"),uo=J("alloy.system.dismissRequested"),ao=J("alloy.system.repositionRequested"),co=J("alloy.focusmanager.shifted"),so=J("alloy.highlight"),fo=J("alloy.dehighlight"),lo=function(n,e){vo(n,n.element(),e,{})},mo=function(n,e,t){vo(n,n.element(),e,t)},go=function(n){lo(n,$r())},po=function(n,e,t){vo(n,e,t,{})},vo=function(n,e,t,r){var o=mn({target:e},r);n.getSystem().triggerEvent(t,e,rn(o,J))},ho=function(n){return wt(n)},bo=function(n,e){return{key:n,value:Br({run:e})}},yo=function(n){return function(t){return{key:n,value:Br({run:function(n,e){kr(n,e)&&t(n,e)}})}}},_o=function(n){return bo(n,function(n,e){e.cut()})},wo=yo(oo()),xo=yo(io()),Oo=yo(ro()),So=(Dr=$r(),function(n){return bo(Dr,n)}),Eo=function(n){return P(n,function(n){return r=e="/*",o=(t=n).length-e.length,""!==r&&(t.length<r.length||t.substr(o,o+r.length)!==r)?n:n.substring(0,n.length-"/*".length);var e,t,r,o})},Co=function(n,e){var t=n.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:Eo(i)}},n},ko=function(n){return{classes:void 0!==n.classes?n.classes:[],attributes:void 0!==n.attributes?n.attributes:{},styles:void 0!==n.styles?n.styles:{}}},To=function(t,r,o){return Oo(function(n,e){o(n,t,r)})},Do=function(o,i,u){var n,e,t,r,a,c;return n=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var r=[t].concat(n);return t.config({name:J(o)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+o+". Using API: "+u)},function(n){var e=Array.prototype.slice.call(r,1);return i.apply(void 0,[t,n.config,n.state].concat(e))})},e=u,t=i.toString(),r=t.indexOf(")")+1,a=t.indexOf("("),c=t.substring(a+1,r-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:e,parameters:Eo(c.slice(0,1).concat(c.slice(3)))}},n},Mo=function(n){return{key:n,value:void 0}},No=function(t,n,r,o,e,i,u){var a=function(n){return Ot(n,r)?n[r]():A.none()},c=rn(e,function(n,e){return Do(r,n,e)}),s=rn(i,function(n,e){return Co(n,e)}),f=mn(mn(mn({},s),c),{revoke:p(Mo,r),config:function(n){var e=ar(r+"-config",t,n);return{key:r,value:{config:e,me:f,configAsRaw:De(function(){return ar(r+"-config",t,n)}),initialConfig:n,state:u}}},schema:function(){return n},exhibit:function(n,t){return a(n).bind(function(e){return yt(o,"exhibit").map(function(n){return n(t,e.config,e.state)})}).getOr(ko({}))},name:function(){return r},handlers:function(n){return a(n).map(function(n){return bt("events",function(n,e){return{}})(o)(n.config,n.state)}).getOr({})}});return f},Ao=function(n){return wt(n)},Fo=Kt([gr("fields"),gr("name"),xr("active",{}),xr("apis",{}),xr("state",Er),xr("extra",{})]),Ro=function(n){var e,t,r,o,i,u,a,c,s=ar("Creating behaviour: "+n.name,Fo,n);return e=s.fields,t=s.name,r=s.active,o=s.apis,i=s.extra,u=s.state,a=Kt(e),c=_r(t,[wr("config",e)]),No(a,c,t,r,o,i,u)},Bo=Kt([gr("branchKey"),gr("branches"),gr("name"),xr("active",{}),xr("apis",{}),xr("state",Er),xr("extra",{})]),Io=J(void 0),Ho=function(n,e){var t,r;return{key:n,value:{config:{},me:(t=n,r=ho(e),Ro({fields:[gr("enabled")],name:t,active:{events:J(r)}})),configAsRaw:J({}),initialConfig:{},state:Er}}},Po=function(n){n.dom().focus()},jo=function(n){var e=void 0!==n?n.dom():b.document;return A.from(e.activeElement).map(w.fromDom)},Vo=function(e){return jo(Zn(e)).filter(function(n){return e.dom().contains(n.dom())})},Lo=function(e,n){j(n,function(n){ae(e,n)})},Wo=function(n){n.dom().textContent="",j(te(n),function(n){Uo(n)})},Uo=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},zo=function(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e},Go=function(n,e){for(var t=0;t<n.length;t++){var r=e(n[t],t);if(r.isSome())return r}return A.none()},qo=function(n){return n.dom().innerHTML},Yo=function(n,e){var t,r,o=Zn(n).dom(),i=w.fromDom(o.createDocumentFragment()),u=(t=e,(r=(o||b.document).createElement("div")).innerHTML=t,te(w.fromDom(r)));Lo(i,u),Wo(n),ae(n,i)},Ko=function(n){return e=n,t=!1,w.fromDom(e.dom().cloneNode(t));var e,t},Xo=function(n){var e,t,r,o=Ko(n);return e=o,t=w.fromTag("div"),r=w.fromDom(e.dom().cloneNode(!0)),ae(t,r),qo(t)},Jo=function(n){return Xo(n)},Qo="unknown";(Nr=Mr||(Mr={}))[Nr.STOP=0]="STOP",Nr[Nr.NORMAL=1]="NORMAL",Nr[Nr.LOGGING=2]="LOGGING";var $o=yn({}),Zo=function(e,n,t){var r,o,i,u;switch(yt($o.get(),e).orThunk(function(){var n=nn($o.get());return Go(n,function(n){return-1<e.indexOf(n)?A.some($o.get()[n]):A.none()})}).getOr(Mr.NORMAL)){case Mr.NORMAL:return t(ti());case Mr.LOGGING:var a=(r=e,o=n,i=[],u=(new Date).getTime(),{logEventCut:function(n,e,t){i.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){i.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){i.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){i.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){i.push({outcome:"response",purpose:t,target:e})},write:function(){var n=(new Date).getTime();I(["mousemove","mouseover","mouseout",ro()],r)||b.console.log(r,{event:r,time:n-u,target:o.dom(),sequence:P(i,function(n){return I(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+Jo(n.target)+")":n.outcome})})}}),c=t(a);return a.write(),c;case Mr.STOP:return!0}},ni=["alloy/data/Fields","alloy/debugging/Debugging"],ei=function(n,e,t){return Zo(n,e,t)},ti=J({logEventCut:_,logEventStopped:_,logNoParent:_,logEventNoHandlers:_,logEventResponse:_,write:_}),ri=function(n,e){return t=p.apply(void 0,[n.handler].concat(e)),r=n.purpose(),{cHandler:t,purpose:J(r)};var t,r},oi=function(n){return n.cHandler},ii=function(n,e,t){return Ar(n,function(n){return Jn(n,e)},t)},ui=function(n,e){return t=e,o=void 0===(r=n)?b.document:r.dom(),Qn(o)?A.none():A.from(o.querySelector(t)).map(w.fromDom);var t,r,o},ai=function(n,e,t){return Tr(Jn,ii,n,e,t)};var ci=function(n){var e=n.raw();return void 0===e.touches||1!==e.touches.length?A.none():A.some(e.touches[0])},si=function(t){var r,o,i,u=yn(A.none()),a=yn(!1),c=(r=function(n){t.triggerEvent(eo(),n),a.set(!0)},o=400,i=null,{cancel:function(){null!==i&&(b.clearTimeout(i),i=null)},schedule:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];i=b.setTimeout(function(){r.apply(null,n),i=null},o)}}),s=wt([{key:Hr(),value:function(t){return ci(t).each(function(n){c.cancel();var e={x:J(n.clientX),y:J(n.clientY),target:t.target};c.schedule(t),a.set(!1),u.set(A.some(e))}),A.none()}},{key:Pr(),value:function(n){return c.cancel(),ci(n).each(function(i){u.get().each(function(n){var e,t,r,o;e=i,t=n,r=Math.abs(e.clientX-t.x()),o=Math.abs(e.clientY-t.y()),(5<r||5<o)&&u.set(A.none())})}),A.none()}},{key:jr(),value:function(e){c.cancel();return u.get().filter(function(n){return $n(n.target(),e.target())}).map(function(n){return a.get()?(e.prevent(),!1):t.triggerEvent(no(),e)})}}]);return{fireIfReady:function(e,n){return yt(s,n).bind(function(n){return n(e)})}}},fi=function(n){var e,t;return 8===n.raw().which&&!I(["input","textarea"],ye(n.target()))&&(e=n.target(),!ai(e,'[contenteditable="true"]',t).isSome())},li=zn().browser.isFirefox(),di=Kt([vr("triggerEvent"),xr("stopBackspace",!0)]),mi=function(e,n){var t,r,o,i,u=ar("Getting GUI events settings",di,n),a=si(u),c=P(["touchstart","touchmove","touchend","touchcancel","gesturestart","mousedown","mouseup","mouseover","mousemove","mouseout","click"].concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),function(n){return O(e,n,function(e){a.fireIfReady(e,n).each(function(n){n&&e.kill()}),u.triggerEvent(n,e)&&e.kill()})}),s=yn(A.none()),f=O(e,"paste",function(e){a.fireIfReady(e,"paste").each(function(n){n&&e.kill()}),u.triggerEvent("paste",e)&&e.kill(),s.set(A.some(b.setTimeout(function(){u.triggerEvent(Jr(),e)},0)))}),l=O(e,"keydown",function(n){u.triggerEvent("keydown",n)?n.kill():!0===u.stopBackspace&&fi(n)&&n.prevent()}),d=(t=e,r=function(n){u.triggerEvent("focusin",n)&&n.kill()},li?S(t,"focus",r):O(t,"focusin",r)),m=yn(A.none()),g=(o=e,i=function(n){u.triggerEvent("focusout",n)&&n.kill(),m.set(A.some(b.setTimeout(function(){u.triggerEvent(Xr(),n)},0)))},li?S(o,"blur",i):O(o,"focusout",i));return{unbind:function(){j(c,function(n){n.unbind()}),l.unbind(),d.unbind(),g.unbind(),f.unbind(),s.get().each(b.clearTimeout),m.get().each(b.clearTimeout)}}},gi=function(n,e){var t=yt(n,"target").map(function(n){return n()}).getOr(e);return yn(t)},pi=rt([{stopped:[]},{resume:["element"]},{complete:[]}]),vi=function(n,r,e,t,o,i){var u,a,c,s,f=n(r,t),l=(u=e,a=o,c=yn(!1),s=yn(!1),{stop:function(){c.set(!0)},cut:function(){s.set(!0)},isStopped:c.get,isCut:s.get,event:J(u),setSource:a.set,getSource:a.get});return f.fold(function(){return i.logEventNoHandlers(r,t),pi.complete()},function(e){var t=e.descHandler();return oi(t)(l),l.isStopped()?(i.logEventStopped(r,e.element(),t.purpose()),pi.stopped()):l.isCut()?(i.logEventCut(r,e.element(),t.purpose()),pi.complete()):ee(e.element()).fold(function(){return i.logNoParent(r,e.element(),t.purpose()),pi.complete()},function(n){return i.logEventResponse(r,e.element(),t.purpose()),pi.resume(n)})})},hi=function(e,t,r,n,o,i){return vi(e,t,r,n,o,i).fold(function(){return!0},function(n){return hi(e,t,r,n,o,i)},function(){return!1})},bi=function(n,e,t){var r,o,i=(r=e,o=yn(!1),{stop:function(){o.set(!0)},cut:_,isStopped:o.get,isCut:J(!1),event:J(r),setSource:u("Cannot set source of a broadcasted event"),getSource:u("Cannot get source of a broadcasted event")});return j(n,function(n){var e=n.descHandler();oi(e)(i)}),i.isStopped()},yi=function(n,e,t,r,o){var i=gi(t,r);return hi(n,e,t,r,i,o)},_i=0,wi=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++_i+String(e)},xi=J("alloy-id-"),Oi=J("data-alloy-id"),Si=xi(),Ei=Oi(),Ci=function(n,e){Object.defineProperty(n.dom(),Ei,{value:e,writable:!0})},ki=function(n){var e=we(n)?n.dom()[Ei]:null;return A.from(e)},Ti=function(n){return wi(n)},Di=Z("element","descHandler"),Mi=function(n,e){return{id:J(n),descHandler:J(e)}};function Ni(){var i={};return{registerId:function(r,o,n){tn(n,function(n,e){var t=void 0!==i[e]?i[e]:{};t[o]=ri(n,r),i[e]=t})},unregisterId:function(t){tn(i,function(n,e){n.hasOwnProperty(t)&&delete n[t]})},filterByType:function(n){return yt(i,n).map(function(n){return un(n,function(n,e){return Mi(e,n)})}).getOr([])},find:function(n,e,t){var o=ht(e)(i);return Rr(t,function(n){return t=o,ki(r=n).fold(function(){return A.none()},function(n){var e=ht(n);return t.bind(e).map(function(n){return Di(r,n)})});var t,r},n)}}}function Ai(){var r=Ni(),o={},i=function(r){var n=r.element();return ki(n).fold(function(){return n="uid-",e=r.element(),t=wi(Si+n),Ci(e,t),t;var n,e,t},function(n){return n})},u=function(n){ki(n.element()).each(function(n){delete o[n],r.unregisterId(n)})};return{find:function(n,e,t){return r.find(n,e,t)},filter:function(n){return r.filterByType(n)},register:function(n){var e=i(n);Ot(o,e)&&function(n,e){var t=o[e];if(t!==n)throw new Error('The tagId "'+e+'" is already used by: '+Jo(t.element())+"\nCannot use it for: "+Jo(n.element())+"\nThe conflicting element is"+(Me(t.element())?" ":" not ")+"already in the DOM");u(n)}(n,e);var t=[n];r.registerId(t,e,n.events()),o[e]=n},unregister:u,getById:function(n){return ht(n)(o)}}}var Fi,Ri,Bi=ho([(Fi=Kr(),Ri=function(n,e){var t,r,o=e.event().originator(),i=e.event().target();return r=i,!($n(t=o,n.element())&&!$n(t,r))||(b.console.warn(Kr()+" did not get interpreted by the desired target. \nOriginator: "+Jo(o)+"\nTarget: "+Jo(i)+"\nCheck the "+Kr()+" event handlers"),!1)},{key:Fi,value:Br({can:Ri})})]),Ii=Object.freeze({__proto__:null,events:Bi}),Hi=g,Pi=function(e){var n=function(n){return function(){throw new Error("The component must be in a context to send: "+n+"\n"+Jo(e().element())+" is not in context.")}};return{debugInfo:J("fake"),triggerEvent:n("triggerEvent"),triggerFocus:n("triggerFocus"),triggerEscape:n("triggerEscape"),build:n("build"),addToWorld:n("addToWorld"),removeFromWorld:n("removeFromWorld"),addToGui:n("addToGui"),removeFromGui:n("removeFromGui"),getByUid:n("getByUid"),getByDom:n("getByDom"),broadcast:n("broadcast"),broadcastOn:n("broadcastOn"),broadcastEvent:n("broadcastEvent"),isConnected:J(!1)}},ji=Pi(),Vi=wi("alloy-premade"),Li=function(n){return _t(Vi,n)},Wi=function(r){return n=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return r.apply(void 0,[n.getApis()].concat([n].concat(e)))},e=r.toString(),t=e.indexOf(")")+1,o=e.indexOf("("),i=e.substring(o+1,t-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:Eo(i.slice(1))}},n;var n,e,t,o,i},Ui=function(n,o){var i={};return tn(n,function(n,r){tn(n,function(n,e){var t=bt(e,[])(i);i[e]=t.concat([o(r,n)])})}),i},zi=function(n,e){return{name:J(n),handler:J(e)}},Gi=function(n,e,t){var r,o,i=mn(mn({},t),(r=n,o={},j(e,function(n){o[n.name()]=n.handlers(r)}),o));return Ui(i,zi)},qi=function(n){var e,i=M(e=n)?{can:J(!0),abort:J(!1),run:e}:e;return function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var o=[n,e].concat(t);i.abort.apply(void 0,o)?e.stop():i.can.apply(void 0,o)&&i.run.apply(void 0,o)}},Yi=function(n,e,t){var r,o,i=e[t];return i?function(u,a,n,c){var e=n.slice(0);try{var t=e.sort(function(n,e){var t=n[a](),r=e[a](),o=c.indexOf(t),i=c.indexOf(r);if(-1===o)throw new Error("The ordering for "+u+" does not have an entry for "+t+".\nOrder specified: "+JSON.stringify(c,null,2));if(-1===i)throw new Error("The ordering for "+u+" does not have an entry for "+r+".\nOrder specified: "+JSON.stringify(c,null,2));return o<i?-1:i<o?1:0});return Pe.value(t)}catch(n){return Pe.error([n])}}("Event: "+t,"name",n,i).map(function(n){var e=P(n,function(n){return n.handler()});return Ir(e)}):(r=t,o=n,Pe.error(["The event ("+r+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+JSON.stringify(P(o,function(n){return n.name()}),null,2)]))},Ki=function(n,i){var e=un(n,function(r,o){return(1===r.length?Pe.value(r[0].handler()):Yi(r,i,o)).map(function(n){var e=qi(n),t=1<r.length?V(i[o],function(e){return H(r,function(n){return n.name()===e})}).join(" > "):r[0].name();return _t(o,{handler:e,purpose:J(t)})})});return xt(e,{})},Xi=function(n){return ir("custom.definition",Xt([Zt("dom","dom",ft(),Xt([gr("tag"),xr("styles",{}),xr("classes",[]),xr("attributes",{}),br("value"),br("innerHtml")])),gr("components"),gr("uid"),xr("events",{}),xr("apis",{}),Zt("eventOrder","eventOrder",(e={"alloy.execute":["disabling","alloy.base.behaviour","toggling","typeaheadevents"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing","item-events","tooltipping"],mousedown:["focusing","alloy.base.behaviour","item-type-events"],touchstart:["focusing","alloy.base.behaviour","item-type-events"],mouseover:["item-type-events","tooltipping"]},ct.mergeWithThunk(J(e))),fr()),br("domModification")]),n);var e},Ji=function(e,n){j(n,function(n){Ye(e,n)})},Qi=function(e,n){j(n,function(n){Xe(e,n)})},$i=function(n){return void 0!==n.style&&M(n.style.getPropertyValue)},Zi=function(n,e,t){if(!C(t))throw b.console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);$i(n)&&n.style.setProperty(e,t)},nu=function(n,e){$i(n)&&n.style.removeProperty(e)},eu=function(n,e,t){var r=n.dom();Zi(r,e,t)},tu=function(n,e){var t=n.dom();tn(e,function(n,e){Zi(t,e,n)})},ru=function(n,e){var t=n.dom(),r=b.window.getComputedStyle(t).getPropertyValue(e),o=""!==r||Me(n)?r:ou(t,e);return null===o?void 0:o},ou=function(n,e){return $i(n)?n.style.getPropertyValue(e):""},iu=function(n,e){var t=n.dom(),r=ou(t,e);return A.from(r).filter(function(n){return 0<n.length})},uu=function(n,e){var t=n.dom();nu(t,e),ke(n,"style")&&""===Ce(n,"style").replace(/^\s+|\s+$/g,"")&&Te(n,"style")},au=function(n){return n.dom().value},cu=function(n,e){if(void 0===e)throw new Error("Value.set was undefined");n.dom().value=e},su=function(n,e){return t=n,o=P(r=e,function(n){return _r(n.name(),[gr("config"),xr("state",Er)])}),i=ir("component.behaviours",Xt(o),t.behaviours).fold(function(n){throw new Error(cr(n)+"\nComplete spec:\n"+JSON.stringify(t,null,2))},function(n){return n}),{list:r,data:rn(i,function(n){var e=n.map(function(n){return{config:n.config,state:n.state.init(n.config)}});return function(){return e}})};var t,r,o,i},fu=function(n){var e,t,r,o=(e=n,t=bt("behaviours",{})(e),r=V(nn(t),function(n){return void 0!==t[n]}),P(r,function(n){return t[n].me}));return su(n,o)},lu=function(n,e,t){var r,o,i,u=mn(mn({},(r=n).dom),{uid:r.uid,domChildren:P(r.components,function(n){return n.element()})}),a=n.domModification.fold(function(){return ko({})},ko),c={"alloy.base.modification":a},s=0<e.length?function(e,n,t,r){var o=mn({},n);j(t,function(n){o[n.name()]=n.exhibit(e,r)});var i=Ui(o,function(n,e){return{name:n,modification:e}}),u=function(n){return L(n,function(n,e){return mn(mn({},e.modification),n)},{})},a=L(i.classes,function(n,e){return e.modification.concat(n)},[]),c=u(i.attributes),s=u(i.styles);return ko({classes:a,attributes:c,styles:s})}(t,c,e,u):a;return i=s,mn(mn({},o=u),{attributes:mn(mn({},o.attributes),i.attributes),styles:mn(mn({},o.styles),i.styles),classes:o.classes.concat(i.classes)})},du=function(n,e,t){var r,o,i,u,a,c,s={"alloy.base.behaviour":(r=n,r.events)};return(o=t,i=n.eventOrder,u=e,a=s,c=Gi(o,u,a),Ki(c,i)).getOrDie()},mu=function(t){var n=function(){return f},r=yn(ji),e=ur(Xi(t)),o=fu(t),i=o.list,u=o.data,a=function(n){var e=w.fromTag(n.tag);Ee(e,n.attributes),Ji(e,n.classes),tu(e,n.styles),n.innerHtml.each(function(n){return Yo(e,n)});var t=n.domChildren;return Lo(e,t),n.value.each(function(n){cu(e,n)}),n.uid,Ci(e,n.uid),e}(lu(e,i,u)),c=du(e,i,u),s=yn(e.components),f={getSystem:r.get,config:function(n){var e=u;return(M(e[n.name()])?e[n.name()]:function(){throw new Error("Could not find "+n.name()+" in "+JSON.stringify(t,null,2))})()},hasConfigured:function(n){return M(u[n.name()])},spec:J(t),readState:function(n){return u[n]().map(function(n){return n.state.readState()}).getOr("not enabled")},getApis:function(){return e.apis},connect:function(n){r.set(n)},disconnect:function(){r.set(Pi(n))},element:J(a),syncComponents:function(){var n=te(a),e=q(n,function(n){return r.get().getByDom(n).fold(function(){return[]},function(n){return[n]})});s.set(e)},components:s.get,events:J(c)};return f},gu=function(n){var e,t,r=Hi(n),o=r.events,i=gn(r,["events"]),u=(e=i,t=bt("components",[])(e),P(t,hu)),a=mn(mn({},i),{events:mn(mn({},Ii),o),components:u});return Pe.value(mu(a))},pu=function(n){var e=ar("external.component",Kt([gr("element"),br("uid")]),n),t=yn(Pi());e.uid.each(function(n){Ci(e.element,n)});var r={getSystem:t.get,config:A.none,hasConfigured:J(!1),connect:function(n){t.set(n)},disconnect:function(){t.set(Pi(function(){return r}))},getApis:function(){return{}},element:J(e.element),spec:J(n),readState:J("No state"),syncComponents:_,components:J([]),events:J({})};return Li(r)},vu=Ti,hu=function(e){return(n=e,yt(n,Vi)).fold(function(){var n=e.hasOwnProperty("uid")?e:mn({uid:vu("")},e);return gu(n).getOrDie()},function(n){return n});var n},bu=Li,yu=function(r,n){return e=r,t={},o=P(n,function(n){return e=n.name(),t="Cannot configure "+n.name()+" for "+r,Zt(e,e,lt(),Yt(function(n){return Nt("The field: "+e+" is forbidden. "+t)}));var e,t}).concat([Sr("dump",g)]),Or(e,t,Xt(o));var e,t,o},_u=function(n){return n.dump},wu=function(n,e){return mn(mn({},n.dump),Ao(e))},xu=yu,Ou=wu,Su=J([gr("menu"),gr("selectedMenu")]),Eu=J([gr("item"),gr("selectedItem")]),Cu=(J(Xt(Eu().concat(Su()))),J(Xt(Eu()))),ku=hr("initSize",[gr("numColumns"),gr("numRows")]),Tu=function(){return hr("markers",[gr("backgroundMenu")].concat(Su()).concat(Eu()))},Du=function(n,e,t){!function(){var n=new Error;if(void 0===n.stack)return;var e=n.stack.split("\n");U(e,function(e){return 0<e.indexOf("alloy")&&!H(ni,function(n){return-1<e.indexOf(n)})}).getOr(Qo)}();return Zt(e,e,t,rr(function(t){return Pe.value(function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t.apply(void 0,n)})}))},Mu=function(n){return Du(0,n,st(_))},Nu=function(n){return Du(0,n,st(A.none))},Au=function(n){return Du(0,n,ft())},Fu=function(n){return Du(0,n,ft())},Ru=function(n,e){return Sr(n,J(e))},Bu=function(n){return Sr(n,g)},Iu=J(ku),Hu="placeholder",Pu=rt([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),ju=function(n,e,t,r){return t.uiType===Hu?(i=t,u=r,(o=n).exists(function(n){return n!==i.owner})?Pu.single(!0,J(i)):yt(u,i.name).fold(function(){throw new Error("Unknown placeholder component: "+i.name+"\nKnown: ["+nn(u)+"]\nNamespace: "+o.getOr("none")+"\nSpec: "+JSON.stringify(i,null,2))},function(n){return n.replace()})):Pu.single(!1,J(t));var o,i,u},Vu=function(i,u,a,c){return ju(i,0,a,c).fold(function(n,e){var t=e(u,a.config,a.validated),r=yt(t,"components").getOr([]),o=q(r,function(n){return Vu(i,u,n,c)});return[mn(mn({},t),{components:o})]},function(n,e){var t=e(u,a.config,a.validated);return a.validated.preprocess.getOr(g)(t)})},Lu=function(e,t,n,r){var o,i,u,a=rn(r,function(n,e){return r=n,o=!1,{name:J(t=e),required:function(){return r.fold(function(n,e){return n},function(n,e){return n})},used:function(){return o},replace:function(){if(!0===o)throw new Error("Trying to use the same placeholder more than once: "+t);return o=!0,r}};var t,r,o}),c=(o=e,i=t,u=a,q(n,function(n){return Vu(o,i,n,u)}));return tn(a,function(n){if(!1===n.used()&&n.required())throw new Error("Placeholder: "+n.name()+" was not found in components list\nNamespace: "+e.getOr("none")+"\nComponents: "+JSON.stringify(t.components,null,2))}),c},Wu=Pu.single,Uu=Pu.multiple,zu=J(Hu),Gu=rt([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),qu=xr("factory",{sketch:g}),Yu=xr("schema",[]),Ku=gr("name"),Xu=Zt("pname","pname",dt(function(n){return"<alloy."+wi(n.name)+">"}),fr()),Ju=Sr("schema",function(){return[br("preprocess")]}),Qu=xr("defaults",J({})),$u=xr("overrides",J({})),Zu=Xt([qu,Yu,Ku,Xu,Qu,$u]),na=Xt([qu,Yu,Ku,Qu,$u]),ea=Xt([qu,Yu,Ku,Xu,Qu,$u]),ta=Xt([qu,Ju,Ku,gr("unit"),Xu,Qu,$u]),ra=function(n){var e=function(n){return n.name};return n.fold(e,e,e,e)},oa=function(t,r){return function(n){var e=ar("Converting part type",r,n);return t(e)}},ia=oa(Gu.required,Zu),ua=oa(Gu.external,na),aa=oa(Gu.optional,ea),ca=oa(Gu.group,ta),sa=J("entirety"),fa=function(n,e,t,r){return ut(e.defaults(n,t,r),t,{uid:n.partUids[e.name]},e.overrides(n,t,r))},la=function(o,n){var i={};return j(n,function(n){var e;(e=n,e.fold(A.some,A.none,A.some,A.some)).each(function(t){var r=da(o,t.pname);i[t.name]=function(n){var e=ar("Part: "+t.name+" in "+o,Xt(t.schema),n);return mn(mn({},r),{config:n,validated:e})}})}),i},da=function(n,e){return{uiType:zu(),owner:n,name:e}},ma=function(n,e,t){return r=e,i={},o={},j(t,function(n){n.fold(function(r){i[r.pname]=Wu(!0,function(n,e,t){return r.factory.sketch(fa(n,r,e,t))})},function(n){var e=r.parts[n.name];o[n.name]=J(n.factory.sketch(fa(r,n,e[sa()]),e))},function(r){i[r.pname]=Wu(!1,function(n,e,t){return r.factory.sketch(fa(n,r,e,t))})},function(o){i[o.pname]=Uu(!0,function(e,n,t){var r=e[o.name];return P(r,function(n){return o.factory.sketch(ut(o.defaults(e,n,t),n,o.overrides(e,n)))})})})}),{internals:J(i),externals:J(o)};var r,i,o},ga=function(n,e,t){return Lu(A.some(n),e,e.components,t)},pa=function(e,n){var t=P(n,ra);return wt(P(t,function(n){return{key:n,value:e+"-"+n}}))},va=function(e){return Zt("partUids","partUids",mt(function(n){return pa(n.uid,e)}),fr())},ha=function(n,e,t,r,o){var i,u,a=(u=o,(0<(i=r).length?[hr("parts",i)]:[]).concat([gr("uid"),xr("dom",{}),xr("components",[]),Bu("originalSpec"),xr("debug.sketcher",{})]).concat(u));return ar(n+" [SpecSchema]",Kt(a.concat(e)),t)},ba=function(n,e,t,r,o){var i=ya(o),u=q(t,function(n){return n.fold(A.none,A.some,A.none,A.none).map(function(n){return hr(n.name,n.schema.concat([Bu(sa())]))}).toArray()}),a=va(t),c=ha(n,e,i,u,[a]),s=ma(0,c,t);return r(c,ga(n,c,s.internals()),i,s.externals())},ya=function(n){return n.hasOwnProperty("uid")?n:mn(mn({},n),{uid:Ti("uid")})};var _a=Kt([gr("name"),gr("factory"),gr("configFields"),xr("apis",{}),xr("extraApis",{})]),wa=Kt([gr("name"),gr("factory"),gr("configFields"),gr("partFields"),xr("apis",{}),xr("extraApis",{})]),xa=function(n){var i=ar("Sketcher for "+n.name,_a,n),e=rn(i.apis,Wi),t=rn(i.extraApis,function(n,e){return Co(n,e)});return mn(mn({name:J(i.name),partFields:J([]),configFields:J(i.configFields),sketch:function(n){return e=i.name,t=i.configFields,r=i.factory,o=ya(n),r(ha(e,t,o,[],[]),o);var e,t,r,o}},e),t)},Oa=function(n){var e=ar("Sketcher for "+n.name,wa,n),t=la(e.name,e.partFields),r=rn(e.apis,Wi),o=rn(e.extraApis,function(n,e){return Co(n,e)});return mn(mn({name:J(e.name),partFields:J(e.partFields),configFields:J(e.configFields),sketch:function(n){return ba(e.name,e.configFields,e.partFields,e.factory,n)},parts:J(t)},r),o)},Sa=(xa({name:"Container",factory:function(n){var e=n.dom,t=e.attributes,r=gn(e,["attributes"]);return{uid:n.uid,dom:mn({tag:"div",attributes:mn({role:"presentation"},t)},r),components:n.components,behaviours:_u(n.containerBehaviours),events:n.events,domModification:n.domModification,eventOrder:n.eventOrder}},configFields:[xr("components",[]),yu("containerBehaviours",[]),xr("events",{}),xr("domModification",{}),xr("eventOrder",{})]}),function(n){lo(n,io());var e=n.components();j(e,Sa)}),Ea=function(n){var e=n.components();j(e,Ea),lo(n,oo())},Ca=function(n,e){ae(n.element(),e.element())},ka=function(e,n){var t,r=e.components();j((t=e).components(),function(n){return Uo(n.element())}),Wo(t.element()),t.syncComponents();var o=X(r,n);j(o,function(n){Sa(n),e.getSystem().removeFromWorld(n)}),j(n,function(n){n.getSystem().isConnected()?Ca(e,n):(e.getSystem().addToWorld(n),Ca(e,n),Me(e.element())&&Ea(n)),e.syncComponents()})},Ta=function(n,e){Da(n,e,ae)},Da=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),Me(n.element())&&Ea(e),n.syncComponents()},Ma=function(n){Sa(n),Uo(n.element()),n.getSystem().removeFromWorld(n)},Na=function(e){var n=ee(e.element()).bind(function(n){return e.getSystem().getByDom(n).toOption()});Ma(e),n.each(function(n){n.syncComponents()})},Aa=function(n){var e=n.components();j(e,Ma),Wo(n.element()),n.syncComponents()},Fa=function(t){var r=function(e){return ee(t.element()).fold(function(){return!0},function(n){return $n(e,n)})},o=Ai(),s=function(n,e){return o.find(r,n,e)},n=mi(t.element(),{triggerEvent:function(u,a){return ei(u,a.target(),function(n){return e=s,t=u,o=n,i=(r=a).target(),yi(e,t,r,i,o);var e,t,r,o,i})}}),i={debugInfo:J("real"),triggerEvent:function(e,t,r){ei(e,t,function(n){yi(s,e,r,t,n)})},triggerFocus:function(a,c){ki(a).fold(function(){Po(a)},function(n){ei(Kr(),a,function(n){var e,t,r,o,i,u;e=s,t=Kr(),r={originator:J(c),kill:_,prevent:_,target:J(a)},i=n,u=gi(r,o=a),vi(e,t,r,o,u,i)})})},triggerEscape:function(n,e){i.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return g(n)},getByDom:function(n){return p(n)},build:hu,addToGui:function(n){a(n)},removeFromGui:function(n){c(n)},addToWorld:function(n){e(n)},removeFromWorld:function(n){u(n)},broadcast:function(n){l(n)},broadcastOn:function(n,e){d(n,e)},broadcastEvent:function(n,e){m(n,e)},isConnected:J(!0)},e=function(n){n.connect(i),xe(n.element())||(o.register(n),j(n.components(),e),i.triggerEvent(ro(),n.element(),{target:J(n.element())}))},u=function(n){xe(n.element())||(j(n.components(),u),o.unregister(n)),n.disconnect()},a=function(n){Ta(t,n)},c=function(n){Na(n)},f=function(t){var n=o.filter(Qr());j(n,function(n){var e=n.descHandler();oi(e)(t)})},l=function(n){f({universal:J(!0),data:J(n)})},d=function(n,e){f({universal:J(!1),channels:J(n),data:J(e)})},m=function(n,e){var t=o.filter(n);return bi(t,e)},g=function(n){return o.getById(n).fold(function(){return Pe.error(new Error('Could not find component with uid: "'+n+'" in system.'))},Pe.value)},p=function(n){var e=ki(n).getOr("not found");return g(e)};return e(t),{root:J(t),element:t.element,destroy:function(){n.unbind(),Uo(t.element())},add:a,remove:c,getByUid:g,getByDom:p,addToWorld:e,removeFromWorld:u,broadcast:l,broadcastOn:d,broadcastEvent:m}},Ra=function(n){var e=void 0!==n.uid&&Ot(n,"uid")?n.uid:Ti("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).toOption()},asSpec:function(){return mn(mn({},n),{uid:e})}}},Ba=Object.freeze({__proto__:null,exhibit:function(n,e){return ko({classes:[],styles:e.useFixed()?{}:{position:"relative"}})}}),Ia=function(t,r){return{left:J(t),top:J(r),translate:function(n,e){return Ia(t+n,r+e)}}},Ha=Ia,Pa=function(n,e){return void 0!==n?n:void 0!==e?e:0},ja=function(n){var e=n.dom().ownerDocument,t=e.body,r=e.defaultView,o=e.documentElement;if(t===n.dom())return Ha(t.offsetLeft,t.offsetTop);var i=Pa(r.pageYOffset,o.scrollTop),u=Pa(r.pageXOffset,o.scrollLeft),a=Pa(o.clientTop,t.clientTop),c=Pa(o.clientLeft,t.clientLeft);return Va(n).translate(u-c,i-a)},Va=function(n){var e,t=n.dom(),r=t.ownerDocument.body;return r===t?Ha(r.offsetLeft,r.offsetTop):Me(n)?(e=t.getBoundingClientRect(),Ha(e.left,e.top)):Ha(0,0)},La=function(n,t){var r=Zn(t),e=jo(r).bind(function(e){var o,i,n=function(n){return $n(e,n)};return n(t)?A.some(t):(o=n,(i=function(n){for(var e=0;e<n.childNodes.length;e++){var t=w.fromDom(n.childNodes[e]);if(o(t))return A.some(t);var r=i(n.childNodes[e]);if(r.isSome())return r}return A.none()})(t.dom()))}),o=n(t);return e.each(function(e){jo(r).filter(function(n){return $n(n,e)}).fold(function(){Po(e)},_)}),o};function Wa(r,o){var n=function(n){var e=o(n);if(e<=0||null===e){var t=ru(n,r);return parseFloat(t)||0}return e},i=function(o,n){return W(n,function(n,e){var t=ru(o,e),r=void 0===t?0:parseInt(t,10);return isNaN(r)?n:n+r},0)};return{set:function(n,e){if(!N(e)&&!e.match(/^[0-9]+$/))throw new Error(r+".set accepts only positive integer values. Value was "+e);var t=n.dom();$i(t)&&(t.style[r]=e+"px")},get:n,getOuter:n,aggregate:i,max:function(n,e,t){var r=i(n,t);return r<e?e-r:0}}}var Ua=Wa("height",function(n){var e=n.dom();return Me(n)?e.getBoundingClientRect().height:e.offsetHeight}),za=function(n){return Ua.getOuter(n)},Ga=Wa("width",function(n){return n.dom().offsetWidth}),qa=function(n){return Ga.getOuter(n)},Ya=(zn().browser.isSafari(),function(n){var e=void 0!==n?n.dom():b.document,t=e.body.scrollLeft||e.documentElement.scrollLeft,r=e.body.scrollTop||e.documentElement.scrollTop;return Ha(t,r)}),Ka=function(n,e,t,r){return{x:J(n),y:J(e),width:J(t),height:J(r),right:J(n+t),bottom:J(e+r)}},Xa=function(r,n){return r.view(n).fold(J([]),function(n){var e=r.owner(n),t=Xa(r,e);return[n].concat(t)})},Ja=Object.freeze({__proto__:null,view:function(n){return(n.dom()===b.document?A.none():A.from(n.dom().defaultView.frameElement)).map(w.fromDom)},owner:function(n){return Zn(n)}}),Qa=function(r){var n,e,t,o,i=w.fromDom(b.document),u=Ya(i);return(n=r,t=(e=Ja).owner(n),o=Xa(e,t),A.some(o)).fold(p(ja,r),function(n){var e=Va(r),t=L(n,function(n,e){var t=Va(e);return{left:n.left+t.left(),top:n.top+t.top()}},{left:0,top:0});return Ha(t.left+e.left()+u.left(),t.top+e.top()+u.top())})},$a=Z("point","width","height"),Za=Z("x","y","width","height"),nc=function(n,e,t,r){return{x:J(n),y:J(e),width:J(t),height:J(r),right:J(n+t),bottom:J(e+r)}},ec=function(n){var e=ja(n),t=qa(n),r=za(n);return nc(e.left(),e.top(),t,r)},tc=function(){return function(n){var e=void 0===n?b.window:n,t=e.document,r=Ya(w.fromDom(t)),o=e.visualViewport;if(void 0!==o)return Ka(Math.max(o.pageLeft,r.left()),Math.max(o.pageTop,r.top()),o.width,o.height);var i=t.documentElement,u=i.clientWidth,a=i.clientHeight;return Ka(r.left(),r.top(),u,a)}(b.window)},rc=["valignCentre","alignLeft","alignRight","alignCentre","top","bottom","left","right"],oc=function(){return e=n=0,t={},o=function(n){return yt(t,n).getOr([])},r=function(n,e,t){var r=X(rc,t);return{offset:function(){return Ha(n,e)},classesOn:function(){return q(t,o)},classesOff:function(){return q(r,o)}}},{southeast:function(){return r(-n,e,["top","alignLeft"])},southwest:function(){return r(n,e,["top","alignRight"])},south:function(){return r(-n/2,e,["top","alignCentre"])},northeast:function(){return r(-n,-e,["bottom","alignLeft"])},northwest:function(){return r(n,-e,["bottom","alignRight"])},north:function(){return r(-n/2,-e,["bottom","alignCentre"])},east:function(){return r(n,-e/2,["valignCentre","left"])},west:function(){return r(-n,-e/2,["valignCentre","right"])},innerNorthwest:function(){return r(-n,e,["top","alignRight"])},innerNortheast:function(){return r(n,e,["top","alignLeft"])},innerNorth:function(){return r(-n/2,e,["top","alignCentre"])},innerSouthwest:function(){return r(-n,-e,["bottom","alignRight"])},innerSoutheast:function(){return r(n,-e,["bottom","alignLeft"])},innerSouth:function(){return r(-n/2,-e,["bottom","alignCentre"])},innerWest:function(){return r(n,-e/2,["valignCentre","right"])},innerEast:function(){return r(-n,-e/2,["valignCentre","left"])}};var n,e,t,o,r},ic=Z("x","y","bubble","direction","label"),uc=rt([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]),ac=uc.southeast,cc=uc.southwest,sc=uc.northeast,fc=uc.northwest,lc=uc.south,dc=uc.north,mc=uc.east,gc=uc.west,pc=function(n){return n.x()},vc=function(n,e){return n.x()+n.width()/2-e.width()/2},hc=function(n,e){return n.x()+n.width()-e.width()},bc=function(n,e){return n.y()-e.height()},yc=function(n){return n.y()+n.height()},_c=function(n,e){return n.y()+n.height()/2-e.height()/2},wc=function(n,e,t){return ic(pc(n),yc(n),t.southeast(),ac(),"layout-se")},xc=function(n,e,t){return ic(hc(n,e),yc(n),t.southwest(),cc(),"layout-sw")},Oc=function(n,e,t){return ic(pc(n),bc(n,e),t.northeast(),sc(),"layout-ne")},Sc=function(n,e,t){return ic(hc(n,e),bc(n,e),t.northwest(),fc(),"layout-nw")},Ec=function(n,e,t){return ic(vc(n,e),bc(n,e),t.north(),dc(),"layout-n")},Cc=function(n,e,t){return ic(vc(n,e),yc(n),t.south(),lc(),"layout-s")},kc=function(n,e,t){return ic((r=n).x()+r.width(),_c(n,e),t.east(),mc(),"layout-e");var r},Tc=function(n,e,t){return ic((r=e,n.x()-r.width()),_c(n,e),t.west(),gc(),"layout-w");var r},Dc=fn(["x","y","width","height","maxHeight","maxWidth","direction","classes","label","candidateYforTest"],[]),Mc=Z("position","left","top","right","bottom"),Nc=rt([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),Ac=function(n,e,t,r,o,i){var u,a,c,s,f,l,d,m,g,p=e.x()-t,v=e.y()-r,h=o-(p+e.width()),b=i-(v+e.height()),y=A.some(p),_=A.some(v),w=A.some(h),x=A.some(b),O=A.none();return u=e.direction(),a=function(){return Mc(n,y,_,O,O)},c=function(){return Mc(n,O,_,w,O)},s=function(){return Mc(n,y,O,O,x)},f=function(){return Mc(n,O,O,w,x)},l=function(){return Mc(n,y,_,O,O)},d=function(){return Mc(n,y,O,O,x)},m=function(){return Mc(n,y,_,O,O)},g=function(){return Mc(n,O,_,w,O)},u.fold(a,c,s,f,l,d,m,g)},Fc=function(n,e){var t=p(Qa,e),r=n.fold(t,t,function(){var n=Ya();return Qa(e).translate(-n.left(),-n.top())}),o=qa(e),i=za(e);return nc(r.left(),r.top(),o,i)},Rc=function(n,e,t){var r=Ha(e,t);return n.fold(J(r),J(r),function(){var n=Ya();return r.translate(-n.left(),-n.top())})},Bc=(Nc.none,Nc.relative),Ic=Nc.fixed,Hc=function(n){return n},Pc=function(e,t){return function(n){return"rtl"===jc(n)?t:e}},jc=function(n){return"rtl"===ru(n,"direction")?"rtl":"ltr"},Vc=function(){return _r("layouts",[gr("onLtr"),gr("onRtl")])},Lc=function(e,n,t,r){var o=n.layouts.map(function(n){return n.onLtr(e)}).getOr(t),i=n.layouts.map(function(n){return n.onRtl(e)}).getOr(r);return Pc(o,i)(e)},Wc=[gr("hotspot"),br("bubble"),xr("overrides",{}),Vc(),Ru("placement",function(n,e,t){var r=e.hotspot,o=Fc(t,r.element()),i=Lc(n.element(),e,[wc,xc,Oc,Sc,Cc,Ec],[xc,wc,Sc,Oc,Cc,Ec]);return A.some(Hc({anchorBox:o,bubble:e.bubble.getOr(oc()),overrides:e.overrides,layouts:i,placer:A.none()}))})],Uc=[gr("x"),gr("y"),xr("height",0),xr("width",0),xr("bubble",oc()),xr("overrides",{}),Vc(),Ru("placement",function(n,e,t){var r=Rc(t,e.x,e.y),o=nc(r.left(),r.top(),e.width,e.height),i=Lc(n.element(),e,[wc,xc,Oc,Sc,Cc,Ec,kc,Tc],[xc,wc,Sc,Oc,Cc,Ec,kc,Tc]);return A.some(Hc({anchorBox:o,bubble:e.bubble,overrides:e.overrides,layouts:i,placer:A.none()}))})],zc={create:Z("start","soffset","finish","foffset")},Gc=rt([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),qc=(Gc.before,Gc.on,Gc.after,function(n){return n.fold(g,g,g)}),Yc=rt([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Kc={domRange:Yc.domRange,relative:Yc.relative,exact:Yc.exact,exactFromRange:function(n){return Yc.exact(n.start(),n.soffset(),n.finish(),n.foffset())},getWin:function(n){var e=n.match({domRange:function(n){return w.fromDom(n.startContainer)},relative:function(n,e){return qc(n)},exact:function(n,e,t,r){return n}});return ne(e)},range:zc.create},Xc=function(n,e,t){var r,o,i=n.document.createRange();return r=i,e.fold(function(n){r.setStartBefore(n.dom())},function(n,e){r.setStart(n.dom(),e)},function(n){r.setStartAfter(n.dom())}),o=i,t.fold(function(n){o.setEndBefore(n.dom())},function(n,e){o.setEnd(n.dom(),e)},function(n){o.setEndAfter(n.dom())}),i},Jc=function(n,e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},Qc=function(n){return{left:J(n.left),top:J(n.top),right:J(n.right),bottom:J(n.bottom),width:J(n.width),height:J(n.height)}},$c=rt([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),Zc=function(n,e,t){return e(w.fromDom(t.startContainer),t.startOffset,w.fromDom(t.endContainer),t.endOffset)},ns=function(n,e){var o,t,r,i=(o=n,e.match({domRange:function(n){return{ltr:J(n),rtl:A.none}},relative:function(n,e){return{ltr:De(function(){return Xc(o,n,e)}),rtl:De(function(){return A.some(Xc(o,e,n))})}},exact:function(n,e,t,r){return{ltr:De(function(){return Jc(o,n,e,t,r)}),rtl:De(function(){return A.some(Jc(o,t,r,n,e))})}}}));return(r=(t=i).ltr()).collapsed?t.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return $c.rtl(w.fromDom(n.endContainer),n.endOffset,w.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return Zc(0,$c.ltr,r)}):Zc(0,$c.ltr,r)};$c.ltr,$c.rtl;var es,ts,rs,os,is,us,as,cs=(es=xe,ts="text",{get:function(n){if(!es(n))throw new Error("Can only get "+ts+" value of a "+ts+" node");return rs(n).getOr("")},getOption:rs=function(n){return es(n)?A.from(n.dom().nodeValue):A.none()},set:function(n,e){if(!es(n))throw new Error("Can only set raw "+ts+" value of a "+ts+" node");n.dom().nodeValue=e}}),ss=function(n,e,t,r){var o,i,u,a,c,s=(i=e,u=t,a=r,(c=Zn(o=n).dom().createRange()).setStart(o.dom(),i),c.setEnd(u.dom(),a),c),f=$n(n,t)&&e===r;return s.collapsed&&!f},fs=function(n){var e=w.fromDom(n.anchorNode),t=w.fromDom(n.focusNode);return ss(e,n.anchorOffset,t,n.focusOffset)?A.some(zc.create(e,n.anchorOffset,t,n.focusOffset)):function(n){if(0<n.rangeCount){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return A.some(zc.create(w.fromDom(e.startContainer),e.startOffset,w.fromDom(t.endContainer),t.endOffset))}return A.none()}(n)},ls=function(n,e){var i,t,r,o,u=ns(i=n,e).match({ltr:function(n,e,t,r){var o=i.document.createRange();return o.setStart(n.dom(),e),o.setEnd(t.dom(),r),o},rtl:function(n,e,t,r){var o=i.document.createRange();return o.setStart(t.dom(),r),o.setEnd(n.dom(),e),o}});return r=(t=u).getClientRects(),0<(o=0<r.length?r[0]:t.getBoundingClientRect()).width||0<o.height?A.some(o).map(Qc):A.none()},ds=Z("element","offset"),ms=function(n,e){var t=te(n);if(0===t.length)return ds(n,e);if(e<t.length)return ds(t[e],0);var r,o=t[t.length-1],i=xe(o)?(r=o,cs.get(r)).length:te(o).length;return ds(o,i)},gs=rt([{screen:["point"]},{absolute:["point","scrollLeft","scrollTop"]}]),ps=function(n){return n.fold(function(n){return n},function(n,e,t){return n.translate(-e,-t)})},vs=function(n){return n.fold(function(n){return n},function(n,e,t){return n})},hs=function(n){return W(n,function(n,e){return n.translate(e.left(),e.top())},Ha(0,0))},bs=function(n){var e=P(n,vs);return hs(e)},ys=gs.screen,_s=gs.absolute,ws=function(n,e,t){var r,o,i,u=Zn(n.element()),a=Ya(u),c=(r=n,o=t,i=ne(o.root).dom(),A.from(i.frameElement).map(w.fromDom).filter(function(n){var e=Zn(n),t=Zn(r.element());return $n(e,t)}).map(ja)).getOr(a);return _s(c,a.left(),a.top())},xs=function(n,e,t,r){var o=n,i=e,u=t,a=r;n<0&&(o=0,u=t+n),e<0&&(i=0,a=r+e);var c=ys(Ha(o,i));return A.some($a(c,u,a))},Os=function(n,c,s,f,l){return n.map(function(n){var e,t,r,o=[c,n.point()],i=(e=function(){return bs(o)},t=function(){return bs(o)},r=function(){return n=P(o,ps),hs(n);var n},f.fold(e,t,r)),u=Za(i.left(),i.top(),n.width(),n.height()),a=Lc(l,s,s.showAbove?[Oc,Sc,wc,xc,Ec,Cc]:[wc,xc,Oc,Sc,Cc,Cc],s.showAbove?[Sc,Oc,xc,wc,Ec,Cc]:[xc,wc,Sc,Oc,Cc,Ec]);return Hc({anchorBox:u,bubble:s.bubble.getOr(oc()),overrides:s.overrides,layouts:a,placer:A.none()})})},Ss=Z("element","offset"),Es=function(n,e){return xe(n)?Ss(n,e):ms(n,e)},Cs=function(e,n){return n.getSelection.getOrThunk(function(){return function(){return n=e,A.from(n.getSelection()).filter(function(n){return 0<n.rangeCount}).bind(fs);var n}})().map(function(n){var e=Es(n.start(),n.soffset()),t=Es(n.finish(),n.foffset());return Kc.range(e.element(),e.offset(),t.element(),t.offset())})},ks=[br("getSelection"),gr("root"),br("bubble"),Vc(),xr("overrides",{}),xr("showAbove",!1),Ru("placement",function(n,e,t){var r=ne(e.root).dom(),o=ws(n,0,e),i=Cs(r,e).bind(function(n){return ls(r,Kc.exactFromRange(n)).orThunk(function(){var e=w.fromText("\ufeff");return ie(n.start(),e),ls(r,Kc.exact(e,0,e,1)).map(function(n){return Uo(e),n})}).bind(function(n){return xs(n.left(),n.top(),n.width(),n.height())})}),u=Cs(r,e).bind(function(n){return we(n.start())?A.some(n.start()):ee(n.start())}).getOr(n.element());return Os(i,o,e,t,u)})],Ts=[gr("node"),gr("root"),br("bubble"),Vc(),xr("overrides",{}),xr("showAbove",!1),Ru("placement",function(o,i,u){var a=ws(o,0,i);return i.node.bind(function(n){var e=n.dom().getBoundingClientRect(),t=xs(e.left,e.top,e.width,e.height),r=i.node.getOr(o.element());return Os(t,a,i,u,r)})})],Ds=function(n){return n.x()+n.width()},Ms=function(n,e){return n.x()-e.width()},Ns=function(n,e){return n.y()-e.height()+n.height()},As=function(n){return n.y()},Fs=function(n,e,t){return ic(Ds(n),As(n),t.southeast(),ac(),"link-layout-se")},Rs=function(n,e,t){return ic(Ms(n,e),As(n),t.southwest(),cc(),"link-layout-sw")},Bs=function(n,e,t){return ic(Ds(n),Ns(n,e),t.northeast(),sc(),"link-layout-ne")},Is=function(n,e,t){return ic(Ms(n,e),Ns(n,e),t.northwest(),fc(),"link-layout-nw")},Hs=[gr("item"),Vc(),xr("overrides",{}),Ru("placement",function(n,e,t){var r=Fc(t,e.item.element()),o=Lc(n.element(),e,[Fs,Rs,Bs,Is],[Rs,Fs,Is,Bs]);return A.some(Hc({anchorBox:r,bubble:oc(),overrides:e.overrides,layouts:o,placer:A.none()}))})],Ps=sr("anchor",{selection:ks,node:Ts,hotspot:Wc,submenu:Hs,makeshift:Uc}),js=Z("anchorBox","origin"),Vs=function(n,e,t,r){var o=n+e;return r<o?t:o<t?r:o},Ls=function(n,e,t){return n<=e?e:t<=n?t:n},Ws=rt([{fit:["reposition"]},{nofit:["reposition","deltaW","deltaH"]}]),Us=function(n,e,t,r){var o,i,u,a,c,s,f,l,d,m,g,p,v,h,b,y,_,w,x,O,S,E,C,k=n.x(),T=n.y(),D=n.bubble().offset().left(),M=n.bubble().offset().top(),N=r.y(),A=r.bottom(),F=r.x(),R=r.right(),B=T+M,I=(o=k+D,i=B,u=e,a=t,s=(c=r).x(),f=c.y(),l=c.width(),d=c.height(),g=f<=i,p=(m=s<=o)&&g,v=o+u<=s+l&&i+a<=f+d,h=Math.abs(Math.min(u,m?s+l-o:s-(o+u))),b=Math.abs(Math.min(a,g?f+d-i:f-(i+a))),{originInBounds:p,sizeInBounds:v,limitX:Ls(o,c.x(),c.right()),limitY:Ls(i,c.y(),c.bottom()),deltaW:h,deltaH:b}),H=I.originInBounds,P=I.sizeInBounds,j=I.limitX,V=I.limitY,L=I.deltaW,W=I.deltaH,U=J(V+W-N),z=J(A-V),G=(y=n.direction(),w=_=z,x=U,y.fold(_,_,x,x,_,x,w,w)),q=J(j+L-F),Y=J(R-j),K=(O=n.direction(),E=S=Y,C=q,O.fold(S,C,S,C,E,E,S,C)),X=Dc({x:j,y:V,width:L,height:W,maxHeight:G,maxWidth:K,direction:n.direction(),classes:{on:n.bubble().classesOn(),off:n.bubble().classesOff()},label:n.label(),candidateYforTest:B});return H&&P?Ws.fit(X):Ws.nofit(X,L,W)},zs=function(n,e,t,r){uu(e,"max-height"),uu(e,"max-width");var o,i,u,a,c,s,f,l,d,m={width:J(qa(o=e)),height:J(za(o))};return i=r.preference(),u=n,a=m,c=t,s=r.bounds(),f=a.width(),l=a.height(),d=function(n,r,o,i){var e=n(u,a,c);return Us(e,f,l,s).fold(Ws.fit,function(n,e,t){return i<t||o<e?Ws.nofit(n,e,t):Ws.nofit(r,o,i)})},W(i,function(n,e){var t=p(d,e);return n.fold(Ws.fit,t)},Ws.nofit(Dc({x:u.x(),y:u.y(),width:a.width(),height:a.height(),maxHeight:a.height(),maxWidth:a.width(),direction:ac(),classes:{on:[],off:[]},label:"none",candidateYforTest:u.y()}),-1,-1)).fold(g,g)},Gs=function(n,e,t){var r,o,i,u,a,c=function(n){return n+"px"},s=(r=t.origin(),o=e,r.fold(function(){return Mc("absolute",A.some(o.x()),A.some(o.y()),A.none(),A.none())},function(n,e,t,r){return Ac("absolute",o,n,e,t,r)},function(n,e,t,r){return Ac("fixed",o,n,e,t,r)}));i=n,u={position:A.some(s.position()),left:s.left().map(c),top:s.top().map(c),right:s.right().map(c),bottom:s.bottom().map(c)},a=i.dom(),tn(u,function(n,e){n.fold(function(){nu(a,e)},function(n){Zi(a,e,n)})})},qs=function(n,e){var t,r,o;t=n,r=Math.floor(e),o=Ua.max(t,r,["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"]),eu(t,"max-height",o+"px")},Ys=J(function(n,e){qs(n,e),tu(n,{"overflow-x":"hidden","overflow-y":"auto"})}),Ks=fn(["bounds","origin","preference","maxHeightFunction","maxWidthFunction"],[]),Xs=function(n,e,t){return void 0===n[e]?t:n[e]},Js=function(n,e,t,r,o,i){var u,a,c=Xs(i,"maxHeightFunction",Ys()),s=Xs(i,"maxWidthFunction",_),f=n.anchorBox(),l=n.origin(),d=Ks({bounds:(u=l,a=o,a.fold(function(){return u.fold(tc,tc,nc)},function(t){return u.fold(t,t,function(){var n=t(),e=Rc(u,n.x(),n.y());return nc(e.left(),e.top(),n.width(),n.height())})})),origin:l,preference:r,maxHeightFunction:c,maxWidthFunction:s});Qs(f,e,t,d)},Qs=function(n,e,t,r){var o,i,u,a,c,s,f=zs(n,e,t,r);Gs(e,f,r),o=e,i=f.classes(),Qi(o,i.off),Ji(o,i.on),u=e,a=f,r.maxHeightFunction()(u,a.maxHeight()),c=e,s=f,r.maxWidthFunction()(c,s.maxWidth())},$s=function(n,e,t,r,o){var i,u=(i=t.anchorBox,js(i,e));Js(u,o.element(),t.bubble,t.layouts,r,t.overrides)},Zs=function(n,e,t,r,o,i){var u=i.map(ec);return nf(n,e,t,r,o,u)},nf=function(c,s,n,e,f,l){var d=ar("positioning anchor.info",Ps,e);La(function(){eu(f.element(),"position","fixed");var n=iu(f.element(),"visibility");eu(f.element(),"visibility","hidden");var e,t,r,o,i=s.useFixed()?(o=b.document.documentElement,Ic(0,0,o.clientWidth,o.clientHeight)):(t=ja((e=c).element()),r=e.element().dom().getBoundingClientRect(),Bc(t.left(),t.top(),r.width,r.height)),u=d.placement,a=l.map(J).or(s.getBounds);u(c,d,i).each(function(n){n.placer.getOr($s)(c,i,n,a,f)}),n.fold(function(){uu(f.element(),"visibility")},function(n){eu(f.element(),"visibility",n)}),iu(f.element(),"left").isNone()&&iu(f.element(),"top").isNone()&&iu(f.element(),"right").isNone()&&iu(f.element(),"bottom").isNone()&&iu(f.element(),"position").is("fixed")&&uu(f.element(),"position")},f.element())},ef=Object.freeze({__proto__:null,position:function(n,e,t,r,o){Zs(n,e,t,r,o,A.none())},positionWithin:Zs,positionWithinBounds:nf,getMode:function(n,e,t){return e.useFixed()?"fixed":"absolute"}}),tf=[xr("useFixed",i),br("getBounds")],rf=Ro({fields:tf,name:"positioning",active:Ba,apis:ef}),of=function(n,e,t,r){var o=n.getSystem().build(r);Da(n,o,t)},uf=function(n,e,t,r){var o=af(n);U(o,function(n){return $n(r.element(),n.element())}).each(Na)},af=function(n,e){return n.components()},cf=function(e,n,t,o,r){var i=af(e);return A.from(i[o]).map(function(n){return uf(e,0,0,n),r.each(function(n){of(e,0,function(n,e){var t,r;r=e,re(t=n,o).fold(function(){ae(t,r)},function(n){ie(n,r)})},n)}),n})},sf=Ro({fields:[],name:"replacing",apis:Object.freeze({__proto__:null,append:function(n,e,t,r){of(n,0,ae,r)},prepend:function(n,e,t,r){of(n,0,ue,r)},remove:uf,replaceAt:cf,replaceBy:function(e,n,t,r,o){var i=af(e);return z(i,r).bind(function(n){return cf(e,0,0,n,o)})},set:function(e,n,t,r){La(function(){var n=P(r,e.getSystem().build);ka(e,n)},e.element())},contents:af})}),ff=function(n){var e,t=n.dom();return!((e=t).offsetWidth<=0&&e.offsetHeight<=0)},lf=Object.freeze({__proto__:null,getCurrent:function(n,e,t){return e.find(n)}}),df=[gr("find")],mf=Ro({fields:df,name:"composing",apis:lf}),gf=function(n,e){e.ignore||(Po(n.element()),e.onFocus(n))},pf=Object.freeze({__proto__:null,focus:gf,blur:function(n,e){e.ignore||n.element().dom().blur()},isFocused:function(n){return e=n.element(),t=Zn(e).dom(),e.dom()===t.activeElement;var e,t}}),vf=Object.freeze({__proto__:null,exhibit:function(n,e){var t=e.ignore?{}:{attributes:{tabindex:"-1"}};return ko(t)},events:function(t){return ho([bo(Kr(),function(n,e){gf(n,t),e.stop()})].concat(t.stopMousedown?[bo(Vr(),function(n,e){e.event().prevent()})]:[]))}}),hf=[Mu("onFocus"),xr("stopMousedown",!1),xr("ignore",!1)],bf=Ro({fields:hf,name:"focusing",active:vf,apis:pf}),yf=function(n,e,t){e.store.manager.onLoad(n,e,t)},_f=function(n,e,t){e.store.manager.onUnload(n,e,t)},wf=Object.freeze({__proto__:null,onLoad:yf,onUnload:_f,setValue:function(n,e,t,r){e.store.manager.setValue(n,e,t,r)},getValue:function(n,e,t){return e.store.manager.getValue(n,e,t)},getState:function(n,e,t){return t}}),xf=Object.freeze({__proto__:null,events:function(t,r){var n=t.resetOnDom?[wo(function(n,e){yf(n,t,r)}),xo(function(n,e){_f(n,t,r)})]:[To(t,r,yf)];return ho(n)}}),Of=function(){var n=yn(null);return Cr({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},Sf=function(){var i=yn({}),u=yn({});return Cr({readState:function(){return{mode:"dataset",dataByValue:i.get(),dataByText:u.get()}},lookup:function(n){return yt(i.get(),n).orThunk(function(){return yt(u.get(),n)})},update:function(n){var e=i.get(),t=u.get(),r={},o={};j(n,function(e){r[e.value]=e,yt(e,"meta").each(function(n){yt(n,"text").each(function(n){o[n]=e})})}),i.set(mn(mn({},e),r)),u.set(mn(mn({},t),o))},clear:function(){i.set({}),u.set({})}})},Ef=Object.freeze({__proto__:null,memory:Of,dataset:Sf,manual:function(){return Cr({readState:function(){}})},init:function(n){return n.store.manager.state(n)}}),Cf=function(n,e,t,r){var o=e.store;t.update([r]),o.setValue(n,r),e.onSetValue(n,r)},kf=[br("initialValue"),gr("getFallbackEntry"),gr("getDataKey"),gr("setValue"),Ru("manager",{setValue:Cf,getValue:function(n,e,t){var r=e.store,o=r.getDataKey(n);return t.lookup(o).fold(function(){return r.getFallbackEntry(o)},function(n){return n})},onLoad:function(e,t,r){t.store.initialValue.each(function(n){Cf(e,t,r,n)})},onUnload:function(n,e,t){t.clear()},state:Sf})],Tf=[gr("getValue"),xr("setValue",_),br("initialValue"),Ru("manager",{setValue:function(n,e,t,r){e.store.setValue(n,r),e.onSetValue(n,r)},getValue:function(n,e,t){return e.store.getValue(n)},onLoad:function(e,t,n){t.store.initialValue.each(function(n){t.store.setValue(e,n)})},onUnload:_,state:Er.init})],Df=[br("initialValue"),Ru("manager",{setValue:function(n,e,t,r){t.set(r),e.onSetValue(n,r)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store.initialValue.each(function(n){t.isNotSet()&&t.set(n)})},onUnload:function(n,e,t){t.clear()},state:Of})],Mf=[Or("store",{mode:"memory"},sr("mode",{memory:Df,manual:Tf,dataset:kf})),Mu("onSetValue"),xr("resetOnDom",!1)],Nf=Ro({fields:Mf,name:"representing",active:xf,apis:wf,extra:{setValueFrom:function(n,e){var t=Nf.getValue(e);Nf.setValue(n,t)}},state:Ef}),Af=Object.freeze({__proto__:null,exhibit:function(n,e){return ko({attributes:wt([{key:e.tabAttr,value:"true"}])})}}),Ff=[xr("tabAttr","data-alloy-tabstop")],Rf=Ro({fields:Ff,name:"tabstopping",active:Af}),Bf=function(n,e,t,r){return yt(e.routes,r.start).bind(function(n){return yt(n,r.destination)})},If=function(n,e,t,r){return Bf(0,e,0,r).bind(function(e){return e.transition.map(function(n){return{transition:n,route:e}})})},Hf=function(t,r,n){var e,o,i;(e=t,o=r,i=n,Pf(e,o).bind(function(n){return If(e,o,i,n)})).each(function(n){var e=n.transition;Xe(t.element(),e.transitionClass),Te(t.element(),r.destinationAttr)})},Pf=function(n,e,t){var r=n.element();return ke(r,e.destinationAttr)?A.some({start:Ce(n.element(),e.stateAttr),destination:Ce(n.element(),e.destinationAttr)}):A.none()},jf=function(n,e,t,r){Hf(n,e,t),ke(n.element(),e.stateAttr)&&Ce(n.element(),e.stateAttr)!==r&&e.onFinish(n,r),Se(n.element(),e.stateAttr,r)},Vf=Object.freeze({__proto__:null,findRoute:Bf,disableTransition:Hf,getCurrentRoute:Pf,jumpTo:jf,progressTo:function(t,r,o,i){var n,e;e=r,ke((n=t).element(),e.destinationAttr)&&(Se(n.element(),e.stateAttr,Ce(n.element(),e.destinationAttr)),Te(n.element(),e.destinationAttr));var u,a,c=(u=r,a=i,{start:Ce(t.element(),u.stateAttr),destination:a});If(t,r,o,c).fold(function(){jf(t,r,o,i)},function(n){Hf(t,r,o);var e=n.transition;Ye(t.element(),e.transitionClass),Se(t.element(),r.destinationAttr,i)})},getState:function(n,e,t){var r=n.element();return ke(r,e.stateAttr)?A.some(Ce(r,e.stateAttr)):A.none()}}),Lf=Object.freeze({__proto__:null,events:function(o,i){return ho([bo(qr(),function(t,n){var r=n.event().raw();Pf(t,o).each(function(e){Bf(0,o,0,e).each(function(n){n.transition.each(function(n){r.propertyName===n.property&&(jf(t,o,i,e.destination),o.onTransition(t,e))})})})}),wo(function(n,e){jf(n,o,i,o.initialState)})])}}),Wf=[xr("destinationAttr","data-transitioning-destination"),xr("stateAttr","data-transitioning-state"),gr("initialState"),Mu("onTransition"),Mu("onFinish"),pr("routes",or(Pe.value,or(Pe.value,Kt([wr("transition",[gr("property"),gr("transitionClass")])]))))],Uf=Ro({fields:Wf,name:"transitioning",active:Lf,apis:Vf,extra:{createRoutes:function(n){var r={};return tn(n,function(n,e){var t=e.split("<->");r[t[0]]=_t(t[1],n),r[t[1]]=_t(t[0],n)}),r},createBistate:function(n,e,t){return wt([{key:n,value:_t(e,t)},{key:e,value:_t(n,t)}])},createTristate:function(n,e,t,r){return wt([{key:n,value:wt([{key:e,value:r},{key:t,value:r}])},{key:e,value:wt([{key:n,value:r},{key:t,value:r}])},{key:t,value:wt([{key:n,value:r},{key:e,value:r}])}])}}}),zf=zn().os.isOSX()?"":"Ctrl",Gf=rn({tc_menu_name:"TinyComments",tc_announce_sidebar_available:"Comment. Sidebar available. Press "+zf+" + Alt + M to switch to sidebar",tc_items_addcomment:"Add comment",tc_items_showcomments:"Show comments",tc_items_deleteall:"Delete all conversations",tc_edit_buttons_save:"Save",tc_edit_buttons_cancel:"Cancel",tc_reply_buttons_save:"Save",tc_reply_buttons_clear:"Clear",tc_reply_placeholders:"Say something ...",tc_kebab_deleteconversation:"Delete conversation",tc_kebab_delete:"Delete",tc_kebab_edit:"Edit",tc_edit_problem_comment:"An error occurred editing this comment. See the Console for details.",tc_edit_unauthorised_comment:"You are not allowed to edit this comment",tc_delete_buttons_cancel:"Cancel",tc_delete_buttons_proceed:"Delete",tc_create_problem:"An error occurred while creating a comment. See the Console for details",tc_reply_problem:"An error occurred while replying to a comment. See the Console for details",tc_delete_prompts_conversation:"Delete this conversation?",tc_delete_prompts_conversation_detail_sing:"1 comment will be deleted. You can't undo this action.",tc_delete_prompts_conversation_detail_pl:"{0} comments will be deleted. You can't undo this action.",tc_delete_prompts_all:"Delete all conversations in the content? This cannot be undone",tc_delete_prompts_comment:"Are you sure you want to delete this comment?",tc_delete_problem_all:"An error occurred deleting all the conversations. See the Console for details.",tc_delete_problem_conversation:"An error occurred deleting the conversation. See the Console for details.",tc_delete_problem_comment:"An error occurred deleting the comment. See the Console for details.",tc_delete_unauthorised_all:"You are not allowed to delete all the conversations",tc_delete_unauthorised_conversation:"You are not allowed to delete this conversation",tc_delete_unauthorised_comment:"You are not allowed to delete this comment",tc_date_less_than_a_minute_ago:"a moment ago",tc_date_1_minute_ago:"1 minute ago",tc_date_x_minutes_ago:"{0} minutes ago",tc_date_1_hour_ago:"1 hour ago",tc_date_x_hours_ago:"{0} hours ago",tc_date_1_day_ago:"1 day ago",tc_date_x_days_ago:"{0} days ago",tc_date_1_week_ago:"1 week ago",tc_date_x_weeks_ago:"{0} weeks ago",tc_date_1_month_ago:"1 month ago",tc_date_x_months_ago:"{0} months ago",tc_date_1_year_ago:"1 year ago",tc_date_x_years_ago:"{0} years ago",tc_date_comment_edited:" (edited)",tc_comment_buttons_showmore:"SHOW MORE",tc_comment_buttons_showless:"SHOW LESS"},g),qf=function(n,e,t){var r=e.aria;r.update(n,r,t.get())},Yf=function(e,n,t){n.toggleClass.each(function(n){t.get()?Ye(e.element(),n):Xe(e.element(),n)})},Kf=function(n,e,t){Qf(n,e,t,!t.get())},Xf=function(n,e,t){t.set(!0),Yf(n,e,t),qf(n,e,t)},Jf=function(n,e,t){t.set(!1),Yf(n,e,t),qf(n,e,t)},Qf=function(n,e,t,r){(r?Xf:Jf)(n,e,t)},$f=function(n,e,t){Qf(n,e,t,e.selected)},Zf=Object.freeze({__proto__:null,onLoad:$f,toggle:Kf,isOn:function(n,e,t){return t.get()},on:Xf,off:Jf,set:Qf}),nl=Object.freeze({__proto__:null,exhibit:function(n,e,t){return ko({})},events:function(n,e){var t,r,o,i=(t=n,r=e,o=Kf,So(function(n){o(n,t,r)})),u=To(n,e,$f);return ho(G([n.toggleOnExecute?[i]:[],[u]]))}}),el=function(n,e,t){Se(n.element(),"aria-expanded",t)},tl=[xr("selected",!1),br("toggleClass"),xr("toggleOnExecute",!0),Or("aria",{mode:"none"},sr("mode",{pressed:[xr("syncWithExpanded",!1),Ru("update",function(n,e,t){Se(n.element(),"aria-pressed",t),e.syncWithExpanded&&el(n,e,t)})],checked:[Ru("update",function(n,e,t){Se(n.element(),"aria-checked",t)})],expanded:[Ru("update",el)],selected:[Ru("update",function(n,e,t){Se(n.element(),"aria-selected",t)})],none:[Ru("update",_)]}))],rl=Ro({fields:tl,name:"toggling",active:nl,apis:Zf,state:(os=!1,{init:function(){var e=yn(os);return{get:function(){return e.get()},set:function(n){return e.set(n)},clear:function(){return e.set(os)},readState:function(){return e.get()}}}})}),ol=function(){var n=function(n,e){e.stop(),go(n)};return[bo(Gr(),n),bo(no(),n),_o(Hr()),_o(Vr())]},il=function(n){return ho(G([n.map(function(t){return So(function(n,e){t(n),e.stop()})}).toArray(),ol()]))},ul=function(n,e,t){var r=K(n.slice(0,e)),o=K(n.slice(e+1));return U(r.concat(o),t)},al=function(n,e,t){var r=K(n.slice(0,e));return U(r,t)},cl=function(n,e,t){var r=n.slice(0,e),o=n.slice(e+1);return U(o.concat(r),t)},sl=function(n,e,t){var r=n.slice(e+1);return U(r,t)},fl=function(t){return function(n){var e=n.raw();return I(t,e.which)}},ll=function(n){return function(e){return Y(n,function(n){return n(e)})}},dl=function(n){return!0===n.raw().shiftKey},ml=function(n){return!0===n.raw().ctrlKey},gl=(is=dl,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return!is.apply(null,n)}),pl=function(n,e){return{matches:n,classification:e}},vl=function(t,r,n,o){var e=Qe(t.element(),"."+r.highlightClass);j(e,function(e){H(o,function(n){return n.element()===e})||(Xe(e,r.highlightClass),t.getSystem().getByDom(e).each(function(n){r.onDehighlight(t,n),lo(n,fo())}))})},hl=function(n,e,t,r){vl(n,e,0,[r]),bl(n,e,t,r)||(Ye(r.element(),e.highlightClass),e.onHighlight(n,r),lo(r,so()))},bl=function(n,e,t,r){return Je(r.element(),e.highlightClass)},yl=function(n,e,t,r){var o=Qe(n.element(),"."+e.itemClass);return A.from(o[r]).fold(function(){return Pe.error("No element found with index "+r)},n.getSystem().getByDom)},_l=function(e,n,t){return ui(e.element(),"."+n.itemClass).bind(function(n){return e.getSystem().getByDom(n).toOption()})},wl=function(e,n,t){var r=Qe(e.element(),"."+n.itemClass);return(0<r.length?A.some(r[r.length-1]):A.none()).bind(function(n){return e.getSystem().getByDom(n).toOption()})},xl=function(t,e,n,r){var o=Qe(t.element(),"."+e.itemClass);return z(o,function(n){return Je(n,e.highlightClass)}).bind(function(n){var e=Vs(n,r,0,o.length-1);return t.getSystem().getByDom(o[e]).toOption()})},Ol=function(e,n,t){var r=Qe(e.element(),"."+n.itemClass);return zo(P(r,function(n){return e.getSystem().getByDom(n).toOption()}))},Sl=Object.freeze({__proto__:null,dehighlightAll:function(n,e,t){return vl(n,e,0,[])},dehighlight:function(n,e,t,r){bl(n,e,t,r)&&(Xe(r.element(),e.highlightClass),e.onDehighlight(n,r),lo(r,fo()))},highlight:hl,highlightFirst:function(e,t,r){_l(e,t).each(function(n){hl(e,t,r,n)})},highlightLast:function(e,t,r){wl(e,t).each(function(n){hl(e,t,r,n)})},highlightAt:function(e,t,r,n){yl(e,t,r,n).fold(function(n){throw new Error(n)},function(n){hl(e,t,r,n)})},highlightBy:function(e,t,r,n){var o=Ol(e,t);U(o,n).each(function(n){hl(e,t,r,n)})},isHighlighted:bl,getHighlighted:function(e,n,t){return ui(e.element(),"."+n.highlightClass).bind(function(n){return e.getSystem().getByDom(n).toOption()})},getFirst:_l,getLast:wl,getPrevious:function(n,e,t){return xl(n,e,0,-1)},getNext:function(n,e,t){return xl(n,e,0,1)},getCandidates:Ol}),El=[gr("highlightClass"),gr("itemClass"),Mu("onHighlight"),Mu("onDehighlight")],Cl=Ro({fields:El,name:"highlighting",apis:Sl}),kl=function(n,e,t){e.exists(function(e){return t.exists(function(n){return $n(n,e)})})||mo(n,co(),{prevFocus:e,newFocus:t})},Tl=function(){var o=function(n){return Vo(n.element())};return{get:o,set:function(n,e){var t=o(n);n.getSystem().triggerFocus(e,n.element());var r=o(n);kl(n,t,r)}}};(as=us||(us={})).OnFocusMode="onFocus",as.OnEnterOrSpaceMode="onEnterOrSpace",as.OnApiMode="onApi";var Dl,Ml,Nl,Al,Fl,Rl,Bl,Il,Hl,Pl,jl,Vl,Ll,Wl,Ul=function(n,e,t,r,a){var c=function(e,t,n,r,o){var i,u,a=n(e,t,r,o);return(i=a,u=t.event(),U(i,function(n){return n.matches(u)}).map(function(n){return n.classification})).bind(function(n){return n(e,t,r,o)})},o={schema:function(){return n.concat([xr("focusManager",Tl()),Or("focusInside","onFocus",rr(function(n){return I(["onFocus","onEnterOrSpace","onApi"],n)?Pe.value(n):Pe.error("Invalid value for focusInside")})),Ru("handler",o),Ru("state",e),Ru("sendFocusIn",a)])},processKey:c,toEvents:function(i,u){var n=i.focusInside!==us.OnFocusMode?A.none():a(i).map(function(t){return bo(Kr(),function(n,e){t(n,i,u),e.stop()})});return ho(n.toArray().concat([bo(Wr(),function(r,o){c(r,o,t,i,u).fold(function(){var e,t,n;e=r,t=o,n=fl([32].concat([13]))(t.event()),i.focusInside===us.OnEnterOrSpaceMode&&n&&kr(e,t)&&a(i).each(function(n){n(e,i,u),t.stop()})},function(n){o.stop()})}),bo(Ur(),function(n,e){c(n,e,r,i,u).each(function(n){e.stop()})})]))}};return o},zl=function(n){var e=[br("onEscape"),br("onEnter"),xr("selector",'[data-alloy-tabstop="true"]:not(:disabled)'),xr("firstTabstop",0),xr("useTabstopAt",J(!0)),br("visibilitySelector")].concat([n]),u=function(n,e){var t,r=n.visibilitySelector.bind(function(n){return ai(e,n)}).getOr(e);return t=r,0<Ua.get(t)},t=function(e,t){var n,r,o,i;(n=e,r=t,o=Qe(n.element(),r.selector),i=V(o,function(n){return u(r,n)}),A.from(i[r.firstTabstop])).each(function(n){t.focusManager.set(e,n)})},a=function(e,n,t,r,o){return o(n,t,function(n){return u(e=r,t=n)&&e.useTabstopAt(t);var e,t}).fold(function(){return r.cyclic?A.some(!0):A.none()},function(n){return r.focusManager.set(e,n),A.some(!0)})},i=function(e,n,t,r){var o,i,u=Qe(e.element(),t.selector);return(o=e,i=t,i.focusManager.get(o).bind(function(n){return ai(n,i.selector)})).bind(function(n){return z(u,p($n,n)).bind(function(n){return a(e,u,n,t,r)})})},r=J([pl(ll([dl,fl([9])]),function(n,e,t,r){var o=t.cyclic?ul:al;return i(n,0,t,o)}),pl(fl([9]),function(n,e,t,r){var o=t.cyclic?cl:sl;return i(n,0,t,o)}),pl(fl([27]),function(e,t,n,r){return n.onEscape.bind(function(n){return n(e,t)})}),pl(ll([gl,fl([13])]),function(e,t,n,r){return n.onEnter.bind(function(n){return n(e,t)})})]),o=J([]);return Ul(e,Er.init,r,o,function(){return A.some(t)})},Gl=zl(Sr("cyclic",J(!1))),ql=zl(Sr("cyclic",J(!0))),Yl=function(n){return"input"===ye(n)&&"radio"!==Ce(n,"type")||"textarea"===ye(n)},Kl=function(n,e,t){return Yl(t)&&fl([32])(e.event())?A.none():(po(n,t,$r()),A.some(!0))},Xl=function(n,e){return A.some(!0)},Jl=[xr("execute",Kl),xr("useSpace",!1),xr("useEnter",!0),xr("useControlEnter",!1),xr("useDown",!1)],Ql=function(n,e,t){return t.execute(n,e,n.element())},$l=Ul(Jl,Er.init,function(n,e,t,r){var o=t.useSpace&&!Yl(n.element())?[32]:[],i=t.useEnter?[13]:[],u=t.useDown?[40]:[],a=o.concat(i).concat(u);return[pl(fl(a),Ql)].concat(t.useControlEnter?[pl(ll([ml,fl([13])]),Ql)]:[])},function(n,e,t,r){return t.useSpace&&!Yl(n.element())?[pl(fl([32]),Xl)]:[]},function(){return A.none()}),Zl=function(n){var t=yn(A.none());return Cr({readState:function(){return t.get().map(function(n){return{numRows:n.numRows(),numColumns:n.numColumns()}}).getOr({numRows:"?",numColumns:"?"})},setGridSize:function(n,e){t.set(A.some({numRows:J(n),numColumns:J(e)}))},getNumRows:function(){return t.get().map(function(n){return n.numRows()})},getNumColumns:function(){return t.get().map(function(n){return n.numColumns()})}})},nd=Object.freeze({__proto__:null,flatgrid:Zl,init:function(n){return n.state(n)}}),ed=function(i){return function(n,e,t,r){var o=i(n.element());return id(o,n,e,t,r)}},td=function(n,e){var t=Pc(n,e);return ed(t)},rd=function(n,e){var t=Pc(e,n);return ed(t)},od=function(o){return function(n,e,t,r){return id(o,n,e,t,r)}},id=function(e,t,n,r,o){return r.focusManager.get(t).bind(function(n){return e(t.element(),n,r,o)}).map(function(n){return r.focusManager.set(t,n),!0})},ud=od,ad=od,cd=od,sd=fn(["index","candidates"],[]),fd=function(n,e,t){var r,o=p($n,e),i=Qe(n,t),u=V(i,ff);return z(r=u,o).map(function(n){return sd({index:n,candidates:r})})},ld=function(n,e){return z(n,function(n){return $n(e,n)})},dd=function(t,n,r,e){return e(Math.floor(n/r),n%r).bind(function(n){var e=n.row()*r+n.column();return 0<=e&&e<t.length?A.some(t[e]):A.none()})},md=function(o,n,i,u,a){return dd(o,n,u,function(n,e){var t=n===i-1?o.length-n*u:u,r=Vs(e,a,0,t-1);return A.some({row:J(n),column:J(r)})})},gd=function(i,n,u,a,c){return dd(i,n,a,function(n,e){var t=Vs(n,c,0,u-1),r=t===u-1?i.length-t*a:a,o=Ls(e,0,r-1);return A.some({row:J(t),column:J(o)})})},pd=[gr("selector"),xr("execute",Kl),Nu("onEscape"),xr("captureTab",!1),Iu()],vd=function(e,t,n){ui(e.element(),t.selector).each(function(n){t.focusManager.set(e,n)})},hd=function(o){return function(n,e,t,r){return fd(n,e,t.selector).bind(function(n){return o(n.candidates(),n.index(),r.getNumRows().getOr(t.initSize.numRows),r.getNumColumns().getOr(t.initSize.numColumns))})}},bd=function(n,e,t,r){return t.captureTab?A.some(!0):A.none()},yd=hd(function(n,e,t,r){return md(n,e,t,r,-1)}),_d=hd(function(n,e,t,r){return md(n,e,t,r,1)}),wd=hd(function(n,e,t,r){return gd(n,e,t,r,-1)}),xd=hd(function(n,e,t,r){return gd(n,e,t,r,1)}),Od=J([pl(fl([37]),td(yd,_d)),pl(fl([39]),rd(yd,_d)),pl(fl([38]),ud(wd)),pl(fl([40]),ad(xd)),pl(ll([dl,fl([9])]),bd),pl(ll([gl,fl([9])]),bd),pl(fl([27]),function(n,e,t,r){return t.onEscape(n,e)}),pl(fl([32].concat([13])),function(e,t,r,n){return(o=e,i=r,i.focusManager.get(o).bind(function(n){return ai(n,i.selector)})).bind(function(n){return r.execute(e,t,n)});var o,i})]),Sd=J([pl(fl([32]),Xl)]),Ed=Ul(pd,Zl,Od,Sd,function(){return A.some(vd)}),Cd=function(n,e,t,i){var u=function(n,e,t){var r,o=Vs(e,i,0,t.length-1);return o===n?A.none():(r=t[o],"button"===ye(r)&&"disabled"===Ce(r,"disabled")?u(n,o,t):A.from(t[o]))};return fd(n,t,e).bind(function(n){var e=n.index(),t=n.candidates();return u(e,e,t)})},kd=[gr("selector"),xr("getInitial",A.none),xr("execute",Kl),Nu("onEscape"),xr("executeOnMove",!1),xr("allowVertical",!0)],Td=function(e,t,r){return(n=e,o=r,o.focusManager.get(n).bind(function(n){return ai(n,o.selector)})).bind(function(n){return r.execute(e,t,n)});var n,o},Dd=function(e,t){t.getInitial(e).orThunk(function(){return ui(e.element(),t.selector)}).each(function(n){t.focusManager.set(e,n)})},Md=function(n,e,t){return Cd(n,t.selector,e,-1)},Nd=function(n,e,t){return Cd(n,t.selector,e,1)},Ad=function(r){return function(n,e,t){return r(n,e,t).bind(function(){return t.executeOnMove?Td(n,e,t):A.some(!0)})}},Fd=function(n,e,t,r){return t.onEscape(n,e)},Rd=J([pl(fl([32]),Xl)]),Bd=Ul(kd,Er.init,function(n,e,t,r){var o=[37].concat(t.allowVertical?[38]:[]),i=[39].concat(t.allowVertical?[40]:[]);return[pl(fl(o),Ad(td(Md,Nd))),pl(fl(i),Ad(rd(Md,Nd))),pl(fl([13]),Td),pl(fl([32]),Td),pl(fl([27]),Fd)]},Rd,function(){return A.some(Dd)}),Id=fn(["rowIndex","columnIndex","cell"],[]),Hd=function(n,e,t){return A.from(n[e]).bind(function(n){return A.from(n[t]).map(function(n){return Id({rowIndex:e,columnIndex:t,cell:n})})})},Pd=function(n,e,t,r){var o=n[e].length,i=Vs(t,r,0,o-1);return Hd(n,e,i)},jd=function(n,e,t,r){var o=Vs(t,r,0,n.length-1),i=n[o].length,u=Ls(e,0,i-1);return Hd(n,o,u)},Vd=function(n,e,t,r){var o=n[e].length,i=Ls(t+r,0,o-1);return Hd(n,e,i)},Ld=function(n,e,t,r){var o=Ls(t+r,0,n.length-1),i=n[o].length,u=Ls(e,0,i-1);return Hd(n,o,u)},Wd=[hr("selectors",[gr("row"),gr("cell")]),xr("cycles",!0),xr("previousSelector",A.none),xr("execute",Kl)],Ud=function(e,t){t.previousSelector(e).orThunk(function(){var n=t.selectors;return ui(e.element(),n.cell)}).each(function(n){t.focusManager.set(e,n)})},zd=function(n,e){return function(t,r,i){var u=i.cycles?n:e;return ai(r,i.selectors.row).bind(function(n){var e=Qe(n,i.selectors.cell);return ld(e,r).bind(function(r){var o=Qe(t,i.selectors.row);return ld(o,n).bind(function(n){var e,t=(e=i,P(o,function(n){return Qe(n,e.selectors.cell)}));return u(t,n,r).map(function(n){return n.cell()})})})})}},Gd=zd(function(n,e,t){return Pd(n,e,t,-1)},function(n,e,t){return Vd(n,e,t,-1)}),qd=zd(function(n,e,t){return Pd(n,e,t,1)},function(n,e,t){return Vd(n,e,t,1)}),Yd=zd(function(n,e,t){return jd(n,t,e,-1)},function(n,e,t){return Ld(n,t,e,-1)}),Kd=zd(function(n,e,t){return jd(n,t,e,1)},function(n,e,t){return Ld(n,t,e,1)}),Xd=J([pl(fl([37]),td(Gd,qd)),pl(fl([39]),rd(Gd,qd)),pl(fl([38]),ud(Yd)),pl(fl([40]),ad(Kd)),pl(fl([32].concat([13])),function(e,t,r){return Vo(e.element()).bind(function(n){return r.execute(e,t,n)})})]),Jd=J([pl(fl([32]),Xl)]),Qd=Ul(Wd,Er.init,Xd,Jd,function(){return A.some(Ud)}),$d=[gr("selector"),xr("execute",Kl),xr("moveOnTab",!1)],Zd=function(e,t,r){return r.focusManager.get(e).bind(function(n){return r.execute(e,t,n)})},nm=function(e,t){ui(e.element(),t.selector).each(function(n){t.focusManager.set(e,n)})},em=function(n,e,t){return Cd(n,t.selector,e,-1)},tm=function(n,e,t){return Cd(n,t.selector,e,1)},rm=J([pl(fl([38]),cd(em)),pl(fl([40]),cd(tm)),pl(ll([dl,fl([9])]),function(n,e,t){return t.moveOnTab?cd(em)(n,e,t):A.none()}),pl(ll([gl,fl([9])]),function(n,e,t){return t.moveOnTab?cd(tm)(n,e,t):A.none()}),pl(fl([13]),Zd),pl(fl([32]),Zd)]),om=J([pl(fl([32]),Xl)]),im=Ul($d,Er.init,rm,om,function(){return A.some(nm)}),um=[Nu("onSpace"),Nu("onEnter"),Nu("onShiftEnter"),Nu("onLeft"),Nu("onRight"),Nu("onTab"),Nu("onShiftTab"),Nu("onUp"),Nu("onDown"),Nu("onEscape"),xr("stopSpaceKeyup",!1),br("focusIn")],am=Ul(um,Er.init,function(n,e,t){return[pl(fl([32]),t.onSpace),pl(ll([gl,fl([13])]),t.onEnter),pl(ll([dl,fl([13])]),t.onShiftEnter),pl(ll([dl,fl([9])]),t.onShiftTab),pl(ll([gl,fl([9])]),t.onTab),pl(fl([38]),t.onUp),pl(fl([40]),t.onDown),pl(fl([37]),t.onLeft),pl(fl([39]),t.onRight),pl(fl([32]),t.onSpace),pl(fl([27]),t.onEscape)]},function(n,e,t){return t.stopSpaceKeyup?[pl(fl([32]),Xl)]:[]},function(n){return n.focusIn}),cm=Gl.schema(),sm=ql.schema(),fm=Bd.schema(),lm=Ed.schema(),dm=Qd.schema(),mm=$l.schema(),gm=im.schema(),pm=am.schema(),vm=(Pl=ar("Creating behaviour: "+(Dl={branchKey:"mode",branches:Object.freeze({__proto__:null,acyclic:cm,cyclic:sm,flow:fm,flatgrid:lm,matrix:dm,execution:mm,menu:gm,special:pm}),name:"keying",active:{events:function(n,e){return n.handler.toEvents(n,e)}},apis:{focusIn:function(e,t,r){t.sendFocusIn(t).fold(function(){e.getSystem().triggerFocus(e.element(),e.element())},function(n){n(e,t,r)})},setGridSize:function(n,e,t,r,o){Ot(t,"setGridSize")?t.setGridSize(r,o):b.console.error("Layout does not support setGridSize")}},state:nd}).name,Bo,Dl),Ml=sr(Pl.branchKey,Pl.branches),Nl=Pl.name,Al=Pl.active,Fl=Pl.apis,Rl=Pl.extra,Bl=Pl.state,Hl=_r(Nl,[yr("config",Il=Ml)]),No(Il,Hl,Nl,Al,Fl,Rl,Bl)),hm=xa({name:"Button",factory:function(n){var e=il(n.action),t=n.dom.tag,r=function(e){return yt(n.dom,"attributes").bind(function(n){return yt(n,e)})};return{uid:n.uid,dom:n.dom,components:n.components,events:e,behaviours:Ou(n.buttonBehaviours,[bf.config({}),vm.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:function(){if("button"!==t)return{role:r("role").getOr("button")};var n=r("type").getOr("button"),e=r("role").map(function(n){return{role:n}}).getOr({});return mn({type:n},e)}()},eventOrder:n.eventOrder}},configFields:[xr("uid",void 0),gr("dom"),xr("components",[]),xu("buttonBehaviours",[bf,vm]),br("action"),br("role"),xr("eventOrder",{})]}),bm=["input","button","textarea","select"],ym=function(n,e,t){e.disabled&&Em(n,e)},_m=function(n,e){return!0===e.useNative&&I(bm,ye(n.element()))},wm=function(n){Se(n.element(),"disabled","disabled")},xm=function(n){Te(n.element(),"disabled")},Om=function(n){Se(n.element(),"aria-disabled","true")},Sm=function(n){Se(n.element(),"aria-disabled","false")},Em=function(e,n,t){n.disableClass.each(function(n){Ye(e.element(),n)}),(_m(e,n)?wm:Om)(e),n.onDisabled(e)},Cm=function(e,n,t){n.disableClass.each(function(n){Xe(e.element(),n)}),(_m(e,n)?xm:Sm)(e),n.onEnabled(e)},km=function(n,e){return _m(n,e)?ke(n.element(),"disabled"):"true"===Ce(n.element(),"aria-disabled")},Tm=Object.freeze({__proto__:null,enable:Cm,disable:Em,isDisabled:km,onLoad:ym,set:function(n,e,t,r){(r?Em:Cm)(n,e,t)}}),Dm=Object.freeze({__proto__:null,exhibit:function(n,e,t){return ko({classes:e.disabled?e.disableClass.map(Q).getOr([]):[]})},events:function(t,n){return ho([(e=$r(),r=function(n,e){return km(n,t)},{key:e,value:Br({abort:r})}),To(t,n,ym)]);var e,r}}),Mm=[xr("disabled",!1),xr("useNative",!0),br("disableClass"),Mu("onDisabled"),Mu("onEnabled")],Nm=Ro({fields:Mm,name:"disabling",active:Dm,apis:Tm}),Am=Object.freeze({__proto__:null,events:function(a){return ho([bo(Qr(),function(o,i){var n,e,u=a.channels,t=nn(u),r=(n=t,(e=i).universal()?n:V(n,function(n){return I(e.channels(),n)}));j(r,function(n){var e=u[n],t=e.schema,r=ar("channel["+n+"] data\nReceiver: "+Jo(o.element()),t,i.data());e.onReceive(o,r)})})])}}),Fm=[pr("channels",or(Pe.value,Kt([Au("onReceive"),xr("schema",fr())])))],Rm=Ro({fields:Fm,name:"receiving",active:Am}),Bm="comments.readonly",Im=function(n){return Nm.config(n)},Hm=function(){var n,e;return Rm.config({channels:(n={},n[Bm]={schema:Kt([(e="readonly",pr(e,dr))]),onReceive:function(n,e){Nm.set(n,e.readonly)}},n)})},Pm=function(n){return[Im(n),Hm()]},jm=Bm,Vm="tox-button--naked",Lm="tox-comment",Wm="tox-comment__body",Um="tox-textarea",zm="tox-comment__reply",Gm="tox-comment__overlay",qm="tox-comment__overlaytext",Ym="tox-comment__buttonspacing",Km="tox-button",Xm="tox-comment__edit",Jm="tox-comment__scroll",Qm="tox-collection__item",$m="tox-conversations",Zm="tox-comment__expander",ng=Zm+" p:contains("+Gf.tc_comment_buttons_showmore+")",eg=Zm+" p:contains("+Gf.tc_comment_buttons_showless+")",tg=function(n){return"."+n},rg=function(e){return function(n){return[tg(Lm)+":contains("+n+")",tg(e)].join(" ")}},og={selectors:{kebab:tg(Vm),cardBody:tg(Lm)+" "+tg(Wm),card:tg(Lm),showMore:tg(ng),showLess:tg(eg),editItem:[".tox-menu",'[role="menuitem"]:contains('+Gf.tc_kebab_edit+")"].join(" "),deleteItem:[".tox-menu",'[role="menuitem"]:contains('+Gf.tc_kebab_delete+")"].join(" "),outerScroll:tg(Jm),outerContainer:tg($m),cardFor:function(n){return tg(Lm)+':contains("'+n+'")'},cardN:function(n){return tg(Lm)+":nth-child("+(n+1)+")"},kebabFor:rg(Vm),showMoreFor:rg(ng),showLessFor:rg(eg),saveButton:".tox-button:contains("+Gf.tc_edit_buttons_save+")",cancelButton:".tox-button:contains("+Gf.tc_edit_buttons_cancel+")",clearButton:".tox-button:contains("+Gf.tc_reply_buttons_clear+")",deleteButton:".tox-button:contains("+Gf.tc_delete_buttons_proceed+")",commentText:[tg($m),tg(Jm),tg(Lm),"textarea"].join(" "),editActions:tg(Xm),cardDeleteButtons:tg(Ym),cardDeleteOverlay:tg(Gm),cardDeleteOverlayText:tg(qm),replyTextarea:"."+zm+" textarea",editTextarea:[tg(Lm),"textarea"].join(" "),kebabMenu:tg("tox-menu"),textarea:tg(Um)},states:{kebabOpen:Vm+"--open",bodyExpanded:"tox-comment__body--expanded",bodyNotAnimating:"tox-comment__body--pending",disappearing:"tox-comment--disappearing",deletingConversation:"tox-comment-thread__overlay",bodyHasGradient:"tox-comment__gradient",editingTextarea:Um},classes:{showMoreLessContainer:[Zm],outerContainer:[$m],date:["tox-comment__date"],replySection:[zm],replyTextarea:[Um],textarea:[],editTextarea:[],kebab:[Vm,Km,"tox-button--icon"],kebabIcon:["tox-icon"],card:[Lm],cardHead:["tox-comment__header"],cardHeadMeta:["tox-comment__meta"],cardBody:[Wm],cardDelete:[Gm],cardDeleteLabel:[qm],cardDeleteButtons:[Ym],button:[Km],secondaryButton:[Km,"tox-button--secondary"],editActions:[Xm],outerScroll:[Jm],commentList:["tox-comment-thread"],avatar:["tox-user__avatar"],username:["tox-user__name"],user:["tox-user"],showMoreLess:[],kebabItem:[Qm],kebabItemLabel:["tox-collection__item-label"],kebabDisabledItem:["tox-collection__item--state-disabled"],kebabMenu:["tox-menu","tox-collection","tox-collection--list"],kebabMenuGroup:["tox-collection__group"],roots:{silver:[$m],modern:[$m,"tox"]}},markers:{kebab:{backgroundMenu:"tox-menu--background",selectedMenu:"tox-menu--active",menu:"tox-menu",item:Qm,selectedItem:"tox-collection__item--active"}}},ig=function(t){return function(n){var e=n.eventName.map(function(e){return{action:function(n){lo(n,e)}}}).getOr({});return hm.sketch(mn(mn({dom:{tag:"button",classes:t,styles:void 0!==n.styles?n.styles:{},innerHtml:n.text}},e),{buttonBehaviours:Ao(pn([Rf.config({})],Pm({})))}))}},ug=ig(og.classes.button),ag=ig(og.classes.secondaryButton),cg={withClasses:ig,primary:ug,secondary:ag},sg="tc-save-edit",fg="tc-cancel-edit",lg=wi("tc-patch-comment-state-event"),dg=wi("tc-purge-comment-state-event"),mg=wi("tc-force-patch-state-event");(Vl=jl||(jl={})).None="Prop_None",Vl.Collapsed="Prop_Collapsed",Vl.Expanded="Prop_Expanded",Vl.CollapsedOrNone="Prop_CollapsedOrNone",Vl.ExpandOrNone="Prop_ExpandOrNone",Vl.Edit="Prop_Edit",(Wl=Ll||(Ll={}))[Wl.BeforeDelete=0]="BeforeDelete",Wl[Wl.QueryingDelete=1]="QueryingDelete",Wl[Wl.PostDelete=2]="PostDelete";var gg,pg,vg=function(n){return P(n.conversation,function(n){return n.props})},hg=function(n,e){return mn(mn({},n),{targetUid:e})},bg=function(n,e){return mn(mn({},n),{queue:n.queue.concat(e)})},yg=function(n){if(0<n.queue.length){var e=(t=P((r=n).conversation,function(t){return U(r.queue,function(n){return n.uid===t.uid}).fold(function(){return t},function(n){var e=void 0!==n.patch.content?{mode:jl.ExpandOrNone}:{};return{uid:t.uid,props:mn(mn(mn({},t.props),n.patch),e)}})}),{targetUid:r.targetUid,conversation:t,queue:[]});return A.some({world:e,props:vg(e)})}return A.none();var r,t},_g=function(){return{targetUid:A.none(),conversation:[],queue:[]}},wg=function(t,r){return function(n){var e=r(n);mo(n,lg,{uid:t,patch:e})}},xg=function(t,r){return function(n){var e=r(n);mo(n,lg,{uid:t,patch:e}),lo(n,mg)}},Og=function(n){return lo(n,mg)},Sg=function(n,e){eu(n.element(),"visibility","hidden"),rl.set(n,!1);var t=n.element().dom().clientHeight;return rl.set(n,!0),uu(n.element(),"visibility"),n.element().dom().scrollHeight>t+1?e:jl.None},Eg=function(n){rl.off(n),Ye(n.element(),og.states.bodyHasGradient)},Cg=function(n){rl.on(n),Xe(n.element(),og.states.bodyHasGradient)},kg=function(n){return oe(n.element())},Tg=function(n,e){Mg(n),e.getOpt(n).fold(function(){sf.append(n,e.asSpec())},function(){})},Dg=function(n){Xe(n.element(),og.states.bodyHasGradient),rl.set(n,!1),Te(n.element(),"aria-expanded")},Mg=function(n){kg(n).each(function(n){Te(n,"readonly"),Ye(n,og.states.editingTextarea),Po(n);var e=n.dom(),t=au(n).length;e.setSelectionRange(t,t)}),n.element().dom().scrollTop=0},Ng=function(n){kg(n).each(function(n){Se(n,"readonly","true"),Xe(n,og.states.editingTextarea)})},Ag=function(r){var n,e=function(n){return function(e){j(n,function(n){return n(e)})}},t=function(e){kg(e).each(function(n){uu(n,"height"),Nf.setValue(e,r.props.content),e.getSystem().triggerEvent(zr(),n,{})})},o=function(n){return e=n,t=r.memCommands,Ng(e),void t.getOpt(e).each(function(n){sf.remove(e,n)});var e,t},i=((n={})[jl.None]=e([o,t,Dg]),n[jl.Expanded]=e([o,t,Cg]),n[jl.Collapsed]=e([o,t,Eg]),n[jl.ExpandOrNone]=e([o,t,function(n){Ye(n.element(),og.states.bodyNotAnimating);var e=Sg(n,jl.Expanded);wg(r.props.uid,function(){return{mode:e}})(n)}]),n[jl.CollapsedOrNone]=e([o,t,function(n){Ye(n.element(),og.states.bodyNotAnimating);var e=Sg(n,jl.Collapsed);e===jl.Collapsed&&(Ye(n.element(),og.states.bodyHasGradient),rl.off(n)),n.element().dom().offsetWidth,wg(r.props.uid,function(){return{mode:e}})(n)}]),n[jl.Edit]=e([function(n){return e=n,t=r.memCommands,rl.on(e),Xe(e.element(),og.states.bodyHasGradient),void Tg(e,t);var e,t},t]),n);return yt(i,r.props.mode)},Fg=wi("tc-focus-outer-comment"),Rg=wi("tc-start-delete-comment"),Bg=wi("tc-start-delete-conversation"),Ig=wi("tc-commit-delete"),Hg=wi("tc-start-edit-comment"),Pg=wi("tc-commit-edit-comment"),jg=(wi("tc-cancel-edit-comment"),wi("tc-long-content"),wi("tc-short-content"),wi("tc-toggle-comment")),Vg=J([br("data"),xr("inputAttributes",{}),xr("inputStyles",{}),xr("tag","input"),xr("inputClasses",[]),Mu("onSetValue"),xr("styles",{}),xr("eventOrder",{}),yu("inputBehaviours",[Nf,bf]),xr("selectOnFocus",!0)]),Lg=function(n){return mn(mn({},(e=n,Ao([bf.config({onFocus:!1===e.selectOnFocus?_:function(n){var e=n.element(),t=au(e);e.dom().setSelectionRange(0,t.length)}})]))),wu(n.inputBehaviours,[Nf.config({store:{mode:"manual",initialValue:n.data.getOr(void 0),getValue:function(n){return au(n.element())},setValue:function(n,e){au(n.element())!==e&&cu(n.element(),e)}},onSetValue:n.onSetValue})]));var e},Wg=xa({name:"Input",configFields:Vg(),factory:function(n,e){return{uid:n.uid,dom:(t=n,{tag:t.tag,attributes:mn({type:"text"},t.inputAttributes),styles:t.inputStyles,classes:t.inputClasses}),components:[],behaviours:Lg(n),eventOrder:n.eventOrder};var t}}),Ug="data-alloy-widget-tabstop",zg=function(n){return vm.config({mode:"cyclic",onEscape:n.onEscape,useTabstopAt:function(n){return"textarea"!==ye(n)||"true"!==Ce(n,"readonly")}})},Gg=function(e){return vm.config({mode:"special",onEnter:function(n){return lo(n,e.enterEvent),A.some(!0)},onShiftEnter:function(n,e){return e.cut(),A.none()},onSpace:function(n,e){return e.cut(),A.none()}})},qg=function(t){return vm.config({mode:"cyclic",selector:"["+Ug+'="true"]',focusInside:us.OnEnterOrSpaceMode,onEscape:function(n,e){return kr(n,e)?A.none():(lo(n,t.escapeEvent),A.some(!0))}})},Yg=function(n){return vm.config({mode:"flow",allowVertical:!0,selector:n.selector})},Kg=Ug,Xg={"data-gramm_editor":"false",rows:"2"},Jg={"white-space":"pre-wrap"},Qg=function(n){var e=n.element().dom().clientHeight,t=n.element().dom().scrollHeight;e<t&&eu(n.element(),"height",t+"px")},$g=function(n,e){var t,r,o=yn(n),i=function(n){lo(n,Fg),xg(o.get().uid,function(n){return{mode:jl.ExpandOrNone}})(n)},u={updateWith:function(e,n,t){o.set(n),Ag({props:n,memCommands:a}).each(function(n){Xe(e.element(),og.states.bodyNotAnimating),n(e)})}},a=Ra((o.get(),t=e,{dom:{tag:"div",classes:og.classes.editActions},components:[cg.withClasses(og.classes.secondaryButton)({text:t.translate(Gf.tc_edit_buttons_cancel),eventName:A.some(fg)}),cg.withClasses(og.classes.button)({text:t.translate(Gf.tc_edit_buttons_save),eventName:A.some(sg)})]}));return{dom:{tag:"div",classes:og.classes.cardBody},components:[(r=o.get().content,Wg.sketch({tag:"textarea",inputAttributes:mn(mn({},Xg),{readonly:"true"}),inputClasses:og.classes.editTextarea,inputStyles:mn(mn({},Jg),{"overflow-y":"hidden",border:"none !important"}),data:r,inputBehaviours:Ao(pn([Ho("textarea-events",[wo(function(n){Qg(n)}),bo(zr(),Qg)]),Gg({enterEvent:Pg}),Rf.config({})],Pm({})))}))],behaviours:Ao([Ho("overflow-events",[wo(function(n){u.updateWith(n,o.get(),{})}),bo(sg,function(n){lo(n,Pg)}),bo(fg,i)]),zg({onEscape:function(n,e){return i(n),A.some(!0)}}),rl.config({toggleClass:og.states.bodyExpanded,selected:!1,toggleOnExecute:!1,aria:{mode:"expanded"}}),Nf.config({store:{mode:"manual",getValue:function(n){return oe(n.element()).map(au).getOr("")},setValue:function(n,e){oe(n.element()).each(function(n){cu(n,e)})}}}),sf.config({})]),apis:u}},Zg=6048e5,np=4*Zg;(pg=gg||(gg={}))[pg.LessThanMinute=0]="LessThanMinute",pg[pg.Minute=1]="Minute",pg[pg.Hour=2]="Hour",pg[pg.Day=3]="Day",pg[pg.Week=4]="Week",pg[pg.Month=5]="Month",pg[pg.Year=6]="Year";var ep,tp,rp,op=function(n,e){var t=n()-Date.parse(e);return t<6e4?{interval:gg.LessThanMinute,intervalUnits:t,intervalMs:t}:t<36e5?{interval:gg.Minute,intervalUnits:Math.floor(t/6e4),intervalMs:t}:t<864e5?{interval:gg.Hour,intervalUnits:Math.floor(t/36e5),intervalMs:t}:t<Zg?{interval:gg.Day,intervalUnits:Math.floor(t/864e5),intervalMs:t}:t<np?{interval:gg.Week,intervalUnits:Math.floor(t/Zg),intervalMs:t}:t<290304e5?{interval:gg.Month,intervalUnits:Math.floor(t/np),intervalMs:t}:{interval:gg.Year,intervalUnits:Math.floor(t/290304e5),intervalMs:t}},ip={nowISO8601:function(){return(new Date).toISOString()},distanceFromNow:p(op,function(){return Date.now()}),distanceFrom:op},up=((ep={})[gg.LessThanMinute]=[Gf.tc_date_less_than_a_minute_ago,Gf.tc_date_less_than_a_minute_ago],ep[gg.Minute]=[Gf.tc_date_1_minute_ago,Gf.tc_date_x_minutes_ago],ep[gg.Hour]=[Gf.tc_date_1_hour_ago,Gf.tc_date_x_hours_ago],ep[gg.Day]=[Gf.tc_date_1_day_ago,Gf.tc_date_x_days_ago],ep[gg.Week]=[Gf.tc_date_1_week_ago,Gf.tc_date_x_weeks_ago],ep[gg.Month]=[Gf.tc_date_1_month_ago,Gf.tc_date_x_months_ago],ep[gg.Year]=[Gf.tc_date_1_year_ago,Gf.tc_date_x_years_ago],ep),ap=function(n,a){var r=function(n){return[(e=""+(r=ip.distanceFromNow(n.createdAt),o=a,i=up[r.interval],u=1===r.intervalUnits?i[0]:i[1],o.translate([u,r.intervalUnits])),t=w.fromText(e),pu({element:t})),{dom:{tag:"span",classes:[],innerHtml:n.modifiedAt===n.createdAt?"":a.translate(Gf.tc_date_comment_edited)}}];var e,t,r,o,i,u},e={updateWith:function(n,e,t){sf.set(n,r(e))}};return{dom:{tag:"div",classes:og.classes.date},components:r(n),behaviours:Ao([sf.config({})]),apis:e}},cp={editCommentEvent:wi("tc-conversation-edit-comment"),deleteCommentEvent:wi("tc-conversation-delete-comment"),deleteConversationEvent:wi("tc-conversation-delete-all"),createCommentEvent:wi("tc-conversation-create")},sp=function(n){var e,t,r,o=w.fromHtml(n),i=te(o),u=(t=void 0!==(e=o).dom().attributes?e.dom().attributes:[],W(t,function(n,e){var t;return"class"===e.name?n:mn(mn({},n),((t={})[e.name]=e.value,t))},{})),a=(r=o,Array.prototype.slice.call(r.dom().classList,0)),c=0===i.length?{}:{innerHtml:qo(o)};return mn({tag:ye(o),classes:a,attributes:u},c)},fp=[Rf.config({}),Ho("overlay-button-events",[bo(Vr(),function(n,e){e.event().prevent()})])],lp=function(n,e,t){t?(uu(e.element(),"display"),e.hasConfigured(vm)&&vm.focusIn(e)):eu(e.element(),"display","none")},dp=function(e,n){return(t=n,Fr(t,function(n){if(!we(n))return!1;var e=Ce(n,"id");return void 0!==e&&-1<e.indexOf("aria-owns")}).bind(function(n){var e=Ce(n,"id"),t=Zn(n);return ui(t,'[aria-owns="'+e+'"]')})).exists(function(n){return mp(e,n)});var t},mp=function(e,n){return t=n,o=J(!(r=function(n){return $n(n,e.element())})),Fr(t,r,o).isSome()||dp(e,n);var t,r,o},gp=Object.freeze({__proto__:null,getCoupled:function(n,e,t,r){return t.getOrCreate(n,e,r)}}),pp=[pr("others",or(Pe.value,fr()))],vp=Ro({fields:pp,name:"coupling",apis:gp,state:Object.freeze({__proto__:null,init:function(n){var i={},e=J({});return Cr({readState:e,getOrCreate:function(t,r,o){var n=nn(r.others);if(n)return yt(i,o).getOrThunk(function(){var n=yt(r.others,o).getOrDie("No information found for coupled component: "+o)(t),e=t.getSystem().build(n);return i[o]=e});throw new Error("Cannot find coupled component: "+o+". Known coupled components: "+JSON.stringify(n,null,2))}})}})}),hp=function(e,n,t,r){t.get().each(function(n){Aa(e)});var o=n.getAttachPoint(e);Ta(o,e);var i=e.getSystem().build(r);return Ta(e,i),t.set(i),i},bp=function(n,e,t,r){var o=hp(n,e,t,r);return e.onOpen(n,o),o},yp=function(e,t,r){r.get().each(function(n){Aa(e),Na(e),t.onClose(e,n),r.clear()})},_p=function(n,e,t){return t.isOpen()},wp=function(n,e,t){var r,o,i,u,a=e.getAttachPoint(n);eu(n.element(),"position",rf.getMode(a)),r=n,o="visibility",i=e.cloakVisibilityAttr,u="hidden",iu(r.element(),o).fold(function(){Te(r.element(),i)},function(n){Se(r.element(),i,n)}),eu(r.element(),o,u)},xp=function(n,e,t){var r;r=n.element(),H(["top","left","right","bottom"],function(n){return iu(r,n).isSome()})||uu(n.element(),"position"),function(n,e,t){if(ke(n.element(),t)){var r=Ce(n.element(),t);eu(n.element(),e,r)}else uu(n.element(),e)}(n,"visibility",e.cloakVisibilityAttr)},Op=Object.freeze({__proto__:null,cloak:wp,decloak:xp,open:bp,openWhileCloaked:function(n,e,t,r,o){wp(n,e),bp(n,e,t,r),o(),xp(n,e)},close:yp,isOpen:_p,isPartOf:function(e,t,n,r){return _p(0,0,n)&&n.get().exists(function(n){return t.isPartOf(e,n,r)})},getState:function(n,e,t){return t.get()},setContent:function(n,e,t,r){return t.get().map(function(){return hp(n,e,t,r)})}}),Sp=Object.freeze({__proto__:null,events:function(t,r){return ho([bo(to(),function(n,e){yp(n,t,r)})])}}),Ep=[Mu("onOpen"),Mu("onClose"),gr("isPartOf"),gr("getAttachPoint"),xr("cloakVisibilityAttr","data-precloak-visibility")],Cp=Ro({fields:Ep,name:"sandboxing",active:Sp,apis:Op,state:Object.freeze({__proto__:null,init:function(){var e=yn(A.none()),n=J("not-implemented");return Cr({readState:n,isOpen:function(){return e.get().isSome()},clear:function(){e.set(A.none())},set:function(n){e.set(A.some(n))},get:function(n){return e.get()}})}})}),kp="alloy.item-hover",Tp="alloy.item-focus",Dp=function(n){(Vo(n.element()).isNone()||bf.isFocused(n))&&(bf.isFocused(n)||bf.focus(n),mo(n,kp,{item:n}))},Mp=function(n){mo(n,Tp,{item:n})},Np=J(kp),Ap=J(Tp),Fp=[gr("data"),gr("components"),gr("dom"),xr("hasSubmenu",!1),br("toggling"),xu("itemBehaviours",[rl,bf,vm,Nf]),xr("ignoreFocus",!1),xr("domModification",{}),Ru("builder",function(n){return{dom:n.dom,domModification:mn(mn({},n.domModification),{attributes:mn(mn(mn({role:n.toggling.isSome()?"menuitemcheckbox":"menuitem"},n.domModification.attributes),{"aria-haspopup":n.hasSubmenu}),n.hasSubmenu?{"aria-expanded":!1}:{})}),behaviours:Ou(n.itemBehaviours,[n.toggling.fold(rl.revoke,function(n){return rl.config(mn({aria:{mode:"checked"}},n))}),bf.config({ignore:n.ignoreFocus,stopMousedown:n.ignoreFocus,onFocus:function(n){Mp(n)}}),vm.config({mode:"execution"}),Nf.config({store:{mode:"memory",initialValue:n.data}}),Ho("item-type-events",pn(ol(),[bo(Lr(),Dp),bo(Zr(),bf.focus)]))]),components:n.components,eventOrder:n.eventOrder}}),xr("eventOrder",{})],Rp=[gr("dom"),gr("components"),Ru("builder",function(n){return{dom:n.dom,components:n.components,events:ho([(e=Zr(),bo(e,function(n,e){e.stop()}))])};var e})],Bp=J([ia({name:"widget",overrides:function(e){return{behaviours:Ao([Nf.config({store:{mode:"manual",getValue:function(n){return e.data},setValue:function(){}}})])}}})]),Ip=[gr("uid"),gr("data"),gr("components"),gr("dom"),xr("autofocus",!1),xr("ignoreFocus",!1),xu("widgetBehaviours",[Nf,bf,vm]),xr("domModification",{}),va(Bp()),Ru("builder",function(i){var n=ma(0,i,Bp()),e=ga("item-widget",i,n.internals()),t=function(n){return(e=n,t=i,r="widget",o=t.partUids[r],e.getSystem().getByUid(o).toOption()).map(function(n){return vm.focusIn(n),n});var e,t,r,o},r=function(n,e){return Yl(e.event().target())||i.autofocus&&e.setSource(n.element()),A.none()};return{dom:i.dom,components:e,domModification:i.domModification,events:ho([So(function(n,e){t(n).each(function(n){e.stop()})}),bo(Lr(),Dp),bo(Zr(),function(n,e){i.autofocus?t(n):bf.focus(n)})]),behaviours:Ou(i.widgetBehaviours,[Nf.config({store:{mode:"memory",initialValue:i.data}}),bf.config({ignore:i.ignoreFocus,onFocus:function(n){Mp(n)}}),vm.config({mode:"special",focusIn:i.autofocus?function(n){t(n)}:Io(),onLeft:r,onRight:r,onEscape:function(n,e){return bf.isFocused(n)||i.autofocus?(i.autofocus&&e.setSource(n.element()),A.none()):(bf.focus(n),A.some(!0))}})])}})],Hp=sr("type",{widget:Ip,item:Fp,separator:Rp}),Pp=J([ca({factory:{sketch:function(n){var e=ar("menu.spec item",Hp,n);return e.builder(e)}},name:"items",unit:"item",defaults:function(n,e){return e.hasOwnProperty("uid")?e:mn(mn({},e),{uid:Ti("item")})},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus,domModification:{classes:[n.markers.item]}}}})]),jp=J([gr("value"),gr("items"),gr("dom"),gr("components"),xr("eventOrder",{}),yu("menuBehaviours",[Cl,Nf,mf,vm]),Or("movement",{mode:"menu",moveOnTab:!0},sr("mode",{grid:[Iu(),Ru("config",function(n,e){return{mode:"flatgrid",selector:"."+n.markers.item,initSize:{numColumns:e.initSize.numColumns,numRows:e.initSize.numRows},focusManager:n.focusManager}})],matrix:[Ru("config",function(n,e){return{mode:"matrix",selectors:{row:e.rowSelector,cell:"."+n.markers.item},focusManager:n.focusManager}}),gr("rowSelector")],menu:[xr("moveOnTab",!0),Ru("config",function(n,e){return{mode:"menu",selector:"."+n.markers.item,moveOnTab:e.moveOnTab,focusManager:n.focusManager}})]})),pr("markers",Cu()),xr("fakeFocus",!1),xr("focusManager",Tl()),Mu("onHighlight")]),Vp=J("alloy.menu-focus"),Lp=Oa({name:"Menu",configFields:jp(),partFields:Pp(),factory:function(n,e,t,r){return{uid:n.uid,dom:n.dom,markers:n.markers,behaviours:wu(n.menuBehaviours,[Cl.config({highlightClass:n.markers.selectedItem,itemClass:n.markers.item,onHighlight:n.onHighlight}),Nf.config({store:{mode:"memory",initialValue:n.value}}),mf.config({find:A.some}),vm.config(n.movement.config(n,n.movement))]),events:ho([bo(Ap(),function(e,t){var n=t.event();e.getSystem().getByDom(n.target()).each(function(n){Cl.highlight(e,n),t.stop(),mo(e,Vp(),{menu:e,item:n})})}),bo(Np(),function(n,e){var t=e.event().item();Cl.highlight(n,t)})]),components:e,eventOrder:n.eventOrder,domModification:{attributes:{role:"menu"}}}}}),Wp=function(t,r,o,n){return yt(o,n).bind(function(n){return yt(t,n).bind(function(n){var e=Wp(t,r,o,n);return A.some([n].concat(e))})}).getOr([])},Up=function(n,e){var t={};tn(n,function(n,e){j(n,function(n){t[n]=e})});var r=e,o=on(e,function(n,e){return{k:n,v:e}}),i=rn(o,function(n,e){return[e].concat(Wp(t,r,o,e))});return rn(t,function(n){return yt(i,n).getOr([n])})},zp=function(n){return"prepared"===n.type?A.some(n.menu):A.none()},Gp={init:function(){var i=yn({}),u=yn({}),a=yn({}),c=yn(A.none()),s=yn({}),f=function(t){return function(n,e){for(var t=nn(n),r=0,o=t.length;r<o;r++){var i=t[r],u=n[i];if(e(u,i,n))return A.some(u)}return A.none()}(i.get(),function(n,e){return n===t})},l=function(n){return e(n).bind(zp)},e=function(n){return yt(u.get(),n)},t=function(n){return yt(i.get(),n)};return{setMenuBuilt:function(n,e){var t;u.set(mn(mn({},u.get()),((t={})[n]={type:"prepared",menu:e},t)))},setContents:function(n,e,t,r){c.set(A.some(n)),i.set(t),u.set(e),s.set(r);var o=Up(r,t);a.set(o)},expand:function(t){return yt(i.get(),t).map(function(n){var e=yt(a.get(),t).getOr([]);return[n].concat(e)})},refresh:function(n){return yt(a.get(),n)},collapse:function(n){return yt(a.get(),n).bind(function(n){return 1<n.length?A.some(n.slice(1)):A.none()})},lookupMenu:e,lookupItem:t,otherMenus:function(n){var e=s.get();return X(nn(e),n)},getPrimary:function(){return c.get().bind(l)},getMenus:function(){return u.get()},clear:function(){i.set({}),u.set({}),a.set({}),c.set(A.none())},isClear:function(){return c.get().isNone()},getTriggeringPath:function(n,u){var e=V(t(n).toArray(),function(n){return l(n).isSome()});return yt(a.get(),n).bind(function(n){var i=K(e.concat(n));return function(n){for(var e=[],t=0;t<n.length;t++){var r=n[t];if(!r.isSome())return A.none();e.push(r.getOrDie())}return A.some(e)}(q(i,function(n,e){return(t=n,r=u,o=i.slice(0,e+1),l(t).bind(function(e){return f(t).bind(function(n){return r(n).map(function(n){return{triggeredMenu:e,triggeringItem:n,triggeringPath:o}})})})).fold(function(){return c.get().is(n)?[]:[A.none()]},function(n){return[A.some(n)]});var t,r,o}))})}}},extractPreparedMenu:zp},qp=J("collapse-item"),Yp=xa({name:"TieredMenu",configFields:[Fu("onExecute"),Fu("onEscape"),Au("onOpenMenu"),Au("onOpenSubmenu"),Au("onRepositionMenu"),Mu("onCollapseMenu"),xr("highlightImmediately",!0),hr("data",[gr("primary"),gr("menus"),gr("expansions")]),xr("fakeFocus",!1),Mu("onHighlight"),Mu("onHover"),Tu(),gr("dom"),xr("navigateOnHover",!0),xr("stayInDom",!1),yu("tmenuBehaviours",[vm,Cl,mf,sf]),xr("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)},highlightPrimary:function(n,e){n.highlightPrimary(e)},repositionMenus:function(n,e){n.repositionMenus(e)}},factory:function(a,n){var c,e,i=yn(A.none()),u=function(r,o,n){return rn(n,function(n,e){var t=function(){return Lp.sketch(mn(mn({dom:n.dom},n),{value:e,items:n.items,markers:a.markers,fakeFocus:a.fakeFocus,onHighlight:a.onHighlight,focusManager:a.fakeFocus?(o=function(n){return Cl.getHighlighted(n).map(function(n){return n.element()})},{get:o,set:function(e,n){var t=o(e);e.getSystem().getByDom(n).fold(_,function(n){Cl.highlight(e,n)});var r=o(e);kl(e,t,r)}}):Tl()}));var o};return e===o?{type:"prepared",menu:r.getSystem().build(t())}:{type:"notbuilt",nbMenu:t}})},s=Gp.init(),f=function(n){return Nf.getValue(n).value},l=function(n){return rn(a.data.menus,function(n,e){return q(n.items,function(n){return"separator"===n.type?[]:[n.data.value]})})},d=function(e,n){Cl.highlight(e,n),Cl.getHighlighted(n).orThunk(function(){return Cl.getFirst(n)}).each(function(n){po(e,n.element(),Zr())})},m=function(e,n){return zo(P(n,function(n){return e.lookupMenu(n).bind(function(n){return"prepared"===n.type?A.some(n.menu):A.none()})}))},g=function(e,n,t){var r=m(n,n.otherMenus(t));j(r,function(n){Qi(n.element(),[a.markers.backgroundMenu]),a.stayInDom||sf.remove(e,n)})},p=function(n,r){var o,e=(o=n,i.get().getOrThunk(function(){var t={},n=Qe(o.element(),"."+a.markers.item),e=V(n,function(n){return"true"===Ce(n,"aria-haspopup")});return j(e,function(n){o.getSystem().getByDom(n).each(function(n){var e=f(n);t[e]=n})}),i.set(A.some(t)),t}));tn(e,function(n,e){var t=I(r,e);Se(n.element(),"aria-expanded",t)})},v=function(r,o,i){return A.from(i[0]).bind(function(n){return o.lookupMenu(n).bind(function(n){if("notbuilt"===n.type)return A.none();var e=n.menu,t=m(o,i.slice(1));return j(t,function(n){Ye(n.element(),a.markers.backgroundMenu)}),Me(e.element())||sf.append(r,bu(e)),Qi(e.element(),[a.markers.backgroundMenu]),d(r,e),g(r,o,i),A.some(e)})})};(e=c||(c={}))[e.HighlightSubmenu=0]="HighlightSubmenu",e[e.HighlightParent=1]="HighlightParent";var h=function(o,i,u){void 0===u&&(u=c.HighlightSubmenu);var n=f(i);return s.expand(n).bind(function(r){return p(o,r),A.from(r[0]).bind(function(t){return s.lookupMenu(t).bind(function(n){var e=function(n,e,t){if("notbuilt"!==t.type)return t.menu;var r=n.getSystem().build(t.nbMenu());return s.setMenuBuilt(e,r),r}(o,t,n);return Me(e.element())||sf.append(o,bu(e)),a.onOpenSubmenu(o,i,e,K(r)),u===c.HighlightSubmenu?(Cl.highlightFirst(e),v(o,s,r)):(Cl.dehighlightAll(e),A.some(i))})})})},r=function(e,t){var n=f(t);return s.collapse(n).bind(function(n){return p(e,n),v(e,s,n).map(function(n){return a.onCollapseMenu(e,t,n),n})})},t=function(t){return function(e,n){return ai(n.getSource(),"."+a.markers.item).bind(function(n){return e.getSystem().getByDom(n).toOption().bind(function(n){return t(e,n).map(function(){return!0})})})}},o=ho([bo(Vp(),function(t,r){var n=r.event().item();s.lookupItem(f(n)).each(function(){var n=r.event().menu();Cl.highlight(t,n);var e=f(r.event().item());s.refresh(e).each(function(n){return g(t,s,n)})})}),So(function(e,n){var t=n.event().target();e.getSystem().getByDom(t).each(function(n){0===f(n).indexOf("collapse-item")&&r(e,n),h(e,n,c.HighlightSubmenu).fold(function(){a.onExecute(e,n)},function(){})})}),wo(function(e,n){var t,r,o;(t=e,r=u(t,a.data.primary,a.data.menus),o=l(),s.setContents(a.data.primary,r,a.data.expansions,o),s.getPrimary()).each(function(n){sf.append(e,bu(n)),a.onOpenMenu(e,n),a.highlightImmediately&&d(e,n)})})].concat(a.navigateOnHover?[bo(Np(),function(n,e){var t,r,o=e.event().item();t=n,r=f(o),s.refresh(r).bind(function(n){return p(t,n),v(t,s,n)}),h(n,o,c.HighlightParent),a.onHover(n,o)})]:[])),b=function(n){return Cl.getHighlighted(n).bind(Cl.getHighlighted)},y={collapseMenu:function(e){b(e).each(function(n){r(e,n)})},highlightPrimary:function(e){s.getPrimary().each(function(n){d(e,n)})},repositionMenus:function(r){s.getPrimary().bind(function(e){return b(r).bind(function(n){var e,t=f(n),r=(e=s.getMenus(),un(e,function(n){return n})),o=zo(P(r,Gp.extractPreparedMenu));return s.getTriggeringPath(t,function(n){return t=n,Go(o,function(n){if(!n.getSystem().isConnected())return A.none();var e=Cl.getCandidates(n);return U(e,function(n){return f(n)===t})});var t})}).map(function(n){return{primary:e,triggeringPath:n}})}).fold(function(){var n;(n=r,A.from(n.components()[0]).filter(function(n){return"menu"===Ce(n.element(),"role")})).each(function(n){a.onRepositionMenu(r,n,[])})},function(n){var e=n.primary,t=n.triggeringPath;a.onRepositionMenu(r,e,t)})}};return{uid:a.uid,dom:a.dom,markers:a.markers,behaviours:wu(a.tmenuBehaviours,[vm.config({mode:"special",onRight:t(function(n,e){return Yl(e.element())?A.none():h(n,e,c.HighlightSubmenu)}),onLeft:t(function(n,e){return Yl(e.element())?A.none():r(n,e)}),onEscape:t(function(n,e){return r(n,e).orThunk(function(){return a.onEscape(n,e).map(function(){return n})})}),focusIn:function(e,n){s.getPrimary().each(function(n){po(e,n.element(),Zr())})}}),Cl.config({highlightClass:a.markers.selectedMenu,itemClass:a.markers.menu}),mf.config({find:function(n){return Cl.getHighlighted(n)}}),sf.config({})]),eventOrder:a.eventOrder,apis:y,events:o}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:_t(n,e),expansions:{}}},collapseItem:function(n){return{value:wi(qp()),meta:{text:n}}}}}),Kp=J("sink"),Xp=J(aa({name:Kp(),overrides:J({dom:{tag:"div"},behaviours:Ao([rf.config({useFixed:a})]),events:ho([_o(Wr()),_o(Vr()),_o(Gr())])})})),Jp=Kt([xr("isExtraPart",J(!1)),_r("fireEventInstead",[xr("event",uo())])]),Qp=Kt([xr("isExtraPart",J(!1)),_r("fireEventInstead",[xr("event",ao())]),vr("doReposition")]);(rp=tp||(tp={}))[rp.HighlightFirst=0]="HighlightFirst",rp[rp.HighlightNone=1]="HighlightNone";var $p,Zp,nv=function(n,e){var t=n.getHotspot(e).getOr(e),r=n.getAnchorOverrides();return n.layouts.fold(function(){return{anchor:"hotspot",hotspot:t,overrides:r}},function(n){return{anchor:"hotspot",hotspot:t,overrides:r,layouts:n}})},ev=function(n,e,t,r,o,i,u){var a,c,s,f,l,d,m,g,p,v,h=nv(n,t);return(c=h,f=r,l=o,d=u,m=e,g=s=t,p=(0,(a=n).fetch)(g).map(m),v=iv(s,a),p.map(function(n){return n.bind(function(n){return A.from(Yp.sketch(mn(mn({},l.menu()),{uid:Ti(""),data:n,highlightImmediately:d===tp.HighlightFirst,onOpenMenu:function(n,e){var t=v().getOrDie();rf.position(t,c,e),Cp.decloak(f)},onOpenSubmenu:function(n,e,t){var r=v().getOrDie();rf.position(r,{anchor:"submenu",item:e},t),Cp.decloak(f)},onRepositionMenu:function(n,e,t){var r=v().getOrDie();rf.position(r,c,e),j(t,function(n){rf.position(r,{anchor:"submenu",item:n.triggeringItem},n.triggeredMenu)})},onEscape:function(){return bf.focus(s),Cp.close(f),A.some(!0)}})))})})).map(function(n){return n.fold(function(){Cp.isOpen(r)&&Cp.close(r)},function(n){Cp.cloak(r),Cp.open(r,n),i(r)}),r})},tv=function(n,e,t,r,o,i,u){return Cp.close(r),be(r)},rv=function(n,e,t,r,o,i){var u=vp.getCoupled(t,"sandbox");return(Cp.isOpen(u)?tv:ev)(n,e,t,u,r,o,i)},ov=function(n,e,t){var r,o,i,u=mf.getCurrent(e).getOr(e),a=(r=n.element(),Ga.get(r));t?eu(u.element(),"min-width",a+"px"):(o=u.element(),i=a,Ga.set(o,i))},iv=function(e,n){return e.getSystem().getByUid(n.uid+"-"+Kp()).map(function(n){return function(){return Pe.value(n)}}).getOrThunk(function(){return n.lazySink.fold(function(){return function(){return Pe.error(new Error("No internal sink is specified, nor could an external sink be found"))}},function(n){return function(){return n(e)}})})},uv=function(n){Cp.getState(n).each(function(n){Yp.repositionMenus(n)})},av=function(r,o,i){var e,n,t,u,a,c,s,f=(e=wi("aria-owns"),{id:J(e),link:function(n){Se(n,"aria-owns",e)},unlink:function(n){Te(n,"aria-owns")}}),l=iv(o,r);return{dom:{tag:"div",classes:r.sandboxClasses,attributes:{id:f.id(),role:"listbox"}},behaviours:Ou(r.sandboxBehaviours,[Nf.config({store:{mode:"memory",initialValue:o}}),Cp.config({onOpen:function(n,e){var t=nv(r,o);f.link(o.element()),r.matchWidth&&ov(t.hotspot,e,r.useMinWidth),r.onOpen(t,n,e),void 0!==i&&void 0!==i.onOpen&&i.onOpen(n,e)},onClose:function(n,e){f.unlink(o.element()),void 0!==i&&void 0!==i.onClose&&i.onClose(n,e)},isPartOf:function(n,e,t){return mp(e,t)||mp(o,t)},getAttachPoint:function(){return l().getOrDie()}}),mf.config({find:function(n){return Cp.getState(n).bind(function(n){return mf.getCurrent(n)})}}),Rm.config({channels:mn(mn({},(a={isExtraPart:J(!1)},s=ar("Dismissal",Jp,a),(c={})[y()]={schema:Kt([gr("target")]),onReceive:function(e,n){Cp.isOpen(e)&&(Cp.isPartOf(e,n.target)||s.isExtraPart(e,n.target)||s.fireEventInstead.fold(function(){return Cp.close(e)},function(n){return lo(e,n.event)}))}},c)),(n={isExtraPart:J(!1),doReposition:uv},u=ar("Reposition",Qp,n),(t={})[m()]={onReceive:function(e){Cp.isOpen(e)&&u.fireEventInstead.fold(function(){return u.doReposition(e)},function(n){return lo(e,n.event)})}},t))})])}},cv=J([gr("dom"),gr("fetch"),Mu("onOpen"),Nu("onExecute"),xr("getHotspot",A.some),xr("getAnchorOverrides",J({})),xr("layouts",A.none()),yu("dropdownBehaviours",[rl,vp,vm,bf]),gr("toggleClass"),xr("eventOrder",{}),br("lazySink"),xr("matchWidth",!1),xr("useMinWidth",!1),br("role")].concat([xr("sandboxClasses",[]),xu("sandboxBehaviours",[mf,Rm,Cp,Nf])])),sv=J([ua({schema:[Tu()],name:"menu",defaults:function(n){return{onExecute:n.onExecute}}}),Xp()]),fv=Oa({name:"Dropdown",configFields:cv(),partFields:sv(),factory:function(e,n,t,r){var o,i,u=function(n){Cp.getState(n).each(function(n){Yp.highlightPrimary(n)})},a={expand:function(n){rl.isOn(n)||rv(e,function(n){return n},n,r,_,tp.HighlightNone).get(_)},open:function(n){rl.isOn(n)||rv(e,function(n){return n},n,r,_,tp.HighlightFirst).get(_)},isOpen:rl.isOn,close:function(n){rl.isOn(n)&&rv(e,function(n){return n},n,r,_,tp.HighlightFirst).get(_)},repositionMenus:function(n){var e,t;rl.isOn(n)&&(e=n,t=vp.getCoupled(e,"sandbox"),uv(t))}},c=function(n,e){return go(n),A.some(!0)};return{uid:e.uid,dom:e.dom,components:n,behaviours:wu(e.dropdownBehaviours,[rl.config({toggleClass:e.toggleClass,aria:{mode:"expanded"}}),vp.config({others:{sandbox:function(n){return av(e,n,{onOpen:function(){rl.on(n)},onClose:function(){rl.off(n)}})}}}),vm.config({mode:"special",onSpace:c,onEnter:c,onDown:function(n,e){if(fv.isOpen(n)){var t=vp.getCoupled(n,"sandbox");u(t)}else fv.open(n);return A.some(!0)},onEscape:function(n,e){return fv.isOpen(n)?(fv.close(n),A.some(!0)):A.none()}}),bf.config({})]),events:il(A.some(function(n){rv(e,function(n){return n},n,r,u,tp.HighlightFirst).get(_)})),eventOrder:mn(mn({},e.eventOrder),(o={},o[$r()]=["disabling","toggling","alloy.base.behaviour"],o)),apis:a,domModification:{attributes:mn(mn({"aria-haspopup":"true"},e.role.fold(function(){return{}},function(n){return{role:n}})),"button"===e.dom.tag?{type:(i="type",yt(e.dom,"attributes").bind(function(n){return yt(n,i)})).getOr("button")}:{})}}},apis:{open:function(n,e){return n.open(e)},expand:function(n,e){return n.expand(e)},close:function(n,e){return n.close(e)},isOpen:function(n,e){return n.isOpen(e)},repositionMenus:function(n,e){return n.repositionMenus(e)}}}),lv=wi("tc-kebab-action"),dv="basecamp",mv="deleting",gv={textKey:Gf.tc_kebab_edit,eventName:Hg},pv={textKey:Gf.tc_kebab_delete,eventName:Rg},vv={textKey:Gf.tc_kebab_deleteconversation,eventName:Bg},hv=function(n,a,e,t,r){var o,i;void 0===e&&(e='<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 24C5.373 24 0 18.627 0 12S5.373 0 12 0s12 5.373 12 12-5.373 12-12 12zm-8.693-5.259A10.981 10.981 0 0 0 12 23c3.535 0 6.68-1.668 8.693-4.259C19.432 16.251 14.591 15 12 15c-2.59 0-7.432 1.25-8.693 3.741zm8.7-5.741C14.224 13 16 10.99 16 8.5S14.224 4 12.007 4C9.79 4 8 6.01 8 8.5S9.79 13 12.007 13z" fill-rule="nonzero"></path></svg>');var u,c,s,f,l,d,m,g,p,v,h,b,y,_,w,x,O=yn(n),S=G([t.deleteConversation?[vv]:[],t.editComment?[gv]:[],t.deleteComment?[pv]:[]]),E=Ra(ap(n,r.universe)),C={updateWith:function(n,e,t){var r,o,i,u;O.set(e),T.getOpt(n).each(function(n){n.getApis().updateWith(n,e,{})}),D.getOpt(n).each(function(n){n.getApis().updateWith(n,e,{})}),r=n,o=t.numComments,i=e.isDeleting===Ll.QueryingDelete,u=a,M.getOpt(r).each(function(n){return lp(0,n,i)}),N.getOpt(r).each(function(n){var e=u?[Gf.tc_delete_prompts_conversation,1===o?Gf.tc_delete_prompts_conversation_detail_sing:{pattern:Gf.tc_delete_prompts_conversation_detail_pl,targets:[o]}]:[Gf.tc_delete_prompts_comment];n.getApis().setText(n,e),lp(0,n,i)}),e.isDeleting===Ll.PostDelete&&Uf.getCurrentRoute(n).filter(function(n){return n.destination===mv}).fold(function(){Uf.progressTo(n,mv)},function(n){}),E.getOpt(n).each(function(n){n.getApis().updateWith(n,e,{})})}},k={dom:{tag:"div",classes:og.classes.cardHead},components:G([[{dom:{tag:"div",classes:og.classes.cardHeadMeta},components:[(f=O.get().authorName,l=e,d={dom:{tag:"div",classes:og.classes.avatar,innerHtml:l}},m={dom:{tag:"div",classes:og.classes.username,innerHtml:f}},{dom:{tag:"div",classes:og.classes.user},components:[d,{dom:{tag:"div"},components:[m,E.asSpec()]}]})]}],0<S.length?[(u=S,c=r,s=P(u,function(e){var n;return{type:"item",data:{value:e.eventName},dom:{tag:"div",classes:og.classes.kebabItem},components:[{dom:{tag:"span",classes:og.classes.kebabItemLabel,innerHtml:c.universe.translate(e.textKey)}}],itemBehaviours:Ao(pn([Ho("item-events",[So(function(n){mo(n,lv,{eventName:e.eventName}),lo(n,to())})])],Pm({disableClass:og.classes.kebabDisabledItem.join(" ")}))),eventOrder:(n={},n[$r()]=["disabling","alloy.base.behaviour","toggling","typeaheadevents","item-events"],n)}}),fv.sketch({dom:{tag:"button",attributes:{type:"button"},classes:og.classes.kebab},components:[{dom:{tag:"div",classes:og.classes.kebabIcon,innerHtml:'<svg width="24" height="24" data-name="icon-image-options"><g id="icon-image-options" stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M6 10a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm12 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm-6 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2z" id="Shape" fill-rule="nonzero"></path></g></svg>'}}],lazySink:function(n){return c.getSink(n).fold(function(){return Pe.error("Could not find sink for kebab")},Pe.value)},dropdownBehaviours:Ao(pn(Pm({}),[Rf.config({tabAttr:Kg})])),sandboxBehaviours:Ao([Ho("kebab-sandbox-events",[bo(lv,function(n,e){var t=Nf.getValue(n);lo(t,e.event().eventName())})])]),parts:{menu:{dom:{tag:"div"},markers:og.markers.kebab}},toggleClass:og.states.kebabOpen,layouts:A.some({onLtr:function(){return[xc]},onRtl:function(){return[wc]}}),fetch:function(n){var e=wi("kebab-id");return be(A.some(Yp.singleData(e,{value:wi(e),dom:{tag:"div",classes:og.classes.kebabMenu},components:[{dom:{tag:"div",classes:og.classes.kebabMenuGroup},components:[Lp.parts().items({})]}],items:s})))}}))]:[]])},T=Ra((g={uid:n.uid,mode:n.mode},p=yn(g),v={updateWith:function(n,e,t){switch(p.set(e),e.mode){case jl.None:eu(n.element(),"display","none");break;case jl.Collapsed:uu(n.element(),"display"),oe(n.element()).each(function(n){return Yo(n,Gf.tc_comment_buttons_showmore)});break;case jl.Expanded:uu(n.element(),"display"),oe(n.element()).each(function(n){return Yo(n,Gf.tc_comment_buttons_showless)});break;case jl.ExpandOrNone:case jl.CollapsedOrNone:break;case jl.Edit:eu(n.element(),"display","none")}}},{dom:{tag:"div",classes:og.classes.showMoreLessContainer,styles:{display:"none"}},components:[hm.sketch({dom:{tag:"p",classes:og.classes.showMoreLess,innerHtml:Gf.tc_comment_buttons_showmore},action:function(n){xg(p.get().uid,function(n){return{mode:p.get().mode===jl.Collapsed?jl.Expanded:jl.Collapsed}})(n)},buttonBehaviours:Ao([Rf.config({tabAttr:Kg})])})],apis:v})),D=Ra($g(O.get(),r.universe)),M=Ra((r.universe,{dom:{tag:"div",classes:og.classes.cardDelete,styles:{display:"none"}}})),N=Ra((h=function(){return O.get().uid},b=r.universe,y=function(n){lo(n,Fg),xg(h(),function(n){return{isDeleting:Ll.BeforeDelete}})(n)},_=function(n,e,t){var r;return hm.sketch({dom:{tag:"button",classes:n?og.classes.button:og.classes.secondaryButton,innerHtml:e},eventOrder:(r={},r[Vr()]=["alloy.base.behaviour","focusing","overlay-button-events"],r),action:t,buttonBehaviours:Ao(fp)})},w={setText:function(n,e){sf.set(n,P(e,function(n){var e="string"==typeof n?b.translate(n):b.translate([n.pattern].concat(n.targets));return{dom:{tag:"div"},components:[{dom:sp("<p>"+e+"</p>")}]}}).concat([x.asSpec()]))}},x=Ra({dom:{tag:"div",classes:og.classes.cardDeleteButtons},components:[_(!0,b.translate(Gf.tc_delete_buttons_cancel),y),_(!1,b.translate(Gf.tc_delete_buttons_proceed),function(n){lo(n,Ig)})]}),{dom:{tag:"div",styles:{display:"none"},classes:og.classes.cardDeleteLabel},components:[],apis:w,behaviours:Ao([sf.config({}),Ho("card-delete-events",[bo(Xr(),function(n){Vo(n.element()).fold(function(){xg(h(),function(n){return{isDeleting:Ll.BeforeDelete}})(n)},function(){})})]),vm.config({mode:"cyclic",onEscape:function(n){return y(n),A.some(!0)}})])}));return{dom:{tag:"div",classes:og.classes.card,styles:{position:"relative"}},components:[k,D.asSpec(),M.asSpec(),N.asSpec(),T.asSpec()],behaviours:Ao([bf.config({}),Rf.config({}),qg({escapeEvent:Fg}),Uf.config({initialState:dv,onTransition:function(n,e){var t;t=O.get().uid,mo(n,dg,{uid:t})},routes:(o={},o[dv]=(i={},i[mv]={transition:{property:"opacity",transitionClass:og.states.disappearing}},i),o)}),Nf.config({store:{mode:"memory",initialValue:O.get().uid}}),Ho("comment-events",[bo(jg,function(n){return xg(O.get().uid,function(){return{mode:O.get().mode===jl.Collapsed?jl.Expanded:jl.Collapsed}})(n)}),bo(Fg,bf.focus),bo(Rg,function(n,e){xg(O.get().uid,function(n){return{isDeleting:Ll.QueryingDelete}})(n)}),bo(Bg,function(n,e){xg(O.get().uid,function(n){return{isDeleting:Ll.QueryingDelete}})(n)}),bo(Hg,function(n){return xg(O.get().uid,function(n){return{mode:jl.Edit}})(n)}),bo(Pg,function(t){D.getOpt(t).each(function(n){var e=Nf.getValue(n);mo(t,cp.editCommentEvent,{uid:O.get().uid,content:e})})}),bo(Ig,function(n,e){mo(n,a?cp.deleteConversationEvent:cp.deleteCommentEvent,{uid:O.get().uid})})])]),apis:C}},bv=function(n,r){return P(n,function(n,e){var t=0===e;return hv(n,t,void 0,{editComment:!0,deleteComment:0<e,deleteConversation:t},r)})},yv=function(n,o){var e={setComments:function(n,e){mf.getCurrent(n).each(function(n){sf.set(n,bv(e,o))}),Og(n)},updateWith:function(e,r,n){mf.getCurrent(e).each(function(n){var t=sf.contents(n);$(r).exists(function(n){return n.isDeleting===Ll.QueryingDelete})?Ye(n.element(),og.states.deletingConversation):Xe(n.element(),og.states.deletingConversation),t.length!==r.length?sf.set(n,bv(r,o)):j(t,function(n,e){t[e].getApis().updateWith(t[e],r[e],{numComments:r.length})}),Og(e)})},scrollToEnd:function(o){mf.getCurrent(o).each(function(n){var e,t=sf.contents(n);(e=t,0===e.length?A.none():A.some(e[e.length-1])).each(function(n){var e=o.element().dom(),t=e.getBoundingClientRect(),r=n.element().dom().getBoundingClientRect();r.top<t.top?e.scrollTop=r.top-t.top:r.bottom>t.bottom&&(e.scrollTop=r.bottom-t.bottom)})})}};return{dom:{tag:"div",classes:og.classes.outerScroll},components:[{dom:{tag:"div",classes:og.classes.commentList},components:bv(n,o),behaviours:Ao([Yg({selector:og.selectors.card}),sf.config({})])}],behaviours:Ao([mf.config({find:function(e){return oe(e.element()).bind(function(n){return e.getSystem().getByDom(n).toOption()})}})]),apis:e}};(Zp=$p||($p={}))[Zp.Start=0]="Start",Zp[Zp.Reply=1]="Reply";var _v=wi("tc-clear-input"),wv=wi("tc-submit-input"),xv=function(n){return e=wv,t=n,Wg.sketch({tag:"textarea",inputClasses:og.classes.replyTextarea,inputAttributes:mn(mn({},Xg),{placeholder:t.translate(Gf.tc_reply_placeholders)}),inputStyles:Jg,inputBehaviours:Ao(pn([Gg({enterEvent:e}),Rf.config({}),Ho("reply-events",[bo(zr(),Qg)])],Pm({})))});var e,t},Ov=function(t,n){var r=Ra(xv(n)),e={focusEditor:function(n){r.getOpt(n).each(bf.focus)},updateWith:function(n,e,t){H(e,function(n){return n.mode===jl.Edit})?eu(n.element(),"display","none"):uu(n.element(),"display")}};return{dom:{tag:"div",classes:og.classes.replySection},behaviours:Ao([Ho("reply-events",[bo(_v,function(n){r.getOpt(n).each(function(n){Nf.setValue(n,"")})}),bo(wv,function(e){r.getOpt(e).map(Nf.getValue).each(function(n){0<n.length&&mo(e,cp.createCommentEvent,{content:n,mode:t})})})])]),components:[r.asSpec(),cg.secondary({text:n.translate(Gf.tc_reply_buttons_clear),eventName:A.some(_v)}),cg.primary({text:n.translate(Gf.tc_reply_buttons_save),eventName:A.some(wv)})],apis:e}},Sv=function(){var r=yn(_g()),n=function(n){r.set(n(r.get()))};return{clearAll:function(){r.set(_g())},recalibrate:function(r){n(function(n){return t=n,e=r.comments,{targetUid:t.targetUid,conversation:P(e,function(n,e){return{uid:n.uid,props:mn(mn({},n),{isDeleting:Ll.BeforeDelete,mode:t.targetUid.is(n.uid)?jl.ExpandOrNone:jl.CollapsedOrNone})}}),queue:[]};var t,e})},enqueuePatch:function(e,t){n(function(n){return bg(n,[{uid:e,patch:t}])})},enqueuePatches:function(e){n(function(n){return bg(n,e)})},setTargetUid:function(e){n(function(n){return hg(n,A.some(e))})},clearTargetUid:function(){n(function(n){return hg(n,A.none())})},processQueue:function(){return yg(r.get()).map(function(n){var e=n.world,t=n.props;return r.set(e),t})},purge:function(t){n(function(n){var e=V(n.conversation,function(n){return n.uid!==t});return mn(mn({},n),{conversation:e})})},getProps:function(){return vg(r.get())},adjust:function(e){n(function(n){return bg(n,P(e,function(n){return{uid:n.uid,patch:"to-delete"===n.type?{isDeleting:Ll.PostDelete}:{}}}))})}}},Ev=function(n){return{type:"redraw-sidebar",view:n}},Cv=function(n,e){if(n.conversation.uid!==e.conversation.uid)return Ev(e);var t,r,o=P(n.conversation.comments,function(n){return n.uid}),i=P(e.conversation.comments,function(n){return n.uid});return r=i,(t=o).length===r.length&&Y(t,function(n,e){return n===r[e]})?{type:"refresh-comments",comments:P(e.conversation.comments,function(n,e){return{uid:n.uid,patch:mn({},n)}})}:0!==X(i,o).length?Ev(e):{type:"remove-comments",adjustments:P(o,function(n){return{type:I(i,n)?"to-remain":"to-delete",uid:n}})}},kv=wi("tc-escapeInSidebar"),Tv=function(n,t,r,e){var o=function(e){l.get().each(function(n){"comments"===n.type&&e(n.conversation.uid)})},u=Sv(),a=function(){u.processQueue().each(function(e){h(e),m.getOpt(s).each(function(n){n.getApis().updateWith(n,e,{})})})},i=function(e){o(function(n){return e(n).get(function(n){n.fold(function(n){return n()},function(n){return n()})})})},c=function(n){n.get(function(n){n.fold(function(n){n()},function(n){u.setTargetUid(n.targetUid),n.fn()})})},s=hu({dom:{tag:"div",classes:n,styles:{position:"relative"}},behaviours:Ao([sf.config({}),zg({onEscape:function(n){return lo(n,kv),A.some(!0)}}),Ho("sidebar-events",[bo(lg,function(n,e){u.enqueuePatch(e.event().uid(),e.event().patch())}),bo(dg,function(n,e){u.purge(e.event().uid()),m.getOpt(s).each(function(n){var e=u.getProps();h(e),n.getApis().updateWith(n,e,{})})}),bo(mg,function(n){a()}),bo(kv,function(n,e){t.onEscape()}),bo(cp.deleteConversationEvent,function(n,e){i(function(n){return r.deleteConversation(n,e.event().uid())})}),bo(cp.deleteCommentEvent,function(n,e){i(function(n){return r.deleteComment(n,e.event().uid())})}),bo(cp.editCommentEvent,function(n,e){o(function(n){c(r.editComment(n,e.event().uid(),e.event().content()))})}),bo(cp.createCommentEvent,function(n,e){e.event().mode()===$p.Reply?o(function(n){c(r.reply(n,e.event().content()))}):c(r.createConversation(e.event().content()))})])])}),f=Fa(s),l=yn(A.none()),d=function(n){sf.set(s,[g.asSpec()].concat(n))},m=Ra(yv([],{getSink:function(n){return g.getOpt(n)},universe:e})),g=Ra({dom:{tag:"div",styles:{"z-index":"100"}},behaviours:Ao([rf.config({})])}),p=Ra(Ov($p.Start,e)),v=Ra(Ov($p.Reply,e)),h=function(e){v.getOpt(s).each(function(n){n.getApis().updateWith(n,e,{})})},b=function(n){"splash"===n.view.type?(u.clearAll(),d([p.asSpec()])):"comments"===n.view.type&&(u.recalibrate(n.view.conversation),d([m.asSpec(),v.asSpec()]),m.getOpt(s).each(function(n){var e=u.getProps();h(e),n.getApis().setComments(n,e),n.getApis().scrollToEnd(n)}))};return{system:f,root:s,element:f.element,update:function(i){m.getOpt(s).bind(function(e){return l.get().map(function(n){return{convUi:e,pview:n}})}).fold(function(){return b(i)},function(n){n.convUi;var e,t,r=n.pview,o=(e=r,t=i.view,e.type!==t.type?Ev(t):"splash"===t.type?{type:"no-change"}:Cv(e,t));switch(o.type){case"add-comment":b(i);break;case"no-change":break;case"redraw-sidebar":b(i);break;case"remove-comments":u.adjust(o.adjustments),a();break;case"refresh-comments":u.enqueuePatches(o.comments),a()}}),l.set(A.some(i.view)),ff(s.element())&&i.grabFocus()&&v.getOpt(s).orThunk(function(){return p.getOpt(s)}).each(function(n){n.getApis().focusEditor(n)})},hasFocus:function(){return Vo(s.element()).isSome()},setReadonly:function(n){n&&f.broadcastOn([y()],{target:f.element()}),f.broadcastOn([jm],{readonly:n})},getSink:g.getOpt}},Dv="tc-delete-conversation-at-cursor",Mv=function(n,e){n.execCommand(Dv,null,{conversationUid:e})},Nv=function(n,e,t,r){return n.fold(function(n){return Pe.error({message:e,error:n,refresh:r})},function(n){return t(n).fold(function(n){return Pe.error({message:n.permError,error:n.reason,refresh:r})},Pe.value)})},Av=function(n){return an(n,"reason")?n.reason:""},Fv=function(o,r,i){var u=function(n){return function(){i().showError(n.message,n.error),n.refresh&&n.refresh()}};return{createConversation:function(n){return We.wrap(o.create({content:n,createdAt:ip.nowISO8601()}).map(function(n){var e=Pe.value,t=_;return Nv(n,Gf.tc_create_problem,e,t).fold(function(n){return Pe.error(u(n))},function(n){return Pe.value({targetUid:n.conversationUid,fn:function(){r.annotator.annotate(Ze(),{uid:n.conversationUid}),i().refreshSidebar(A.some(n.conversationUid),3)}})})}))},reply:function(r,n){return We.wrap(o.reply({conversationUid:r,content:n,createdAt:ip.nowISO8601()}).map(function(n){var e=Pe.value,t=_;return Nv(n,Gf.tc_reply_problem,e,t).fold(function(n){return Pe.error(u(n))},function(n){return Pe.value({targetUid:n.commentUid,fn:function(){i().refreshSidebar(A.some(r),3)}})})}))},editComment:function(t,r,n){return We.wrap(o.editComment({conversationUid:t,commentUid:r,content:n,modifiedAt:ip.nowISO8601()}).map(function(n){var e=_;return Nv(n,Gf.tc_edit_problem_comment,function(n){return n.canEdit?Pe.value(n):Pe.error({permError:Gf.tc_edit_unauthorised_comment,reason:Av(n)})},e).fold(function(n){return Pe.error(u(n))},function(n){return Pe.value({targetUid:r,fn:function(){i().refreshSidebar(A.some(t),4)}})})}))},deleteComment:function(e,n){return We.wrap(o.deleteComment({conversationUid:e,commentUid:n}).map(function(n){return Nv(n,Gf.tc_delete_problem_comment,function(n){return n.canDelete?Pe.value(n):Pe.error({permError:Gf.tc_delete_unauthorised_comment,reason:Av(n)})},function(){i().refreshSidebar(A.some(e),4)}).fold(function(n){return Pe.error(u(n))},function(n){return Pe.value(function(){i().refreshSidebar(A.some(e),4)})})}))},deleteConversation:function(e){return We.wrap(o.deleteConversation({conversationUid:e}).map(function(n){return Nv(n,Gf.tc_delete_problem_conversation,function(n){return n.canDelete?Pe.value(n):Pe.error({permError:Gf.tc_delete_unauthorised_conversation,reason:Av(n)})},function(){i().refreshSidebar(A.some(e),4)}).fold(function(n){return Pe.error(u(n))},function(n){return Pe.value(function(){Mv(r,e),i().refreshSidebar(A.none(),2)})})}))}}};Fe(function(n,e,t,r,o,i){var u,a,c,s,f,l,d=Fv(t,e,function(){return p}),m=n===fe.Modern?(s=e,f=d,l=i,{createSidebar:function(){return Tv(og.classes.roots.modern,{onEscape:function(){return s.focus()}},f,l)},createController:nt}):(u=e,a=d,c=i,{createSidebar:function(){return Tv(og.classes.roots.silver,{onEscape:function(){return u.focus()}},a,c)},createController:nt}),g=m.createSidebar(),p=m.createController(t,r,e,g),v=function(n){g.system.broadcastOn([y()],{target:w.fromDom(n.target)})},h=O(w.fromDom(b.document),"mousedown",function(n){g.system.broadcastOn([y()],{target:n.target()})});e.on("mousedown",v),e.on("remove",function(){e.off("mousedown",v),h.unbind()});o({controller:p,attachTo:function(n){ae(n,g.element())}})})}(window);