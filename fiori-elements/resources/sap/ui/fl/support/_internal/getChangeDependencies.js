/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Component","sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/apply/_internal/changes/FlexCustomData","sap/ui/fl/support/_internal/extractChangeDependencies","sap/ui/fl/Utils"],function(t,e,n,r,i,o){"use strict";function a(t){if(t){var e=t.oContainer.getComponentInstance();var r=n.getChangePersistenceForControl(e);return i(r)}}return function(){return o.getUShellService("AppLifeCycle").then(function(n){if(n){var r=n.getCurrentApplication();if(r.componentInstance){return a(r.componentInstance)}return r.getIntent().then(function(e){var n=document.getElementById("application-"+e.semanticObject+"-"+e.action);if(!n){t.error("the iFrame in the cFLP scenario could not be determined");return}return n.contentWindow.eval(""+"\t\t\t\t\t\t\tnew Promise(function (resolve) {"+"\t\t\t\t\t\t\t\tsap.ui.require(["+'\t\t\t\t\t\t\t\t\t"sap/ui/fl/ChangePersistenceFactory",'+'\t\t\t\t\t\t\t\t\t"sap/ui/fl/Utils",'+'\t\t\t\t\t\t\t\t\t"sap/ui/fl/support/_internal/extractChangeDependencies"'+"\t\t\t\t\t\t\t\t], function ("+"\t\t\t\t\t\t\t\t\tChangePersistenceFactory,"+"\t\t\t\t\t\t\t\t\tUtils,"+"\t\t\t\t\t\t\t\t\textractChangeDependencies"+"\t\t\t\t\t\t\t\t) {"+'\t\t\t\t\t\t\t\t\tUtils.getUShellService("AppLifeCycle").then(function (oAppLifeCycleService) {'+"\t\t\t\t\t\t\t\t\t\treturn oAppLifeCycleService.getCurrentApplication().componentInstance;"+"\t\t\t\t\t\t\t\t\t}).then(function (oCurrentAppContainerObject) {"+"\t\t\t\t\t\t\t\t\t\tif (oCurrentAppContainerObject) {"+"\t\t\t\t\t\t\t\t\t\t\tvar oAppComponent = oCurrentAppContainerObject.oContainer.getComponentInstance();"+"\t\t\t\t\t\t\t\t\t\t\tresolve(extractChangeDependencies(ChangePersistenceFactory.getChangePersistenceForControl(oAppComponent)));"+"\t\t\t\t\t\t\t\t\t\t};"+"\t\t\t\t\t\t\t\t});"+"\t\t\t\t\t\t\t});"+"\t\t\t\t\t\t});")})}var i=e.registry.filter(function(t){return t.getManifestObject().getRawJson()["sap.app"].type==="application"});if(i.length===1){return a(i[0])}})}});