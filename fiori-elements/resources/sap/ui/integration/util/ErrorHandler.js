/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/library","sap/ui/core/library","sap/ui/core/Configuration","sap/base/Log","sap/ui/Device","sap/ui/base/ManagedObject","sap/ui/integration/util/Utils","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/IllustratedMessageSize","sap/m/Button","sap/m/Dialog","sap/m/Text","sap/m/Bar","sap/m/Title","sap/ui/base/BindingParser","sap/m/HBox"],function(e,t,r,a,n,s,i,o,l,T,d,R,u,E,g,p,c){"use strict";var _=t.TitleLevel;var C=e.FlexRendertype;var f=e.FlexJustifyContent;var S=e.FlexAlignItems;function D(e){return p.complexParser.escape(JSON.stringify(e,null,4))}function x(e){if(e.options){e.options.body=e.body&&e.body.toString();e.options.headers=Object.fromEntries(e.options.headers)}return D(e)}var A=s.extend("sap.ui.integration.util.ErrorHandler",{metadata:{library:"sap.ui.integration",properties:{card:{type:"object"}}}});A.prototype.getIllustratedMessage=function(e,t){if(e.requestErrorParams){e=this._configureDataRequestErrorInfo(e)}else if(!t){e=this._configureErrorInfo(e)}return this._createIllustratedMessage(e,t)};A.prototype._createIllustratedMessage=function(e,t){var s=e.type||l.ErrorScreen,i=e.size||T.Auto,p="",D=e.title,x=e.description,A=e.details,O=this.getCard();O._oContentMessage={type:t?"noData":"error",illustrationType:s,illustrationSize:i,title:D,description:x,details:A};var m=new o({illustrationType:s,illustrationSize:i,title:D,enableDefaultTitleAndDescription:false,enableVerticalResponsiveness:true,description:x});if(A){if(r.getDebug()){m.addAdditionalContent(new d({text:O.getTranslatedText("CARD_BUTTON_SHOW_MORE"),press:function(){var e=new u({renderWhitespace:true,text:A}).addStyleClass("sapUiSmallMargin");var t=new R({stretch:n.system.phone,customHeader:new E({contentMiddle:new g({text:O.getTranslatedText("CARD_ERROR_DIALOG_TITLE"),level:_.H1}),contentRight:new d({icon:"sap-icon://copy",tooltip:O.getTranslatedText("CARD_TEXT_COPY"),press:function(){var t=document.createRange(),r=e.getDomRef();t.selectNode(r);window.getSelection().removeAllRanges();window.getSelection().addRange(t);window.navigator.clipboard.writeText(r.textContent)}})}),content:e,buttons:[new d({text:O.getTranslatedText("CARD_DIALOG_CLOSE_BUTTON"),press:function(){t.close()}})],afterClose:function(){t.destroy()}});t.open()}}))}else{a.error(A)}}if(O.getCardContent()&&O.getCardContent().getDomRef()){p=O.getCardContent().getDomRef().offsetHeight+"px"}var I=new c({renderType:C.Bare,justifyContent:f.Center,alignItems:S.Center,width:"100%",height:p,items:[m]}).addStyleClass("sapFCardErrorContent");return I};A.prototype._configureDataRequestErrorInfo=function(e){var t=this.getCard(),r=e.requestErrorParams.response,a=e.requestErrorParams.responseText,n=l.ErrorScreen,s=r?r.status+" "+r.statusText:t.getTranslatedText("CARD_ERROR_OCCURED"),o=r?t.getTranslatedText("CARD_ERROR_REQUEST_DESCRIPTION"):e.requestErrorParams.message,T=e.requestSettings,d=T.request?T.request.url:"",R=t.getTranslatedText("CARD_ERROR_REQUEST_DETAILS",[d]);if(r){switch(r.status){case 0:switch(r.statusText){case"timeout":n=l.ReloadScreen;s="408 "+t.getTranslatedText("CARD_ERROR_REQUEST_TIMEOUT_TITLE");R=t.getTranslatedText("CARD_ERROR_REQUEST_TIMEOUT_DETAILS",[d]);break;default:n=l.PageNotFound;s="404 "+t.getTranslatedText("CARD_ERROR_REQUEST_NOTFOUND_TITLE");break}break;case 404:n=l.PageNotFound;if(!r.statusText){s="404 "+t.getTranslatedText("CARD_ERROR_REQUEST_NOTFOUND_TITLE")}break;case 408:n=l.ReloadScreen;R=t.getTranslatedText("CARD_ERROR_REQUEST_TIMEOUT_DETAILS",[d]);break;case 401:case 403:case 511:o=t.getTranslatedText("CARD_ERROR_REQUEST_ACCESS_DENIED_DESCRIPTION");break}}R=s+"\n"+o+"\n\n";if(r){R+=t.getTranslatedText("CARD_LOG_MSG")+"\n"+r.statusText+"\n\n"}R+=t.getTranslatedText("CARD_REQUEST_SETTINGS")+"\n"+D(T)+"\n\n";if(r){R+=t.getTranslatedText("CARD_REQUEST")+"\n"+x(e.requestErrorParams.settings)+"\n\n"+t.getTranslatedText("CARD_RESPONSE_HEADERS")+"\n"+D(Object.fromEntries(r.headers))+"\n\n"}if(r&&a){R+=t.getTranslatedText("CARD_RESPONSE")+"\n";if(i.isJson(a)){R+=D(JSON.parse(a))}else{R+=p.complexParser.escape(a)}R+="\n\n"}R+=t.getTranslatedText("CARD_MANIFEST")+"\n"+D(t._oCardManifest.getJson())+"\n\n";R+=t.getTranslatedText("CARD_STACK_TRACE")+"\n"+(new Error).stack;return{type:n,title:s,description:o,details:R}};A.prototype._configureErrorInfo=function(e){var t=this.getCard(),r=t.getTranslatedText("CARD_MANIFEST")+"\n"+D(t._oCardManifest.getJson())+"\n\n"+t.getTranslatedText("CARD_STACK_TRACE")+"\n"+(new Error).stack;return{type:e.type,title:e.title,description:e.description,details:r}};return A});