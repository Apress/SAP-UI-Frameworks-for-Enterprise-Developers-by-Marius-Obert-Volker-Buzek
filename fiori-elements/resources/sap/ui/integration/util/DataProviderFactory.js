/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/EventProvider","sap/ui/integration/library","sap/ui/integration/util/ServiceDataProvider","sap/ui/integration/util/RequestDataProvider","sap/ui/integration/util/CacheAndRequestDataProvider","sap/ui/integration/util/DataProvider","sap/ui/integration/util/ExtensionDataProvider","sap/ui/integration/util/JSONBindingHelper","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/CsrfTokenHandler"],function(e,t,i,s,r,n,o,a,d,l){"use strict";var u=t.CardPreviewMode;var f=e.extend("sap.ui.integration.util.DataProviderFactory",{constructor:function(t){e.call(this);t=t||{};this._oDestinations=t.destinations;this._oExtension=t.extension;this._oCsrfTokenHandler=t.csrfTokenHandler;this._oCard=t.card;this._oEditor=t.editor;this._oHost=t.host;if(t.csrfTokensConfig){this._oCsrfTokenHandler=new l({host:t.host,configuration:t.csrfTokensConfig})}this._aDataProviders=[];this._aFiltersProviders=[]}});f.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments);if(this._aDataProviders){this._aDataProviders.forEach(function(e){if(!e.bIsDestroyed){e.destroy()}});this._aDataProviders=null;this._aFiltersProviders=null}if(this._oCsrfTokenHandler){this._oCsrfTokenHandler.destroy();this._oCsrfTokenHandler=null}this._oCard=null;this._oExtension=null;this._bIsDestroyed=true};f.prototype.isDestroyed=function(){return this._bIsDestroyed};f.prototype.create=function(e,t,a,l){var f=this._oCard;if(!this._isProvidingConfiguration(e)||f&&f.getPreviewMode()===u.Abstract){return null}if(f&&f.getPreviewMode()===u.MockData){e=this._applyMockDataConfiguration(e)}var h=this._oEditor,c=this._oHost||f&&f.getHostInstance()||h&&h.getHostInstance(),p=c&&c.bUseExperimentalCaching,g=this._createDataProviderSettings(e,l),v;if(e.request&&p){v=new r(g);v.setHost(c)}else if(e.request){v=new s(g);if(c){v.setHost(c)}}else if(e.service){v=new i(g)}else if(e.json){v=new n(g)}else if(e.extension){v=new o(g,this._oExtension)}if(f){v.setCard(f);d.propagateModels(f,v)}else if(h){d.propagateModels(h,v)}v.bindObject("/");v.setDestinations(this._oDestinations);if(this._oCsrfTokenHandler){v.setCsrfTokenHandler(this._oCsrfTokenHandler);this._oCsrfTokenHandler.setDataProviderFactory(this)}if(v.isA("sap.ui.integration.util.IServiceDataProvider")){v.createServiceInstances(t)}this._aDataProviders.push(v);if(a){this._aFiltersProviders.push(v)}else{v.setDependencies(this._aFiltersProviders)}return v};f.prototype.remove=function(e){var t=this._aDataProviders.indexOf(e);if(t>-1){this._aDataProviders.splice(t,1)}if(e&&!e.bDestroyed&&e._bIsDestroyed){e.destroy()}};f.prototype.setHost=function(e){this._oHost=e;if(this._oCsrfTokenHandler){this._oCsrfTokenHandler.setHost(e)}};f.prototype._createDataProviderSettings=function(e,t){var i=this._oCard;var s=this._oEditor;var r={};if(i){r.baseRuntimeUrl=i.getRuntimeUrl("/");if(t){r.settings=e}else{r.settingsJson=a.createJsonWithBindingInfos(e,i.getBindingNamespaces())}}else if(s){r.baseRuntimeUrl=s.getRuntimeUrl("/");r.settingsJson=a.createJsonWithBindingInfos(e,s.getBindingNamespaces())}else{r.settingsJson=a.createJsonWithBindingInfos(e,{})}return r};f.prototype._applyMockDataConfiguration=function(e){if(e.mockData&&this._isProvidingConfiguration(e.mockData)){var t=Object.assign({},e);delete t.request;delete t.service;delete t.json;delete t.extension;return Object.assign(t,e.mockData)}this.fireEvent("liveDataFallback");return e};f.prototype._isProvidingConfiguration=function(e){return e&&(e.request||e.service||e.json||e.extension)};return f});