/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./AnalyticalContentRenderer","./BaseContent","sap/m/IllustratedMessageType","sap/ui/integration/library","sap/ui/integration/util/BindingResolver","sap/base/Log","sap/base/util/merge","sap/ui/core/Core"],function(t,e,a,i,n,r,o,s){"use strict";var l=i.CardActionArea;var p,c,d,u;var g={Top:"top",Bottom:"bottom",Left:"left",Right:"right"};var v={TopLeft:"topLeft",Center:"center"};var h={Left:"left",Center:"center",Right:"right"};var f={Line:"line",StackedColumn:"stacked_column",StackedBar:"stacked_bar",Donut:"donut"};var m={Chart:"Chart",Full:"Full"};var y=e.extend("sap.ui.integration.cards.AnalyticalContent",{metadata:{library:"sap.ui.integration"},renderer:t});y.prototype.exit=function(){e.prototype.exit.apply(this,arguments);if(this._oPopover){this._oPopover.destroy()}};y.prototype.loadDependencies=function(t){return new Promise(function(t,e){s.loadLibrary("sap.viz",{async:true}).then(function(){sap.ui.require(["sap/viz/ui5/controls/VizFrame","sap/viz/ui5/controls/common/feeds/FeedItem","sap/viz/ui5/controls/Popover","sap/viz/ui5/data/FlattenedDataset"],function(e,a,i,n){p=e;c=a;u=i;d=n;t()},function(t){e(t)})}).catch(function(){e("Analytical content type is not available with this distribution.")})})};y.prototype.onDataChanged=function(){this._createChart();var t=this.getAggregation("_content");if(t){var e=t._getVizDataset(),i=e&&e._FlatTableD&&e._FlatTableD._data&&Array.isArray(e._FlatTableD._data)&&e._FlatTableD._data.length;if(i){this.destroyAggregation("_noDataMessage")}else{this.showNoDataMessage({type:a.NoEntries,title:this.getCardInstance().getTranslatedText("CARD_NO_ITEMS_ERROR_LISTS")})}}};y.prototype._createChart=function(){var t=this.getParsedConfiguration();if(!t.chartType){r.error('"sap.card".content.chartType is mandatory property.',null,"sap.ui.integration.widgets.Card");return}var e=n.resolveValue(t,this,"/");var a=new p({uiConfig:{applicationSet:"fiori"},height:"100%",width:"100%",vizType:f[e.chartType]||e.chartType,vizProperties:this._getVizProperties(e),dataset:this._getDataset(t,e),feeds:this._getFeeds(e)});this.setAggregation("_content",a);this._attachActions(t);if(e.popover&&e.popover.active){this._attachPopover()}};y.prototype._attachActions=function(t){var e={area:l.Content,actions:t.actions,control:this};if(t.actionableArea===m.Chart){e.eventName="selectData";e.actionControl=this.getAggregation("_content");this._oActions.setBindingPathResolver(function(t){var e=t.getParameter("data")[0].data._context_row_number;return this.getBindingContext().getPath()+"/"+e}.bind(this))}else{e.eventName="press"}this._oActions.attach(e)};y.prototype._attachPopover=function(){if(this._oPopover){this._oPopover.destroy()}this._oPopover=new u;this._oPopover.connect(this.getAggregation("_content").getVizUid())};y.prototype._getVizProperties=function(t){if(!t){return null}var e=t.title,a=t.legend,i=t.plotArea;var n={title:{style:{fontWeight:"normal"},layout:{respectPlotPosition:false}},legend:{},legendGroup:{layout:{}},plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"}},categoryAxis:{title:{}},valueAxis:{title:{}},interaction:{noninteractiveMode:true}};if(t.actions||t.popover){var s=t.actionableArea===m.Chart||t.popover&&t.popover.active;n.interaction.noninteractiveMode=!s}if(e){n.title.text=e.text;n.title.visible=e.visible;n.title.alignment=h[e.alignment];r.warning('"sap.card".content.title is deprecated. Use "sap.card".content.chartProperties instead',null,"sap.ui.integration.widgets.Card")}if(a){n.legend.visible=a.visible;n.legendGroup.layout.position=g[a.position];n.legendGroup.layout.alignment=v[a.alignment];r.warning('"sap.card".content.legend is deprecated. Use "sap.card".content.chartProperties instead',null,"sap.ui.integration.widgets.Card")}if(i){if(i.dataLabel){n.plotArea.dataLabel=i.dataLabel}if(i.categoryAxisText){n.categoryAxis.title.visible=i.categoryAxisText.visible}if(i.valueAxisText){n.valueAxis.title.visible=i.valueAxisText.visible}r.warning('"sap.card".content.plotArea is deprecated. Use "sap.card".content.chartProperties instead',null,"sap.ui.integration.widgets.Card")}o(n,t.chartProperties);return n};y.prototype._getDataset=function(t,e){var a,i;if(t.dimensions){i=t.dimensions.map(function(t,a){return{name:e.dimensions[a].name||e.dimensions[a].label,value:t.value,displayValue:t.displayValue,dataType:t.dataType}})}if(t.measures){a=t.measures.map(function(t,a){return{name:e.measures[a].name||e.measures[a].label,value:t.value}})}return new d({measures:a,dimensions:i,data:{path:this.getBindingContext().getPath()}})};y.prototype._getFeeds=function(t){var e=t.feeds;if(t.measureAxis||t.dimensionAxis){r.warning('"sap.card".content.measureAxis and "sap.card".content.dimensionAxis are deprecated. Use "sap.card".content.feeds instead',null,"sap.ui.integration.widgets.Card");e=[{uid:t.measureAxis,type:"Measure",values:t.measures.map(function(t){return t.label})},{uid:t.dimensionAxis,type:"Dimension",values:t.dimensions.map(function(t){return t.label})}]}return e.map(function(t){return new c(t)})};return y});