/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/core/Control","sap/ui/comp/providers/ChartProvider","sap/suite/ui/microchart/library","sap/m/library","sap/ui/core/CustomData","sap/ui/comp/smartmicrochart/SmartMicroChartBase","sap/base/Log","./SmartMicroChartRenderer"],function(t,e,a,i,r,o,s,n,h){"use strict";var l=r.Size;var c=e.extend("sap.ui.comp.smartmicrochart.SmartMicroChart",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartmicrochart/SmartMicroChart.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},showLabel:{type:"boolean",group:"Appearance",defaultValue:true},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},chartBindingPath:{type:"string",group:"Misc",defaultValue:null},chartType:{type:"string",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Misc"},size:{type:"sap.m.Size",group:"Misc",defaultValue:"Auto"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"_chart",aggregations:{_chart:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{chartTitle:{type:"sap.m.Label",group:"Misc",multiple:false},chartDescription:{type:"sap.m.Label",group:"Misc",multiple:false},unitOfMeasure:{type:"sap.m.Label",group:"Misc",multiple:false},freeText:{type:"sap.m.Label",group:"Misc",multiple:false},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{initialize:{}}},renderer:h});c.prototype.init=function(){this._bIsInitialized=false;this._bMetaModelLoadAttached=false};c.prototype.setChartType=function(){return this};c.prototype.getChartType=function(){return this.getAggregation("_chart").getChartType()};c.prototype.propagateProperties=function(){if(e.prototype.propagateProperties){e.prototype.propagateProperties.apply(this,arguments)}this._initializeMetadata()};c.prototype.onBeforeRendering=function(){var t=this.getAggregation("_chart");if(t){if(t.getMetadata().hasProperty("height")){t.setHeight(this.getHeight(),true)}if(t.getMetadata().hasProperty("width")){t.setWidth(this.getWidth(),true)}if(t.getMetadata().hasProperty("size")){t.setSize(this.getSize(),true)}i._passParentContextToChild(this,t);if(t.getMetadata().hasProperty("showLabel")){t.setShowLabel(this.getShowLabel(),true)}if(t.getMetadata().hasAssociation("chartTitle")){t.setAssociation("chartTitle",this.getChartTitle(),true)}if(t.getMetadata().hasAssociation("chartDescription")){t.setAssociation("chartDescription",this.getChartDescription(),true)}if(t.getMetadata().hasAssociation("unitOfMeasure")){t.setAssociation("unitOfMeasure",this.getUnitOfMeasure(),true)}if(t.getMetadata().hasAssociation("freeText")){t.setAssociation("freeText",this.getFreeText(),true)}}};c.prototype.setSize=function(t){if(this.getSize()!==t){if(t===l.Responsive){this.setProperty("isResponsive",true)}else{this.setProperty("isResponsive",false)}this.setProperty("size",t)}return this};c.prototype.setIsResponsive=function(t){var e,a=this.getSize();this.setProperty("isResponsive",t);if(t){e=l.Responsive}else{e=a===l.Responsive?l.Auto:a}this.setProperty("size",e);return this};c.prototype.addAriaLabelledBy=function(t){this.addAssociation("ariaLabelledBy",t,true);this.getAggregation("_chart").addAriaLabelledBy(t);return this};c.prototype.removeAriaLabelledBy=function(t){this.removeAssociation("ariaLabelledBy",t,true);this.getAggregation("_chart").removeAriaLabelledBy(t);return this};c.prototype.removeAllAriaLabelledBy=function(){this.removeAllAssociation("ariaLabelledBy",true);this.getAggregation("_chart").removeAllAriaLabelledBy();return this};c.prototype._initializeMetadata=function(){if(!this._bIsInitialized){var t=this.getModel();if(t&&(t.getMetadata().getName()==="sap.ui.model.odata.v2.ODataModel"||t.getMetadata().getName()==="sap.ui.model.odata.ODataModel")){if(!this._bMetaModelLoadAttached){t.getMetaModel().loaded().then(this._onMetadataInitialized.bind(this));this._bMetaModelLoadAttached=true}}else if(t){this._onMetadataInitialized()}}};c.prototype._createChartProvider=function(){var t=this.getEntitySet(),e=this.getModel();if(e&&t){this._oChartProvider=new a({entitySet:t,model:e,chartQualifier:this.data("chartQualifier")})}};c.prototype._onMetadataInitialized=function(){var t,e;this._bMetaModelLoadAttached=false;if(!this._bIsInitialized){this._createChartProvider();if(this._oChartProvider){this._oChartViewMetadata=this._oChartProvider.getChartViewMetadata();if(this._oChartViewMetadata){this._bIsInitialized=true;this._createInnerChart()}else{t=this.data("chartQualifier");e=this._oChartProvider.getChartDataPointMetadata();if(e){e=t?e.additionalAnnotations[t]:e.primaryAnnotation;if(e){this._bIsInitialized=true;this._createInnerChartFromDataPoint(e)}else{n.error("There is no UI.Chart annotation nore DataPoint annotation. We cannot initialize SmartMicroChart.")}}else{n.error("There is no UI.Chart annotation nore DataPoint annotation. We cannot initialize SmartMicroChart.")}}}}};c.prototype._createInnerChartFromDataPoint=function(t){var e=t.Visualization.EnumMember;if(s._isBulletVizualizationType(e)){this._buildSmartBulletMicroChart()}else{n.error("Only Bullet chart can be initialize with just DataPoint annotation. Type: "+e+" is not a Bullet chart type.");return}this.invalidate()};c.prototype._createInnerChart=function(){if(!this._checkChartMetadata()){n.error("Created annotations not valid. Please review the annotations and metadata.");return}var t=this._oChartViewMetadata.chartType;switch(t){case"line":case"area":var e=this._oChartViewMetadata.annotation.ChartType.EnumMember.split("/").pop().toLowerCase();if(e==="area"){this._buildSmartAreaMicroChart()}else if(e==="line"){this._buildSmartLineMicroChart()}else{n.error("Not supported chart type used.");return}break;case"bullet":this._buildSmartBulletMicroChart();break;case"donut":this._buildSmartRadialMicroChart();break;case"stacked_bar":this._buildSmartStackedBarMicroChart();break;case"column":this._buildSmartColumnMicroChart();break;case"pie":this._buildSmartHarveyBallMicroChart();break;default:n.error("Not supported chart type used.");return}this.invalidate()};c.prototype._buildSmartLineMicroChart=function(){this._buildSmartMicroChart(t.smartmicrochart.SmartLineMicroChart)};c.prototype._buildSmartAreaMicroChart=function(){this._buildSmartMicroChart(t.smartmicrochart.SmartAreaMicroChart)};c.prototype._buildSmartBulletMicroChart=function(){this._buildSmartMicroChart(t.smartmicrochart.SmartBulletMicroChart)};c.prototype._buildSmartRadialMicroChart=function(){this._buildSmartMicroChart(t.smartmicrochart.SmartRadialMicroChart)};c.prototype._buildSmartStackedBarMicroChart=function(){this._buildSmartMicroChart(t.smartmicrochart.SmartStackedBarMicroChart)};c.prototype._buildSmartColumnMicroChart=function(){this._buildSmartMicroChart(t.smartmicrochart.SmartColumnMicroChart)};c.prototype._buildSmartHarveyBallMicroChart=function(){this._buildSmartMicroChart(t.smartmicrochart.SmartHarveyBallMicroChart)};c.prototype._buildSmartMicroChart=function(t){var e=new t({entitySet:this.getEntitySet(),chartBindingPath:this.getChartBindingPath(),initialize:[this._onChartInitialized,this],customData:[new o({key:"chartQualifier",value:this.data("chartQualifier")})]});if(e.getMetadata().hasProperty("enableAutoBinding")){e.setProperty("enableAutoBinding",this.getEnableAutoBinding(),true)}this.setAggregation("_chart",e,true)};c.prototype._onChartInitialized=function(){this.fireInitialize()};c.prototype._checkChartMetadata=function(){if(this._oChartViewMetadata.chartType&&this._oChartViewMetadata.annotation&&this._oChartViewMetadata.annotation.ChartType&&this._oChartViewMetadata.annotation.ChartType.EnumMember&&this._oChartViewMetadata.annotation.ChartType.EnumMember.length>0){return true}else{return false}};c.prototype.getAccessibilityInfo=function(){var t={};var e=this.getAggregation("_chart");if(e&&e.getAccessibilityInfo){t=e.getAccessibilityInfo()}return t};return c});