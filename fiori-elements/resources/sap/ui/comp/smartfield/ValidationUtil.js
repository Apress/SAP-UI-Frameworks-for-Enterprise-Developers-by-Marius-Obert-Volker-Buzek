/*
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define("sap/ui/comp/smartfield/ValidationUtil",["sap/ui/core/Core","sap/ui/core/library","sap/ui/comp/library","sap/ui/core/message/Message","sap/ui/core/message/ControlMessageProcessor","sap/ui/model/ValidateException"],function(e,t,s,i,o,r){"use strict";var a=s.smartfield.TextInEditModeSource;var n=function(t){this.oSmartField=t;this.oRB=e.getLibraryResourceBundle("sap.ui.comp")};n.prototype._getPropertyName=function(e){if(e.isA("sap.ui.comp.smartfield.ComboBox")){return"enteredValue"}else if(e.isA("sap.m.ComboBox")){return"selectedKey"}else{return"value"}};n.prototype._createMessage=function(t,s,o){var r=this._getPropertyName(s),a;this._removeMessage();a=new i({message:this.oRB.getText(t),type:o,target:s.getId()+"/"+r,processor:this._getMessageProcessor()});this._oCurrentMessage=a;e.getMessageManager().addMessages(a)};n.prototype._removeMessage=function(){if(this._oCurrentMessage){e.getMessageManager().removeMessages(this._oCurrentMessage);this._oCurrentMessage.destroy();this._oCurrentMessage=null}};n.prototype.handleValueListWarning=function(e){var s=this.oSmartField._oControl.edit;if(s&&this.oSmartField._isValueListWarning()){if(e.length===0){this._createMessage("SMARTFIELD_NOT_FOUND",s,t.MessageType.Warning)}else if(e.length>1){this._createMessage("SMARTFIELD_DUPLICATE_VALUES",s,t.MessageType.Warning)}else{this._removeMessage()}}};n.prototype._getMessageProcessor=function(){var t;if(this._oMessageProcessor){return this._oMessageProcessor}t=new o;e.getMessageManager().registerMessageProcessor(t);this._oMessageProcessor=t;return this._oMessageProcessor};n.prototype.handleComboValidation=function(e){if(!this._isComboBoxValidationWarning()){return}if(e.getEnteredValue()&&!e.getSelectedKey()&&e.getValue()!==""){this._createMessage("SMARTFIELD_NOT_FOUND",e,t.MessageType.Warning)}else{this._removeMessage()}};n.prototype.addValidationToType=function(e){var t;if(!e||!this._isComboBoxValidationStrict()){return}t=e.validateValue;e.validateValue=function(e){var s=this.oSmartField._oControl.edit;if(!s.getSelectedItem()&&s.getValue()){throw new r(this.oRB.getText("SMARTFIELD_NOT_FOUND"))}return t.apply(this,arguments)}.bind(this)};n.prototype._isLegacyMode=function(){var e=this.oSmartField;return e._isFixedValueList()&&e.getFixedValueListValidationEnabled()};n.prototype._isComboBoxValidationStrict=function(){if(this._isLegacyMode()){return false}return this.oSmartField._getComputedTextInEditModeSource()===a.ValueList};n.prototype._isComboBoxValidationWarning=function(){if(this._isLegacyMode()){return false}return this.oSmartField._isValueListWarning()};return n},true);