/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/core/Element","sap/ui/layout/form/SimpleForm","sap/m/Title","sap/m/Label","sap/m/Text","sap/m/Image","sap/m/Link","sap/ui/base/ManagedObjectObserver","sap/ui/comp/odata/MetadataAnalyser","sap/base/Log","sap/ui/layout/library","sap/ui/core/library","sap/base/util/merge"],function(e,t,r,n,o,i,a,s,p,u,d,l,c,f){"use strict";var m=c.TitleLevel;var h=l.form.SimpleFormLayout;var v=t.extend("sap.ui.comp.navpopover.ContactDetailsController",{metadata:{library:"sap.ui.comp"}});v.prototype.init=function(){this._oObserver=null};v.prototype.exit=function(){if(this._oObserver){this._oObserver.disconnect();this._oObserver=null}};v.prototype.getBindingPath4ContactAnnotation=function(e,t,r){if(t===undefined||t===null||!e){return Promise.resolve(null)}if(!this.getModel()){return Promise.resolve(null)}if(!this.getModel().getMetaModel()){return Promise.resolve(null)}var n=this.getModel().getMetaModel();return n.loaded().then(function(){var o;try{n.getMetaContext(e)}catch(t){d.error("sap.ui.comp.navpopover.ContactDetailsController.getBindingPath4ContactAnnotation: binding path '"+e+"' is not valid. Error has been caught: "+t);return null}try{o="/"+t+"('"+r+"')";n.getMetaContext(o);return o}catch(e){}try{o=t?e+"/"+t:e;n.getMetaContext(o);return o}catch(r){d.error("sap.ui.comp.navpopover.ContactDetailsController.getBindingPath4ContactAnnotation: the path of sContactAnnotationPath '"+e+"/"+t+"' is not valid. Error has been caught: "+r);return null}})};v.prototype.getContactDetailsAnnotation=function(e){if(!e){return null}var t=new u(this.getModel());var r=t.getContactAnnotation(e);if(!r){return null}return r};v.prototype.getContactDetailsContainers=function(e){var t=this.getContactDetailsAnnotation(e);if(!t){return[]}var o=[];var i=[];var a=[];var s;this._oObserver=new p(function(e){if(e.type==="property"&&e.name==="visible"){var t=false;for(var r=1;r<s.getContent().length;r++){if(s.getContent()[r].getLabelFor&&s.getContent()[r].getLabelFor()){continue}if(s.getContent()[r].getVisible()){t=true}}s.setVisible(t)}});var u=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.addProperty2ExpandAndSelect("photo",t,e,i,a);this._addPhoto("photo",t,e,o,this._oObserver);this.addProperty2ExpandAndSelect("fn",t,e,i,a);this._addLabeledText("fn",u.getText("POPOVER_CONTACT_SECTION_NAME"),t,e,o,this._oObserver);this.addProperty2ExpandAndSelect("role",t,e,i,a);this._addLabeledText("role",u.getText("POPOVER_CONTACT_SECTION_ROLE"),t,e,o,this._oObserver);this.addProperty2ExpandAndSelect("title",t,e,i,a);this._addLabeledText("title",u.getText("POPOVER_CONTACT_SECTION_JOBTITLE"),t,e,o,this._oObserver);this.addProperty2ExpandAndSelect("org",t,e,i,a);this._addLabeledText("org",u.getText("POPOVER_CONTACT_SECTION_DEPARTMENT"),t,e,o,this._oObserver);this._addEmails(t,e,i,a,o,this._oObserver);this._addTels(t,e,i,a,o,this._oObserver);this._addAddresses(t,e,i,a,o,this._oObserver);if(!o.length){return[]}o.splice(0,0,new n({text:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_CONTACT_SECTION_TITLE"),level:m.H2}));s=new r({maxContainerCols:1,editable:false,layout:h.ResponsiveGridLayout,content:o});this._requestData(s,e,i,a);return[s]};v.prototype._addPhoto=function(e,t,r,n,o){if(!t[e]){return}var i=r+"/"+t[e].Path;if(this.isPropertyHidden(i)){return}var s=new a({src:{path:i},visible:{path:i,formatter:function(e){return!!e}},decorative:false});s.addStyleClass("sapUiIcon");s.addStyleClass("navigationPopoverThumbnail");o.observe(s,{properties:["visible"]});n.push(s)};v.prototype._addLabeledText=function(e,t,r,n,a,s){if(!r[e]){return}var p=n+"/"+r[e].Path;if(this.isPropertyHidden(p)){return}var u=new i({text:{path:p},visible:{path:p,formatter:function(e){return!!e}}});var d=new o({text:t,labelFor:u.getId()});s.observe(u,{properties:["visible"]});a.push(d);a.push(u)};v.prototype._addEmails=function(e,t,r,n,o,i){if(!e.email||!e.email.length){return}var a=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var s=f([],e.email);s.filter(function(e){return!e.processed&&e.type&&(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1||e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/work")>-1)}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return 1}return 0}).forEach(function(e){this.addProperty2ExpandAndSelect("address",e,t,r,n);this._addLabeledEmail("address",a.getText("POPOVER_CONTACT_SECTION_EMAIL"),e,t,o,i);e.processed=true},this)};v.prototype._addTels=function(e,t,r,n,o,i){if(!e.tel||!e.tel.length){return}var a=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var s=f([],e.tel);s.filter(function(e){return!e.processed&&e.type&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/work")>-1}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return 1}return 0}).forEach(function(e){this.addProperty2ExpandAndSelect("uri",e,t,r,n);this._addLabeledTel("uri",a.getText("POPOVER_CONTACT_SECTION_PHONE"),e,t,o,i);e.processed=true},this);s.filter(function(e){return!e.processed&&e.type&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/cell")>-1}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return 1}return 0}).forEach(function(e){this.addProperty2ExpandAndSelect("uri",e,t,r,n);this._addLabeledTel("uri",a.getText("POPOVER_CONTACT_SECTION_MOBILE"),e,t,o,i);e.processed=true},this);s.filter(function(e){return!e.processed&&e.type&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/fax")>-1}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return 1}return 0}).forEach(function(e){this.addProperty2ExpandAndSelect("uri",e,t,r,n);this._addLabeledTel("uri",a.getText("POPOVER_CONTACT_SECTION_FAX"),e,t,o,i);e.processed=true},this);s.filter(function(e){return!e.processed&&e.type&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1}).forEach(function(e){this.addProperty2ExpandAndSelect("uri",e,t,r,n);this._addLabeledTel("uri",a.getText("POPOVER_CONTACT_SECTION_PHONE"),e,t,o,i);e.processed=true},this)};v.prototype._addAddresses=function(e,t,r,n,o,i){if(!e.adr||!e.adr.length){return}var a=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var s=f([],e.adr);s.filter(function(e){return!e.processed&&e.type&&(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1||e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/work")>-1)}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return 1}return 0}).forEach(function(e){this._addLabeledAddress(a.getText("POPOVER_CONTACT_SECTION_ADR"),e,t,r,n,o,i);e.processed=true},this)};v.prototype._addLabeledAddress=function(e,t,r,n,a,s,p){var u=[];["street","code","locality","region","country"].forEach(function(e){this.addProperty2ExpandAndSelect(e,t,r,n,a);var o;if(t[e]){o=r+"/"+t[e].Path}u.push(o&&!this.isPropertyHidden(o)?{path:o}:{path:"$notExisting"})},this);if(!u.length){return}var d=new i({text:{parts:u,formatter:function(e,t,r,n,o){var i=[];if(e){i.push(e)}if(t&&r){i.push(t+" "+r)}else{if(t){i.push(t)}if(r){i.push(r)}}if(n){i.push(n)}if(o){i.push(o)}return i.join(", ")}},visible:{parts:u,formatter:function(e,t,r,n,o){return!!(e||t||r||n||o)}}});var l=new o({text:e,labelFor:d.getId()});p.observe(d,{properties:["visible"]});s.push(l);s.push(d)};v.prototype._addLabeledTel=function(e,t,r,n,i,a){if(!r[e]||!n){return}var p=n+"/"+r[e].Path;if(this.isPropertyHidden(p)){return}var u=new s({href:{path:p,formatter:function(e){return e?"tel:"+e:e}},text:{path:p},visible:{path:p,formatter:function(e){return!!e}}});var d=new o({text:t,labelFor:u.getId()});a.observe(u,{properties:["visible"]});i.push(d);i.push(u)};v.prototype._addLabeledEmail=function(e,t,r,n,i,a){if(!r[e]||!n){return}var p=n+"/"+r[e].Path;if(this.isPropertyHidden(p)){return}var u=new s({href:{path:p,formatter:function(e){return e?"mailto:"+e:e}},text:{path:p},visible:{path:p,formatter:function(e){return!!e}}});var d=new o({text:t,labelFor:u.getId()});a.observe(u,{properties:["visible"]});i.push(d);i.push(u)};v.prototype.addProperty2ExpandAndSelect=function(e,t,r,n,o){if(!t[e]||!r){return}var i=r+"/"+t[e].Path;if(!i){return}if(i.indexOf("/")!==0){throw"sap.ui.comp.navpopover.ContactDetailsController.addProperty2ExpandAndSelect: the path of sBindingPathOfProperty '"+i+"' is not valid."}var a=i.split("/");a.shift();a.shift();var s=a.join("/");if(s){o.push(s)}a.pop();var p=a.join("/");if(!p){return}var u=n.filter(function(e){return e===p});if(!u.length){n.push(p)}};v.prototype.isPropertyHidden=function(e){var t;if(!this.getModel()){d.error("sap.ui.comp.navpopover.ContactDetailsController.isPropertyHidden: the model does not exist");return false}if(!this.getModel().getMetaModel()){d.error("sap.ui.comp.navpopover.ContactDetailsController.isPropertyHidden: the model should be the ODataModel");return false}try{t=this.getModel().getMetaModel().getMetaContext(e)}catch(t){d.error("sap.ui.comp.navpopover.ContactDetailsController.isPropertyHidden: the path of property path '"+e+"' is not valid. Error has been caught: "+t);return false}var r=t.getProperty(t.getPath());return u.isHidden(r)};v.prototype._requestData=function(e,t,r,n){var o={};if(r.length){o.expand=r.join(",")}if(n.length){o.select=n.join(",")}var i="/"+t.split("/")[1];e.bindContext({path:i,parameters:o,events:{change:function(){e.invalidate()}}})};return v});