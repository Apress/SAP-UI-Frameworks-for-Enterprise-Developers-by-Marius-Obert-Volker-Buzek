/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/LocaleData","sap/ui/core/Configuration"],function(t,e,r){"use strict";var o=t.extend("sap.ui.comp.odata.FiscalFormat",{metadata:{library:"sap.ui.comp"},constructor:function(o,a){t.call(this,o,a);var s,n,i,p,f=r.getFormatSettings().getFormatLocale(),u=e.getInstance(f),l=r.getFormatSettings().getCustomLocaleData(),m=/(m|y)(?:.*)(\W)(m|y)/i,g=l["dateFormats-short"];this.oFormatOptions=a;if(this.oFormatOptions.format.length>4){s="yM"}else if(this.oFormatOptions.format==="PPP"){s="M"}else{s=this.oFormatOptions.format}if(g&&s==="yM"){p=g.match(m).splice(1).join("");if(p){n=p}}else{n=u.getCustomDateTimePattern(s,this.oFormatOptions.calendarType)}n=n.replace(/([\u4e00-\u9faf\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uffef])+/gi,"");if(this.oFormatOptions.format.length>4){n=n.replace(/y+/i,this.oFormatOptions.format.slice(0,this.oFormatOptions.format.lastIndexOf("Y")+1));n=n.replace(/m+/i,this.oFormatOptions.format.slice(this.oFormatOptions.format.lastIndexOf("Y")+1))}else if(this.oFormatOptions.format==="PPP"){n="PPP"}i=this.parseCldrDatePattern(n);this.oFormatOptions.pattern=i.length>1?n:"";this._setFormatRegex(i);this._setParseRegex(i);this._setValidationRegex(i)}});o.getDateInstance=function(t){return new o(null,t)};o.prototype.getPattern=function(){return this.oFormatOptions.pattern};o.prototype.getRegExPattern=function(){return this.sFormatRegExPattern};o.prototype.getTemplate=function(){return this.sFormatRegExGroups};o.prototype._setFormatRegex=function(t){var e=[],r=[],o,a,s,n,i;for(i=0;i<t.length;i++){o=t[i];a=o.symbol||"";s=this.oSymbols[a].format;if(a===""){r[i]=o.value}else if(a==="y"||a==="Y"){e.unshift("("+s.source+")");r[i]="$"+1}else{e.push("("+s.source+")");n=t.some(function(t){return t.symbol==="y"||t.symbol==="Y"});r[i]=n?"$"+2:"$"+1}}this.sFormatRegExPattern=new RegExp(e.join(""));this.sFormatRegExGroups=r.join("")};o.prototype._setParseRegex=function(t){var e,r,o,s,n,i=[],p={},f=0;for(s=0;s<t.length;s++){e=t[s];r=e.symbol||"";o=this.oSymbols[r].parse;if(r===""){i.push("\\D+?")}else{i.push("("+o.source+")");n=++f;p[n]=e}}this.sParseRegExPattern=new RegExp("^"+i.join("")+"$");this.fnParseRegExReplacer=function(){var t,e,r=[];for(var o in p){t=p[o];e=arguments[o];if(e.length<t.digits){if(t.symbol==="y"||t.symbol==="Y"){e=a(e)}else{e=e.padStart(t.digits,"0")}}if(t.symbol==="y"||t.symbol==="Y"){r.unshift(e)}else{r.push(e)}}return r.join("")}};o.prototype._setValidationRegex=function(t){var e,r,o,a,s=[];for(e=0;e<t.length;e++){r=t[e];o=r.symbol||"";a=this.oSymbols[o].format;if(o===""){continue}else if(o==="y"||o==="Y"){s.unshift(a.source)}else{s.push(a.source)}}this.sValidationRegExPattern=new RegExp("^("+s.join(")(")+")$")};o.prototype.parseCldrDatePattern=function(t){var e,r,o,a,s=[];for(e=0;e<t.length;e++){r=t[e];if(o!==r){a={}}else{a.digits+=1;continue}if(typeof this.oSymbols[r]==="undefined"){a.value=r;a.type="text"}else{a.symbol=r;a.digits=1}o=r;s.push(a)}return s};o.prototype.format=function(t){if(t==null){return""}return t.replace(this.sFormatRegExPattern,this.sFormatRegExGroups)};o.prototype.parse=function(t){if(t){return t.replace(this.sParseRegExPattern,this.fnParseRegExReplacer)}return null};o.prototype.validate=function(t){return this.sValidationRegExPattern.test(t)};o.oRegexFormatPatterns={year:/[1-9][0-9]{3}/,period:/[0-9]{3}/,quarter:/[1-4]/,week:/0[1-9]|[1-4][0-9]|5[0-3]/,day:/371|370|3[0-6][0-9]|[1-2][0-9][0-9]|[1-9][0-9]|[1-9]/};o.oRegexParsePatterns={year:/[0-9]{1,4}/,period:/[0-9]{1,3}/,quarter:/[1-4]/,week:/[0-9]{1,2}/,day:/[1-9]/};o.prototype.oSymbols={"":"",y:{format:o.oRegexFormatPatterns.year,parse:o.oRegexParsePatterns.year},Y:{format:o.oRegexFormatPatterns.year,parse:o.oRegexParsePatterns.year},P:{format:o.oRegexFormatPatterns.period,parse:o.oRegexParsePatterns.period},W:{format:o.oRegexFormatPatterns.week,parse:o.oRegexParsePatterns.week},d:{format:o.oRegexFormatPatterns.day,parse:o.oRegexParsePatterns.day},Q:{format:o.oRegexFormatPatterns.quarter,parse:o.oRegexParsePatterns.quarter},q:{format:o.oRegexFormatPatterns.quarter,parse:o.oRegexParsePatterns.quarter}};o.prototype.destroy=function(){t.prototype.destroy.apply(this,arguments);if(this._oAnnotationValidationRegexPattern){this._oAnnotationValidationRegexPattern=null}};function a(t){var e,r=Number.parseInt(t),o=(new Date).getUTCFullYear(),a=Math.floor(o/100);e=a*100+r-o;if(t.length===3){r+=Math.floor((a-1)/10)*1e3}else if(e<-70){r+=(a+1)*100}else if(e<30){r+=a*100}else{r+=(a-1)*100}return r}return o});