/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define([],function(){"use strict";var e={};e.applyChange=function(e,t,r){var n=e.getContent();var o=r.modifier;var i=r.appComponent;var l=r.view;var a=o.bySelector(n.sourceSelector,i,l);var s;var u=function(e,t){if(e.index>t.index){return 1}else if(e.index<t.index){return-1}};var g=o.bySelector(n.parentSelector,i,l);var c=n.newElementIds.slice();var p=[];var d;var f;var m;var v;return Promise.all([o.getAggregation(a,"elements"),o.getProperty(a,"elementForLabel"),o.getAggregation(g,"groupElements")]).then(function(e){d=e[0];f=e[1];m=e[2];v=m.indexOf(a);return o.getProperty(a,"label")}).then(function(e){if(e&&typeof e!=="string"){return o.getProperty(e,"text")}return e}).then(function(e){s=e;return d.reduce(function(e,t,n){if(n!==f){var u=c.pop();var d;return e.then(o.createControl.bind(o,"sap.ui.comp.smartform.GroupElement",r.appComponent,l,u)).then(function(e){d=e;p.push({groupElementSelector:o.getSelector(d,i),index:n});return Promise.resolve().then(o.removeAggregation.bind(o,a,"elements",t)).then(o.insertAggregation.bind(o,d,"elements",t,0,l)).then(o.insertAggregation.bind(o,g,"groupElements",d,v+n,l)).then(o.getProperty.bind(o,d,"label")).then(function(e){if(e&&typeof e!=="string"){o.setProperty(e,"text",s)}else{o.setProperty(d,"label",s)}})})}else{p.push({groupElementSelector:o.getSelector(a,i),index:n});if(f!==0){o.setProperty(a,"elementForLabel",0)}return e.then(o.removeAggregation.bind(o,a,"elements",t)).then(o.insertAggregation.bind(o,a,"elements",t,0,l)).then(o.getProperty.bind(o,a,"label")).then(function(e){if(e&&typeof e!=="string"){o.setProperty(e,"text",s)}else{o.setProperty(a,"label",s)}})}},Promise.resolve())}).then(function(){e.setRevertData({sourceControlSelector:n.sourceSelector,labelText:s,splittedFields:p.sort(u)})})};e.completeChangeContent=function(e,t,r){var n=r.modifier;var o=r.appComponent;var i={};if(t.newElementIds){i.newElementIds=t.newElementIds.slice(0,-1)}else{throw new Error("oSpecificChangeInfo.newElementIds attribute required")}if(t.sourceControlId){i.sourceSelector=n.getSelector(t.sourceControlId,o);e.addDependentControl(t.sourceControlId,"sourceControl",r)}else{throw new Error("oSpecificChangeInfo.sourceControlId attribute required")}if(t.parentId){i.parentSelector=n.getSelector(t.parentId,o);e.addDependentControl(t.parentId,"parent",r)}else{throw new Error("oSpecificChangeInfo.parentId attribute required")}e.setContent(i)};e.revertChange=function(e,t,r){var n=r.view;var o=r.modifier;var i=r.appComponent;var l=e.getRevertData();var a=l.splittedFields;var s=o.bySelector(l.sourceControlSelector,i,n);return a.reduce(function(e,t){var r=o.bySelector(t.groupElementSelector,i,n);return e.then(o.getAggregation.bind(o,r,"elements")).then(function(e){var i=e[0];return Promise.resolve().then(o.removeAggregation.bind(o,r,"elements",i)).then(o.insertAggregation.bind(o,s,"elements",i,t.index,n))}).then(function(){if(r!==s){o.destroy(r)}})},Promise.resolve()).then(o.getProperty.bind(o,s,"label")).then(function(t){if(t&&typeof t!=="string"){o.setProperty(t,"text",l.labelText)}else{o.setProperty(s,"label",l.labelText)}e.resetRevertData()})};e.getChangeVisualizationInfo=function(e){return{affectedControls:[e.getContent().sourceSelector],dependentControls:e.getContent().newElementIds}};return e},true);