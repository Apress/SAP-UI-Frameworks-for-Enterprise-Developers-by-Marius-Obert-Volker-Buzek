/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier"],function(e,n){"use strict";var r={};r._checkCompleteChangeContentConditions=function(e){if(!e.movedElements){throw new Error("oSpecificChangeInfo.movedElements attribute required")}if(e.movedElements.length===0){throw new Error("MovedElements array is empty")}e.movedElements.forEach(function(e){if(!e.id){throw new Error("MovedElements element has no id attribute")}if(typeof e.targetIndex!=="number"){throw new Error("Index attribute at MovedElements element is no number")}})};r._buildStableChangeInfo=function(e){var n=e.source.id;var r=e.target.id;var t={changeType:e.changeType,selector:{id:n},targetId:r!==n?r:null};t[e.changeType]=[];e.movedElements.forEach(function(n){t[e.changeType].push({id:n.id,sourceIndex:n.sourceIndex,index:n.targetIndex})});return t};r.applyChange=function(n,r,t){function o(n,t){if(!n){return Promise.reject(new Error("No change instance"))}var o=n.getContent();return Promise.resolve().then(t.getAggregation.bind(t,r,"groups")).then(function(n){if(!n){e.error("Object has no smartform elements aggregation",t.getId(r))}if(!o||!o.moveGroups||o.moveGroups.length===0){return Promise.reject(new Error("Change format invalid"))}return undefined})}function i(e,n,r,t){if(!e.selector&&!e.id){return Promise.reject(new Error("Change format invalid - moveGroups element has no id attribute"))}if(typeof e.index!=="number"){return Promise.reject(new Error("Change format invalid - moveGroups element index attribute is no number"))}return Promise.resolve(n.bySelector(e.selector||e.id,r,t))}var u=t.modifier;var a=t.view;var s=t.appComponent;var d=[];function c(n,t){if(!t){return Promise.resolve(e.warning("Group to move not found"))}return Promise.resolve().then(u.findIndexInParentAggregation.bind(u,t)).then(function(e){if(e===n.index&&typeof n.sourceIndex==="number"){e=n.sourceIndex}d.push({selector:u.getSelector(t,s),index:e})}).then(u.removeAggregation.bind(u,r,"groups",t,a)).then(u.insertAggregation.bind(u,r,"groups",t,n.index))}return o(n,u).then(function(){var e=n.getContent();return e.moveGroups.reduce(function(e,n){return e.then(i.bind(null,n,u,s,a)).then(function(e){return c(n,e)})},Promise.resolve())}).then(function(){n.setRevertData({movedGroups:d})})};r.completeChangeContent=function(e,r,t){this._checkCompleteChangeContentConditions(r);r=this._buildStableChangeInfo(r);var o={moveGroups:[]};var i=r.moveGroups.map(function(e){var r=sap.ui.getCore().byId(e.id);var i=n.getSelector(r,t.appComponent);o.moveGroups.push({selector:i,sourceIndex:e.sourceIndex,index:e.index});return r});e.addDependentControl(i,"movedGroups",t);e.setContent(o)};r.revertChange=function(e,n,r){var t=r.appComponent;var o=r.view;var i=r.modifier;var u=e.getRevertData().movedGroups;return u.reduce(function(e,r){var u=i.bySelector(r.selector,t,o);return e.then(i.removeAggregation.bind(i,n,"groups",u,o)).then(i.insertAggregation.bind(i,n,"groups",u,r.index))},Promise.resolve()).then(function(){e.resetRevertData()})};r.getChangeVisualizationInfo=function(e){var n=e.getContent();return{affectedControls:[n.moveGroups[0].selector],dependentControls:[n.moveGroups[0].selector.source||e.getSelector()]}};return r},true);