/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/fl/changeHandler/Base","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/comp/smartform/flexibility/changes/AddFields"],function(e,r,t){"use strict";var i={};i.applyChange=function(r,i,n){var l=r.getTexts();var o=r.getContent();var a=function(){var e=l&&l.fieldLabel&&l.fieldLabel.value;var r=o;var t=false;if(r){t=o.field&&(o.field.selector||o.field.id)&&o.field.jsType&&o.field.value&&o.field.valueProperty}return e&&r&&t};var f=n.modifier;var d=n.appComponent;var u=n.view;if(a()){var s=o.field.selector;var p=o.field.id;var c=l.fieldLabel.value;var v=o.field.jsType;var C=o.field.valueProperty;var g=o.field.value;var h=o.field.entitySet;var y=o.field.index;if(f.bySelector(s||p,d,u)){return e.markAsNotApplicable("Control to be created already exists:"+s||p,true)}return Promise.resolve().then(f.createControl.bind(f,"sap.ui.comp.smartform.GroupElement",d,u,s||p)).then(function(e){if(!s){s=f.getSelector(p,d)}r.setRevertData({newFieldSelector:s});f.setProperty(e,"label",undefined);f.setProperty(e,"label",c);return Promise.resolve().then(f.insertAggregation.bind(f,i,"groupElements",e,y,u)).then(function(){return t.addElementIntoGroupElement(f,u,e,v,C,g,h,y,d)})})}return Promise.resolve()};i.completeChangeContent=function(e,t,i){var n=i.appComponent;if(t.fieldLabel){e.setText("fieldLabel",t.fieldLabel,"XFLD")}else{throw new Error("oSpecificChangeInfo.fieldLabel attribute required")}var l={field:{}};if(t.fieldValue){l.field.value=t.fieldValue}else{throw new Error("oSpecificChangeInfo.fieldValue attribute required")}if(t.valueProperty){l.field.valueProperty=t.valueProperty}else{throw new Error("oSpecificChangeInfo.valueProperty attribute required")}if(t.newControlId){l.field.selector=r.getSelector(t.newControlId,n,{index:t.index})}else{throw new Error("oSpecificChangeInfo.newControlId attribute required")}if(t.jsType){l.field.jsType=t.jsType}else{throw new Error("oSpecificChangeInfo.jsType attribute required")}if(t.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required")}else{l.field.index=t.index}if(t.entitySet){l.field.entitySet=t.entitySet}e.setContent(l)};i.revertChange=function(e,r,i){return t.revertChange(e,r,i)};i.getChangeVisualizationInfo=function(e){return{affectedControls:[e.getContent().field.selector]}};return i},true);