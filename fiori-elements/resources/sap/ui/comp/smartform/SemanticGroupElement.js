/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/core/Control","sap/ui/layout/form/SemanticFormElement","sap/m/Label","sap/ui/comp/smartfield/SmartLabel","sap/ui/comp/smartfield/SmartField","sap/base/Log"],function(e,t,i,a,r,o,l){"use strict";var s;var n;var u=e.smartfield.ControlContextType;var h=i.extend("sap.ui.comp.smartform.SemanticGroupElement",{metadata:{library:"sap.ui.comp",interfaces:["sap.ui.comp.IFormGroupElement"],properties:{elementForLabel:{type:"int",group:"Misc",defaultValue:0}},defaultAggregation:"elements",aggregations:{elements:{type:"sap.ui.core.Control",multiple:true,singularName:"element"}},events:{visibleChanged:{}}},_bVisibleElements:false});function p(e,i){if(e==this._oSetLabelFromOutside){return}var a;if(this._oSetLabelFromOutside&&this._oSetLabelFromOutside instanceof t){a=m.call(this._oSetLabelFromOutside)}if(!a){a=m.call(this)}if(a){if(e instanceof r){if(i&&i.setTooltipLabel){i.setTooltipLabel(a)}}else{e.setTooltip(a)}}}function m(){var e=this.getTooltip();if(!e||typeof e==="string"||e instanceof String){return e}else{return e.getText()}}function f(e){if(e.getParameter("name")=="text"){var t=e.oSource;var i=t.getText();if(this._oLabel){this._oLabel.setText(i)}var a=this._getFieldRelevantForLabel();if(a&&a.getComputedTextLabel){if(!a._oTextLabelSetBySemanticGroupElement){a._oTextLabelSetBySemanticGroupElement={oldText:a.getComputedTextLabel()}}a.setTextLabel(i)}}}function b(){if(this.getRequired&&this.getRequired()){return true}var e=this.getParent();var t=e.getElements();for(var i=0;i<t.length;i++){var a=t[i];if(a.getRequired&&a.getRequired()===true&&(!a.getEditable||a.getEditable())&&(!a.getContextEditable||a.getContextEditable())){return true}}return false}function d(){if(this.getDisplayOnly){if(!this.isPropertyInitial("displayOnly")){return this.getDisplayOnly()}var e=this.getParent();var t=e.getParent();if(t){var i=t.getParent();if(i){return!i.getEditable()}}}return false}function c(){var e=this.getParent();if(e._oSetLabelFromOutside&&!(typeof e._oSetLabelFromOutside==="string")&&e._oSetLabelFromOutside.getWrapping&&!e._oSetLabelFromOutside.isPropertyInitial("wrapping")){return e._oSetLabelFromOutside.getWrapping()}return true}function g(e,t){if(e._oTextLabelSetBySemanticGroupElement){if(e.getComputedTextLabel()==t){e.setTextLabel(e._oTextLabelSetBySemanticGroupElement.oldText)}delete e._oTextLabelSetBySemanticGroupElement}}function L(e){e._bCreatedBySemanticGroupElement=true;e.isRequired=b;e.isDisplayOnly=d;e.isWrapping=c;return e}function y(e){if(e.getEditable){if(!e.getEditable()){e.data("editable",false)}}this._oObserver.observe(e,{properties:["visible"]});if(e.attachInnerControlsCreated){e.attachInnerControlsCreated(this._updateFormElementLabel,this)}if(e.setControlContext){e.setControlContext(u.Form)}if(e.getMetadata().getProperty("mandatory")){this._oObserver.observe(e,{properties:["mandatory"]})}E.call(this,e,this.getProperty("_editable"));S.call(this,e);if(e.isA("sap.ui.comp.smartfield.SmartField")&&e._isInnerControlCreationDelayed&&e.getMode()==="display"){e._forceInitialise()}if(e.isA("sap.ui.comp.smartfield.SmartField")){e.attachInnerControlsCreated(function(){this._observeChanges({object:e,name:"visible"});e.getInnerControls().forEach(function(t){var i=t.getBinding("text");if(i){i.attachChange(function(){this._observeChanges({object:e,name:"visible"})}.bind(this))}}.bind(this))}.bind(this))}}function _(e){if(e.name=="mandatory"){this.invalidateLabel()}else if(e.name=="visible"){this._updateFormElementVisibility()}}function v(){this.fireVisibleChanged({visible:this.isVisible()});if(this.getParent()){this.getParent()._updateLineBreaks()}}function F(e){var t=this.getElements();for(var i=0;i<t.length;i++){var a=t[i];E.call(this,a,e)}}function E(e,t){if(e instanceof o){if(!(e.data("editable")===false)){e.setContextEditable(t)}}}function S(e){if(e instanceof o){var t=this.getCustomData();for(var i=0;i<t.length;i++){O.call(this,e,t[i])}}}function C(e,t){if(e instanceof o){var i=e.getCustomData();for(var a=0;a<i.length;a++){var r=i[a];if(r._bFromSemanticGroupElement&&(!t||t==r._sOriginalId)){e.removeCustomData(r);r.destroy()}}}}function O(t,i){if(t instanceof o&&e.smartform.inheritCostomDataToFields(i)&&!t.data(i.getKey())){var a=i.clone();a._bFromSemanticGroupElement=true;a._sOriginalId=i.getId();t.addCustomData(a)}}function x(e){if(e.detachInnerControlsCreated){e.detachInnerControlsCreated(this._updateFormElementLabel,this)}if(e.setControlContext){e.setControlContext(u.None)}C.call(this,e);g.call(this,e,this.getLabelText())}h.prototype.init=function(){i.prototype.init.apply(this,arguments);this._oObserver.observe(this,{properties:["elementForLabel","_editable","delimiter"]})};h.prototype._getFieldRelevantForLabel=function(){var e=this.getElements();var t=this.getElementForLabel();if(e.length>t&&e[t]instanceof o){return e[t]}return null};h.prototype._extractFields=function(e,t){var i=[];e.forEach(function(e){i.push(e)});if(t){i=i.filter(function(e){return!(e instanceof a)})}return i};h.prototype._observeChanges=function(e){i.prototype._observeChanges.apply(this,arguments);if(e.object==this){switch(e.name){case"useHorizontalLayout":l.error("useHorizontalLayout can't be used with SemanticGroupElement",this);break;case"elementForLabel":this.updateLabelOfFormElement();break;case"_editable":F.call(this,e.current);break;default:break}}else{_.call(this,e)}};h.prototype._getLabel=function(){if(this._oLabel){return this._oLabel}else{return this._oSetLabelFromOutside}};h.prototype._createLabel=function(e){var t=null;var i=this._getFieldRelevantForLabel();if(i){if(i.getShowLabel&&i.getShowLabel()){t=new r(i.getId()+"-label");if(e){if(!i._oTextLabelSetBySemanticGroupElement){i._oTextLabelSetBySemanticGroupElement={oldText:i.getComputedTextLabel()}}i.setTextLabel(e);t.setText(e)}t.setLabelFor(i)}}else{t=new a(this.getId()+"-label",{text:e})}if(t){t=L(t);this._oLabel=t;this.setAggregation("_label",t,true);if(this._oSetLabelFromOutside&&typeof this._oSetLabelFromOutside!=="string"){this._oSetLabelFromOutside.setAlternativeLabelFor(null)}}return t};h.prototype._updateFormElementLabel=function(e){var t=this._getFieldRelevantForLabel();var i=this._getLabel();var a=e.oSource;var o=e.getParameters();if(i instanceof r&&a&&o&&a===t){i.updateLabelFor(o)}};h.prototype._updateFormElementVisibility=function(){var e=this.getVisibleBasedOnElements();if(this._bVisibleElements!==e){this._bVisibleElements=e;if(this.isPropertyInitial("visible")){v.call(this);this.invalidate()}}};h.prototype._updateGridDataSpan=function(){};h.prototype._setLinebreak=function(e,t,i,a){var r=this.getFields();if(r.length>0){var o=r[0];if(!(o instanceof s)){return}var l=o.getLayoutData();if(l instanceof n){l.setLinebreakXL(e);l.setLinebreakL(t);l.setLinebreakM(i);l.setLinebreakS(a)}}};h.prototype.setTooltip=function(e){i.prototype.setTooltip.apply(this,[e]);var t=this._getFieldRelevantForLabel();var a=this._getLabel();p.call(this,a,t);return this};h.prototype.setLabel=function(e){if(this._oSetLabelFromOutside&&typeof this._oSetLabelFromOutside!=="string"){this._oSetLabelFromOutside.detachEvent("_change",f,this)}var t;var a;var o;if(typeof e==="string"){t=this._getLabel();if(t){a=t.getText()}}else if(!e&&this._oSetLabelFromOutside){a=this.getLabelText()}i.prototype.setLabel.apply(this,[e]);this._oSetLabelFromOutside=e;if(typeof e==="string"){if(this._oLabel instanceof r&&e!=a&&(e.length>0||a.length>0)){o=this._getFieldRelevantForLabel();if(o&&e!=null){if(o.getComputedTextLabel){if(!o._oTextLabelSetBySemanticGroupElement){o._oTextLabelSetBySemanticGroupElement={oldText:o.getComputedTextLabel()}}o.setTextLabel(e)}}}this.setAggregation("_label",this._oLabel,true);this._oLabel.isRequired=b;this._oLabel.isDisplayOnly=d}else{if(e){if(e.isRequired){e.isRequired=b}if(e.isDisplayOnly){e.isDisplayOnly=d}e.attachEvent("_change",f,this)}else{o=this._getFieldRelevantForLabel();if(o){g.call(this,o,a)}}this.updateLabelOfFormElement()}return this};h.prototype.destroyLabel=function(){var e=this.getLabelText();i.prototype.destroyLabel.apply(this);delete this._oSetLabelFromOutside;var t=this._getFieldRelevantForLabel();if(t){g.call(this,t,e)}this.updateLabelOfFormElement();return this};h.prototype.getLabel=function(){return this._oSetLabelFromOutside};h.prototype.getLabelControl=function(){return this._getLabel()};h.prototype.getLabelText=function(){var e="";var t=this._getLabel();if(t){e=t.getText()}return e};h.prototype.getDataSourceLabel=function(){var e=this._getFieldRelevantForLabel();if(e&&e.isA("sap.ui.comp.smartfield.SmartField")){return e.getDataSourceLabel()}};h.prototype.updateLabelOfFormElement=function(){var e=false,t=null;var a=this.getElements();var o=this._getFieldRelevantForLabel();var l=this._getLabel();var s=false;if(l&&l._bCreatedBySemanticGroupElement){if(l instanceof r){if(!o||l._sSmartFieldId&&l._sSmartFieldId!=o.getId()){s=true}}else if(o){s=true}if(s){l.destroy();delete this._oLabel;l=null;if(this._oSetLabelFromOutside&&!o){if(typeof this._oSetLabelFromOutside==="string"){i.prototype.setLabel.apply(this,[this._oSetLabelFromOutside]);l=this._oLabel;this._oLabel.isRequired=b;this._oLabel.isDisplayOnly=d}else{l=this._oSetLabelFromOutside}}}}else if(l&&o){if(l==this._oLabel){l.destroy();delete this._oLabel}l=null}if(!l){if(this._oSetLabelFromOutside){if(typeof this._oSetLabelFromOutside==="string"){t=this._oSetLabelFromOutside}else{t=this._oSetLabelFromOutside.getText()}}else{t=""}}if(!l&&a.length>0){l=this._createLabel(t);e=true}if(l){if(l instanceof r){if(o&&o.setTextLabel&&o.getComputedTextLabel()){l.setText(o.getComputedTextLabel())}}p.call(this,l,o)}if(e){if(l&&l.setLabelFor&&!(l instanceof r)&&!o&&a.length>0){l.setLabelFor(a[0])}}};h.prototype.invalidateLabel=function(){var e=this._getLabel();if(e){e.invalidate()}};h.prototype.getUseHorizontalLayout=function(){l.error("getUseHorizontalLayout can't be used with SemanticGroupElement",this)};h.prototype.setUseHorizontalLayout=function(){l.error("setUseHorizontalLayout can't be used with SemanticGroupElement",this)};h.prototype.getHorizontalLayoutGroupElementMinWidth=function(){l.error("getHorizontalLayoutGroupElementMinWidth can't be used with SemanticGroupElement",this)};h.prototype.setHorizontalLayoutGroupElementMinWidth=function(){l.error("setHorizontalLayoutGroupElementMinWidth can't be used with SemanticGroupElement",this)};h.prototype.setVisible=function(e){var t=this.isVisible();i.prototype.setVisible.apply(this,arguments);if(t!=e){v.call(this)}return this};h.prototype.isVisible=function(){if(this.isPropertyInitial("visible")){return this._bVisibleElements}else{return this.getVisible()}};h.prototype.getVisibleBasedOnElements=function(){var e=false;var t=this.getElements();if(t&&t.length>0){e=t.some(function(e){return e.getVisible()})}return e};h.prototype.getFormElement=function(){return this};h.prototype.addElement=function(e){if(!e){return this}e=this.validateAggregation("elements",e,true);y.call(this,e);var t;if(this._oLabel&&this._oLabel._bCreatedBySemanticGroupElement&&this._oLabel._sSmartFieldId){t=this._oLabel._sSmartFieldId}this.addField(e);if(t&&t!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(t)}this.updateLabelOfFormElement();this._updateFormElementVisibility();return this};h.prototype.insertElement=function(e,t){if(!e){return this}e=this.validateAggregation("elements",e,true);y.call(this,e);var i;if(this._oLabel&&this._oLabel._bCreatedBySemanticGroupElement&&this._oLabel._sSmartFieldId){i=this._oLabel._sSmartFieldId}this.insertField(e,t);if(i&&i!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(i)}this.updateLabelOfFormElement();this._updateFormElementVisibility();return this};h.prototype.getElements=function(){var e;e=this.getFields();return e};h.prototype.indexOfElement=function(e){var t=-1;t=this.indexOfField(e);return t};h.prototype.removeElement=function(e){var t;var i;if(this._oLabel&&this._oLabel._bCreatedBySemanticGroupElement&&this._oLabel._sSmartFieldId){i=this._oLabel._sSmartFieldId}t=this.removeField(e);if(t){x.call(this,t)}if(i&&i!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(i)}this.updateLabelOfFormElement();this._updateFormElementVisibility();return t};h.prototype.removeAllElements=function(){var e=this.removeAllFields();if(e&&Array.isArray(e)){for(var t=0;t<e.length;t++){x.call(this,e[t])}}this.updateLabelOfFormElement();this._updateFormElementVisibility();return e};h.prototype.destroyElements=function(){this.destroyFields();this.updateLabelOfFormElement();this._updateFormElementVisibility();return this};h.prototype.addCustomData=function(e){if(!e){return this}i.prototype.addCustomData.apply(this,arguments);var t=this.getElements();for(var a=0;a<t.length;a++){O.call(this,t[a],e)}return this};h.prototype.insertCustomData=function(e,t){if(!e){return this}i.prototype.insertCustomData.apply(this,arguments);var a=this.getElements();for(var r=0;r<a.length;r++){O.call(this,a[r],e)}return this};h.prototype.removeCustomData=function(e){var t=i.prototype.removeCustomData.apply(this,arguments);if(t){var a=this.getElements();for(var r=0;r<a.length;r++){C.call(this,a[r],t.getId())}}return t};h.prototype.removeAllCustomData=function(){var e=i.prototype.removeAllCustomData.apply(this,arguments);if(e.length>0){var t=this.getElements();for(var a=0;a<t.length;a++){C.call(this,t[a])}}return e};h.prototype.destroyCustomData=function(){i.prototype.destroyCustomData.apply(this,arguments);var e=this.getElements();for(var t=0;t<e.length;t++){C.call(this,e[t])}return this};h.prototype.clone=function(e,t){var a=this.removeAllElements();var r=i.prototype.clone.apply(this,arguments);for(var o=0;o<a.length;o++){var l=a[o];var s=l.clone(e,t);this.addElement(l);r.addElement(s)}return r};return h});