/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log","sap/base/strings/capitalize","sap/ui/dom/containsOrEquals","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/ui/core/delegate/ItemNavigation","./CarouselRenderer","sap/ui/Device","sap/ui/events/KeyCodes","sap/ui/core/Configuration","sap/ui/dom/jquery/Selectors","sap/ui/dom/jquery/Focusable"],function(t,e,i,s,o,n,a,r,l,h,d,u){"use strict";var c=o.enums.Orientation;var f=n.extend("sap.ui.commons.Carousel",{metadata:{library:"sap.ui.commons",deprecated:true,properties:{orientation:{type:"sap.ui.commons.enums.Orientation",group:"Misc",defaultValue:c.horizontal},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},defaultItemHeight:{type:"int",group:"Misc",defaultValue:150},defaultItemWidth:{type:"int",group:"Misc",defaultValue:150},animationDuration:{type:"int",group:"Misc",defaultValue:500},visibleItems:{type:"int",group:"Misc",defaultValue:null},handleSize:{type:"int",group:"Misc",defaultValue:22},firstVisibleIndex:{type:"int",group:"Appearance",defaultValue:0}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content",bindable:"bindable"}}}});f.prototype.init=function(){this._visibleItems=0;this.data("sap-ui-fastnavgroup","true",true)};f.prototype.exit=function(){if(this.sResizeListenerId){a.deregister(this.sResizeListenerId);this.sResizeListenerId=null}this._destroyItemNavigation()};f.prototype.onclick=function(t){switch(t.target){case this.getDomRef("prevbutton"):this.showPrevious();break;case this.getDomRef("nextbutton"):this.showNext();break;default:return}};f.prototype.onBeforeRendering=function(){if(this.sResizeListenerId){a.deregister(this.sResizeListenerId);this.sResizeListenerId=null}};f.prototype.onAfterRendering=function(){if(this.getOrientation()=="vertical"){this._sAnimationAttribute="margin-top"}else{if(u.getRTL()){this._sAnimationAttribute="margin-right"}else{this._sAnimationAttribute="margin-left"}}this.showElementWithId(this._getItemIdByIndex(this.getFirstVisibleIndex()));this.calculateAndSetSize();this.oDomRef=this.getDomRef();this.sResizeListenerId=a.register(this.oDomRef,t.proxy(this.onresize,this));this._initItemNavigation()};f.prototype._initItemNavigation=function(){var t=this.$("scrolllist");if(!this._oItemNavigation){this._oItemNavigation=new r;this._oItemNavigation.setCycling(true);this.addDelegate(this._oItemNavigation);this._oItemNavigation.attachEvent(r.Events.AfterFocus,function(t){var e=this.$("contentarea"),i=this.$("scrolllist");var s=t.getParameter("event");if(s&&s.type=="mousedown"){var o=false;for(var n=0;n<i.children().length;n++){var a=i.children()[n];if(s.target.id==a.id){o=true;break}}if(!o){s.target.focus()}}if(u.getRTL()){e.scrollLeft(i.width()-e.width())}else{e.scrollLeft(0)}},this)}this._oItemNavigation.setRootDomRef(t[0]);this._oItemNavigation.setItemDomRefs(t.children())};f.prototype._destroyItemNavigation=function(){if(this._oItemNavigation){this._oItemNavigation.destroy();this._oItemNavigation=undefined}};f.prototype.onThemeChanged=function(t){this.calculateAndSetSize()};f.prototype.onfocusin=function(e){var i=t(e.target);if(!this._bIgnoreFocusIn&&(i.hasClass("sapUiCrslBefore")||i.hasClass("sapUiCrslAfter"))){this._leaveActionMode();t(this._oItemNavigation.getFocusedDomRef()||this._oItemNavigation.getRootDomRef()).trigger("focus")}};f.prototype.onsaptabnext=function(t){var e=this.$();if(this._bActionMode){if(e.find(".sapUiCrslScl").lastFocusableDomRef()===t.target){e.find(".sapUiCrslScl").firstFocusableDomRef().focus();t.preventDefault();t.stopPropagation()}}else{if(this._oItemNavigation.getFocusedDomRef()===t.target){this._bIgnoreFocusIn=true;e.find(".sapUiCrslAfter").trigger("focus");this._bIgnoreFocusIn=false}}};f.prototype.onsaptabprevious=function(t){var e=this.$();if(this._bActionMode){if(e.find(".sapUiCrslScl").firstFocusableDomRef()===t.target){e.find(".sapUiCrslScl").lastFocusableDomRef().focus();t.preventDefault();t.stopPropagation()}}else{if(this._oItemNavigation.getFocusedDomRef()===t.target&&s(e.find(".sapUiCrslScl").get(0),t.target)){this._bIgnoreFocusIn=true;e.find(".sapUiCrslBefore").trigger("focus");this._bIgnoreFocusIn=false}}};f.prototype.onsapescape=function(t){this._leaveActionMode(t)};f.prototype.onsapnext=function(e){var i=t(e.target);var s=this.$("scrolllist");s.stop(true,true);if(i.hasClass("sapUiCrslItm")&&i.nextAll(":visible").length<2){this.showNext();e.preventDefault()}};f.prototype.onsapprevious=function(e){var i=t(e.target);var s=this.$("scrolllist");s.stop(true,true);if(i.hasClass("sapUiCrslItm")&&i.prevAll(":visible").length<2){this.showPrevious();e.preventDefault()}};f.prototype.onkeydown=function(t){var e=this.$();if(!this._bActionMode&&t.keyCode==d.F2||t.keyCode==d.ENTER){if(e.find(".sapUiCrslScl li:focus").length>0){this._enterActionMode(e.find(".sapUiCrslScl li:focus :sapFocusable").get(0));t.preventDefault();t.stopPropagation()}}else if(this._bActionMode&&t.keyCode==d.F2){this._leaveActionMode(t)}};f.prototype.onmouseup=function(t){if(this.$().find(".sapUiCrslScl li :focus").length>0){this._enterActionMode(this.$().find(".sapUiCrslScl li :focus").get(0))}else{this._leaveActionMode(t)}};if(h.support.touch){f.prototype.onswipeleft=function(t){this.showNext()};f.prototype.onswiperight=function(t){this.showPrevious()}}f.prototype._enterActionMode=function(e){if(e&&!this._bActionMode){this._bActionMode=true;this.removeDelegate(this._oItemNavigation);t(this._oItemNavigation.getFocusedDomRef()).attr("tabindex","-1");this.$("scrolllist").attr("aria-activedescendant",t(this._oItemNavigation.getFocusedDomRef()).attr("id"));t(e).trigger("focus")}};f.prototype._leaveActionMode=function(e){if(this._bActionMode){this._bActionMode=false;this.addDelegate(this._oItemNavigation);t(this._oItemNavigation.getFocusedDomRef()).attr("tabindex","0");this.$("scrolllist").removeAttr("aria-activedescendant");if(e){if(t(e.target).closest("li[tabindex=-1]").length>0){var i=t(this._oItemNavigation.aItemDomRefs).index(t(e.target).closest("li[tabindex=-1]").get(0));this._oItemNavigation.focusItem(i,null)}else{if(s(this.$().find(".sapUiCrslScl").get(0),e.target)){this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex(),null)}}}else{this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex(),null)}}};f.prototype.onresize=function(t){if(!this.getDomRef()){if(this.sResizeListenerId){a.deregister(this.sResizeListenerId);this.sResizeListenerId=null}return}this.calculateAndSetSize()};f.prototype.showPrevious=function(){var t=this,e={},i=this.$("scrolllist");var s,o;e[this._sAnimationAttribute]=0;if(i.children("li").length<2){return}i.stop(true,true);i.css(this._sAnimationAttribute,-this._iMaxWidth);s=i.children("li:last");o=i.children("li:first");this._showAllItems();s.insertBefore(o);i.append(s.sapExtendedClone(true));i.animate(e,this.getAnimationDuration(),function(){i.children("li:last").remove();t.setProperty("firstVisibleIndex",t._getContentIndex(i.children("li:first").attr("id")),true);t._hideInvisibleItems()})};f.prototype.showNext=function(){var e=this,i={},s=this._sAnimationAttribute,o=this.$("scrolllist");var n;i[this._sAnimationAttribute]=-this._iMaxWidth;if(o.children("li").length<2){return}o.stop(true,true);this._showAllItems();n=o.children("li:first");n.appendTo(o);n.sapExtendedClone(true).insertBefore(o.children("li:first"));o.animate(i,this.getAnimationDuration(),function(){o.children("li:first").remove();t(this).css(s,"0px");e.setProperty("firstVisibleIndex",e._getContentIndex(o.children("li:first").attr("id")),true);e._hideInvisibleItems()})};f.prototype.showElementWithId=function(t){this._showAllItems();var e=this.$("scrolllist"),i;i=e.children("li").index(this.getDomRef("item-"+t));e.children("li:lt("+i+")").appendTo(e);this._hideInvisibleItems()};f.prototype.calculateAndSetSize=function(){var t=this._getDimensions();var e=t.maxWidth;var s=t.maxHeight;var o;var n=this.getVisibleItems();var a=this.$();var r=this.$("nextbutton");var l=this.$("prevbutton");var h=this.$("contentarea");this._showAllItems();if(this.getContent().length<=0){return}if(this.getWidth()&&this.getOrientation()=="vertical"){e=a.width()}if(this.getHeight()&&this.getOrientation()=="horizontal"){s=a.height()}this.$().addClass("sapUiCrsl"+i(this.getOrientation()));if(this.getOrientation()=="horizontal"){o=a.width()-this.getHandleSize()*2-1;h.css("left",this.getHandleSize()+"px").css("right",this.getHandleSize()+"px");if(n==0){n=Math.floor(o/e)}e=o/n;this._iMaxWidth=e;var d=s+"px";h.find(".sapUiCrslItm").css("width",e+"px").css("height",s+"px").css("display","inline-block");l.css("height",s).css("line-height",d);r.css("height",s).css("line-height",d);h.height(s);a.height(s);var u=this.getContent().length<n?this.getContent().length:n;if(this.getWidth()){a.width(this.getWidth())}else{var c=a.width()-(e*u+(this.getHandleSize()*2-1));if(c>5){a.width(e*u+(this.getHandleSize()*2-1))}}}else{o=a.height()-this.getHandleSize()*2-1;h.css("top",this.getHandleSize()+"px").css("bottom",this.getHandleSize()+"px");if(n==0){n=Math.floor(o/s)}s=o/n;this._iMaxWidth=s;h.find(".sapUiCrslItm").css("width",e+"px").css("height",s+"px").css("display","block");l.width(e).after(h);r.width(e);h.width(e);a.width(e)}this._visibleItems=n;this._hideInvisibleItems()};f.prototype._getDimensions=function(){var t=this.getContent();var e=0;var i=0;for(var s=0;s<t.length;s++){var o,n;try{o=t[s].getWidth();if(o.substr(-1)=="%"){o=this.getDefaultItemWidth()}}catch(t){o=this.getDefaultItemWidth()}try{n=t[s].getHeight();if(n.substr(-1)=="%"){n=this.getDefaultItemHeight()}}catch(t){n=this.getDefaultItemHeight()}e=Math.max(e,parseInt(o));i=Math.max(i,parseInt(n))}if(e==0||isNaN(e)){e=this.getDefaultItemWidth()}if(i==0||isNaN(i)){i=this.getDefaultItemHeight()}return{maxWidth:e,maxHeight:i}};f.prototype.getFocusDomRef=function(){return this.$("scrolllist")[0]};f.prototype._showAllItems=function(){var t=this.$("contentarea");t.find(".sapUiCrslItm").show().css("display","inline-block")};f.prototype._hideInvisibleItems=function(){var t=this.$("contentarea");t.find(".sapUiCrslItm:gt("+(this._visibleItems-1)+")").hide()};f.prototype._getContentIndex=function(e){var i=e.split("-item-");return t.inArray(sap.ui.getCore().byId(i[1]),this.getContent())};f.prototype._getItemIdByIndex=function(t){var e=this.getContent()[t];if(!e){return null}return e.getId()};f.prototype.setFirstVisibleIndex=function(t){if(t>this.getContent().length-1){e.warning("The index is invalid. There are less items available in the carousel.");return this}this.setProperty("firstVisibleIndex",t,true);this.showElementWithId(this._getItemIdByIndex(t));if(this._oItemNavigation){this._oItemNavigation.focusItem(t)}return this};
//Licensed under the terms of the MIT source code license
(function(e){t.fn.sapExtendedClone=function(){var i=e.apply(this,arguments);var s=this.find("textarea").add(this.filter("textarea"));var o=i.find("textarea").add(i.filter("textarea"));var n=this.find("select").add(this.filter("select"));var a=i.find("select").add(i.filter("select"));for(var r=0,l=s.length;r<l;++r){t(o[r]).val(t(s[r]).val())}for(var r=0,l=n.length;r<l;++r){a[r].selectedIndex=n[r].selectedIndex}return i}})(t.fn.clone);return f});