/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler","sap/ui/core/Core"],function(e,t,n){"use strict";var i=e.extend("sap.ui.vk.RedlineDesignHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(e){this._redlineDesign=e;this._x=0;this._y=0;this._gesture=false}});i.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false};i.prototype._getOffset=function(e){var t=e.getBoundingClientRect();return{x:t.left+window.pageXOffset,y:t.top+window.pageYOffset}};i.prototype._inside=function(e,t){var n=t.getDomRef(),i=false;if(n!==null){var r=this._getOffset(n);var s={x:r.x,y:r.y,width:n.getBoundingClientRect().width,height:n.getBoundingClientRect().height};i=e.x>=s.x&&e.x<=s.x+s.width&&e.y>=s.y&&e.y<=s.y+s.height}return i};i.prototype._onresize=function(e){this._gesture=false};i.prototype.beginGesture=function(e){var t=this.getViewport();if(this._inside(e,t)&&t._activeElementInstance){this._gesture=true;this._x=e.x;this._y=e.y;t._isDrawingOn=true;var i=t.getDomRef();var r=t._toVirtualSpace(e.x-i.getBoundingClientRect().left-window.pageXOffset,e.y-i.getBoundingClientRect().top-window.pageYOffset);t._activeElementInstance.setOriginX(r.x);t._activeElementInstance.setOriginY(r.y);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){t.invalidate()}else{var s=n.createRenderManager();t._activeElementInstance.render(s);s.flush(t.getDomRef(),false,true);s.destroy();var a=t.$();a.html(a.html())}e.handled=true}return this};i.prototype.move=function(e){var t=this.getViewport();if(t._activeElementInstance&&t._isDrawingOn){var n=t.getDomRef().getBoundingClientRect(),i=e.x-n.left-window.pageXOffset,r=e.y-n.top-window.pageYOffset;t._activeElementInstance.edit(i,r);e.handled=true}return this};i.prototype.endGesture=function(e){var t=this.getViewport();this._gesture=false;if(t._activeElementInstance){t.addRedlineElement(t._activeElementInstance);t.fireElementCreated({element:t._activeElementInstance});t.stopAdding();e.handled=true}return this};i.prototype.contextMenu=function(e){e.handled=true};i.prototype.getViewport=function(){return this._redlineDesign};return i});