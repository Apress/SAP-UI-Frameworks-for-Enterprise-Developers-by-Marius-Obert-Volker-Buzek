/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/Log","./glMatrix","./AnimationTrackType","./AnimationTrackValueType"],function(a,t,e,r){"use strict";var i="sap.ui.vk.AnimationMath";var n={};n.clamp11=function(a){return Math.max(-1,Math.min(1,a))};n.neutralAngleAxisToGlMatrixQuat=function(a){return t.quat.setAxisAngle(t.quat.create(),t.vec3.fromValues(a[0],a[1],a[2]),a[3])};n.neutralEulerToGlMatrixQuat=function(a){var e=1,r=1,i=1,n=1;switch(a[3]){case 6:r=-1;n=-1;break;case 18:r=-1;i=-1;break;case 33:e=-1;n=-1;break;case 36:e=-1;i=-1;break;case 24:i=-1;n=-1;break;case 9:e=-1;r=-1;break;default:}var l=a[0];var u=a[1];var s=a[2];var o=Math.cos(l/2);var v=Math.sin(l/2);var c=Math.cos(u/2);var h=Math.sin(u/2);var M=Math.cos(s/2);var f=Math.sin(s/2);var m=v*c*M+e*o*h*f;var b=o*h*M+r*v*c*f;var p=o*c*f+i*v*h*M;var k=o*c*M+n*v*h*f;return t.quat.fromValues(m,b,p,k)};n.threeQuatToNeutralEuler=function(a,e){var r=t.mat4.fromQuat(t.mat4.create(),t.quat.fromValues(a.x,a.y,a.z,a.w));var i=r[0],l=r[4],u=r[8];var s=r[1],o=r[5],v=r[9];var c=r[2],h=r[6],M=r[10];var f=0,m=0,b=0;var p=.9999999;switch(e){case 6:m=Math.asin(n.clamp11(u));if(Math.abs(u)<p){f=Math.atan2(-v,M);b=Math.atan2(-l,i)}else{f=Math.atan2(h,o)}break;case 18:f=Math.asin(-n.clamp11(v));if(Math.abs(v)<p){m=Math.atan2(u,M);b=Math.atan2(s,o)}else{m=Math.atan2(-c,i)}break;case 33:f=Math.asin(n.clamp11(h));if(Math.abs(h)<p){m=Math.atan2(-c,M);b=Math.atan2(-l,o)}else{b=Math.atan2(s,i)}break;case 36:m=Math.asin(-n.clamp11(c));if(Math.abs(c)<p){f=Math.atan2(h,M);b=Math.atan2(s,i)}else{b=Math.atan2(-l,o)}break;case 24:b=Math.asin(n.clamp11(s));if(Math.abs(s)<p){f=Math.atan2(-v,o);m=Math.atan2(-c,i)}else{m=Math.atan2(u,M)}break;case 9:b=Math.asin(-n.clamp11(l));if(Math.abs(l)<p){f=Math.atan2(h,o);m=Math.atan2(u,i)}else{f=Math.atan2(-v,M)}break;default:}var k=[f,m,b,e];return k};n.neutralQuatToGlMatrixQuat=function(a){return t.quat.fromValues(a[0],a[1],a[2],a[3])};n.glMatrixQuatToNeutral=function(a){return[a[0],a[1],a[2],a[3]]};n.getModulatedAngularValue=function(a){return a-a%(2*Math.PI)};n.equalMatrices=function(a,t,e){for(var r=0;r<a.elements.length;r++){if(Math.abs(a.elements[r]-t.elements[r])>e){return false}}return true};n.interpolate=function(){var l=t.quat;var u=t.vec3;var s=l.create();var o=l.create();var v=u.create();return function(c,h,M,f,m,b,p){var k=h.value;var g=M.value;var T={};var A;var d;var x;var y=1e-4;switch(c){case r.Quaternion:A=n.neutralQuatToGlMatrixQuat(k);d=n.neutralQuatToGlMatrixQuat(g);x=t.quat.slerp(t.quat.create(),A,d,f);if(p!=null){x=t.quat.multiply(t.quat.create(),x,t.quat.invert(t.quat.create(),n.neutralQuatToGlMatrixQuat(p)))}T.value=n.glMatrixQuatToNeutral(x);break;case r.Euler:var Q=[n.interpolateScalarLinear(k[0],g[0],f),n.interpolateScalarLinear(k[1],g[1],f),n.interpolateScalarLinear(k[2],g[2],f),k[3]];if(p!=null){Q[0]-=p[0];Q[1]-=p[1];Q[2]-=p[2]}T[r.Euler]=Q;x=n.neutralEulerToGlMatrixQuat(Q);T.value=n.glMatrixQuatToNeutral(x);break;case r.AngleAxis:var q;var z;var L;var S;var w;var G;var V;l.identity(s);if(p===true){for(z=m.getKeysCount()-1;z>=0;z--){q=m.getKey(z);if(q===M){break}l.setAxisAngle(o,u.copy(v,q.value),-q.value[3]);l.multiply(s,o,s)}S=g[0];w=g[1];G=g[2];V=(f-1)*g[3]}else{for(z=0,L=m.getKeysCount();z<L;z++){q=m.getKey(z);if(q===M){break}l.setAxisAngle(o,u.copy(v,q.value),q.value[3]);l.multiply(s,o,s)}S=g[0];w=g[1];G=g[2];V=f*g[3]}T[r.AngleAxis]=[S,w,G,V];l.setAxisAngle(o,u.set(v,S,w,G),V);l.multiply(s,o,s);T.value=n.glMatrixQuatToNeutral(s);break;case r.Vector3:T.value=[n.interpolateScalarLinear(k[0],g[0],f),n.interpolateScalarLinear(k[1],g[1],f),n.interpolateScalarLinear(k[2],g[2],f)];if(p!=null){switch(b){case e.Translate:T.value[0]-=p[0];T.value[1]-=p[1];T.value[2]-=p[2];break;case e.Scale:if(Math.abs(p[0])<y||Math.abs(p[1])<y||Math.abs(p[2])<y){a.error("The scale factor for reverse relative animation is too small","["+p[0]+", "+p[1]+", "+p[2]+"]",i)}else{T.value[0]/=p[0];T.value[1]/=p[1];T.value[2]/=p[2]}break;default:break}}break;default:T.value=n.interpolateScalarLinear(k,g,f);if(p!=null){switch(b){case e.Opacity:if(Math.abs(p)<y){a.warning("The opacity factor for reverse relative animation is too small","["+p+"]",i)}else{T.value/=p}break;default:break}}break}return T}}();n.interpolateScalarLinear=function(a,t,e){return a+e*(t-a)};n.cartesianToPolar=function(a){var t={azimuth:0,elevation:0,radius:1};if(Array.isArray(a)&&a.length===3){var e=a[0];var r=a[1];var i=a[2];var n=e*e+i*i;if(n>0){t.azimuth=Math.acos(i/Math.sqrt(n))*(e<0?-1:1)}t.radius=Math.sqrt(e*e+r*r+i*i);if(t.radius>0){t.elevation=Math.asin(r/t.radius)}}return t};n.polarToCartesian=function(a){var t=[0,0,1];var e="radius"in a?a.radius:1;t[0]=e*Math.cos(a.elevation)*Math.sin(a.azimuth);t[1]=e*Math.sin(a.elevation);t[2]=e*Math.cos(a.elevation)*Math.cos(a.azimuth);return t};n.cartesianToPolar=function(a){var t={azimuth:0,elevation:0,radius:1};if(Array.isArray(a)&&a.length===3){var e=a[0];var r=a[1];var i=a[2];var n=e*e+i*i;if(n>0){t.azimuth=Math.acos(i/Math.sqrt(n))*(e<0?-1:1)}t.radius=Math.sqrt(e*e+r*r+i*i);if(t.radius>0){t.elevation=Math.asin(r/t.radius)}}return t};n.polarToCartesian=function(a){var t=[0,0,1];var e="radius"in a?a.radius:1;t[0]=e*Math.cos(a.elevation)*Math.sin(a.azimuth);t[1]=e*Math.sin(a.elevation);t[2]=e*Math.cos(a.elevation)*Math.cos(a.azimuth);return t};return n});