/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/ManagedObject","./Messages","./getResourceBundle","sap/base/util/array/uniqueSort","sap/base/Log"],function(e,r,t,n,a){"use strict";var i=e.extend("sap.ui.vk.NodeHierarchy",{metadata:{library:"sap.ui.vk",abstract:true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeReplaced:{parameters:{ReplacedNodeRef:{type:"any"},ReplacementNodeRef:{type:"any"},ReplacedNodeId:{type:"string"},ReplacementNodeId:{type:"string"}}},nodeUpdated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});i.prototype.findNodesById=function(e){if(e.fields.some(function(e){return!e.caseSensitive})){e=jQuery.extend(true,{},e);e.fields.forEach(function(e){if(!e.caseSensitive){e.value=e.value.toLowerCase()}})}var n=function(e,n,i,s){var o;e=e||"equals";s=s||"";var d=n?i:i.toLowerCase();switch(e){case"equals":o=d===s;break;case"contains":o=d.indexOf(s)!==-1;break;case"startsWith":o=d.indexOf(s)===0;break;default:o=false;a.error(t().getText(r.VIT8.summary),r.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy")}return o};var i=function(e,r){return!e.some(function(e){return r.name===e.name?n(r.predicate,r.caseSensitive,e.value,r.value):false})};var s=function(e,r){return e.source===r.source&&e.type===r.type&&!e.fields.some(i.bind(undefined,r.fields))};var o=this.findNodesByName();var d=o.filter(function(r){var t=this.createNodeProxy(r);var n=t.getVeIds();this.destroyNodeProxy(t);return n.some(s.bind(undefined,e))}.bind(this));return d};i.prototype.findNodesByMetadata=function(e){var i=function(e,r,t,n,a,i){if(e&&e.hasOwnProperty(r)){var s=e[r];if(s.hasOwnProperty(t)){var o=s[t];if(!i){o=o.toLowerCase()}return n.some(a.bind(undefined,o))}}return false};var s=function(e,r){return e&&e.hasOwnProperty(r)};var o=function(e,r,t,n,a,i,s){var o=this._baseNodeProxyPool.borrowObject();var d=e.filter(function(e){o.init(this,e);var d=o.getNodeMetadata();var u=r(d,t,n,a,i,s);o.reset();return u}.bind(this));this._baseNodeProxyPool.returnObject(o);return d};var d=this.findNodesByName(),u=[];if(e===undefined||e===null||jQuery.isEmptyObject(e)){u=d}else if(e.category!==null&&e.category!==undefined&&e.category!==""){var c,f,y,l,p=!!(e&&e.caseSensitive);if(e.key===undefined||e.key===null){c=s}else{f=e.value;y=e.predicate||"equals";if(f===undefined||f===null){f="";y="contains"}if(!Array.isArray(f)){f=[f]}if(!p){f=f.map(function(e){return e.toLowerCase()})}switch(y){case"equals":l=function(e,r){return e===r};break;case"contains":l=function(e,r){return e.indexOf(r)!==-1};break;case"startsWith":l=function(e,r){return e.indexOf(r)===0};break;default:a.error(t().getText(r.VIT9.summary),r.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy")}c=i}u=o.bind(this)(d,c,e.category,e.key,f,l,p)}else{a.error(t().getText(r.VIT10.summary),r.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy")}return n(u)};i.prototype._appendAncestors=function(e,r){r=r?new Set(r):null;var t=new Set(e);e.forEach(function(e){var n=this.getAncestors(e);n.forEach(function(e){if(r===null||!r.has(e)){t.add(e)}})},this);return Array.from(t)};return i});