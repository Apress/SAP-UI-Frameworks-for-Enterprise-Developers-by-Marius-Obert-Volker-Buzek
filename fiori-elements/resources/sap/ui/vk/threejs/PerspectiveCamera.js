/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../PerspectiveCamera","../thirdparty/three"],function(t,e){"use strict";var a=t.extend("sap.ui.vk.threejs.PerspectiveCamera",{metadata:{library:"sap.ui.vk"}});var i=t.getMetadata().getParent().getClass().prototype;a.prototype.init=function(){if(i.init){i.init.call(this)}var t=1;var a=1e4;this._nativeCamera=new e.PerspectiveCamera(30,1,t,a);this._nativeCamera.position.set(0,0,100);this.setUsingDefaultClipPlanes(true)};a.prototype.update=function(t,e){var a=this._nativeCamera.aspect;var i=this._nativeCamera.zoom;this._nativeCamera.aspect=t/e;this._nativeCamera.zoom=Math.min(this._nativeCamera.aspect,1);var r=this._nativeCamera.view;if(r&&r.enabled){var n=t/r.fullWidth;var o=e/r.fullHeight;var s=this._nativeCamera.zoom/i;var p=s*a/this._nativeCamera.aspect;r.offsetX=(r.offsetX*p+(r.fullWidth-r.width)*(1-p)*.5)*n;r.offsetY=(r.offsetY*s+(r.fullHeight-r.height)*(1-s)*.5)*o;r.width*=n;r.height*=o;r.fullWidth=t;r.fullHeight=e}this._nativeCamera.updateProjectionMatrix()};a.prototype.exit=function(){if(i.exit){i.exit.call(this)}this._nativeCamera=null};a.prototype.getFov=function(){return this._nativeCamera.fov};a.prototype.setFov=function(t){this._nativeCamera.fov=t;this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getCameraRef=function(){return this._nativeCamera};a.prototype.setCameraRef=function(t){this._nativeCamera=t;return this};a.prototype.getNearClipPlane=function(){return this._nativeCamera.near};a.prototype.setNearClipPlane=function(t){this._nativeCamera.near=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getFarClipPlane=function(){return this._nativeCamera.far};a.prototype.setFarClipPlane=function(t){this._nativeCamera.far=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getPosition=function(){return this._nativeCamera.position.toArray()};a.prototype.setPosition=function(t){this._nativeCamera.position.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray()};a.prototype.setUpDirection=function(t){this._nativeCamera.up.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getTargetDirection=function(){return this._nativeCamera.getWorldDirection(new e.Vector3).toArray()};a.prototype.setTargetDirection=function(t){var a=(new e.Vector3).fromArray(t);a.add(this._nativeCamera.position);this._nativeCamera.lookAt(a);return this};a.prototype.setUsingDefaultClipPlanes=function(t){this._nativeCamera.userData.usingDefaultClipPlanes=t;return this};a.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes};a.prototype.adjustClipPlanes=function(t){var e=this._nativeCamera;e.updateMatrixWorld();t=t.clone().applyMatrix4(e.matrixWorldInverse);e.near=-t.max.z;e.far=-t.min.z;var a=Math.max(Math.max(e.far-e.near,e.far)*.0025,.001);e.near-=a;e.far+=a;e.near=Math.max(e.near,a);e.far=Math.max(e.far,e.near+a);var i=-(e.far+e.near)/(e.far-e.near);var r=-2*e.far*e.near/(e.far-e.near);e.projectionMatrix.elements[10]=i;e.projectionMatrix.elements[14]=r;e.projectionMatrixInverse.copy(e.projectionMatrix).invert();return this};return a});