/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/Object","../thirdparty/three","../HighlightDisplayState"],function(t,e,i){"use strict";var s=t.extend("sap.ui.vk.threejs.HighlightPlayer",{constructor:function(){this._state=i.stopped;this._startTime=0;this._timeElapsed=0;this._highlightsNodesMap=new Map}});s.prototype.reset=function(t,e){this.stop();this._highlightsNodesMap.clear();this._state=i.stopped;if(t&&e){var s=t.getHighlightIdNodesMap();var a=this;s.forEach(function(t,i){var s=e.getHighlight(i);a.addHighlights(s,t)})}return this};s.prototype.setViewStateManager=function(t){this._viewStateManager=t};s.prototype.addHighlights=function(t,e){if(t&&e&&e.length){this._highlightsNodesMap.set(t,{nodes:e})}};s.prototype.start=function(t){if(this._state===i.pausing){this._startTime=t-this._timeElapsed}else{this._startTime=t;this._timeElapsed=0}this._state=i.playing;var e=this._viewStateManager;this._highlightsNodesMap.forEach(function(t,i){var s=[];t.nodes.forEach(function(t){while(t){if(!t.visible){e.setVisibilityState(t,true,false);s.push(t)}t=t.parent}});t.hiddenNodes=s.length>0?s:undefined})};s.prototype.play=function(t){if(this._state!==i.playing){return false}this._timeElapsed=t-this._startTime;var e=this;var s=[];this._highlightsNodesMap.forEach(function(t,i){var a=i.getColour(e._timeElapsed/1e3);var h=t.nodes,n;if(a!==undefined){for(n=0;n<h.length;n++){h[n]._vkSetHighlightColor(a.colour)}}var o=i.getOpacity(e._timeElapsed/1e3);if(o!==undefined){for(n=0;n<h.length;n++){h[n]._vkSetOpacity(o.opacity)}if(o.isCompleted&&i.isFadeOut()&&t.hiddenNodes!==undefined){e._viewStateManager.setVisibilityState(t.hiddenNodes,false,false)}}if((a===undefined||a.isCompleted)&&(o===undefined||o.isCompleted)){s.push(i)}});s.forEach(function(t){e._highlightsNodesMap.delete(t)});if(this._highlightsNodesMap.size===0){this._state=i.stopped;return false}return true};s.prototype.stop=function(t){this._timeElapsed=0;this._startTime=0;var e=this;this._highlightsNodesMap.forEach(function(t,i){var s=t.nodes;for(var a=0;a<s.length;a++){var h=s[a];h._vkSetHighlightColor(undefined);h._vkSetOpacity(undefined)}if(i.isFadeOut()&&s.hiddenNodes!=undefined){e._viewStateManager.setVisibilityState(s.hiddenNodes,false,false)}});this._state=i.stopped;return this};s.prototype.pause=function(t){if(this._state===i.stopped){return this}this._timeElapsed=t-this._startTime;this._state=i.pausing;return this};return s});