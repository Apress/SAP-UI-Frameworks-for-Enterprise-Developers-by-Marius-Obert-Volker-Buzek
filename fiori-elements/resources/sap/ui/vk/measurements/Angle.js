/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./Measurement","./MeasurementType","./Utils"],function(t,i,e){"use strict";var o=function(i){t.apply(this,arguments);this._angle=i&&"angle"in i?i.angle:0;this._state=i&&"state"in i?i.state:0;this._scale=i&&"scale"in i?i.scale:1;this._point1=i&&"point1"in i?i.point1.slice():[0,0,0];this._point2=i&&"point2"in i?i.point2.slice():[0,0,0];this._point3=i&&"point3"in i?i.point3.slice():[0,0,0];this._point4=i&&"point4"in i?i.point4.slice():[0,0,0]};o.prototype=Object.create(t.prototype);o.prototype.constructor=o;o.prototype.isAngle=true;t._classMap.set(i.Angle,o);o.prototype.getAngle=function(){return this._angle};o.prototype.setAngle=function(t){this._angle=t;return this};o.prototype.getState=function(){return this._state};o.prototype.setState=function(t){this._state=t;return this};o.prototype.getPoint1=function(){return this._point1};o.prototype.setPoint1=function(t){var i=this._point1;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.setPoint2=function(t){var i=this._point2;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.setPoint3=function(t){var i=this._point3;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.setPoint4=function(t){var i=this._point4;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.getRadiusScale=function(){return this._scale};o.prototype.setRadiusScale=function(t){this._scale=t;return this};o.prototype.setAngleRadius=function(t,i,o,n,r,s){var a=e.computeEdgeDirection(i,t);var p=e.computeEdgeDirection(n,r);var c=e.computeEdgeDirection(o,s);var u=e.computePointToPointDistance(s,o);var h=e.computePointToPointDistance(r,o);var l=e.computePointToPointDistance(n,o);if(l>h){h=l}var v=h>0?u/h:1;var _=e.angleBetweenVectors2D(a[0],a[1],c[0],c[1]);var f=e.angleBetweenVectors2D(a[0],a[1],p[0],p[1]);if(_<0){_+=2*Math.PI}if(f<0){f+=2*Math.PI;if(_<f){v=-v}}else if(_>f){v=-v}return this.setRadiusScale(v)};o.prototype.toString=function(){return"{ visible: "+this._visible+", angle: "+this._angle+", state: "+this._state+", scale: "+this._scale+", p1: ["+this._point1.join(", ")+"]"+", p2: ["+this._point2.join(", ")+"]"+", p3: ["+this._point3.join(", ")+"]"+", p4: ["+this._point4.join(", ")+"]"+" }"};o.prototype.isEdge1Defined=function(){var t=this._point1;var i=this._point2;var e=t[0]-i[0];var o=t[1]-i[1];var n=t[2]-i[2];return Math.sqrt(e*e+o*o+n*n)>1e-5};o.prototype.isEdge2Defined=function(){var t=this._point3;var i=this._point4;var e=t[0]-i[0];var o=t[1]-i[1];var n=t[2]-i[2];return Math.sqrt(e*e+o*o+n*n)>1e-5};o.prototype.getPoints=function(){var t=this._point1;var i=this._point2;var o=this._point3;var n=this._point4;var r=t;var s=i;var a=i;var p=i;var c=i;var u=i;var h;if(e.computePointToPointDistance2(t,i)>0&&e.computePointToPointDistance2(o,n)>0){var l=e.findClosestPointEdgeToEdge([t[0],t[1],t[2],i[0],i[1],i[2]],[o[0],o[1],o[2],n[0],n[1],n[2]]);a=[l[0],l[1],l[2]];u=[l[3],l[4],l[5]];var v=e.computeEdgeDirection(t,i);var _=e.computeEdgeDirection(o,n);var f=e.compareNormal(v,_,true)?null:e.findClosestPointLineToLine([t[0],t[1],t[2],i[0],i[1],i[2]],[o[0],o[1],o[2],n[0],n[1],n[2]]);if(f){h=e.computePointToPointDistance2(t,a)>e.computePointToPointDistance2(i,a);r=h?t:i;s=h?i:t;h=e.computePointToPointDistance2(o,u)>e.computePointToPointDistance2(n,u);p=h?n:o;c=h?o:n}else if(e.compareNormal(v,_,false)){p=o;c=n}else{p=n;c=o}}return[r[0],r[1],r[2],s[0],s[1],s[2],a[0],a[1],a[2],u[0],u[1],u[2],p[0],p[1],p[2],c[0],c[1],c[2]]};o.prototype.computeAngle=function(){var t=this._point1;var i=this._point2;var o=this._point3;var n=this._point4;if(e.computePointToPointDistance2(t,i)>0&&e.computePointToPointDistance2(o,n)>0){var r=e.computeEdgeDirection(i,t);var s=e.computeEdgeDirection(o,n);var a=e.dotProduct(r,s);this.setAngle(Math.acos(a))}else{this.setAngle(0)}};o.prototype.toJSON=function(){return{type:i.Angle,id:this._id,visible:this._visible,angle:this._angle,state:this._state,scale:this._scale,point1:Array.from(this._point1),point2:Array.from(this._point2),point3:Array.from(this._point3),point4:Array.from(this._point4),features:this._features.map(function(t){return t!=null?t.toJSON():null})}};return o});