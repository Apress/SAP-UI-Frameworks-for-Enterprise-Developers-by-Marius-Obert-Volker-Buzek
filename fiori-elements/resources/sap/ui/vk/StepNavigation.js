/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Control","./library","./Core","./Messages","./DvlException","./ContentConnector","./StepNavigationRenderer","./dvl/GraphicsCoreApi","./dvl/getPointer","./dvl/getJSONObject","./dvl/Scene","./getResourceBundle","sap/base/Log","sap/ui/core/Core"],function(e,t,s,o,n,r,i,a,p,u,l,c,d,h){"use strict";var g=e.extend("sap.ui.vk.StepNavigation",{metadata:{library:"sap.ui.vk",properties:{settings:"object",width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},showThumbnails:{type:"boolean",group:"Appearance",defaultValue:true},showToolbar:{type:"boolean",group:"Appearance",defaultValue:true},showStepInfo:{type:"boolean",group:"Appearance",defaultValue:false}},publicMethods:["setScene","playStep","pauseStep","playAllSteps","getStep","getNextStep","getPreviousStep","getProceduresAndSteps","refresh","clear"],associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"}},aggregations:{procedureItemTemplate:{type:"sap.ui.core.Item",multiple:false},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},layout:{type:"sap.m.Toolbar",multiple:false},thumbnailsContainer:{type:"sap.m.ScrollContainer",multiple:false}},events:{resize:{parameters:{oldSize:"object",size:"object"}},stepChanged:{parameters:{clientId:"object",type:"object",stepId:"object"}}}},constructor:function(t,o){e.apply(this,arguments);s.observeAssociations(this)}});g.prototype._onStepEvent=function(e){var t=this.getSettings();this.instanceSettings.currentStepId=e.stepId;switch(e.type){case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_FINISHED:t.currentStepFinished=true;t.currentStepPaused=false;t.playAllActive=false;t.isPlaying=false;this._togglePlayPause(true);break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_SWITCHED:case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED:t.currentStepId=e.stepId;t.currentStepFinished=false;this._highlightStep(e.stepId);if(t.currentStepPaused){this.pauseStep()}break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_PLAYING:if(this.getShowStepInfo()&&this.stepMessagePopup&&!this.stepMessagePopup.isOpen()){this._highlightStep(e.stepId)}break;default:d.error(c().getText(o.VIT12.summary),o.VIT12.code,"sap.ui.vk.StepNavigation")}this.fireStepChanged({clientId:e.clientId,type:e.type,stepId:e.stepId})};g.prototype.setScene=function(e){if(this._scene){this.oDvl.Client.detachStepEvent(this._onStepEvent,this);this.oDvl=null}if(e){var t=e.getMetadata().getName();if(t!=="sap.ui.vk.dvl.Scene"){return}}this._scene=e;this.instanceSettings={};if(this._scene){this.oDvl=e.getGraphicsCore().getApi(a.LegacyDvl);this.oDvl.Client.attachStepEvent(this._onStepEvent,this)}delete this._procedures;var s=this.getProcedureList();var o=this.getSettings();o.reset();s.unbindItems();s.setSelectedItem(s.getFirstItem());if(o.stepInfo.stepMessagePopup){if(o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close()}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"))}var n=this._getStepThumbnails();this.oModel.setData(n);this._togglePlayPause(true);this._refreshControl();this.refresh()};g.prototype.init=function(){this._emptyThumbnail="iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRm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";if(e.prototype.init){e.prototype.init.call(this)}if(this.getSettings()==undefined){this.setSettings(new this._settings)}this._scene=null;this.oModel=new sap.ui.model.json.JSONModel;this.setModel(this.oModel);this._layout=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid});this.setAggregation("layout",this._layout);if(this.getShowThumbnails()){this._thumbnailsScroller=new sap.m.ScrollContainer(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false});this.setAggregation("thumbnailsContainer",this._thumbnailsScroller)}this.playPreviousButton=new sap.m.Button(this.getId()+"-playPreviousButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-left",tooltip:c().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(e){var t=this.getSettings();var s=this.getPreviousStep(t.currentProcedureIndex);if(s){t.currentStepPaused=false;this.playStep(s.id,true,t.playAllActive);this._togglePlayPause(false)}}.bind(this)});this.playNextButton=new sap.m.Button(this.getId()+"-playNextButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-right",tooltip:c().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(e){var t=this.getSettings();var s=this.getNextStep(t.currentProcedureIndex);if(s){t.currentStepPaused=false;this.playStep(s.id,true,t.playAllActive);this._togglePlayPause(false)}}.bind(this)});this.playOptionButton=new sap.m.Button(this.getId()+"-playOptionButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-play",tooltip:c().getText("STEP_NAV_PLAYBUTTON_PLAY"),visible:true,press:function(e){var t=this.getPlayMenuButton().getSelectedKey();var s=this.getSettings();var o=null;switch(t){case"0":if(!s.currentStepId){o=this.getNextStep(s.currentProcedureIndex);if(o){s.currentStepId=o.id}else{return}}s.playAllActive=false;this.playStep(s.currentStepId,!s.currentStepPaused,s.playAllActive);s.isPlaying=true;s.currentStepPaused=false;this._togglePlayPause(false);break;case"1":s.playAllActive=true;s.currentStepPaused=false;this.playAllSteps(s.currentProcedureId);s.isPlaying=true;this._togglePlayPause(false);break;case"2":if(!s.currentStepId){o=this.getNextStep(s.currentProcedureIndex);if(o){s.currentStepId=o.id}else{return}}s.playAllActive=true;var n=!s.currentStepPaused;s.currentStepPaused=false;this.playStep(s.currentStepId,n,s.playAllActive);s.isPlaying=true;this._togglePlayPause(false);break;default:break}}.bind(this)});this.procedureList=new sap.m.Select(this.getId()+"-procedureList",{tooltip:c().getText("STEP_NAV_PROCEDURESLISTHEADING"),selectedKey:"0",type:sap.m.SelectType.Default,enabled:true,width:"30%",autoAdjustWidth:true,change:function(e){var t=this.getProcedureList();var s=this.getSettings();s.currentProcedureIndex=0;s.currentProcedureId=this.instanceSettings.currentProcedureId=t.getSelectedKey();s.currentStepId=this.instanceSettings.currentStepId=null;for(var o=0;o<this.oModel.oData.procedures.length;o++){if(this.oModel.oData.procedures[o].id==s.currentProcedureId){s.currentProcedureIndex=o;s.currentProcedure=this.oModel.oData.procedures[o];break}}if(s.stepInfo.stepMessagePopup){if(s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null}this._refreshItems()}.bind(this)});this.procedureList.addStyleClass("sapVizKitStepNavigationProcedureList");this.setAggregation("procedureItemTemplate",(new sap.ui.core.ListItem).bindProperty("text","name").bindProperty("key","id").bindProperty("tooltip","name"));this.playMenuButton=new sap.m.Select(this.getId()+"-playMenuButtonIcon",{selectedKey:"0",type:sap.m.SelectType.Default,tooltip:c().getText("STEP_NAV_PLAYMENU_PLAYOPTIONS"),enabled:true,autoAdjustWidth:false,items:[new sap.ui.core.ListItem({key:"0",icon:"sap-icon://media-play",text:c().getText("STEP_NAV_PLAYMENU_PLAY"),tooltip:c().getText("STEP_NAV_PLAYMENU_PLAY")}),new sap.ui.core.ListItem({key:"1",icon:"sap-icon://media-play",text:c().getText("STEP_NAV_PLAYMENU_PLAYALL"),tooltip:c().getText("STEP_NAV_PLAYMENU_PLAYALL")}),new sap.ui.core.ListItem({key:"2",icon:"sap-icon://media-play",text:c().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"),tooltip:c().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING")})]});this.playMenuButton.addStyleClass("sapVizKitStepNavigationPlayOptionsSelect");this.pauseButton=new sap.m.Button(this.getId()+"-pauseButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-pause",visible:false,tooltip:c().getText("STEP_NAV_PLAYMENU_PAUSE"),press:function(e){var t=this.getSettings();this.pauseStep();t.currentStepPaused=true;t.isPlaying=false;this._togglePlayPause(true)}.bind(this)});this.showStepInfoButton=new sap.m.ToggleButton(this.getId()+"-showStepInfoButton",{icon:"sap-icon://hide",type:sap.m.ButtonType.Transparent,pressed:false,text:c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),tooltip:c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),press:function(e){var t=e.getSource();if(t.getPressed()){this.setShowStepInfo(true);t.setIcon("sap-icon://show");t.setTooltip(c().getText("STEP_NAV_HIDESTEPDESCRIPTIONBUTTON"));var s=this.getSettings();if(s.currentStepId){this._highlightStep(s.currentStepId)}}else{this.setShowStepInfo(false);t.setIcon("sap-icon://hide");t.setTooltip(c().getText("STEP_NAV_SHOWSTEPDESCRIPTIONBUTTON"));if(this.stepMessagePopup&&this.stepMessagePopup.isOpen()){this.stepMessagePopup.close()}}}.bind(this)});this._layout.addContent(this.playPreviousButton).addContent(this.playOptionButton).addContent(this.pauseButton).addContent(this.playMenuButton).addContent(this.procedureList).addContent(this.showStepInfoButton).addContent(new sap.m.ToolbarSpacer).addContent(this.playNextButton)};g.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};g.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};g.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};g.prototype.getScroller=function(){return this._thumbnailsScroller};g.prototype.getProcedureList=function(){var e=this.getId()+"-procedureList";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPlayMenuButton=function(){var e=this.getId()+"-playMenuButtonIcon";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPlayOptionButton=function(){var e=this.getId()+"-playOptionButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPauseButton=function(){var e=this.getId()+"-pauseButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPlayNextButton=function(){var e=this.getId()+"-playNextButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPlayPreviousButton=function(){var e=this.getId()+"-playPreviousButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getShowStepInfoButton=function(){var e=this.getId()+"-showStepInfoButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype._settings=function(){return{enabled:false,toggle:{addCss:function(e,t,s,o){if(!this.targets[e]){this.targets[e]={type:"css",property:t,onValue:s,offValue:o}}},addMethod:function(e,t,s,o,n){var r=e.getId();if(!this.targets[r]){this.targets[r]={type:"method",target:e,method:t,onValue:s,offValue:o,useJQuery:n}}},targets:{}},currentProcedureIndex:0,currentProcedureId:"",currentProcedure:null,currentStepId:null,currentStep:null,currentStepPaused:false,isPlaying:false,currentStepFinished:true,playAllActive:false,showToolbar:true,showThumbnails:true,portfolioMode:false,reset:function(){this.currentStep=null;this.currentProcedure=null;this.currentProcedureIndex=0;this.currentProcedureId="";this.currentStepId=null;this.currentStepPaused=false;this.currentStepFinished=true;this.playAllActive=false;this.portfolioMode=false},stepInfo:{lastTop:null,lastLeft:null,stepMessagePopup:null,openPopup:function(e,t,s,o){this._customHeaderText=this._customHeaderText||new sap.m.Text({width:"100%",textAlign:sap.ui.core.TextAlign.Center}).addStyleClass("sapVizKitStepNavigationPopoverTitle");this._customHeaderText.setText(e);this._customHeaderText.setTooltip(e);this._customHeader=this._customHeader||new sap.m.Bar({contentLeft:[this._customHeaderText]});this._textContent=this._textContent||new sap.m.Text({});this._textContent.addStyleClass("sapVizKitStepNavigationPopoverContent");this._textContent.setText(t);this.stepMessagePopup=this.stepMessagePopup||new sap.m.ResponsivePopover({placement:o,showCloseButton:true,verticalScrolling:true,contentHeight:"10%",contentWidth:"30%",content:[this._textContent],customHeader:this._customHeader});this.stepMessagePopup.addStyleClass("sapVizKitStepNavigationPopoverStepInfo");this.stepMessagePopup.openBy(s)}}}};g.prototype.refresh=function(e){d.info("StepNavigation refresh() called.");if(this.getVisible()&&(this["_getStepThumbnails"]&&this._scene!=null)){var t=this.getProcedureList();var s=this.getSettings();s.reset();t.setSelectedItem(t.getFirstItem());var o=this._getStepThumbnails();if(s.stepInfo.stepMessagePopup){if(s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null}this.oModel.setData(o);this._togglePlayPause(true);this._refreshControl()}else if(this.getVisible()){this._refreshControl()}return true};g.prototype.clear=function(){d.info("StepNavigation clear() called.");return true};g.prototype.onBeforeRendering=function(){if(this.getShowToolbar()){var e=this.getProcedureList();e.setModel(this.oModel);var t=this.getProcedureItemTemplate();e.bindItems("/procedures",t)}};g.prototype.onAfterRendering=function(){var e=this.getSettings();this._togglePlayPause(!e.isPlaying);if(e.currentStepId){this._highlightStep(e.currentStepId)}};var f={onAfterRendering:function(e){e.srcControl.focus();e.srcControl.removeEventDelegate(this)}};g.prototype._togglePlayPause=function(e){this.togglePlayPauseActive=true;if(this.getSettings().showToolbar){var t=this.getPlayOptionButton(),s=this.getPauseButton();if(e){if(h.getCurrentFocusedControlId()===s.getId()){t.addEventDelegate(f)}s.setVisible(false);t.setVisible(true)}else{if(h.getCurrentFocusedControlId()===t.getId()){s.addEventDelegate(f)}t.setVisible(false);s.setVisible(true)}}};g.prototype._refreshControl=function(){if(!this.oModel.oData.procedures){return}var e=this.getProcedureList();var t=this.getProcedureItemTemplate();var s=this.getSettings();if(s.stepInfo.stepMessagePopup){if(s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"))}e.unbindItems();if(this.oModel.oData.procedures.length>0){var o=this.oModel.oData.procedures[0];if(this.getShowToolbar()){e.bindItems("/procedures",t);e.selectedKey=o.id;e.enabled=true}this._refreshItems()}else{if(this.getShowToolbar()){e.bindItems("/procedures",t);e.enabled=false}if(this.getShowThumbnails()){var n=this.getScroller();n.destroyContent()}}};g.prototype._refreshItems=function(){var e=this;var t=[];var s=this.getProcedureList();var o=e.getSettings();var n=new sap.m.HBox;if(!o.currentProcedure){o.currentProcedure=e.oModel.oData.procedures[o.currentProcedureIndex];s.setSelectedItem(s.getFirstItem())}if(o.currentProcedureId!=""||e.oModel.oData.procedures.length>0){if(e.getShowThumbnails()){var r=e.getScroller();r.removeAllContent();t=e.oModel.oData.procedures[o.currentProcedureIndex].steps;var i=function(t){o.currentStepPaused=false;var s=h.byId(t.getSource().getId());e.playStep(s.getCustomData()[0].getValue("stepId"));o.playAllActive=false;e._togglePlayPause(false)};var a=function(e){var t=80;var s=e.getSource();var o=s.getDomRef().width;var n=s.getDomRef().height;var r=o/n;if(o>n){s.setWidth(t+"px");s.setHeight(t/r+"px")}else{s.setHeight(t+"px");s.setWidth(t*r+"px")}};for(var p=0;p<t.length;p++){var u=new sap.m.Image({alt:t[p].name,src:"data:image/"+t[p].thumbnailType+";base64,"+t[p].thumbnailData,densityAware:false,tooltip:t[p].name,press:i.bind(e),load:a,layoutData:new sap.m.FlexItemData({shrinkFactor:0})});u.data("stepId",t[p].id);u.addCustomData(new sap.ui.core.CustomData({key:"stepId",value:t[p].id}));u.addStyleClass("sapVizKitStepNavigationStepItem");n.addItem(u)}r.addContent(n)}}};g.prototype._getPopupPlacement=function(e){var t=null;var s=0;while(e){s+=e.offsetTop;e=e.offsetParent}if(s>200){t=sap.m.PlacementType.Top}else{t=sap.m.PlacementType.Bottom}return t};g.prototype._isScrollingNecessary=function(e,t){var s;if(e&&t){var o=jQuery(e).offset().left+jQuery(e).width();var n=jQuery(t).width();if(o-jQuery(e).width()<0){s=true}else if(n-o<jQuery(e).width()){s=true}else{s=false}}else{s=false}return s};g.prototype._scrollToItem=function(e,t){var s={},o=jQuery(e).offset(),n=jQuery(t).scrollLeft();s.scrollLeft=o.left+(n-jQuery(t).offset().left);s.scrollLeft-=parseInt(jQuery(e).css("marginLeft"),10)||0;s.scrollLeft-=parseInt(jQuery(e).css("borderLeftWidth"),10)||0;jQuery(t).animate(s,50)};g.prototype._highlightStep=function(e){var t=this;if(t.getVisible()){var s=t.getSettings();var o=t.getStep(0,s.currentProcedureIndex,e);if(!s.currentProcedure){s.currentProcedure=t.oModel.oData.procedures[t.oSettings.currentProcedureIndex]}var n=t.getShowStepInfoButton();var r;var i=document.getElementById(n.getId());r=t._getPopupPlacement(i);if(t.getShowStepInfo()){s.stepInfo.openPopup.call(this,o.name,o.description,n,r)}else if(s.stepInfo.stepMessagePopup&&s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}if(t.getShowThumbnails()){var a=t.getScroller();var p=a.getContent()[0].getItems();for(var u=0;u<p.length;u++){if(p[u].getCustomData()[0].getValue("stepId")==e){p[u].addStyleClass("selected");if(t._isScrollingNecessary(p[u].$()[0],jQuery("#"+a.sId)[0])){t._scrollToItem(p[u].$()[0],jQuery("#"+a.sId)[0])}}else{p[u].removeStyleClass("selected")}}}}};g.prototype.getProceduresAndSteps=function(){return this._getStepThumbnails()};g.prototype._getStepThumbnails=function(){var e=function(e,t,s){var o,n,r;try{var i=t.Scene.RetrieveThumbnail(e,s.id);if(i===sap.ve.dvl.DVLRESULT.NOTFOUND){o=this._emptyThumbnail}else{o=p(i)}r=o.substring(0,3);if(r==="iVB"){n="png"}else{n="jpg"}s.thumbnailData=o;s.thumbnailType=n}catch(e){if(e.code!==sap.ve.dvl.DVLRESULT.NOTFOUND){d.error(e.message,e.code,"sap.ui.vk.StepNavigation")}s.thumbnailData=null;s.thumbnailType=null}};var t=this._retrieveProcedures();if(t.sceneId!=null){t.procedures.forEach(function(s){s.steps.forEach(e.bind(this,t.sceneId,this.oDvl))},this);t.portfolios.forEach(function(s){s.steps.forEach(e.bind(this,t.sceneId,this.oDvl))},this);t.hasThumbnails=true}this._procedures=t;return t};g.prototype._retrieveProcedures=function(e){var t=this;var s={};if(!t._procedures){s={sceneId:null,hasThumbnails:false,procedures:[],portfolios:[]}}else{s=t._procedures}if(t._scene&&s.sceneId!=(e||t._scene._dvlSceneRef)){var o=e||t._scene._dvlSceneRef;if(o!=null){s={sceneId:null,hasThumbnails:false,procedures:[],portfolios:[]};try{var r=u(t.oDvl.Scene.RetrieveProcedures(o));if(r!=null){s.hasThumbnails=false;s.sceneId=t._scene._dvlSceneRef;s.procedures=r.procedures;s.portfolios=r.portfolios}}catch(e){if(!(e instanceof n&&e.code===sap.ve.dvl.DVLRESULT.NOTIMPLEMENTED)){throw e}}}}return s};g.prototype.getStep=function(e,t,s){var o=this;var n=o.oDvl.Settings.LastLoadedSceneId;var r=null;if(n!=null){t=t!=null?t:0;var i=s?s:o.instanceSettings.currentStepId;var a=o._retrieveProcedures(n);var p=a.procedures[t];if(p&&p.steps.length>0){r=p.steps[0]}else{return null}if(i!=""){for(var u=0;u<p.steps.length;u++){var l=p.steps[u];if(l.id==i){var c=u+e;if(c<p.steps.length&&c>=0){r=p.steps[c]}else{r=null}break}}}}return r};g.prototype.pauseStep=function(){var e=this;var t=e.oDvl.Settings.LastLoadedSceneId;if(t!=null){e.oDvl.Scene.PauseCurrentStep(t)}};g.prototype._stepCount=function(e){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;var o=0;if(s!=null){var n=t._retrieveProcedures(s);for(var r=0;r<n.procedures.length;r++){if(n.procedures[r].id==e){o=n.procedures[r].steps.length;break}else if(e==null){o+=n.procedures[r].steps.length}}}return o};g.prototype.getPreviousStep=function(e){var t=this;return t.getStep(-1,e)};g.prototype.getNextStep=function(e){var t=this;return t.getStep(1,e)};g.prototype.playStep=function(e,t,s){var o=this;var n=o.oDvl.Settings.LastLoadedSceneId;if(n!=null){o.instanceSettings.currentStepId=e;o.oDvl.Scene.ActivateStep(n,e,t!=null?t:true,s!=null?s:false)}};g.prototype.playAllSteps=function(e){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){var o=t._retrieveProcedures(s);var n=0;if(e!=null&&o.procedures.length>1){for(var r=0;r<o.procedures.length;r++){if(o.procedures[r].id==e){n=r;break}}}if(o.procedures.length>0){var i=o.procedures[n].steps[0];if(i){t.instanceSettings.currentStepId=i.id;t.oDvl.Scene.ActivateStep(s,i.id,true,true)}}}};g.prototype._setContent=function(e){if(this._bIsBeingDestroyed){return this}var t=null;if(e&&e instanceof l){t=e}this.setScene(t);return this};return g});