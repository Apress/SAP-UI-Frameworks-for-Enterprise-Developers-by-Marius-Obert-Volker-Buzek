/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Control","./RedlineSurface","./RedlineElement","./RedlineGesturesHandler","./RedlineDesignHandler","./Loco","./RedlineDesignRenderer"],function(e,t,i,n,s,r,a){"use strict";var o=t.extend("sap.ui.vk.RedlineDesign",{metadata:{library:"sap.ui.vk",events:{elementCreated:{parameters:{element:"object"}}},aggregations:{activeElementInstance:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});o.prototype.init=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this._gestureHandler=new n(this);this._designHandler=new s(this);this._loco=new r(this)};o.prototype.onBeforeRendering=function(){if(this._loco){this._loco.removeHandler(this._gestureHandler);this._loco.removeHandler(this._designHandler)}};o.prototype.onAfterRendering=function(){var e=this.getDomRef();e.style.width="100%";e.style.height="100%";if(this._isAddingModeActive){this._loco.addHandler(this._designHandler)}else{this._loco.addHandler(this._gestureHandler)}this.updatePanningRatio()};o.prototype.startAdding=function(e){this._isAddingModeActive=true;this._activeElementInstance=e;this.setAggregation("activeElementInstance",this._activeElementInstance);this.addStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode");return this};o.prototype.stopAdding=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this.setAggregation("activeElementInstance",null);this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this.removeStyleClass("sapUiVizkitRedlineDesignMode");return this};o.prototype._getOffset=function(e){var t=e.getBoundingClientRect();return{x:t.left+window.pageXOffset,y:t.top+window.pageYOffset}};o.prototype._getTargetViewport=function(){return this._targetViewport};o.prototype._setTargetViewport=function(e){this._targetViewport=e;this._targetViewport.attachEvent("resize",this,this._onresize,this)};o.prototype._onresize=function(e){var t=e.oSource.getOutputSize();this.setProperty("virtualLeft",t.left,true);this.setProperty("virtualTop",t.top,true);this.setProperty("virtualSideLength",t.sideLength,true);this.invalidate()};return o});