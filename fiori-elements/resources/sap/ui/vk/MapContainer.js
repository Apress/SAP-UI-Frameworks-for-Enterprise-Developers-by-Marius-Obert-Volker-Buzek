/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./ContainerBase","sap/ui/core/IconPool","sap/ui/vbm/lib/sapvbi","sap/ui/Device","./MapContainerRenderer","./MapContainerButtonType","./getResourceBundle"],function(t,e,o,n,i,a,s){"use strict";var r=t.extend("sap.ui.vk.MapContainer",{metadata:{library:"sap.ui.vk",properties:{showNavbar:{type:"boolean",group:"Misc",defaultValue:true},showHome:{type:"boolean",group:"Misc",defaultValue:true},showMapLayer:{type:"boolean",group:"Misc",defaultValue:true},showRectangularZoom:{type:"boolean",group:"Misc",defaultValue:true},showZoom:{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{listPanelStack:{type:"sap.ui.vk.ListPanelStack",multiple:false},scrollCont:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"}},associations:{},events:{}}});r.prototype.init=function(){t.prototype.init.apply(this,arguments);var e=new sap.ui.model.json.JSONModel;e.setData({rectZoom:false});this.setModel(e,"rectZoom");this._oNavbar=new sap.m.Toolbar({width:"auto"});this._oScrollCont=new sap.m.ScrollContainer({horizontal:false,vertical:true,focusable:false});this.setAggregation("scrollCont",this._oScrollCont,true);this._oHomeButton=new sap.m.Button({icon:"sap-icon://home",type:sap.m.ButtonType.Transparent,tooltip:s().getText("MAPCONTAINER_HOME"),press:this._onNavbarHome.bind(this)});this._oRectZoomButton=new sap.m.ToggleButton({icon:"sap-icon://draw-rectangle",type:sap.m.ButtonType.Transparent,pressed:"{rectZoom>/rectZoom}",tooltip:s().getText("MAPCONTAINER_RECT_ZOOM")}).setModel(e,"rectZoom");this._oZoomInButton=new sap.m.Button({icon:"sap-icon://add",type:sap.m.ButtonType.Transparent,tooltip:s().getText("MAPCONTAINER_ZOOMIN"),press:this._onNavbarZoomIn.bind(this)});this._oZoomOutButton=new sap.m.Button({icon:"sap-icon://less",type:sap.m.ButtonType.Transparent,tooltip:s().getText("MAPCONTAINER_ZOOMOUT"),press:this._onNavbarZoomOut.bind(this)});if(n.system.phone){this._oMenuOpenButton=new sap.m.Button({layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}),icon:"sap-icon://menu2",type:sap.m.ButtonType.Transparent,tooltip:s().getText("CONTAINERBASE_MENU"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._showListPanelStack()}.bind(this)});this._oMenuCloseButton=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:"sap-icon://nav-back",press:function(){this._bSegmentedButtonSaveSelectState=true;this._hideListPanelStack()}.bind(this)})}this.addStyleClass("sapUiVkMapContainer")};r.prototype.exit=function(){if(this._oNavbar){this._oNavbar.destroy();this._oNavbar=undefined}if(this._oScrollCont){this._oScrollCont.destroy();this._oScrollCont=undefined}t.prototype.exit.apply(this,arguments)};r.prototype.getListPanelStack=function(){return this._oScrollCont.getContent()[0]};r.prototype.setListPanelStack=function(t){if(n.system.phone){t.setCollapsible(false);t.setWidth("100%")}this._oScrollCont.removeAllContent();return this._oScrollCont.addContent(t)};r.prototype.onBeforeRendering=function(){t.prototype.onBeforeRendering.apply(this,arguments);this._oNavbar.removeAllContent();this._shouldRenderMapLayerSwitch=false;var e=this.getSelectedContent();if(e!==null){var o=e.getContent();this._isInstanceGeoAnalytic=o instanceof sap.ui.vbm.GeoMap||o instanceof sap.ui.vbm.AnalyticMap;if(this._isInstanceGeoAnalytic){if(this.getShowHome()){this._oNavbar.addContent(this._oHomeButton)}if(!n.system.phone&&this.getShowRectangularZoom()){this._oNavbar.addContent(this._oRectZoomButton)}if(this.getShowZoom()){this._oNavbar.addContent(this._oZoomInButton);this._oNavbar.addContent(this._oZoomOutButton)}this._shouldRenderListPanel=true}else{this._shouldRenderListPanel=false}this._isSupportingMapLayerSwitch=o instanceof sap.ui.vbm.GeoMap&&!(o instanceof sap.ui.vbm.AnalyticMap);if(this._isSupportingMapLayerSwitch&&o.getMapConfiguration()!==null&&this.getShowMapLayer()){var i=o.getMapConfiguration();var a=[].concat(i.MapLayerStacks);if(a.length>1){this._currentText=(new sap.m.Text).addStyleClass("mapLayerSelectedText");this.addDependent(this._currentText);this._box=(new sap.m.HBox).addStyleClass("mapContainerHboxPopover");this._popover=new sap.m.Popover({enableScrolling:false,placement:sap.m.PlacementType.Horizontal,content:this._box,showHeader:false});this._selectionMap=new sap.m.Image({press:function(t){if(this._popover.isOpen()){this._popover.close()}else{this._popover.openBy(this._selectionMap)}}.bind(this)}).addStyleClass("mapLayerPopoverItem");this.addDependent(this._selectionMap);this._shouldRenderMapLayerSwitch=true}}}};r.prototype.onAfterRendering=function(){if(n.system.phone){var e=document.getElementById(this.getId()+"-LPW");this.getDomRef().appendChild(e)}t.prototype.onAfterRendering.apply(this,arguments);if(this._shouldRenderMapLayerSwitch){var o=this.getSelectedContent().getContent();var i=o.getMapConfiguration();var a=[].concat(i.MapLayerStacks);var s=o.mVBIContext.GetMainScene();a.forEach(function(t){var e=o.mVBIContext.m_MapLayerStackManager.GetMapLayerStack(t.name);var n=new sap.m.Image({alt:t.name,press:function(i){this._popover.close();this._currentText.setText(t.name);this._selectionMap.setAlt(t.name);o.setRefMapLayerStack(t.name);if(n.getSrc()){this._selectionMap.setSrc(n.getSrc())}else{s.GetPreviewImage(e,function(t){this._selectionMap.setSrc(t.src)}.bind(this))}}.bind(this)}).addStyleClass("layerType");s.GetPreviewImage(e,function(t){n.setSrc(t.src)});var i=new sap.m.Text({text:t.name}).addStyleClass("mapLayerPopoverItemText");var a=new sap.ui.layout.VerticalLayout;a.addContent(n);a.addContent(i);this._box.addItem(a)},this);this._currentText.setText(o.getRefMapLayerStack());this._selectionMap.setAlt(o.getRefMapLayerStack());s.GetPreviewImage(s.m_MapLayerStack,function(t){this._selectionMap.setSrc(t.src)}.bind(this))}};r.prototype.setToolbarItem=function(t){if(!t||!t.id){return null}var e;for(var o=0;o<this._customButtons.length;++o){if(t.id===this._customButtons[o].id){e=this._customButtons[o];e.index=o;this._customButtons.splice(o,1);break}}if(!e){e={id:t.id,visible:true,active:true,index:this._customButtons.length,type:a.Click}}if("index"in t){e.index=t.index}if("visible"in t){e.visible=t.visible}if("overflow"in t){e.overflow=t.overflow}if("active"in t){e.active=t.active}if("text"in t){e.text=t.text}if("tooltip"in t){e.tooltip=t.tooltip}if("icon"in t){e.icon=t.icon}if("activeIcon"in t){e.activeIcon=t.activeIcon}if("press"in t){e.press=t.press}if("toggled"in t){e.toggled=t.toggled;if(e.button){e.button.setPressed(t.toggled)}}if("type"in t){e.type=t.type}if(e.index>this._customButtons.length){e.index=this._customButtons.length}else if(e.index<0){e.index=0}this._customButtons.splice(e.index,0,e);this.invalidate();return e};r.prototype.setSelectedContent=function(e){var o;if(this._oSelectedContent){if((o=this._oSelectedContent.getContent())instanceof sap.ui.vbm.GeoMap){o.unbindProperty("rectZoom","rectZoom>/rectZoom")}}t.prototype.setSelectedContent.apply(this,arguments);var n=this._oSelectedContent.getContent();if(n instanceof sap.ui.vbm.GeoMap){n.bindProperty("rectZoom","rectZoom>/rectZoom")}};r.prototype._addToolbarContent=function(){if(n.system.phone){this._oToolbar.addContent(this._oMenuOpenButton)}t.prototype._addToolbarContent.apply(this,arguments)};r.prototype._onNavbarZoomIn=function(t){var e=this.getSelectedContent().getContent();if(e.getZoomlevel&&e.setZoomlevel&&e.setEnableAnimation){e.setEnableAnimation(true);e.setZoomlevel(e.getZoomlevel()+1)}};r.prototype._onNavbarZoomOut=function(t){var e=this.getSelectedContent().getContent();if(e.getZoomlevel&&e.setZoomlevel&&e.setEnableAnimation){e.setEnableAnimation(true);e.setZoomlevel(e.getZoomlevel()-1)}};r.prototype._onNavbarHome=function(t){var e=this.getSelectedContent().getContent();if(e.goToStartPosition){e.goToStartPosition()}};r.prototype._showListPanelStack=function(){jQuery("#"+this.getId()+"-LPW").addClass("sapUiVkMapContainerLPWIn");jQuery("#"+this.getId()+"-wrapper").addClass("sapUiVkMapContainerMapOut")};r.prototype._hideListPanelStack=function(){jQuery("#"+this.getId()+"-LPW").removeClass("sapUiVkMapContainerLPWIn");jQuery("#"+this.getId()+"-wrapper").removeClass("sapUiVkMapContainerMapOut")};return r});