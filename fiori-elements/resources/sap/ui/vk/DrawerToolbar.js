/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./library","./Core","./DrawerToolbarRenderer","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/Device","sap/m/VBox","sap/m/FlexAlignContent","sap/m/FlexAlignItems","sap/m/FlexItemData","sap/m/FlexRendertype","sap/m/OverflowToolbar","sap/ui/core/Icon","sap/m/Button","sap/m/ButtonType","sap/m/ToolbarDesign","sap/m/ToolbarSeparator","sap/m/ToggleButton","sap/m/MenuButton","./tools/RectSelectTool","./tools/CrossSectionTool","sap/m/Menu","sap/m/MenuItem","./NavigationMode","./ZoomTo","./getResourceBundle","./ToggleMenuButton","./ToggleMenuItem","./Viewport","./DrawerToolbarButton","sap/ui/base/ManagedObjectObserver","sap/ui/core/Core","./tools/HighlightMeasurementTool","./tools/CalibrateDistanceMeasurementTool","./tools/DeleteMeasurementTool","./tools/DistanceMeasurementTool","./tools/AngleMeasurementTool","./tools/AreaMeasurementTool","./thirdparty/three"],function(e,t,n,i,s,a,o,r,l,u,c,m,_,h,d,g,p,T,f,v,w,b,M,I,S,E,y,x,V,R,A,C,D,O,P,F,B,N,L){"use strict";var k=i.extend("sap.ui.vk.DrawerToolbar",{metadata:{library:"sap.ui.vk",properties:{expanded:{type:"boolean",defaultValue:true},navigationMode:{type:"sap.ui.vk.NavigationMode",defaultValue:I.Turntable}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}},_container:{type:"sap.m.VBox",multiple:false,visibility:"hidden"}},associations:{viewport:{type:"sap.ui.vk.ViewportBase",multiple:false}},events:{expanded:{parameters:{expand:{type:"boolean"}}}}},constructor:function(e,t){i.apply(this,arguments)}});var H=[{name:"show",unicode:"e900"},{name:"hide",unicode:"e901"},{name:"turntable",unicode:"e902"},{name:"orbit",unicode:"e903"},{name:"pan",unicode:"e904"},{name:"zoom",unicode:"e905"},{name:"fit-to-view",unicode:"e906"},{name:"rectangular-selection",unicode:"e907"},{name:"predefined-views",unicode:"e93c"},{name:"cross-section",unicode:"e913"},{name:"cross-section-x",unicode:"e914"},{name:"cross-section-y",unicode:"e916"},{name:"cross-section-z",unicode:"e915"},{name:"reverse-direction",unicode:"e917"},{name:"distance-measurement",unicode:"e92b"},{name:"angle-measurement",unicode:"e926"},{name:"area-measurement",unicode:"e963"},{name:"settings",unicode:"e909"},{name:"calibrate-distance",unicode:"e968"}];var U="vk-icons";var z="vk-icons";H.forEach(function(e){s.addIcon(e.name,U,z,e.unicode)});var W="sap-icon://vk-icons/";k.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._measurementsToggleButton=null;this._distanceMeasurementItem=null;this._angleMeasurementItem=null;this._areaMeasurementItem=null;this._deleteMeasurementItem=null;this._measurementSettingsItem=null;this._calibrateDistanceMeasurementItem=null;this._itemsVisibility=new Map;this._itemsVisibilityObserver=new A(this._itemVisibilityChanged.bind(this));this._toolbar=new m({width:"auto",design:g.Solid,layoutData:new u({growFactor:0,shrinkFactor:0}),content:this.createButtons()});this._toolbar.ontouchstart=function(e){e.setMarked()};this._toolbarObserver=new A(this._toolbarContentChanged.bind(this));this._toolbarObserver.observe(this._toolbar,{aggregations:["content"]});this._container=new o({renderType:c.Bare,alignContent:r.Center,alignItems:l.Center,items:[this._toolbar,new _({src:"sap-icon://navigation-up-arrow",noTabStop:true,press:function(e){this._toggleExpanded()}.bind(this),layoutData:new u({growFactor:0,shrinkFactor:0})}).addStyleClass("drawerToolbarIcon")]});this.setAggregation("_container",this._container);this._rectSelectTool=new v;this._distanceMeasurementTool=new F({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._distanceMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"))}},this]});this._angleMeasurementTool=new B({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._angleMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"))}},this]});this._areaMeasurementTool=new N({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._areaMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"))}},this]});this._deleteMeasurementTool=new P({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._deleteMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"));if(this._getViewport().getMeasurementSurface().getMeasurements().length===0){this._measurementsToggleButton.setDefaultItem(this._distanceMeasurementItem)}}},this]});this._calibrateDistanceMeasurementTool=new O({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._calibrateDistanceMeasurementItem.getId()){var t=e.getParameter("enabled");this._measurementsToggleButton.setPressed(t);if(!t){this._measurementsToggleButton.setDefaultItem(this._distanceMeasurementItem)}}},this]});this._highlightMeasurementTool=new D;var e=[this._distanceMeasurementTool,this._angleMeasurementTool,this._areaMeasurementTool,this._deleteMeasurementTool,this._calibrateDistanceMeasurementTool];function n(t){var n=e.find(function(e){return e.getActive()});this._highlightMeasurementTool.setActive(n==null,this._getViewport())}e.forEach(function(e){e.attachEnabled(n,this)},this);var s=t.getEventBus();s.subscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);s.subscribe("sap.ui.vk","readyForAnimation",this._onReadyForAnimation,this)};k.prototype.exit=function(){var e=t.getEventBus();e.unsubscribe("sap.ui.vk","readyForAnimation",this._onReadyForAnimation,this);e.unsubscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);this._distanceMeasurementTool.destroy();this._distanceMeasurementTool=null;this._angleMeasurementTool.destroy();this._angleMeasurementTool=null;this._highlightMeasurementTool.destroy();this._highlightMeasurementTool=null;this._areaMeasurementTool.destroy();this._areaMeasurementTool=null;this._deleteMeasurementTool.destroy();this._deleteMeasurementTool=null;this._calibrateDistanceMeasurementTool.destroy();this._calibrateDistanceMeasurementTool=null;this._measurementsToggleButton=null;this._distanceMeasurementItem=null;this._angleMeasurementItem=null;this._areaMeasurementItem=null;this._deleteMeasurementItem=null;this._measurementSettingsItem=null;this._calibrateDistanceMeasurementItem=null;this._toolbarObserver.disconnect();this._toolbarObserver=null;this._toolbar.destroy();this._toolbar=null};k.prototype._toolbarContentChanged=function(){var e=this._toolbar.getContent();for(var t=0;t<e.length;t++){if(e[t].getMetadata().getName()=="sap.m.ToolbarSeparator"){if(e[t-1]==undefined||e[t+1]==undefined||e[t-1].getMetadata().getName()=="sap.m.ToolbarSeparator"){this._toolbar.removeContent(t)}}}};k.prototype._itemVisibilityChanged=function(e){if(!this._ignoreVisiblityChange){this._itemsVisibility.set(e.object,e.current)}};function Z(e){return e?e.getMetadata().getName()==="sap.ui.vk.threejs.Viewport":false}function q(e){return e?e.getMetadata().getName()==="sap.ui.vk.svg.Viewport":false}function G(e){return e?e.getMetadata().getName()==="sap.ui.vk.NativeViewport":false}function K(e){var t=e.getCurrentView&&e.getCurrentView();var n=t&&t.getDimension();return Z(e)&&!e._redlineHandler&&!e._isPlanarActivated()&&n!==2}k.prototype._getViewport=function(){var e=C.byId(this.getViewport());e=e instanceof V&&e.getImplementation()||e;return e&&(Z(e)||q(e)||G(e))?e:null};k.prototype._getViewStateManager=function(){var e=C.byId(this.getViewport());var t=e.getViewStateManager();if(t){return C.byId(t)}return null};var Q=[null,(new L.Quaternion).setFromAxisAngle(new L.Vector3(0,1,0),0),(new L.Quaternion).setFromAxisAngle(new L.Vector3(0,1,0),Math.PI),(new L.Quaternion).setFromAxisAngle(new L.Vector3(0,1,0),-Math.PI/2),(new L.Quaternion).setFromAxisAngle(new L.Vector3(0,1,0),Math.PI/2),(new L.Quaternion).setFromAxisAngle(new L.Vector3(1,0,0),-Math.PI/2),(new L.Quaternion).setFromAxisAngle(new L.Vector3(1,0,0),Math.PI/2)];k.prototype.createButtons=function(){var e=this;var t=E();var n=new y({type:d.Transparent,tooltip:t.getText("CROSS_SECTION_TOOLTIP"),items:[new x({icon:W+"cross-section-x",text:t.getText("CROSS_SECTION_X"),key:0}),new x({icon:W+"cross-section-y",text:t.getText("CROSS_SECTION_Y"),key:1}),new x({icon:W+"cross-section-z",text:t.getText("CROSS_SECTION_Z"),key:2}),new x({icon:W+"reverse-direction",text:t.getText("CROSS_SECTION_REVERSE"),startsSection:true,toggleable:false,press:function(t){var n=e._getViewport();if(n&&e._crossSectionTool&&e._crossSectionTool.getActive()){e._crossSectionTool.setFlip(!e._crossSectionTool.getFlip())}}})],itemToggled:function(t){var n=e._getViewport();if(n&&e._crossSectionTool){var i=t.getParameter("newItem");e._crossSectionTool.setActive(i!=null,n);if(i){var s=parseInt(i.getKey(),10);if(s>=0&&s<3){e._crossSectionTool.setAxis(s)}}}}});n.vitId=R.CrossSection;var i=new T({icon:W+"turntable",type:d.Transparent,tooltip:t.getText("TURNTABLE_TOOLTIP"),press:function(t){e.setNavigationMode(I.Turntable)}});i.vitId=R.Turntable;var s=new T({icon:W+"orbit",type:d.Transparent,tooltip:t.getText("ORBIT_TOOLTIP"),pressed:false,press:function(t){e.setNavigationMode(I.Orbit)}});s.vitId=R.Orbit;var a=new T({icon:W+"pan",type:d.Transparent,tooltip:t.getText("PAN_TOOLTIP"),press:function(t){e.setNavigationMode(I.Pan)}});a.vitId=R.Pan;var o=new T({icon:W+"zoom",type:d.Transparent,tooltip:t.getText("ZOOM_TOOLTIP"),press:function(){e.setNavigationMode(I.Zoom)}});o.vitId=R.Zoom;this._gestureButtons=[i,s,a,o];var r=new h({icon:W+"show",type:d.Transparent,tooltip:t.getText("SHOW_TOOLTIP"),press:function(){var t=e._getViewStateManager();if(t){var n=[];t.enumerateSelection(function(e){n.push(e)});t.setVisibilityState(n,true,false)}}});r.vitId=R.Show;var l=new h({icon:W+"hide",type:d.Transparent,tooltip:t.getText("HIDE_TOOLTIP"),press:function(){var t=e._getViewStateManager();if(t){var n=[];t.enumerateSelection(function(e){n.push(e)});t.setVisibilityState(n,false,false)}}});l.vitId=R.Hide;var u=new h({icon:W+"fit-to-view",type:d.Transparent,tooltip:t.getText("FIT_TO_VIEW"),press:function(){var t=C.byId(e.getViewport());t=t instanceof V&&t.getImplementation()||t;if(t){t.zoomTo(S.All,null,.5,0)}}});u.vitId=R.FitToView;this._rectSelectionButton=new T({icon:W+"rectangular-selection",type:d.Transparent,tooltip:t.getText("RECTANGULAR_SELECTION_TOOLTIP")});this._rectSelectionButton.vitId=R.RectangularSelection;var c=new f({icon:W+"predefined-views",activeIcon:W+"predefined-views",type:d.Transparent,tooltip:t.getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:new b({items:[new M({text:t.getText("PREDEFINED_VIEW_INITIAL")}),new M({text:t.getText("PREDEFINED_VIEW_FRONT"),startsSection:true}),new M({text:t.getText("PREDEFINED_VIEW_BACK")}),new M({text:t.getText("PREDEFINED_VIEW_LEFT")}),new M({text:t.getText("PREDEFINED_VIEW_RIGHT")}),new M({text:t.getText("PREDEFINED_VIEW_TOP")}),new M({text:t.getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(t){var n=e._getViewport();if(n){var i=t.getParameters("item").item;var s=this.indexOfItem(i);n._viewportGestureHandler.setView(Q[s],1e3)}})});c.vitId=R.PredefinedViews;var m=new T({icon:"sap-icon://full-screen",type:d.Transparent,tooltip:t.getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:function(t){var n=e._getViewport();var i=function(e){return!!(e.fullScreen||e.webkitIsFullScreen||e.mozFullScreen||e.msFullscreenElement)};if(this.getPressed()){if(!i(document)){if(!e._fullScreenHandler){e._fullScreenHandler=function(t){var s=i(document);if(!s){document.removeEventListener("fullscreenchange",e._fullScreenHandler);document.removeEventListener("mozfullscreenchange",e._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",e._fullScreenHandler);document.removeEventListener("MSFullscreenChange",e._fullScreenHandler);this.setPressed(false);n.removeStyleClass("sapVizKitViewerFullScreen")}}.bind(this)}var s=document.getElementsByTagName("body")[0];if(s.requestFullscreen){document.addEventListener("fullscreenchange",e._fullScreenHandler);s.requestFullscreen()}else if(s.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",e._fullScreenHandler);s.webkitRequestFullscreen()}else if(s.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",e._fullScreenHandler);s.mozRequestFullScreen()}else if(s.msRequestFullscreen){document.addEventListener("MSFullscreenChange",e._fullScreenHandler);s.msRequestFullscreen()}}n.addStyleClass("sapVizKitViewerFullScreen")}else{if(i(document)){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}n.removeStyleClass("sapVizKitViewerFullScreen")}}});m.vitId=R.FullScreen;this._distanceMeasurementItem=new x({icon:W+"distance-measurement",text:t.getText("MEASUREMENTS_DISTANCE_MENUITEM")});this._angleMeasurementItem=new x({icon:W+"angle-measurement",text:t.getText("MEASUREMENTS_ANGLE_MENUITEM")});this._areaMeasurementItem=new x({icon:W+"area-measurement",text:t.getText("MEASUREMENTS_AREA_MENUITEM")});this._deleteMeasurementItem=new x({icon:"sap-icon://delete",text:t.getText("MEASUREMENTS_DELETE_MENUITEM")});this._calibrateDistanceMeasurementItem=new x({icon:W+"calibrate-distance",text:t.getText("MEASUREMENTS_CALIBRATE_DISTANCE_MENUITEM")});this._measurementSettingsItem=new x({startsSection:true,icon:W+"settings",text:t.getText("MEASUREMENTS_SETTINGS_MENUITEM"),toggleable:false});this._measurementsToggleButton=new y({type:d.Transparent,tooltip:t.getText("MEASUREMENTS_TOOLTIP"),items:[this._distanceMeasurementItem,this._angleMeasurementItem,this._areaMeasurementItem,this._deleteMeasurementItem,this._calibrateDistanceMeasurementItem,this._measurementSettingsItem],itemToggled:function(t){var n=e._getViewport();var i=t.getParameter("oldItem");var s=t.getParameter("newItem");if(i===e._distanceMeasurementItem){e._distanceMeasurementTool.setActive(false,n)}else if(i===e._angleMeasurementItem){e._angleMeasurementTool.setActive(false,n)}else if(i===e._areaMeasurementItem){e._areaMeasurementTool.setActive(false,n)}else if(i===e._deleteMeasurementItem){e._deleteMeasurementTool.setActive(false,n)}else if(i===e._calibrateDistanceMeasurementItem){e._calibrateDistanceMeasurementTool.setActive(false,n)}var a=n.getTools();var o;if(s===e._distanceMeasurementItem){o=e._distanceMeasurementTool}else if(s===e._angleMeasurementItem){o=e._angleMeasurementTool}else if(s===e._areaMeasurementItem){o=e._areaMeasurementTool}else if(s===e._deleteMeasurementItem){o=e._deleteMeasurementTool}else if(s===e._calibrateDistanceMeasurementItem){o=e._calibrateDistanceMeasurementTool}if(o!=null){if(a.indexOf(o.getId())<0){n.addTool(o)}o.setActive(true,n)}},itemSelected:function(t){var n=e._getViewport();var i=t.getParameter("item");if(i===e._measurementSettingsItem){e._distanceMeasurementTool.setActive(false,n);e._angleMeasurementTool.setActive(false,n);e._areaMeasurementTool.setActive(false,n);e._deleteMeasurementTool.setActive(false,n);e._calibrateDistanceMeasurementTool.setActive(false,n);e._distanceMeasurementTool.showSettingsDialog(n)}},beforeMenuOpen:function(){var t=e._getViewport();var n=t.getMeasurementSurface();var i=n.getMeasurements().length>0;e._deleteMeasurementItem.setEnabled(i);var s=n.getMeasurements().some(function(e){return e.isDistance});e._calibrateDistanceMeasurementItem.setEnabled(s)}});this._measurementsToggleButton.vitId=R.Measurements;var _=new p;_.vitId=R.MeasurementsSeparator;var g=new p;var v=new p;var w=new p;var A=new p;this._itemsShowHideSelect=[r,l,w,this._rectSelectionButton,A];this._itemTurntable=this._gestureButtons[0];this._itemPan=this._gestureButtons[2];this._items3D=[this._gestureButtons[1],n,g,c,v];var D=[r,l,w,this._gestureButtons[0],this._gestureButtons[1],this._gestureButtons[2],this._gestureButtons[3],new p,this._measurementsToggleButton,_,u,new p,this._rectSelectionButton,A,n,g,c,v,m];D.forEach(function(e){this._itemsVisibility.set(e,true);this._itemsVisibilityObserver.observe(e,{properties:["visible"]})}.bind(this));return D};var j=["drawerToolbarIconTurntable","drawerToolbarIconOrbit","drawerToolbarIconPan","drawerToolbarIconZoom"];var J=function(e,t){this.viewport=e;this._toolbar=t;this._mode=1;this._gesture=false;this._x=0;this._y=0};function X(e,t){j.forEach(function(n,i){if(e.hasStyleClass(n)&&i!==t){e.removeStyleClass(n)}else if(i===t){e.addStyleClass(n)}})}function Y(e){var t=e.viewport;var n=e._mode;var i=t.hasStyleClass(j[n])?n:-1;e._isScrolling=true;if(i!==3){X(t,3);setTimeout(function(){e._isScrolling=false;X(t,i)},500)}}J.prototype.beginGesture=function(e){this._gesture=true;if(this._mode<3){this._x=e.points[0].x;this._y=e.points[0].y}else{this._x=e.x;this._y=e.y}if(e.scroll){Y(this)}if(this._toolbar._rectSelectionButton.getPressed()||e.event&&(a.os.macintosh?e.event.metaKey:e.event.ctrlKey)){var t=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect={x1:this._x-t.left,y1:this._y-t.top,x2:this._x-t.left,y2:this._y-t.top}}};J.prototype.endGesture=function(){this._gesture=false;if(this._selectionRect&&(this._selectionRect.x1!==this._selectionRect.x2||this._selectionRect.y1!==this._selectionRect.y2)){this._toolbar._rectSelectTool._select(this._selectionRect.x1,this._selectionRect.y1,this._selectionRect.x2,this._selectionRect.y2,this.viewport,this.viewport.getScene(),this.viewport.getCamera());this._selectionRect=null;this.viewport.setSelectionRect(null)}else if(!this._isScrolling){X(this.viewport,-1)}};J.prototype.move=function(e){if(this._gesture){if(e.n==1){var t=e.points[0];if(this._selectionRect){var n=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect.x2=t.x-n.left;this._selectionRect.y2=t.y-n.top;this.viewport.setSelectionRect(this._selectionRect)}else{X(this.viewport,this._mode);var i=t.x-this._x;var s=t.y-this._y;switch(this._mode){case 0:this.viewport.rotate(i,s,true);break;case 1:this.viewport.rotate(i,s,false);break;case 2:this.viewport.pan(i,s);break;case 3:this.viewport.zoom(1+s*.005);break;default:break}this._x=t.x;this._y=t.y}e.handled=true}else if(e.n==2&&!this._isScrolling){X(this.viewport,2)}}};J.prototype.hover=function(){};J.prototype.getViewport=function(){return this.viewport};k.prototype.setNavigationMode=function(e){if(!e||e===I.NoChange){e=this.getNavigationMode()}var t=this._getViewport();if(t){if(!K(t)){if(e!==I.Pan&&e!==I.Zoom){e=I.Pan}}else if(Z(t)&&t._isPanoramicActivated()){if(e!==I.Turntable&&e!==I.Zoom){e=I.Turntable}}}this.setProperty("navigationMode",e,true);var n=[I.Turntable,I.Orbit,I.Pan,I.Zoom].indexOf(e);this._gestureButtons.forEach(function(e,t){e.setPressed(t===n)});if(t){if(!this._cameraHandler||this._cameraHandler.getViewport()!==t){this._cameraHandler=new J(t,this);t._loco.addHandler(this._cameraHandler,0)}this._cameraHandler._mode=n}};k.prototype._getToolbar=function(){return this._toolbar};k.prototype._toggleExpanded=function(){var e=!this.getExpanded();this.setExpanded(e);this.fireExpanded({expand:e})};k.prototype.setExpanded=function(e){this.setProperty("expanded",e,true);var t=this.getDomRef();if(t){if(!e){t.classList.add("drawerToolbarCollapsed");t.classList.remove("drawerToolbarExpanded");this._container.addStyleClass("vboxCollapsed")}else{t.classList.add("drawerToolbarExpanded");t.classList.remove("drawerToolbarCollapsed");this._container.removeStyleClass("vboxCollapsed")}}return this};k.prototype._onViewActivated=function(e,t,n){if(n&&n.view&&n.source&&n.source===this._getViewport()){this.invalidate()}};k.prototype._onReadyForAnimation=function(e,t,n){var i=this._getViewport();if(n&&n.view&&n.source&&i._getViewStateManagerThreeJS&&n.source===i._getViewStateManagerThreeJS()){this.invalidate()}};k.prototype.onBeforeRendering=function(){var e=this._getViewport();this._container.setVisible(!!e);if(e){var t=K(e);var n=Z(e)&&e._isPanoramicActivated();var i=G(e);this._ignoreVisiblityChange=true;this._itemsShowHideSelect.forEach(function(e){e.setVisible(!i&&this._itemsVisibility.get(e))}.bind(this));this._itemTurntable.setVisible(t&&this._itemsVisibility.get(this._itemTurntable));this._itemPan.setVisible(!n&&this._itemsVisibility.get(this._itemPan));this._items3D.forEach(function(e){e.setVisible(t&&!n&&this._itemsVisibility.get(e))}.bind(this));this._ignoreVisiblityChange=false;if(t&&!n){this._crossSectionTool=this._crossSectionTool||new w;e.addTool(this._crossSectionTool)}this.setNavigationMode(I.NoChange)}};return k});