/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.TransformSvgElementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=10;this._tool=t;this._gizmo=t.getGizmo();this._rect=null}});i.prototype._getPosition=function(t){return this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y)};i.prototype._getGizmoHandle=function(t){var i=this._tool._viewport;if(!i||!this._gizmo||!this._inside(t)){return null}if(t.scroll!==undefined){return null}var o=i._camera;var n=this._gizmo._nodes;if(!o||!n||n.length===0){return null}var r=t.x-this._rect.x;var s=t.y-this._rect.y;var a=this._getPosition(t);var h=12;var _=-1;for(var l=0;l<n.length;l++){var d=n[l];var u=d.node;var c=u._getBBox();if(!c){continue}var f=u._matrixWorld();var v=this._gizmo._getHandleLocalPositions(d,f);var g=[0,4,2,6,8,1,3,5,7];for(var p=0;p<9;p++){var y=g[p];var m=e._transformPoint(v[y*2],v[y*2+1],f);var x=o._worldToScreen(m.x,m.y);if(r>=x.x-h&&r<=x.x+h&&s>=x.y-h&&s<=x.y+h){return{gizmoIndex:l,handleIndex:y,angle:Math.atan2(f[2],f[3])}}}if(_<0){var z=h/(o.zoom*Math.sqrt(f[0]*f[0]+f[1]*f[1]));var w=h/(o.zoom*Math.sqrt(f[2]*f[2]+f[3]*f[3]));var P=e._transformPoint(a.x,a.y,e._invertMatrix(f));if(P.x>=c.x-z&&P.x<=c.x+c.width+z&&P.y>=c.y-w&&P.y<=c.y+c.height+w){_=l}}}return _<0?null:{gizmoIndex:_,handleIndex:-1}};i.prototype.hover=function(t){if(this._gizmo){var e=this._getGizmoHandle(t);if(e){this._gizmo._selectHandle(e.gizmoIndex,e.handleIndex)}else{this._gizmo._selectHandle(-1,-1)}}};i.prototype.beginGesture=function(t){this._handle=t.buttons===1&&this._getGizmoHandle(t)||null;if(this._handle){t.handled=true;this._gizmo._selectHandle(this._handle.gizmoIndex,this._handle.handleIndex);this._startPos=this._getPosition(t);this._gizmo._beginGesture()}};i.prototype.move=function(t){if(this._handle&&this._inside(t)){t.handled=true;var e=this._getPosition(t);this._gizmo._update(e.x-this._startPos.x,e.y-this._startPos.y,t.event&&(sap.ui.Device.os.macintosh?t.event.metaKey:t.event.ctrlKey))}};i.prototype.endGesture=function(t){if(this._handle){this._handle=null;t.handled=true;this._gizmo._endGesture()}};i.prototype.click=function(t){};i.prototype.doubleClick=function(t){};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var o=this._getOffset(i);this._rect={x:o.x,y:o.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});