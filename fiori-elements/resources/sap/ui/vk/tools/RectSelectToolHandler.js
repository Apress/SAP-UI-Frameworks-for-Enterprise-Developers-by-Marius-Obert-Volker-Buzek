/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.RectSelectToolHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","endGesture","move","click","doubleClick","contextMenu"]},constructor:function(t){this._tool=t;this._rect=null;this._gesture=false;this._nomenu=false;this._selectionRect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false};e.prototype.activate=function(t){this._deactivate=false;if(t._loco){this._viewport=t;t._loco.addHandler(this,1)}};e.prototype.deactivate=function(){if(this._gesture){this._deactivate=true}else if(this._viewport){this._deactivate=false;this._viewport._loco.removeHandler(this);this._viewport=null}};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};if(document.activeElement){try{document.activeElement.blur()}catch(t){}}i.focus();return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};e.prototype.beginGesture=function(t){if(t.n===1&&this._inside(t)&&!this._gesture){this._gesture=true;t.handled=true;var e=t.x-this._rect.x,i=t.y-this._rect.y;this._selectionRect={x1:e,y1:i,x2:e,y2:i};return}};e.prototype.move=function(t){if(this._gesture){t.handled=true;this._nomenu=true;if(this._selectionRect){this._selectionRect.x2=t.x-this._rect.x;this._selectionRect.y2=t.y-this._rect.y;if(this._viewport){this._viewport.setSelectionRect(this._selectionRect)}}}};e.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;if(this._selectionRect){if(this._viewport){var e=t.x-this._rect.x,i=t.y-this._rect.y;if(this._tool.isViewportType("sap.ui.vk.svg.Viewport")||this._tool.isViewportType("sap.ui.vk.dvl.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,e,i,null,null)}else if(this._tool.isViewportType("sap.ui.vk.threejs.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,e,i,this._viewport.getScene(),this._viewport.getCamera())}}this._viewport.setSelectionRect(null);this._selectionRect=null}if(this._deactivate){this.deactivate()}}};e.prototype.getViewport=function(){return this._viewport};return e});