/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./CreateParametricGizmo","../svg/Element","../svg/Text","sap/ui/richtexteditor/RichTextEditor"],function(t,e,o,i){"use strict";var r=t.extend("sap.ui.vk.tools.CreateTextToolGizmo",{metadata:{library:"sap.ui.vk"}});r.prototype.hasDomElement=function(){return true};r.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._editForm=null;this.updateParentNode()};r.prototype.hide=function(){this._viewport=null;this._tool=null;this._root=null;if(this._editForm){this._editForm.close();this._editForm=null}};r.prototype._createText=function(t,i){if(this._editForm){return}var r=1/this._viewport._camera.zoom;var n=e._multiplyMatrices(e._invertMatrix(this._root._matrixWorld()),[r,0,0,r,t.x,t.y]);var s=[1,0,0,n[3]<0?-1:1,0,0];if(n[3]<0){n[2]*=-1;n[3]*=-1}var a=new o({subelement:true,text:i,style:{size:this._tool.getFontSize(),fontFace:this._tool.getFontFace()},matrix:s,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});var l=new e({name:"Text",matrix:n});l.add(a);this._root.add(l);this._editText(a)};r.prototype._editText=function(t){var o=this.getDomRef();if(!o){this._editElementWhenReady=t;return}var r=e._transformPoint(t.x,t.y,t._matrixWorld());var n=this._viewport._camera._worldToScreen(r.x,r.y);o.style.left=n.x+"px";o.style.top=n.y+"px";var s=this._editForm=new sap.m.Popover({showHeader:false,placement:sap.m.PlacementType.PreferredLeftOrFlip,content:new sap.m.VBox({items:[new i({width:"500px",height:"200px",wrapping:false,customToolbar:true,showGroupUndo:true,showGroupFont:true,showGroupTextAlign:false,value:t.getHtmlTextContent(),change:function(e){t.setHtmlTextContent(this.getValue())},customButtons:[new sap.m.Button({text:"OK",press:function(){s.close()}})]}).addStyleClass("sapUiSizeCompact"),new sap.m.Button({text:"OK",press:function(){s.close()}})]})});s.attachAfterClose(function(){this._tool.fireCompleted({node:t.parent,request:this._createRequest(t.parent)});this._editForm=null}.bind(this));s.openBy(this)};r.prototype.onAfterRendering=function(){if(this._editElementWhenReady){this._editText(this._editElementWhenReady);this._editElementWhenReady=null}};return r});