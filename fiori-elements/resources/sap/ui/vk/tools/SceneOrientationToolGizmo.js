/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./Gizmo","sap/m/MenuButton","sap/m/Menu","sap/m/MenuItem","../thirdparty/three","./SceneOrientationToolGizmoRenderer","../getResourceBundle","./PredefinedView","./AxisColours"],function(e,t,i,a,n,r,s,o,l){"use strict";sap.ui.require("sap.m.Menu");var c=e.extend("sap.ui.vk.tools.SceneOrientationToolGizmo",{metadata:{library:"sap.ui.vk"}});function p(e,t){var i=64,a=.5,r=15,s=3,o=29,l=30;e.multiplyScalar(1/80);var c=new n.Vector3(e.y,e.z,e.x),p=new n.Vector3(e.z,e.x,e.y);var d=new n.MeshLambertMaterial({color:t}),h=new n.MeshBasicMaterial({color:16777215,transparent:true,opacity:.8}),m=new n.MeshBasicMaterial({color:0,transparent:true,opacity:.8});var u=new n.CylinderGeometry(a,a,i-r,4);var w=(new n.Matrix4).makeBasis(c,e,p).setPosition(e.clone().multiplyScalar((i-r)*.5));u.applyMatrix4(w);var _=new n.Mesh(u,d);var y=new n.CylinderGeometry(0,s,r,12,1);w.setPosition(e.clone().multiplyScalar(i-r*.5));y.applyMatrix4(w);_.add(new n.Mesh(y,d));var x=new n.CylinderGeometry(a,a,o,4);w.makeBasis(e,p,c).setPosition(p.clone().multiplyScalar(.5).add(e).multiplyScalar(o));x.applyMatrix4(w);_.add(new n.Mesh(x,h));x=new n.CylinderGeometry(a,a,o,4);w.setPosition(p.clone().multiplyScalar(.5).add(e).add(c).multiplyScalar(o));x.applyMatrix4(w);_.add(new n.Mesh(x,h));x=new n.CylinderGeometry(a,a,o,4);w.makeBasis(p,c,e).setPosition(c.clone().multiplyScalar(.5).add(e).multiplyScalar(o));x.applyMatrix4(w);_.add(new n.Mesh(x,h));x=new n.CylinderGeometry(a,a,l,4);w.makeBasis(e,p,c).setPosition(p.clone().multiplyScalar(.5).add(e).multiplyScalar(l));x.applyMatrix4(w);_.add(new n.Mesh(x,m));x=new n.CylinderGeometry(a,a,l,4);w.setPosition(p.clone().multiplyScalar(.5).add(e).add(c).multiplyScalar(l));x.applyMatrix4(w);_.add(new n.Mesh(x,m));x=new n.CylinderGeometry(a,a,l,4);w.makeBasis(p,c,e).setPosition(c.clone().multiplyScalar(.5).add(e).multiplyScalar(l));x.applyMatrix4(w);_.add(new n.Mesh(x,m));return _}c.prototype.init=function(){if(e.prototype.init){e.prototype.init.apply(this)}this._enableInitialView=true;this._viewport=null;this._renderer=new n.WebGLRenderer({antialias:true,alpha:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(1,1);this._camera=new n.OrthographicCamera(-1,1,1,-1,.1,100);this._scene=new n.Scene;var r=new n.DirectionalLight(16777215,.5);r.position.set(1,3,2);this._scene.add(r);this._scene.add(new n.AmbientLight(16777215,.5));this._scene.add(p(new n.Vector3(1,0,0),l.x));this._scene.add(p(new n.Vector3(0,1,0),l.y));this._scene.add(p(new n.Vector3(0,0,1),l.z));this._scene.traverse(function(e){e.matrixAutoUpdate=false});this._axisTitles=this._createAxisTitles(32,16);this._scene.add(this._axisTitles);var c=[o.Initial,o.Front,o.Back,o.Left,o.Right,o.Top,o.Bottom];this._menu=new i({items:[new a({text:s().getText("PREDEFINED_VIEW_INITIAL")}),new a({text:s().getText("PREDEFINED_VIEW_FRONT")}),new a({text:s().getText("PREDEFINED_VIEW_BACK")}),new a({text:s().getText("PREDEFINED_VIEW_LEFT")}),new a({text:s().getText("PREDEFINED_VIEW_RIGHT")}),new a({text:s().getText("PREDEFINED_VIEW_TOP")}),new a({text:s().getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(e){var t=e.getParameters("item").item;var i=e.getSource().indexOfItem(t);this.setView(c[i],1e3)},this);this._button=new t({icon:"sap-icon://vk-icons/predefined-views",tooltip:s().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:this._menu}).addStyleClass("sapUiVizKitSceneOrientationGizmoButton").addStyleClass("sapUiSizeCompact")};c.prototype.setView=function(e,t){var i;switch(e){case o.Initial:i=null;break;case o.Front:i=(new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),0);break;case o.Back:i=(new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),Math.PI);break;case o.Left:i=(new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),-Math.PI/2);break;case o.Right:i=(new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),Math.PI/2);break;case o.Top:i=(new n.Quaternion).setFromAxisAngle(new n.Vector3(1,0,0),-Math.PI/2);break;case o.Bottom:i=(new n.Quaternion).setFromAxisAngle(new n.Vector3(1,0,0),Math.PI/2);break;default:return this}this._viewport._viewportGestureHandler.setView(i,t||0);return this};c.prototype.setEnableInitialView=function(e){this._enableInitialView=e;var t=this._menu.getItems();t[0].setVisible(e);t[1].setStartsSection(e)};c.prototype.render=function(e){this._viewport=e;this._camera.quaternion.copy(e.getCamera().getCameraRef().quaternion);this._camera.position.set(0,0,1).applyQuaternion(this._camera.quaternion);var t=this._renderer.getSize(new n.Vector2).x;this._updateAxisTitles(this._axisTitles,this._scene,this._camera,t*.45,2/t);this._renderer.render(this._scene,this._camera)};c.prototype.onBeforeRendering=function(){};c.prototype.onAfterRendering=function(){var e=this.getDomRef();this._renderer.setSize(e.clientWidth,e.clientHeight);e.appendChild(this._renderer.domElement)};c.prototype.exit=function(){if(this._axisTitles){if(this._scene){this._scene.remove(this._axisTitles)}this._axisTitles=null}if(this._camera){if(this._scene){this._scene.remove(this._camera)}this._camera=null}this._scene=null;e.prototype.exit.call(this)};return c});