/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./RedlineElement","./Redline","sap/base/Log"],function(t,e,r){"use strict";var i=t.extend("sap.ui.vk.RedlineElementFreehand",{metadata:{library:"sap.ui.vk",properties:{path:{type:"float[]",defaultValue:null}}}});i.prototype.setPath=function(t){this.setProperty("path",t,true);var e=this.getDomRef();if(e){e.setAttribute("d",this._getProcessedPath())}};i.prototype.edit=function(t,e){var r=this.getParent();var i=r._toVirtualSpace(t,e);var s=this.getPath()||[];s.push(i.x-this.getOriginX(),i.y-this.getOriginY());this.setPath(s);var a=this.getDomRef();if(a){a.setAttribute("d",this._getProcessedPath())}return this};i.prototype.applyZoom=function(t){this.setProperty("path",this.getPath().map(function(e){return e*t}),true);return this};i.prototype._getProcessedPath=function(){var t=this.getParent(),e=t._toPixelSpace(this.getOriginX(),this.getOriginY());var r="";(this.getPath()||[]).forEach(function(i,s){i=t._toPixelSpace(i);if(s===0){r+="M "+(e.x+i)}else if(s===1){r+=" "+(e.y+i)}else{r+=" "+(s%2===0?"L "+(e.x+i):e.y+i)}});return r};i.prototype.renderElement=function(t,e){t.openStart("path",this);t.attr("d",this._getProcessedPath());t.attr("stroke",this.getStrokeColor());t.attr("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.attr("stroke-dasharray",this.getStrokeDashArray().toString())}t.attr("opacity",this.getOpacity());t.attr("fill","none");if(e){t.attr("filter",this._getHaloFilter())}t.openEnd();t.close("path")};i.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Freehand,version:1,path:(this.getPath()||[]).slice()})};i.prototype.importJSON=function(i){if(i.type===e.ElementType.Freehand){if(i.version===1){t.prototype.importJSON.call(this,i);if(i.hasOwnProperty("path")){this.setPath(i.path.slice())}}else{r.error("wrong version number")}}else{r.error("Redlining JSON import: Wrong element type")}return this};i.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"path");t.setAttribute("x",this.getOriginX());t.setAttribute("y",this.getOriginY());t.setAttribute("d",this.getPath());t.setAttribute("fill","none");t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());return t};i.prototype.importSVG=function(e){if(e.tagName==="path"){t.prototype.importSVG.call(this,e);if(e.getAttribute("d")){this.setPath(e.getAttribute("d").split(",").map(parseFloat))}}else{r.error("Redlining SVG import: Wrong element type")}return this};return i});